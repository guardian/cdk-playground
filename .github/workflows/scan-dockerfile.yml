name: Monitor container image

#This action should run only after publish.yml has run
on:
    workflow_run:
        workflows: ["Publish Docker image"]
        types:
            - completed
    workflow_dispatch:
            

jobs:
    security:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout branch
              uses: actions/checkout@v3

            - uses: snyk/actions/setup@0.3.0

            - name: Snyk monitor
              run: |
                projectTags="commit=${GITHUB_SHA}"

                snyk container monitor ghcr.io/guardian/cdk-playground:latest \
                  --org="guardian-test" \
                  -d \
                  --project-tags=${projectTags}
              env:
                  SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}