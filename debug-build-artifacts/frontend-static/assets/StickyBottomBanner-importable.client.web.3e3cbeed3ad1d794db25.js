"use strict";(self.webpackChunk_guardian_dotcom_rendering=self.webpackChunk_guardian_dotcom_rendering||[]).push([[9761],{76749:(e,n,t)=>{t.d(n,{QA:()=>g,Y_:()=>p,_Q:()=>f,rS:()=>h});var r=t(72762),i=t(61082),a=t(85770),o=t(9474);const s="gu.prefs.sign-in-gate",c=(e,n)=>"".concat(n,"-").concat(e),d=(e,n)=>"gate-dismissed-count-".concat(n,"-").concat(e),l=()=>{const e=i.I.local.get(s);return(0,a.G)(e)&&(n=e,Object.entries(n).every((e=>{let[n,t]=e;return(0,r.K)(n)&&["string","number"].includes(typeof t)})))?e:{};var n},u=e=>{i.I.local.set(s,e)},g=(e,n)=>{const t=l();t[c(e,n)]=(new Date).toISOString(),u(t)},p=(e,n,t)=>{const r=l()[c(e,n)];return(0,o.b)(t)?!(null==r):!(0,o.b)(r)&&"number"!=typeof r&&!((Date.now()-new Date(r).getTime())/36e5>=t&&(((e,n)=>{const t=l();delete t[c(e,n)],u(t)})(e,n),1))},m=(e,n)=>{const t=l()[d(e,n)];return"number"==typeof t&&t>0?t:0},h=(e,n,t)=>m(e,n)>t,f=(e,n)=>{const t=l();t[d(e,n)]=m(e,n)+1,u(t)}},28621:(e,n,t)=>{t.d(n,{ez:()=>P,fU:()=>O,xc:()=>B});var r=t(11733),i=t(52197),a=t(76749),o=t(15901);const s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;var n;const[t={}]=null!==(n=(0,o.L3)())&&void 0!==n?n:[],{count:r=0}=t;return r>=e},c=()=>{const e=navigator.userAgent,n=/(iPhone|iPod|iPad)/i.test(e),t=/(CPU OS 9_)/i.test(e);return n&&t},d=e=>["Article"].some((n=>e===n)),l=e=>!["about","info","membership","help","guardian-live-australia","gnm-archive"].some((n=>e===n)),u=e=>!["info/newsletter-sign-up"].some((n=>e.map((e=>e.id)).includes(n))),g={canShow:e=>{let{isSignedIn:n,currentTest:t,contentType:r,sectionId:i,tags:o,isPaidContent:g,isPreview:p}=e;return Promise.resolve(!n&&!(0,a.Y_)(t.variant,t.name)&&s(3)&&d(r)&&l(i)&&u(o)&&!g&&!p&&!c())}};var p=t(50484),m=t(88793),h=t(9474),f=t(67400),b=t(24017),w=t(58452);function v(){const e=(n=["\n\tdisplay: flex;\n\tflex-grow: 1;\n"],t||(t=n.slice(0)),Object.freeze(Object.defineProperties(n,{raw:{value:Object.freeze(t)}})));var n,t;return v=function(){return e},e}const y=(0,b.css)(v()),C=e=>{let{children:n,margin:t,disableFlexStyles:r}=e;const[i,a]=(0,w.E)({rootMargin:"".concat(t,"px")});if("function"!=typeof a)return null;const o=i||C.disabled;return(0,p.jsx)("div",{ref:a,css:!r&&y,children:o&&(0,p.jsx)(p.Fragment,{children:n})})};C.disabled=!1;const S=f.default.lazy((()=>{const{endPerformanceMeasure:e}=(0,m.h)("identity","SignInGateMain");return Promise.all([t.e(4684),t.e(9787)]).then(t.bind(t,95589)).then((n=>(e(),{default:n.SignInGateMain})))})),I=f.default.lazy((()=>{const{endPerformanceMeasure:e}=(0,m.h)("identity","SignInGateMainCheckoutComplete");return Promise.all([t.e(4684),t.e(6382)]).then(t.bind(t,35219)).then((n=>(e(),{default:n.SignInGateMainCheckoutComplete})))})),A={gate:e=>{let{ophanComponentId:n,dismissGate:t,guUrl:r,signInUrl:i,registerUrl:a,abTest:o,checkoutCompleteCookieData:s,personaliseSignInGateAfterCheckoutSwitch:c}=e;return(0,p.jsx)(C,{margin:300,children:(0,p.jsx)(f.Suspense,{fallback:(0,p.jsx)(p.Fragment,{}),children:c&&!(0,h.b)(s)?(0,p.jsx)(I,{ophanComponentId:n,dismissGate:t,guUrl:r,signInUrl:i,registerUrl:a,abTest:o,checkoutCompleteCookieData:s}):(0,p.jsx)(S,{ophanComponentId:n,dismissGate:t,guUrl:r,signInUrl:i,registerUrl:a,abTest:o})})})},canShow:e=>{let{isSignedIn:n,currentTest:t,contentType:r,sectionId:i,tags:o,isPaidContent:g,isPreview:p}=e;return Promise.resolve(!n&&!(0,a.rS)(t.variant,t.name,5)&&s(3)&&d(r)&&l(i)&&u(o)&&!g&&!p&&!c())}},B=[i.k,r.k],O={"main-control-5":g,"main-variant-5":A},P={SignInGateMainVariant:"main_variant_5",SignInGateMainControl:"main_control_5"}},96830:(e,n,t)=>{t.r(n),t.d(n,{StickyBottomBanner:()=>D});var r=t(50484),i=t(61082),a=t(72762),o=t(9092),s=t(9474),c=t(67400),d=t(99952),l=t(59820),u=t(14374),g=t(37438),p=t(75747),m=t(66743),h=t(53399),f=t(89810),b=t(15593),w=t(24017),v=t(50026),y=t(3002),C=t(70451),S=t(38169),I=t(82871),A=t(97656);function B(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function O(){const e=(n=["\n\tposition: fixed;\n\tbottom: -1px;\n\twidth: 100%;\n\tz-index: ",";\n"],t||(t=n.slice(0)),Object.freeze(Object.defineProperties(n,{raw:{value:Object.freeze(t)}})));var n,t;return O=function(){return e},e}const P=(0,w.css)(O(),(0,I.f)("banner")),k=e=>{let{BrazeComponent:n,meta:t,idApiUrl:i}=e;const a=(0,u.w)(),{renderingTarget:o}=(0,b.U)();(0,c.useEffect)((()=>{var e;t.logImpressionWithBraze(),(0,v.u_)({component:{componentType:"RETENTION_ENGAGEMENT_BANNER",id:null!==(e=t.dataFromBraze.ophanComponentId)&&void 0!==e?e:t.dataFromBraze.componentName},action:"VIEW"},o)}),[]);const s=t.dataFromBraze.componentName;if(!s)return null;const d=(0,S.w)(i);return(0,r.jsx)("div",{css:P,children:(0,r.jsx)(n,{logButtonClickWithBraze:t.logButtonClickWithBraze,submitComponentEvent:e=>{(0,v.u_)(e,o)},componentName:s,brazeMessageProps:t.dataFromBraze,subscribeToNewsletter:async e=>{if("SignedInWithCookies"==a.kind||"SignedInWithOkta"==a.kind){const n=(0,A.Kv)(a);await fetch("".concat(i,"/users/me/newsletters"),function(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){B(e,n,t[n])}))}return e}({method:"PATCH",body:JSON.stringify({id:e,subscribed:!0})},n))}},fetchEmail:d})})},j=e=>{let{meta:n,idApiUrl:i}=e;const[a,o]=(0,c.useState)();return(0,c.useEffect)((()=>{Promise.all([t.e(4684),t.e(2051)]).then(t.bind(t,82188)).then((e=>{o((()=>e.BrazeBannerComponent))})).catch((e=>window.guardian.modules.sentry.reportError(e,"braze-banner")))}),[]),(0,r.jsx)(r.Fragment,{children:a?(0,r.jsx)(k,{BrazeComponent:a,meta:n,idApiUrl:i}):(0,r.jsx)("div",{})})};var M=t(18411),E=t(29995),x=t(36226),T=t(15901),U=t(20522);function L(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function z(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){L(e,n,t[n])}))}return e}function R(){const e=(n=["\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\tz-index: ",";\n\t\t\t\t"],t||(t=n.slice(0)),Object.freeze(Object.defineProperties(n,{raw:{value:Object.freeze(t)}})));var n,t;return R=function(){return e},e}function G(e){if(!e)return;const n=E.cM.safeParse(JSON.parse(e));if(n.success)return n.data;{const e=n.error.message;window.guardian.modules.sentry.reportError(new Error(e),"rr-banner")}}const _=async e=>{let{remoteBannerConfig:n,isSignedIn:t,countryCode:r,contentType:i,sectionId:a,shouldHideReaderRevenue:s,isMinuteArticle:c,isPaidContent:d,isSensitive:l,tags:u,contributionsServiceUrl:g,engagementBannerLastClosedAt:p,subscriptionBannerLastClosedAt:m,signInBannerLastClosedAt:h,abandonedBasketBannerLastClosedAt:f,isPreview:b,idApiUrl:w,signInGateWillShow:v,asyncArticleCounts:y,isAndroidWebview:C}=e;if(!n)return{show:!1};if(C)return{show:!1};if(s||d||b||v)return{show:!1};const I=(0,x.h3)(t);if("Pending"===I)return{show:!1};const A=(0,x.q6)()&&!t&&!h,B=window.location.search.includes("force-banner");if(!A&&!B){if((0,x.tZ)(p)||(0,x.tZ)(m))return{show:!1};if(p&&m&&(0,x.n8)())return{show:!1}}const O=await(0,o.GD)().then((e=>{let{canTarget:n}=e;return n})).catch((()=>!1)),P=await(0,x.Jj)(),k=await(async e=>{let{isSignedIn:n,shouldHideReaderRevenue:t,isPaidContent:r,engagementBannerLastClosedAt:i,subscriptionBannerLastClosedAt:a,signInBannerLastClosedAt:o,abandonedBasketBannerLastClosedAt:s,countryCode:c,optedOutOfArticleCount:d,asyncArticleCounts:l,sectionId:u,tags:g,contentType:p,userConsent:m,hideSupportMessagingForUser:h}=e;const f=await l,b=null==f?void 0:f.weeklyArticleHistory,w=(e=>{const n=null==e?void 0:e.dailyArticleHistory[0];if(n)return n.day===(0,T.Gq)()?n.count:0})(f),v=(0,M.R)({name:"bwid",shouldMemoize:!0});return{tracking:{ophanPageId:window.guardian.config.ophan.pageViewId,platformId:"GUARDIAN_WEB",clientName:"dcr",referrerUrl:window.location.origin+window.location.pathname},targeting:{shouldHideReaderRevenue:t,isPaidContent:r,showSupportMessaging:!h,engagementBannerLastClosedAt:i,subscriptionBannerLastClosedAt:a,signInBannerLastClosedAt:o,abandonedBasketBannerLastClosedAt:s,mvtId:Number((0,M.R)({name:"GU_mvt_id",shouldMemoize:!0})),countryCode:c,weeklyArticleHistory:b,articleCountToday:w,hasOptedOutOfArticleCount:d,sectionId:u,tagIds:g.map((e=>e.id)),contentType:p,browserId:await(0,x.Xr)()&&null!=v?v:void 0,purchaseInfo:(0,x.q6)(),isSignedIn:n,hasConsented:m,abandonedBasket:G((0,M.R)({name:"GU_CO_INCOMPLETE",shouldMemoize:!0}))}}})({isSignedIn:t,countryCode:r,contentType:i,sectionId:a,shouldHideReaderRevenue:s,isMinuteArticle:c,isPaidContent:d,tags:u,contributionsServiceUrl:g,isSensitive:l,engagementBannerLastClosedAt:p,subscriptionBannerLastClosedAt:m,signInBannerLastClosedAt:h,abandonedBasketBannerLastClosedAt:f,optedOutOfArticleCount:P,asyncArticleCounts:y,userConsent:O,hideSupportMessagingForUser:I}),j=await(0,E.j$)(g,k);if(!j.data)return p&&m&&(0,x._f)(),{show:!1};const{module:U,meta:L}=j.data;return{show:!0,meta:{module:U,meta:L,fetchEmail:t?(0,S.w)(w):void 0}}},N=e=>{let{module:n,fetchEmail:i}=e;const[a,o]=(0,c.useState)(null);return(0,c.useEffect)((()=>{(0,U.q)(),("SignInPromptBanner"===n.name?Promise.all([t.e(4684),t.e(9735),t.e(1262),t.e(1714)]).then(t.bind(t,91714)):Promise.all([t.e(4684),t.e(8920),t.e(6398),t.e(9766),t.e(1908),t.e(1262),t.e(7460),t.e(5550)]).then(t.bind(t,15550))).then((e=>{o((()=>{var t;return null!==(t=e[n.name])&&void 0!==t?t:null}))})).catch((e=>{const n="Error importing RR banner: ".concat(String(e));window.guardian.modules.sentry.reportError(new Error(n),"rr-banner")}))}),[n]),null!==a?(0,r.jsx)("div",{css:(0,w.css)(R(),(0,I.f)("banner")),children:(0,r.jsx)(a,(s=z({},n.props),d={submitComponentEvent:v.u_,fetchEmail:i},d=null!=d?d:{},Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(d)):function(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t.push.apply(t,r)}return t}(Object(d)).forEach((function(e){Object.defineProperty(s,e,Object.getOwnPropertyDescriptor(d,e))})),s))}):null;var s,d},W=e=>{let{meta:n,module:t,fetchEmail:i}=e;return(0,r.jsx)(N,{componentTypeName:"ACQUISITIONS_SUBSCRIPTIONS_BANNER",displayEvent:"subscription-banner : display",meta:n,module:t,fetchEmail:i})},H=e=>{const n=i.I.local.get("gu.prefs.".concat(e));return(0,a.K)(n)?n:void 0},F=(e,n,t,i,a)=>({candidate:{id:"braze-banner",canShow:()=>(async(e,n,t,r)=>{const i=(0,y.B)();if(i)return{show:!0,meta:i};if(r)return{show:!1};if((0,C.O)(t))return{show:!1};try{const t=await e.getMessageForBanner(n),r=e=>{t.logButtonClick(e)},i=()=>{t.logImpression()};return t.extras?{show:!0,meta:{dataFromBraze:t.extras,logImpressionWithBraze:i,logButtonClickWithBraze:r}}:{show:!1}}catch(e){return{show:!1}}})(e,n,i,a),show:e=>()=>(0,r.jsx)(j,{meta:e,idApiUrl:t})},timeoutMillis:2e3}),D=e=>{let{contentType:n,sectionId:t,tags:i,isPaidContent:a,isPreview:w,shouldHideReaderRevenue:v,isMinuteArticle:y,isSensitive:C,contributionsServiceUrl:S,idApiUrl:I,pageId:A,remoteBannerSwitch:B}=e;const{renderingTarget:O}=(0,b.U)(),{brazeMessages:P}=(0,g.m)(I,O),k=(0,p.F)("sticky-bottom-banner"),j=(0,u.T)(),[M,E]=(0,c.useState)(null),[x,T]=(0,c.useState)(),U=(e=>{let{isSignedIn:n,contentType:t,sectionId:r,tags:i,isPaidContent:a,isPreview:o,currentLocaleCode:s}=e;const[d,l]=(0,c.useState)(void 0),[u,g]=(0,c.useState)(void 0),[p,m]=(0,c.useState)(!1),b=(0,f.M)();return(0,h.H)((()=>{const[e,n]=b;l(e),g(n)}),[b]),(0,c.useEffect)((()=>{d&&u&&d.canShow({isSignedIn:!!n,currentTest:u,contentType:t,sectionId:r,tags:i,isPaidContent:a,isPreview:o,currentLocaleCode:s}).then(m)}),[u,d,n,t,r,i,a,o,s]),p&&!!d&&!!d.gate})({isSignedIn:!0===j,contentType:n,sectionId:t,tags:i,isPaidContent:a,isPreview:w,currentLocaleCode:k}),L=!!(0,m.J)();return(0,c.useEffect)((()=>{T((0,d.r2)(A,i,n))}),[n,i,A]),(0,c.useEffect)((()=>{if((0,s.b)(k)||(0,s.b)(j)||(0,s.b)(P)||(0,s.b)(x)||(0,s.b)(U)||"Pending"===j)return;const e={candidate:{id:"cmpUi",canShow:()=>o.r2.willShowPrivacyMessage().then((e=>e?{show:!0,meta:void 0}:{show:!1})),show:()=>null},timeoutMillis:null},c=(e=>{let{id:n,BannerComponent:t,canShowFn:i,isEnabled:a}=e;return e=>{let{isSignedIn:o,countryCode:s,isPreview:c,asyncArticleCounts:d,signInGateWillShow:l=!1,contentType:u,sectionId:g,shouldHideReaderRevenue:p,isMinuteArticle:m,isPaidContent:h,isSensitive:f,tags:b,contributionsServiceUrl:w,idApiUrl:v,isAndroidWebview:y}=e;return{candidate:{id:n,canShow:()=>i({remoteBannerConfig:a,isSignedIn:o,countryCode:s,contentType:u,sectionId:g,shouldHideReaderRevenue:p,isMinuteArticle:m,isPaidContent:h,isSensitive:f,tags:b,contributionsServiceUrl:w,engagementBannerLastClosedAt:H("engagementBannerLastClosedAt"),subscriptionBannerLastClosedAt:H("subscriptionBannerLastClosedAt"),signInBannerLastClosedAt:H("signInBannerLastClosedAt"),abandonedBasketBannerLastClosedAt:H("abandonedBasketLastClosedAt"),isPreview:c,idApiUrl:v,signInGateWillShow:l,asyncArticleCounts:d,isAndroidWebview:y}),show:e=>{let{meta:n,module:i,fetchEmail:a}=e;return()=>(0,r.jsx)(t,{meta:n,module:i,fetchEmail:a})}},timeoutMillis:2e3}}})({id:"reader-revenue-banner",BannerComponent:W,canShowFn:_,isEnabled:B})({isSignedIn:j,countryCode:k,isPreview:w,asyncArticleCounts:x,signInGateWillShow:U,contentType:n,sectionId:t,shouldHideReaderRevenue:v,isMinuteArticle:y,isPaidContent:a,isSensitive:C,tags:i,contributionsServiceUrl:S,idApiUrl:I,isAndroidWebview:L}),d={candidates:[e,F(P,{section:t},I,i,v),c],name:"banner"};(0,l.h)(d,O).then((e=>E(e))).catch((e=>console.error("StickyBottomBanner pickMessage - error: ".concat(String(e)))))}),[j,k,P,x,n,S,I,L,y,a,w,C,B,O,t,v,U,i]),M?(0,r.jsx)(M,{}):null}},11733:(e,n,t)=>{t.d(n,{k:()=>r});const r={id:"SignInGateMainControl",start:"2020-05-20",expiry:"2025-12-01",author:"Mahesh Makani",description:"Show sign in gate to 100% of users on 3rd article view of simple article templates, and show a further 5 times after the first dismissal, with higher priority over banners and epic. Control Audience.",audience:.1,audienceOffset:.9,successMeasure:"N/A - User does not see gate, only to compare to variant.",audienceCriteria:"3rd article of the day, lower priority than consent banner, simple articles (not gallery, live etc.), not signed in, not shown after dismiss, not on help, info sections etc. Exclude iOS 9 and guardian-live-australia. Suppresses other banners, and appears over epics",dataLinkNames:"SignInGateMain",idealOutcome:"Increase the number of users signed in whilst running at a reasonable scale",showForSensitive:!1,canRun:()=>!0,variants:[{id:"main-control-5",test:()=>{}}]}},52197:(e,n,t)=>{t.d(n,{k:()=>r});const r={id:"SignInGateMainVariant",start:"2020-06-09",expiry:"2025-12-01",author:"Mahesh Makani",description:"Show sign in gate to 100% of users on 3rd article view of simple article templates, and show a further 5 times after the first dismissal, with higher priority over banners and epic. Main/Variant Audience.",audience:.9,audienceOffset:0,successMeasure:"Users sign in or create a Guardian account",audienceCriteria:"3rd article of the day, lower priority than consent banner, simple articles (not gallery, live etc.), not signed in, not shown after dismiss, not on help, info sections etc. Exclude iOS 9 and guardian-live-australia. Suppresses other banners, and appears over epics",dataLinkNames:"SignInGateMain",idealOutcome:"Increase the number of users signed in whilst running at a reasonable scale",showForSensitive:!1,canRun:()=>!0,variants:[{id:"main-variant-5",test:()=>{}}]}},82871:(e,n,t)=>{t.d(n,{f:()=>i});const r=["lightbox","youTubeFullscreen","sticky-video-button","sticky-video","banner","dropdown","burger","mastheadVeggieBurgerExpandedMobile","expanded-veggie-menu-wrapper","expanded-veggie-menu","fullPageInteractiveHeaderWrapper","mobileSticky","stickyAdWrapperLabsHeader","stickyAdWrapper","stickyAdWrapperNav","mastheadMyAccountDropdown","mastheadEditionDropdown","editionDropdown","summaryDetails","toast","onwardsCarousel","myAccountDropdown","searchHeaderLink","TheGuardian","editionSwitcherBanner","expandableMarketingCardOverlay","tableOfContents","articleHeadline","immersiveBlackBox","bodyArea","rightColumnArea","mainMedia","card-nested-link","card-link"],i=e=>{const n=r.indexOf(e);return-1===n?-1:r.length-n}},67061:(e,n,t)=>{t.d(n,{H:()=>s,z:()=>c});var r=t(29273),i=t(53994);const a=new Promise((()=>{})),o="ab-tests",s=()=>{const{data:e}=(0,i.A)(o,(()=>a));return e},c=e=>{let{api:n,participations:t}=e;(0,r.Tk)(o,{api:n,participations:t},!1)}},66743:(e,n,t)=>{t.d(n,{J:()=>a});var r=t(67400),i=t(15593);const a=()=>{const{renderingTarget:e}=(0,i.U)(),[n,t]=(0,r.useState)("Web"!==e&&void 0);return(0,r.useEffect)((()=>{if("Web"===e)return t(!1);t((()=>/android/i.test(window.navigator.userAgent)))}),[e]),n}},89810:(e,n,t)=>{t.d(n,{M:()=>a});var r=t(28621),i=t(67061);const a=()=>{var e;const n=null===(e=(0,i.H)())||void 0===e?void 0:e.api;if(!n)return;const t=n.firstRunnableTest(r.xc);if(!t)return[null,null];var a;const o={name:null!==(a=t.dataLinkNames)&&void 0!==a?a:t.id,variant:t.variantToRun.id,id:t.id},s=r.fU[o.variant];return s?[s,o]:[null,null]}}}]);
//# sourceMappingURL=StickyBottomBanner-importable.client.web.3e3cbeed3ad1d794db25.js.map