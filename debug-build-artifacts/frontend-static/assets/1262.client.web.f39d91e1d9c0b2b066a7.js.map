{"version":3,"file":"1262.client.web.f39d91e1d9c0b2b066a7.js","mappings":"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","sources":["webpack://@guardian/dotcom-rendering/./src/components/marketing/lib/articleCountOptOut.ts","webpack://@guardian/dotcom-rendering/./src/components/marketing/shared/ArticleCountOptOutOverlay.tsx","webpack://@guardian/dotcom-rendering/./src/components/marketing/shared/ArticleCountOptOutPopup.tsx","webpack://@guardian/dotcom-rendering/./src/components/marketing/lib/replaceArticleCount.tsx","webpack://@guardian/dotcom-rendering/./src/components/marketing/lib/tracking.ts"],"sourcesContent":["/**\n * @file\n * This file was migrated from:\n * https://github.com/guardian/support-dotcom-components/blob/9c3eae7cb0b159db4a1c40679d6b37710b0bb937/packages/modules/src/modules/shared/helpers/articleCountOptOut.ts\n */\nimport { getCookie, removeCookie, setCookie, storage } from '@guardian/libs';\n\nconst ARTICLE_COUNT_OPT_OUT_COOKIE = {\n\tname: 'gu_article_count_opt_out',\n\tdaysToLive: 90,\n};\n\nconst DAILY_ARTICLE_COUNT_STORAGE_KEY = 'gu.history.dailyArticleCount';\nconst WEEKLY_ARTICLE_COUNT_STORAGE_KEY = 'gu.history.weeklyArticleCount';\nconst ARTICLES_THIS_WEEK_STORAGE_KEY = 'gu.history.articleCountsThisWeek';\n\nexport const addArticleCountOptOutCookie = (): void =>\n\tsetCookie({\n\t\tname: ARTICLE_COUNT_OPT_OUT_COOKIE.name,\n\t\tvalue: new Date().getTime().toString(),\n\t\tdaysToLive: ARTICLE_COUNT_OPT_OUT_COOKIE.daysToLive,\n\t});\n\nexport const removeArticleCountOptOutCookie = (): void =>\n\tremoveCookie({ name: ARTICLE_COUNT_OPT_OUT_COOKIE.name });\n\nexport const removeArticleCountFromLocalStorage = (): void => {\n\tstorage.local.remove(DAILY_ARTICLE_COUNT_STORAGE_KEY);\n\tstorage.local.remove(WEEKLY_ARTICLE_COUNT_STORAGE_KEY);\n\tstorage.local.remove(ARTICLES_THIS_WEEK_STORAGE_KEY);\n};\n\nexport const hasArticleCountOptOutCookie = (): boolean =>\n\t!!getCookie({ name: ARTICLE_COUNT_OPT_OUT_COOKIE.name });\n","/**\n * @file\n * This file was migrated from:\n * https://github.com/guardian/support-dotcom-components/blob/9c3eae7cb0b159db4a1c40679d6b37710b0bb937/packages/modules/src/modules/shared/ArticleCountOptOutOverlay.tsx\n */\nimport type { SerializedStyles } from '@emotion/react';\nimport { css, ThemeProvider } from '@emotion/react';\nimport {\n\tbackground,\n\tbrandAltBackground,\n\tbrandAltLine,\n\tbrandAltText,\n\tfrom,\n\tpalette,\n\tspace,\n\ttextSans14,\n\ttextSans17,\n} from '@guardian/source/foundations';\nimport {\n\tButton,\n\tbuttonThemeBrand,\n\tbuttonThemeBrandAlt,\n\tbuttonThemeDefault,\n\tSvgCross,\n} from '@guardian/source/react-components';\nimport type { ReactComponent } from '../lib/ReactComponent';\nimport type { ArticleCountOptOutType } from './ArticleCountOptOutPopup';\n\nconst { brand, neutral } = palette;\n\nconst COLOURS = {\n\tepic: 'white',\n\tbanner: brandAltText.primary,\n\t['investigations-moment-banner']: neutral[0],\n\t['us-eoy-moment-banner']: neutral[0],\n\t['global-new-year-moment-banner']: neutral[0],\n\t['election-au-moment-banner']: neutral[0],\n};\n\nconst BACKGROUND_COLOURS = {\n\tepic: brand[400],\n\tbanner: brandAltBackground.primary,\n\t['investigations-moment-banner']: neutral[100],\n\t['us-eoy-moment-banner']: '#FFEEDB',\n\t['global-new-year-moment-banner']: '#F79E1B',\n\t['election-au-moment-banner']: '#e4e4e3',\n};\n\nconst BORDER_COLOURS = {\n\tepic: 'transparent',\n\tbanner: brandAltLine.primary,\n\t['investigations-moment-banner']: neutral[0],\n\t['us-eoy-moment-banner']: neutral[0],\n\t['global-new-year-moment-banner']: neutral[0],\n\t['election-au-moment-banner']: neutral[0],\n};\n\nconst BUTTON_THEMES = {\n\tepic: buttonThemeBrand,\n\tbanner: buttonThemeBrandAlt,\n\t['investigations-moment-banner']: buttonThemeDefault,\n\t['us-eoy-moment-banner']: buttonThemeDefault,\n\t['global-new-year-moment-banner']: buttonThemeDefault,\n\t['election-au-moment-banner']: buttonThemeDefault,\n};\n\nconst overlayContainer = (\n\ttype: ArticleCountOptOutType,\n): SerializedStyles => css`\n\tcolor: ${COLOURS[type]};\n\tbackground: ${BACKGROUND_COLOURS[type]};\n\tborder: 1px solid ${BORDER_COLOURS[type]};\n\t${textSans17}\n\tpadding: ${space[2]}px;\n\tbox-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);\n`;\n\nconst overlayHeader = css`\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: space-between;\n`;\n\nconst overlayHeaderText = css`\n\tfont-size: 17px;\n\tfont-weight: bold;\n`;\n\nconst overlayBody = css`\n\tmargin-top: ${space[1]}px;\n\tfont-size: 15px;\n`;\n\nconst overlayCtaContainer = css`\n\tmargin-top: ${space[3]}px;\n\tdisplay: flex;\n\tflex-direction: row;\n\n\t> * + * {\n\t\tmargin-left: ${space[2]}px;\n\t}\n\n\t${from.tablet} {\n\t\t> * + * {\n\t\t\tmargin-left: ${space[3]}px;\n\t\t}\n\t}\n`;\n\nconst NOTE_LINK_COLOURS = {\n\tepic: neutral[100],\n\tbanner: brandAltText.primary,\n\t['investigations-moment-banner']: neutral[0],\n\t['us-eoy-moment-banner']: neutral[0],\n\t['global-new-year-moment-banner']: neutral[0],\n\t['election-au-moment-banner']: neutral[0],\n};\n\nconst BUTTON_OVERRIDES = {\n\tepic: css``,\n\tbanner: css``,\n\t['investigations-moment-banner']: css`\n\t\tbackground-color: ${palette.neutral[100]};\n\t\tcolor: ${palette.neutral[0]};\n\t\tborder: 1px solid ${palette.neutral[0]};\n\n\t\t&:hover {\n\t\t\tbackground-color: ${palette.neutral[86]};\n\t\t}\n\t`,\n\t['us-eoy-moment-banner']: css`\n\t\tcolor: ${palette.neutral[7]};\n\t\tborder: 1px solid ${palette.neutral[7]};\n\n\t\t&:hover {\n\t\t\tbackground-color: ${palette.culture[350]};\n\t\t\tcolor: ${palette.neutral[100]};\n\t\t\tborder: 1px solid ${palette.culture[350]};\n\t\t}\n\t`,\n\t['global-new-year-moment-banner']: css`\n\t\tcolor: ${palette.neutral[7]};\n\t\tborder: 1px solid ${palette.neutral[7]};\n\n\t\t&:hover {\n\t\t\tbackground-color: ${palette.brand[500]};\n\t\t\tcolor: ${palette.neutral[100]};\n\t\t\tborder: 1px solid ${palette.brand[500]};\n\t\t}\n\t`,\n\t['election-au-moment-banner']: css`\n\t\tcolor: ${palette.neutral[7]};\n\t\tborder: 1px solid ${palette.neutral[7]};\n\n\t\t&:hover {\n\t\t\tbackground-color: ${palette.brand[500]};\n\t\t\tcolor: ${palette.neutral[100]};\n\t\t\tborder: 1px solid ${palette.brand[500]};\n\t\t}\n\t`,\n};\n\nconst PRIMARY_BUTTON_OVERRIDES = {\n\tepic: css``,\n\tbanner: css``,\n\t['investigations-moment-banner']: css`\n\t\tbackground-color: ${palette.neutral[0]};\n\t\tcolor: ${palette.neutral[100]};\n\t\tborder: 1px solid ${palette.neutral[0]};\n\n\t\t&:hover {\n\t\t\tbackground-color: ${palette.neutral[46]};\n\t\t\tborder-color: ${palette.neutral[46]};\n\t\t}\n\t`,\n\t['us-eoy-moment-banner']: css`\n\t\tbackground-color: ${palette.neutral[7]};\n\t\tcolor: ${palette.neutral[100]};\n\t\tborder: 1px solid ${palette.neutral[7]};\n\n\t\t&:hover {\n\t\t\tbackground-color: ${palette.culture[350]};\n\t\t\tcolor: ${palette.neutral[100]};\n\t\t\tborder: 1px solid ${palette.culture[350]};\n\t\t}\n\t`,\n\t['global-new-year-moment-banner']: css`\n\t\tbackground-color: ${palette.neutral[0]};\n\t\tcolor: ${palette.neutral[100]};\n\t\tborder: 1px solid ${palette.neutral[0]};\n\n\t\t&:hover {\n\t\t\tbackground-color: ${palette.brand[500]};\n\t\t\tcolor: ${palette.neutral[100]};\n\t\t\tborder: 1px solid ${palette.brand[500]};\n\t\t}\n\t`,\n\t['election-au-moment-banner']: css`\n\t\tbackground-color: ${palette.neutral[0]};\n\t\tcolor: ${palette.neutral[100]};\n\t\tborder: 1px solid ${palette.neutral[0]};\n\n\t\t&:hover {\n\t\t\tbackground-color: ${background.ctaPrimaryHover};\n\t\t\tcolor: ${palette.neutral[100]};\n\t\t\tborder: 1px solid ${background.ctaPrimaryHover};\n\t\t}\n\t`,\n};\n\nconst overlayNote = (type: ArticleCountOptOutType): SerializedStyles => css`\n\tmargin-top: ${space[2]}px;\n\t${textSans14}\n\tfont-style: italic;\n\n\ta {\n\t\t/* stylelint-disable-next-line declaration-no-important */\n\t\tcolor: ${NOTE_LINK_COLOURS[type]} !important;\n\t\t/* stylelint-disable-next-line declaration-no-important */\n\t\ttext-decoration: underline !important;\n\t}\n`;\n\nexport interface ArticleCountOptOutOverlayProps {\n\ttype: ArticleCountOptOutType;\n\thasOptedOut: boolean;\n\tonOptOut: () => void;\n\tonClose: () => void;\n}\n\nexport const ArticleCountOptOutOverlay: ReactComponent<\n\tArticleCountOptOutOverlayProps\n> = ({\n\ttype,\n\thasOptedOut,\n\tonClose,\n\tonOptOut,\n}: ArticleCountOptOutOverlayProps) => {\n\treturn (\n\t\t<div css={overlayContainer(type)}>\n\t\t\t<div css={overlayHeader}>\n\t\t\t\t<div css={overlayHeaderText}>\n\t\t\t\t\t{hasOptedOut ? \"You've opted out\" : \"What's this?\"}\n\t\t\t\t</div>\n\t\t\t\t<ThemeProvider theme={BUTTON_THEMES[type]}>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tonClick={onClose}\n\t\t\t\t\t\tcssOverrides={BUTTON_OVERRIDES[type]}\n\t\t\t\t\t\ticon={<SvgCross />}\n\t\t\t\t\t\thideLabel={true}\n\t\t\t\t\t\tsize=\"xsmall\"\n\t\t\t\t\t\tpriority=\"tertiary\"\n\t\t\t\t\t>\n\t\t\t\t\t\tClose\n\t\t\t\t\t</Button>\n\t\t\t\t</ThemeProvider>\n\t\t\t</div>\n\n\t\t\t<div css={overlayBody}>\n\t\t\t\t{hasOptedOut\n\t\t\t\t\t? \"Starting from your next page view, we won't count the articles you read or show you this message for three months.\"\n\t\t\t\t\t: 'We would like to remind you how many Guardian articles you’ve enjoyed on this device. Can we continue showing you this?'}\n\t\t\t</div>\n\n\t\t\t{!hasOptedOut && (\n\t\t\t\t<div css={overlayCtaContainer}>\n\t\t\t\t\t<ThemeProvider theme={BUTTON_THEMES[type]}>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tonClick={onClose}\n\t\t\t\t\t\t\tcssOverrides={PRIMARY_BUTTON_OVERRIDES[type]}\n\t\t\t\t\t\t\tpriority=\"primary\"\n\t\t\t\t\t\t\tsize=\"xsmall\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tYes, that&apos;s OK\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</ThemeProvider>\n\t\t\t\t\t<ThemeProvider theme={BUTTON_THEMES[type]}>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tonClick={onOptOut}\n\t\t\t\t\t\t\tcssOverrides={BUTTON_OVERRIDES[type]}\n\t\t\t\t\t\t\tpriority=\"tertiary\"\n\t\t\t\t\t\t\tsize=\"xsmall\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tNo, opt me out\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</ThemeProvider>\n\t\t\t\t</div>\n\t\t\t)}\n\n\t\t\t<div css={overlayNote(type)}>\n\t\t\t\t{hasOptedOut ? (\n\t\t\t\t\t<span>\n\t\t\t\t\t\tIf you have any questions, please{' '}\n\t\t\t\t\t\t<a href=\"https://www.theguardian.com/help/contact-us\">\n\t\t\t\t\t\t\tcontact us.\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</span>\n\t\t\t\t) : (\n\t\t\t\t\t\"Please note that opting out is a permanent action and can't be reversed\"\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","/**\n * @file\n * This file was migrated from:\n * https://github.com/guardian/support-dotcom-components/blob/9c3eae7cb0b159db4a1c40679d6b37710b0bb937/packages/modules/src/modules/shared/ArticleCountOptOutPopup.tsx\n */\nimport type { SerializedStyles } from '@emotion/react';\nimport { css } from '@emotion/react';\nimport type { OphanComponentEvent, OphanComponentType } from '@guardian/libs';\nimport { from, space } from '@guardian/source/foundations';\nimport { useEffect, useState } from 'react';\nimport { useIsInView } from '../../../lib/useIsInView';\nimport {\n\taddArticleCountOptOutCookie,\n\tremoveArticleCountFromLocalStorage,\n} from '../lib/articleCountOptOut';\nimport type { ReactComponent } from '../lib/ReactComponent';\nimport { ArticleCountOptOutOverlay } from './ArticleCountOptOutOverlay';\n\nconst OPHAN_COMPONENT_ID_OPT_OUT_VIEW = 'article-count-opt-out-view';\nconst OPHAN_COMPONENT_ID_OPT_OUT_OPEN = 'article-count-opt-out-open';\nconst OPHAN_COMPONENT_ID_OPT_OUT_CLOSE = 'article-count-opt-out-close';\nconst OPHAN_COMPONENT_ID_OPT_OUT_CONFIRM = 'article-count-opt-out-confirm';\n\nexport const ophanComponentEventOptOutView = (\n\tcomponentType: OphanComponentType,\n): OphanComponentEvent => ({\n\tcomponent: {\n\t\tcomponentType: 'ACQUISITIONS_OTHER',\n\t\tid: OPHAN_COMPONENT_ID_OPT_OUT_VIEW,\n\t},\n\taction: 'VIEW',\n\tvalue: `article-count-opt-out-popup-${componentType}`,\n});\n\nexport const ophanComponentEventOptOutOpen = (\n\tcomponentType: OphanComponentType,\n): OphanComponentEvent => ({\n\tcomponent: {\n\t\tcomponentType: 'ACQUISITIONS_OTHER',\n\t\tid: OPHAN_COMPONENT_ID_OPT_OUT_OPEN,\n\t},\n\taction: 'CLICK',\n\tvalue: `article-count-opt-out-popup-${componentType}`,\n});\n\nexport const ophanComponentEventOptOutClose = (\n\tcomponentType: OphanComponentType,\n): OphanComponentEvent => ({\n\tcomponent: {\n\t\tcomponentType: 'ACQUISITIONS_OTHER',\n\t\tid: OPHAN_COMPONENT_ID_OPT_OUT_CLOSE,\n\t},\n\taction: 'CLICK',\n\tvalue: `article-count-opt-out-popup-${componentType}`,\n});\n\nexport const ophanComponentEventOptOutConfirm = (\n\tcomponentType: OphanComponentType,\n): OphanComponentEvent => ({\n\tcomponent: {\n\t\tcomponentType: 'ACQUISITIONS_OTHER',\n\t\tid: OPHAN_COMPONENT_ID_OPT_OUT_CONFIRM,\n\t},\n\taction: 'CLICK',\n\tvalue: `article-count-opt-out-popup-${componentType}`,\n});\n\nexport type ArticleCountOptOutType =\n\t| 'epic'\n\t| 'banner'\n\t| 'investigations-moment-banner'\n\t| 'us-eoy-moment-banner'\n\t| 'global-new-year-moment-banner'\n\t| 'election-au-moment-banner';\nconst isBanner = (type: ArticleCountOptOutType): boolean =>\n\ttype === 'banner' ||\n\ttype === 'investigations-moment-banner' ||\n\ttype === 'us-eoy-moment-banner' ||\n\ttype === 'global-new-year-moment-banner' ||\n\ttype === 'election-au-moment-banner';\n\nconst optOutContainer = (type: ArticleCountOptOutType): SerializedStyles => css`\n\tdisplay: inline-block;\n\n\t${from.tablet} {\n\t\t${!isBanner(type) ? 'position: relative;' : ''}\n\t}\n`;\n\nconst articleCountButton = css`\n\tbackground: none;\n\tborder: none;\n\tpadding: 0;\n\tcursor: pointer;\n\tborder-bottom: 1px solid;\n\t/* stylelint-disable-next-line property-disallowed-list */\n\tfont-family: inherit;\n\tfont-size: inherit;\n\tfont-weight: inherit;\n\tfont-style: inherit;\n\tcolor: inherit;\n\t&:focus {\n\t\t/* stylelint-disable-next-line declaration-no-important */\n\t\toutline: none !important;\n\t}\n`;\n\nconst overlayContainer = (\n\ttype: ArticleCountOptOutType,\n): SerializedStyles => css`\n\tposition: absolute;\n\tz-index: 100;\n\t${isBanner(type)\n\t\t? css`\n\t\t\t\ttop: 0px;\n\t\t\t\tleft: 0px;\n\t\t  `\n\t\t: css`\n\t\t\t\tleft: ${space[4]}px;\n\t\t\t\tright: ${space[4]}px;\n\t\t\t\t${isBanner(type) ? 'bottom: 21px;' : ''}\n\t\t  `}\n\tdisplay: block;\n\n\t${from.tablet} {\n\t\t${isBanner(type)\n\t\t\t? css`\n\t\t\t\t\ttop: 10px;\n\t\t\t\t\tleft: 10px;\n\t\t\t\t\twidth: 450px;\n\t\t\t  `\n\t\t\t: css`\n\t\t\t\t\twidth: 400px;\n\t\t\t\t\tleft: 0;\n\t\t\t  `}\n\t}\n`;\n\nexport interface OphanTracking {\n\tcomponentType: OphanComponentType;\n\tsubmitComponentEvent: (componentEvent: OphanComponentEvent) => void;\n}\n\nexport interface ArticleCountOptOutProps {\n\tnumArticles: number;\n\tnextWord: string | null;\n\ttype: ArticleCountOptOutType;\n\ttracking?: OphanTracking;\n}\n\nexport const ArticleCountOptOutPopup: ReactComponent<\n\tArticleCountOptOutProps\n> = ({ numArticles, nextWord, type, tracking }: ArticleCountOptOutProps) => {\n\tconst [isOpen, setIsOpen] = useState(false);\n\tconst [hasOptedOut, setHasOptedOut] = useState(false);\n\tconst [hasBeenSeen, setNode] = useIsInView({\n\t\tdebounce: true,\n\t\trootMargin: '-18px',\n\t\tthreshold: 0,\n\t});\n\n\tuseEffect(() => {\n\t\tif (hasBeenSeen && tracking) {\n\t\t\ttracking.submitComponentEvent(\n\t\t\t\tophanComponentEventOptOutView(tracking.componentType),\n\t\t\t);\n\t\t}\n\t}, [hasBeenSeen, tracking]);\n\n\tconst onOptOut = (): void => {\n\t\taddArticleCountOptOutCookie();\n\t\tremoveArticleCountFromLocalStorage();\n\t\tsetHasOptedOut(true);\n\t\tif (tracking) {\n\t\t\ttracking.submitComponentEvent(\n\t\t\t\tophanComponentEventOptOutConfirm(tracking.componentType),\n\t\t\t);\n\t\t}\n\t};\n\n\tconst onOpen = (): void => {\n\t\tsetIsOpen(true);\n\t\tif (tracking) {\n\t\t\ttracking.submitComponentEvent(\n\t\t\t\tophanComponentEventOptOutOpen(tracking.componentType),\n\t\t\t);\n\t\t}\n\t};\n\n\tconst onClose = (): void => {\n\t\tsetIsOpen(false);\n\t\tif (tracking) {\n\t\t\ttracking.submitComponentEvent(\n\t\t\t\tophanComponentEventOptOutClose(tracking.componentType),\n\t\t\t);\n\t\t}\n\t};\n\n\tconst onToggle = (): void => (isOpen ? onClose() : onOpen());\n\n\treturn (\n\t\t<div ref={setNode} css={optOutContainer(type)}>\n\t\t\t<button css={articleCountButton} onClick={onToggle}>\n\t\t\t\t{`${numArticles}${nextWord ? nextWord : ''}`}\n\t\t\t</button>\n\t\t\t{isOpen && (\n\t\t\t\t<div css={overlayContainer(type)}>\n\t\t\t\t\t<ArticleCountOptOutOverlay\n\t\t\t\t\t\ttype={type}\n\t\t\t\t\t\thasOptedOut={hasOptedOut}\n\t\t\t\t\t\tonOptOut={onOptOut}\n\t\t\t\t\t\tonClose={onClose}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n","/**\n * @file\n * This file was migrated from:\n * https://github.com/guardian/support-dotcom-components/blob/9c3eae7cb0b159db4a1c40679d6b37710b0bb937/packages/modules/src/lib/replaceArticleCount.tsx\n */\nimport type {\n\tArticleCountOptOutType,\n\tOphanTracking,\n} from '../shared/ArticleCountOptOutPopup';\nimport { ArticleCountOptOutPopup } from '../shared/ArticleCountOptOutPopup';\n\nexport const replaceArticleCountWithLink = (\n\ttext: string,\n\tnumArticles: number,\n\tarticleCountOptOutType: ArticleCountOptOutType,\n\ttracking?: OphanTracking,\n): Array<JSX.Element> => {\n\tconst nextWords: Array<string | null> = [];\n\tconst subbedText = text.replace(\n\t\t/%%ARTICLE_COUNT%%( \\w+)?/g,\n\t\t(_, nextWord) => {\n\t\t\tnextWords.push(nextWord);\n\t\t\treturn '%%ARTICLE_COUNT_AND_NEXT_WORD%%';\n\t\t},\n\t);\n\n\tconst parts = subbedText.split(/%%ARTICLE_COUNT_AND_NEXT_WORD%%/);\n\tconst elements = [];\n\tlet key = 0;\n\tfor (let i = 0; i < parts.length - 1; i += 1) {\n\t\telements.push(\n\t\t\t<span\n\t\t\t\tdangerouslySetInnerHTML={{ __html: parts[i] as string }}\n\t\t\t\tkey={key++}\n\t\t\t/>,\n\t\t);\n\t\telements.push(\n\t\t\t<ArticleCountOptOutPopup\n\t\t\t\tnumArticles={numArticles}\n\t\t\t\tnextWord={nextWords[i] as string}\n\t\t\t\ttype={articleCountOptOutType}\n\t\t\t\ttracking={tracking}\n\t\t\t\tkey={key++}\n\t\t\t/>,\n\t\t);\n\t}\n\telements.push(\n\t\t<span\n\t\t\tdangerouslySetInnerHTML={{\n\t\t\t\t__html: parts[parts.length - 1] as string,\n\t\t\t}}\n\t\t\tkey={key++}\n\t\t/>,\n\t);\n\n\treturn elements;\n};\n\nexport const replaceArticleCount = (\n\ttext: string,\n\tnumArticles: number,\n\tarticleCountOptOutType: ArticleCountOptOutType,\n\ttracking?: OphanTracking,\n\toptOutLink = true,\n): Array<JSX.Element> | JSX.Element => {\n\tif (optOutLink) {\n\t\treturn replaceArticleCountWithLink(\n\t\t\ttext,\n\t\t\tnumArticles,\n\t\t\tarticleCountOptOutType,\n\t\t\ttracking,\n\t\t);\n\t}\n\treturn (\n\t\t<span\n\t\t\tdangerouslySetInnerHTML={{\n\t\t\t\t__html: text.replace(/%%ARTICLE_COUNT%%/, `${numArticles}`),\n\t\t\t}}\n\t\t/>\n\t);\n};\n","/**\n * @file\n * This file was migrated from:\n * https://github.com/guardian/support-dotcom-components/blob/9c3eae7cb0b159db4a1c40679d6b37710b0bb937/packages/shared/src/lib/tracking.ts\n */\nimport type { OphanAction, OphanComponentEvent } from '@guardian/libs';\nimport { isUndefined } from '@guardian/libs';\nimport { addRegionIdToSupportUrl } from '@guardian/support-dotcom-components';\nimport type {\n\tAbandonedBasket,\n\tBannerTest,\n\tBannerVariant,\n\tContributionFrequency,\n\tEpicTest,\n\tEpicVariant,\n\tTargetingAbTest,\n\tTracking,\n} from '@guardian/support-dotcom-components/dist/shared/types';\n\n// TRACKING VIA support.theguardian.com\ntype LinkParams = {\n\tREFPVID: string;\n\tINTCMP: string;\n\tacquisitionData: string;\n\tnumArticles: number;\n};\n\ntype AbTestObject = {\n\tname: string;\n\tvariant: string;\n\ttestType?: string;\n};\n\nconst generateAbTestArray = (\n\tabTestName: string,\n\tabTestVariant: string,\n\ttargetingAbTest?: TargetingAbTest,\n\tamountsAbTestName?: string,\n\tamountsAbTestVariant?: string,\n): AbTestObject[] => {\n\tconst abTests: AbTestObject[] = [\n\t\t{\n\t\t\tname: abTestName,\n\t\t\tvariant: abTestVariant,\n\t\t},\n\t];\n\tif (targetingAbTest) {\n\t\tabTests.push({\n\t\t\tname: targetingAbTest.testName,\n\t\t\tvariant: targetingAbTest.variantName,\n\t\t});\n\t}\n\tif (amountsAbTestName && amountsAbTestVariant) {\n\t\tabTests.push({\n\t\t\tname: amountsAbTestName,\n\t\t\tvariant: amountsAbTestVariant,\n\t\t\ttestType: 'AMOUNTS_TEST',\n\t\t});\n\t}\n\treturn abTests;\n};\n\nconst encodeAcquisitionsData = (\n\tparams: Tracking,\n\tabTests: AbTestObject[],\n): string => {\n\treturn encodeURIComponent(\n\t\tJSON.stringify({\n\t\t\tsource: params.platformId,\n\t\t\tcomponentId: params.campaignCode,\n\t\t\tcomponentType: params.componentType,\n\t\t\tcampaignCode: params.campaignCode,\n\t\t\tabTests,\n\t\t\treferrerPageviewId: params.ophanPageId,\n\t\t\treferrerUrl: params.referrerUrl,\n\t\t\tisRemote: true, // Temp param to indicate served by remote service\n\t\t\tlabels: params.labels,\n\t\t}),\n\t);\n};\n\nconst generateQueryString = (\n\tparams: Tracking,\n\tacquisitionData: string,\n\tnumArticles: number,\n): string => {\n\tconst trackingLinkParams: LinkParams = {\n\t\tREFPVID: params.ophanPageId || 'not_found',\n\t\tINTCMP: params.campaignCode || '',\n\t\tacquisitionData,\n\t\tnumArticles: numArticles || 0,\n\t};\n\n\tconst queryString = Object.entries(trackingLinkParams)\n\t\t.filter(([, value]) => !isUndefined(value))\n\t\t.map(([key, value]) => `${key}=${value}`);\n\n\treturn queryString.join('&');\n};\n\nexport const addTrackingParams = (\n\tbaseUrl: string,\n\tparams: Tracking,\n\tnumArticles?: number,\n\tamountsAbTestName?: string,\n\tamountsAbTestVariant?: string,\n): string => {\n\tconst abTests = generateAbTestArray(\n\t\tparams.abTestName,\n\t\tparams.abTestVariant,\n\t\tparams.targetingAbTest,\n\t\tamountsAbTestName,\n\t\tamountsAbTestVariant,\n\t);\n\tconst acquisitionData = encodeAcquisitionsData(params, abTests);\n\tconst queryString = generateQueryString(\n\t\tparams,\n\t\tacquisitionData,\n\t\tnumArticles ?? 0,\n\t);\n\tconst alreadyHasQueryString = baseUrl.includes('?');\n\treturn `${baseUrl}${alreadyHasQueryString ? '&' : '?'}${queryString}`;\n};\n\nconst addAbandonedBasketContributionParams = (\n\tbaseUrl: string,\n\t{ region, amount, billingPeriod }: AbandonedBasket,\n): string => {\n\treturn `${baseUrl}/${region}/contribute/checkout?selected-amount=${amount}&selected-contribution-type=${billingPeriod}`;\n};\n\nexport const addAbandonedBasketParamsToUrl = (\n\tbaseUrl: string,\n\tabandonedBasket: AbandonedBasket,\n): string => {\n\tswitch (abandonedBasket.product) {\n\t\tcase 'Contribution':\n\t\tcase 'SupporterPlus':\n\t\t\treturn addAbandonedBasketContributionParams(\n\t\t\t\tbaseUrl,\n\t\t\t\tabandonedBasket,\n\t\t\t);\n\t\tdefault:\n\t\t\treturn baseUrl;\n\t}\n};\n\nexport const addAbandonedBasketAndTrackingParamsToUrl = (\n\tbaseUrl: string,\n\tabandonedBasket: AbandonedBasket,\n\ttracking: Tracking,\n): string => {\n\treturn addTrackingParams(\n\t\taddAbandonedBasketParamsToUrl(baseUrl, abandonedBasket),\n\t\ttracking,\n\t);\n};\n\nexport const isSupportUrl = (baseUrl: string): boolean =>\n\t/\\bsupport\\./.test(baseUrl);\n\nexport const addRegionIdAndTrackingParamsToSupportUrl = (\n\tbaseUrl: string,\n\ttracking: Tracking,\n\tnumArticles?: number,\n\tcountryCode?: string,\n\tamountsAbTestName?: string,\n\tamountsAbTestVariant?: string,\n): string => {\n\tif (!isSupportUrl(baseUrl)) {\n\t\treturn baseUrl;\n\t}\n\tconst urlWithRegion = addRegionIdToSupportUrl(baseUrl, countryCode);\n\n\treturn addTrackingParams(\n\t\turlWithRegion,\n\t\ttracking,\n\t\tnumArticles,\n\t\tamountsAbTestName,\n\t\tamountsAbTestVariant,\n\t);\n};\n\nconst hrefRegex = /href=\"(.*?)\"/g;\nexport const addTrackingParamsToBodyLinks = (\n\ttext: string,\n\ttracking: Tracking,\n\tnumArticles?: number,\n\tcountryCode?: string,\n): string => {\n\tconst trackingWithLabel = addLabelToTracking(tracking, 'body-link');\n\n\tconst replaceHref = (wholeMatch: string, url: string) =>\n\t\t`href=\"${addRegionIdAndTrackingParamsToSupportUrl(\n\t\t\turl,\n\t\t\ttrackingWithLabel,\n\t\t\tnumArticles,\n\t\t\tcountryCode,\n\t\t)}\"`;\n\n\treturn text.replace(hrefRegex, replaceHref);\n};\n\n// TRACKING VIA profile.theguardian.com\ntype ProfileLinkParams = {\n\tcomponentEventParams: string;\n\treturnUrl: string;\n};\n\ntype TrackingParam = keyof Tracking;\n\nexport const addProfileTrackingParams = (\n\tbaseUrl: string,\n\tparams: Tracking,\n): string => {\n\tconst constructQuery = (query: Partial<Tracking>): string =>\n\t\tObject.keys(query)\n\t\t\t.map((param) => {\n\t\t\t\tconst value = query[param as TrackingParam];\n\t\t\t\tconst queryValue = Array.isArray(value)\n\t\t\t\t\t? value.map((v) => encodeURIComponent(v)).join(',')\n\t\t\t\t\t: encodeURIComponent(value as string | number | boolean);\n\t\t\t\treturn `${param}=${queryValue}`;\n\t\t\t})\n\t\t\t.join('&');\n\n\tconst componentEventParamsData = {\n\t\tcomponentType: params.componentType,\n\t\tcomponentId: params.campaignCode,\n\t\tabTestName: params.abTestName,\n\t\tabTestVariant: params.abTestVariant,\n\t\tviewId: params.ophanPageId,\n\t};\n\n\tconst trackingLinkParams: ProfileLinkParams = {\n\t\t// Note: profile subdomain take uri encoded query params NOT json\n\t\tcomponentEventParams: encodeURIComponent(\n\t\t\tconstructQuery(componentEventParamsData),\n\t\t),\n\t\treturnUrl: params.referrerUrl,\n\t};\n\n\tconst queryString = Object.entries(trackingLinkParams)\n\t\t.filter(([, value]) => !isUndefined(value))\n\t\t.map(([key, value]) => `${key}=${value}`);\n\tconst alreadyHasQueryString = baseUrl.includes('?');\n\n\treturn `${baseUrl}${alreadyHasQueryString ? '&' : '?'}${queryString.join(\n\t\t'&',\n\t)}`;\n};\n\nexport const addChoiceCardsParams = (\n\turl: string,\n\tfrequency: ContributionFrequency,\n\tamount?: number | 'other',\n): string => {\n\tconst newParams = `selected-contribution-type=${frequency}${\n\t\tamount !== undefined ? `&selected-amount=${amount}` : ''\n\t}`;\n\tconst alreadyHasQueryString = url.includes('?');\n\treturn `${url}${alreadyHasQueryString ? '&' : '?'}${newParams}`;\n};\n\nexport const addChoiceCardsOneTimeParams = (url: string): string => {\n\tconst newParams = `oneTime`;\n\tconst alreadyHasQueryString = url.includes('?');\n\treturn `${url}${alreadyHasQueryString ? '&' : '?'}${newParams}`;\n};\n\nexport const addChoiceCardsProductParams = (\n\turl: string,\n\tproduct: string,\n\tratePlan: string,\n\tcontribution?: number,\n): string => {\n\tconst newParams = `product=${product}&ratePlan=${ratePlan}${\n\t\tcontribution !== undefined ? `&contribution=${contribution}` : ''\n\t}`;\n\n\tconst alreadyHasQueryString = url.includes('?');\n\treturn `${url}${alreadyHasQueryString ? '&' : '?'}${newParams}`;\n};\n\nexport const isProfileUrl = (baseUrl: string): boolean =>\n\t/\\bprofile\\./.test(baseUrl);\nexport const addTrackingParamsToProfileUrl = (\n\tbaseUrl: string,\n\ttracking: Tracking,\n): string => {\n\treturn isProfileUrl(baseUrl)\n\t\t? addProfileTrackingParams(baseUrl, tracking)\n\t\t: baseUrl;\n};\n\n// SHARED TRACKING\nconst campaignPrefix = 'gdnwb_copts_memco';\n\nexport const buildCampaignCode = (\n\ttest: EpicTest,\n\tvariant: EpicVariant,\n): string =>\n\t`${campaignPrefix}_${test.campaignId ?? test.name}_${variant.name}`;\n\nexport const buildBannerCampaignCode = (\n\ttest: BannerTest,\n\tvariant: BannerVariant,\n): string => `${test.name}_${variant.name}`;\n\nexport const buildAmpEpicCampaignCode = (\n\ttestName: string,\n\tvariantName: string,\n): string => `AMP__${testName}__${variantName}`;\n\nconst createEventFromTracking = (action: OphanAction) => {\n\treturn (tracking: Tracking, componentId: string): OphanComponentEvent => {\n\t\tconst {\n\t\t\tabTestName,\n\t\t\tabTestVariant,\n\t\t\tcomponentType,\n\t\t\tproducts = [],\n\t\t\tlabels = [],\n\t\t\tcampaignCode,\n\t\t} = tracking;\n\t\tconst abTest =\n\t\t\tabTestName && abTestVariant\n\t\t\t\t? {\n\t\t\t\t\t\tname: abTestName,\n\t\t\t\t\t\tvariant: abTestVariant,\n\t\t\t\t  }\n\t\t\t\t: null;\n\n\t\tconst targetingAbTest = tracking.targetingAbTest\n\t\t\t? {\n\t\t\t\t\tname: tracking.targetingAbTest.testName,\n\t\t\t\t\tvariant: tracking.targetingAbTest.variantName,\n\t\t\t  }\n\t\t\t: null;\n\n\t\treturn {\n\t\t\tcomponent: {\n\t\t\t\tcomponentType,\n\t\t\t\tproducts,\n\t\t\t\tcampaignCode,\n\t\t\t\tid: componentId,\n\t\t\t\tlabels,\n\t\t\t},\n\t\t\t...(abTest ? { abTest } : {}),\n\t\t\t...(targetingAbTest ? { targetingAbTest } : {}),\n\t\t\taction,\n\t\t};\n\t};\n};\n\nexport const addLabelToTracking = (\n\ttracking: Tracking,\n\tlabel: string,\n): Tracking => {\n\tif (tracking.labels) {\n\t\treturn {\n\t\t\t...tracking,\n\t\t\tlabels: [...tracking.labels, label],\n\t\t};\n\t} else {\n\t\treturn {\n\t\t\t...tracking,\n\t\t\tlabels: [label],\n\t\t};\n\t}\n};\n\nexport const createClickEventFromTracking = createEventFromTracking('CLICK');\n\nexport const createViewEventFromTracking = createEventFromTracking('VIEW');\n\nexport const createInsertEventFromTracking = createEventFromTracking('INSERT');\n"],"names":["ARTICLE_COUNT_OPT_OUT_COOKIE","addArticleCountOptOutCookie","setCookie","name","value","Date","getTime","toString","daysToLive","removeArticleCountOptOutCookie","removeCookie","removeArticleCountFromLocalStorage","storage","local","remove","hasArticleCountOptOutCookie","getCookie","brand","neutral","palette","COLOURS","epic","banner","brandAltText","primary","BACKGROUND_COLOURS","brandAltBackground","BORDER_COLOURS","brandAltLine","BUTTON_THEMES","buttonThemeBrand","buttonThemeBrandAlt","buttonThemeDefault","overlayContainer","type","css","textSans17","space","overlayHeader","overlayHeaderText","overlayBody","overlayCtaContainer","from","tablet","NOTE_LINK_COLOURS","BUTTON_OVERRIDES","culture","PRIMARY_BUTTON_OVERRIDES","background","ctaPrimaryHover","overlayNote","textSans14","ArticleCountOptOutOverlay","hasOptedOut","onClose","onOptOut","div","ThemeProvider","theme","Button","onClick","cssOverrides","icon","SvgCross","hideLabel","size","priority","span","a","href","isBanner","optOutContainer","articleCountButton","ArticleCountOptOutPopup","numArticles","nextWord","tracking","isOpen","setIsOpen","useState","setHasOptedOut","hasBeenSeen","setNode","useIsInView","debounce","rootMargin","threshold","useEffect","componentType","submitComponentEvent","component","id","action","ref","button","replaceArticleCount","text","articleCountOptOutType","optOutLink","dangerouslySetInnerHTML","__html","replace","nextWords","parts","_","push","split","elements","key","i","length","replaceArticleCountWithLink","addTrackingParams","baseUrl","params","amountsAbTestName","amountsAbTestVariant","abTests","abTestName","abTestVariant","targetingAbTest","variant","testName","variantName","testType","generateAbTestArray","acquisitionData","encodeURIComponent","JSON","stringify","source","platformId","componentId","campaignCode","referrerPageviewId","ophanPageId","referrerUrl","isRemote","labels","encodeAcquisitionsData","queryString","trackingLinkParams","REFPVID","INTCMP","Object","entries","filter","isUndefined","map","join","generateQueryString","alreadyHasQueryString","includes","addAbandonedBasketAndTrackingParamsToUrl","abandonedBasket","product","region","amount","billingPeriod","addAbandonedBasketContributionParams","addAbandonedBasketParamsToUrl","isSupportUrl","test","addRegionIdAndTrackingParamsToSupportUrl","countryCode","urlWithRegion","addRegionIdToSupportUrl","hrefRegex","addTrackingParamsToBodyLinks","trackingWithLabel","addLabelToTracking","wholeMatch","url","addChoiceCardsParams","frequency","newParams","undefined","addChoiceCardsOneTimeParams","addChoiceCardsProductParams","ratePlan","contribution","isProfileUrl","addTrackingParamsToProfileUrl","componentEventParamsData","viewId","componentEventParams","query","keys","param","queryValue","Array","isArray","v","returnUrl","addProfileTrackingParams","createEventFromTracking","products","abTest","label","createClickEventFromTracking","createViewEventFromTracking","createInsertEventFromTracking"],"sourceRoot":""}