"use strict";(self.webpackChunk_guardian_dotcom_rendering=self.webpackChunk_guardian_dotcom_rendering||[]).push([[8301],{54041:(e,a,r)=>{r.r(a),r.d(a,{BrazeMessaging:()=>i});var n=r(60439),s=r(37438),t=r(15593);const i=e=>{let{idApiUrl:a}=e;const{renderingTarget:r}=(0,t.U)(),{brazeMessages:i,brazeCards:o}=(0,s.m)(a,r);return i&&(0,n.Rm)("tx","Braze Messages Interface loaded",i),o&&(0,n.Rm)("tx","Braze Cards Interface loaded",o),null}},47513:(e,a,r)=>{r.d(a,{J:()=>o,h:()=>d});var n=r(88482);function s(e){if(!e.ok)throw Error(e.statusText||"getIdApiUserData | An api call returned HTTP status ".concat(e.status));return e}const t=e=>fetch(e,{credentials:"include"}).then(s).then((e=>e.json())),i={},o=e=>{if(!i.idapiUserMeResponse){const a=(0,n.w)(e,"user/me");i.idapiUserMeResponse=t(a)}return i.idapiUserMeResponse},d=e=>{if(!i.idapiUserIdentifiersResponse){const a=(0,n.w)(e,"user/me/identifiers");i.idapiUserIdentifiersResponse=t(a)}return i.idapiUserIdentifiersResponse}},14374:(e,a,r)=>{r.d(a,{T:()=>t,w:()=>i});var n=r(67400),s=r(97656);const t=()=>{switch(i().kind){case"Pending":return"Pending";case"SignedInWithCookies":case"SignedInWithOkta":return!0;case"SignedOutWithCookies":case"SignedOutWithOkta":return!1}},i=()=>{const[e,a]=(0,n.useState)({kind:"Pending"});return(0,n.useEffect)((()=>{(0,s.kU)((e=>{a((0,s.dx)(e))}),(()=>a((0,s.Hn)()))).catch((e=>{console.error(e)}))}),[]),e}},37438:(e,a,r)=>{r.d(a,{m:()=>v});var n=r(6506),s=r(53994),t=r(61082),i=r(60439),o=r(88793),d=r(50026);const c="gu.brazeUserSet";var u=r(47513),l=r(97656);const g=async e=>(0,l.kU)((e=>{var a;return null===(a=e.idToken)||void 0===a?void 0:a.claims.braze_uuid}),(()=>(0,u.h)(e).then((e=>e.brazeUuid)).catch((e=>{window.guardian.modules.sentry.reportError(e,"getBrazeUuid")}))));var w=r(9092);const b=(e,a,r)=>({isSuccessful:!1,failure:{field:e,data:a},data:r});var h=r(9474);const m={enableLogging:!0,noCookies:!0,baseUrl:"https://sdk.fra-01.braze.eu/api/v3",sessionTimeoutInSeconds:1,minimumIntervalBetweenTriggerActionsInSeconds:0,devicePropertyAllowlist:[]},z=(()=>{let e;return a=>((0,h.b)(e)&&(e=(async e=>{const a=await r.e(7659).then(r.t.bind(r,14844,23));return a.setLogger((e=>(0,i.Rm)("tx",e))),a.initialize(e,m),a})(a)),e)})(),f=async(e,a,r)=>{if(!t.I.local.isAvailable())return{brazeMessages:new n._v,brazeCards:new n.ho};const s=await(async(e,a)=>{const r=((e,a)=>[{name:"apiKey",value:Promise.resolve(window.guardian.config.page.brazeApiKey)},{name:"brazeSwitch",value:Promise.resolve(window.guardian.config.switches.brazeSwitch)},{name:"brazeUuid",value:e?g(a):Promise.resolve(null)},{name:"consent",value:new Promise(((e,a)=>{(0,w.Ym)((r=>{try{e((0,w.gS)("braze",r))}catch(e){a(e)}}))}))},{name:"isNotPaidContent",value:Promise.resolve(!window.guardian.config.page.isPaidContent)}])(e,a),n={};for(const{name:e,value:a}of r)try{const r=await a;if(!r)return b(e,r,n);n[e]=r}catch(a){return b(e,a instanceof Error?a.message:a,n)}return{isSuccessful:!0,data:n}})(a,e);if(!s.isSuccessful){const{failure:e,data:a}=s;return(0,i.Rm)("tx","Not attempting to show Braze messages. Dependency ".concat(e.field," failed with ").concat(String(e.data),".")),await(async(e,a,r,s)=>{const i="true"===t.I.local.getRaw(c);if(!a&&i||!r&&i||!s&&i)try{e&&(await z(e)).wipeData(),n.tP.clear(),t.I.local.remove(c)}catch(e){window.guardian.modules.sentry.reportError(e,"braze-maybeWipeUserData")}})(a.apiKey,a.brazeUuid,a.consent,a.brazeSwitch),{brazeMessages:new n._v,brazeCards:new n.ho}}try{const{endPerformanceMeasure:e}=(0,o.h)("tx","braze-sdk-load"),a=await z(s.data.apiKey),i=e();(await(0,d.V5)(r)).record({component:"braze-sdk-load-timing",value:i});const u=(e,a)=>{window.guardian.modules.sentry.reportError(e,a)};t.I.local.setRaw(c,"true"),a.changeUser(s.data.brazeUuid),a.openSession();const l=window.guardian.config.switches.brazeContentCards?new n.ue(a,u):new n.ho;return{brazeMessages:new n.xK(a,n.tP,u,n.Aw),brazeCards:l}}catch(e){return{brazeMessages:new n._v,brazeCards:new n.ho}}};var p=r(14374);const v=(e,a)=>{const r=(0,p.w)(),t="SignedInWithOkta"===r.kind||"SignedInWithCookies"===r.kind,{data:i,error:o}=(0,s.A)("Pending"!==r.kind?"braze-message":null,(()=>f(e,t,a)));return o?{brazeMessages:new n._v,brazeCards:new n.ho}:{brazeMessages:null==i?void 0:i.brazeMessages,brazeCards:null==i?void 0:i.brazeCards}}}}]);
//# sourceMappingURL=BrazeMessaging-importable.client.web.87e3ecb6eeaa78977a01.js.map