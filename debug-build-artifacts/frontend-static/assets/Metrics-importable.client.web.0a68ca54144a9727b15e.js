"use strict";(self.webpackChunk_guardian_dotcom_rendering=self.webpackChunk_guardian_dotcom_rendering||[]).push([[5904],{23825:(e,t,a)=>{a.r(t),a.d(t,{Metrics:()=>A});var n=a(54577),i=a(60439);const r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6;const a=Math.pow(10,t);return Math.round(e*a)/a},s={},o=new Set;let c=!1,d=!1;const l=()=>{d||void 0!==s.fcp&&(d=navigator.sendBeacon("https://feast-events.guardianapis.com/web-vitals",JSON.stringify(s)),o.size>0&&o.forEach((e=>{(0,i.Rm)(e,d?"Core Web Vitals payload successfully queued for transfer":"Failed to queue Core Web Vitals payload for transfer")})))},u=e=>{switch(e.name){case"CLS":s.cls=r(e.value),s.cls_target=e.attribution.largestShiftTarget;break;case"INP":s.inp=r(e.value),s.inp_target=e.attribution.interactionTarget;break;case"LCP":s.lcp=r(e.value),s.lcp_target=e.attribution.element;break;case"FCP":s.fcp=r(e.value);break;case"FID":s.fid=r(e.value);break;case"TTFB":s.ttfb=r(e.value)}},g=e=>{switch(e.type){case"visibilitychange":return void("hidden"===document.visibilityState&&l());case"pagehide":return void l()}},b=async()=>{const e=await a.e(4501).then(a.bind(a,84501)),{onCLS:t,onFCP:n,onFID:i,onLCP:r,onTTFB:s,onINP:o}=e;t(u,{reportAllChanges:!1}),o(u),r(u),n(u),i(u),s(u),addEventListener("visibilitychange",g),addEventListener("pagehide",g)};var f=a(18411),w=a(72762),p=a(9474),h=a(67400),m=a(6595),v=a(70919),y=a(67061),k=a(18274),C=a(80680),I=a(40901),S=a(15593);const V=Math.random()<.01,E=[v.l,m.K],A=e=>{let{commercialMetricsEnabled:t,tests:a}=e;var i;const r=null===(i=(0,y.H)())||void 0===i?void 0:i.api,d=(0,k.g)(),l=(0,C.t)(),{renderingTarget:u}=(0,S.U)(),g=(()=>{const[e,t]=(0,h.useState)();return(0,h.useEffect)((()=>{const e=(0,f.R)({name:"bwid",shouldMemoize:!0}),a=(0,w.K)(e)?e:"no-browser-id-available";t(a)}),[]),e})(),m=(0,I.L)(u),v=(()=>{const[e,t]=(0,h.useState)();return(0,h.useEffect)((()=>{t(!!window.guardian.config.page.isDev||"m.code.dev-theguardian.com"===window.location.hostname||"localhost"===window.location.hostname||"preview.gutools.co.uk"===window.location.hostname)}),[]),e})(),A=Object.keys(a).length>0,_=(0,h.useCallback)((e=>V||A||E.some((t=>e.runnableTest(t)))),[A]);return(0,h.useEffect)((function(){if((0,p.b)(r))return;if((0,p.b)(g))return;if((0,p.b)(v))return;if((0,p.b)(m))return;const e=_(r),t=Number.MIN_VALUE;(async e=>{let{browserId:t,pageViewId:a,sampling:n=.01,isDev:i,team:r}=e;if(c)return void console.warn("initCoreWebVitals already initialised","use the bypassCoreWebVitalsSampling method instead");c=!0,r&&o.add(r),s.stage=i?"CODE":"PROD",s.browser_id=t,s.page_view_id=a,t&&a||console.warn("browserId or pageViewId missing from Core Web Vitals.","Resulting data cannot be joined to page view tables",{browserId:t,pageViewId:a}),(n<0||n>1)&&console.warn("Core Web Vitals sampling is outside the 0 to 1 range: ",n),0===n&&console.warn("Core Web Vitals are sampled at 0%"),1===n&&console.warn("Core Web Vitals are sampled at 100%");const d=Math.random()<n,l="#bypassCoreWebVitalsSampling"===window.location.hash;(d||l)&&b()})({browserId:g,pageViewId:m,isDev:v,sampling:t,team:"dotcom"}),(e||v)&&(async e=>{if(c)return e&&o.add(e),b();console.warn("initCoreWebVitals not yet initialised")})("commercial")}),[r,g,v,m,_]),(0,h.useEffect)((function(){if(!t)return;if((0,p.b)(r))return;if((0,p.b)(d))return;if((0,p.b)(g))return;if((0,p.b)(v))return;if((0,p.b)(m))return;const e=_(r);n.W6.get().setProperty("detectedAdBlocker",l),(0,n.q5)({pageViewId:m,browserId:g,isDev:v,adBlockerInUse:d}).then((()=>{(e||v)&&(0,n.XZ)()})).catch((e=>console.error("Error initialising commercial metrics: ".concat(String(e)))))}),[r,d,l,g,t,v,m,_]),null}},6595:(e,t,a)=>{a.d(t,{K:()=>n});const n={id:"AdBlockAsk",author:"@guardian/commercial-dev",start:"2024-04-10",expiry:"2024-05-31",audience:.1,audienceOffset:.1,audienceCriteria:"",successMeasure:"",description:"Show new ad block ask component in ad slots when we detect ad blocker usage",variants:[{id:"control",test:()=>{}},{id:"variant",test:()=>{}}],canRun:()=>!0}},70919:(e,t,a)=>{a.d(t,{l:()=>n});const n={id:"IntegrateIma",start:"2022-07-14",expiry:"2024-02-28",author:"Zeke Hunter-Green",description:"Test the commercial impact of replacing YouTube ads with Interactive Media Ads on first-party videos",audience:0,audienceOffset:.1,audienceCriteria:"Opt in",successMeasure:"IMA integration works as expected without adversely affecting pages with videos",canRun:()=>!0,variants:[{id:"control",test:()=>{}},{id:"variant",test:()=>{}}]}},67061:(e,t,a)=>{a.d(t,{H:()=>o,z:()=>c});var n=a(29273),i=a(53994);const r=new Promise((()=>{})),s="ab-tests",o=()=>{const{data:e}=(0,i.A)(s,(()=>r));return e},c=e=>{let{api:t,participations:a}=e;(0,n.Tk)(s,{api:t,participations:a},!1)}},18274:(e,t,a)=>{a.d(t,{g:()=>r});var n=a(54577),i=a(67400);const r=()=>{const[e,t]=(0,i.useState)();return(0,i.useEffect)((()=>{(0,n.hO)().then((e=>{t(e)}))}),[]),e}},80680:(e,t,a)=>{a.d(t,{t:()=>d});var n=a(9092),i=a(67400);let r;const s=async e=>{try{return!(await fetch("https://www3.doubleclick.net",{method:"HEAD",mode:"no-cors",cache:"no-store",signal:AbortSignal.timeout(e)})).redirected}catch(e){return!1}},o=async e=>{try{return await fetch("https://www.theguardian.com",{method:"HEAD",mode:"no-cors",cache:"no-store",signal:AbortSignal.timeout(e)}),!0}catch(e){return!1}},c=async()=>r||(r=Promise.all([s(1e3),o(250)]).then((e=>{let[t,a]=e;return!t&&a})),r),d=()=>{const[e,t]=(0,i.useState)(!1),[a,r]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{(0,n.Ym)((e=>{if(e.tcfv2)return r((0,n.gS)("googletag",e));r(!0)}))}),[]),(0,i.useEffect)((()=>{(async()=>{if(a){const e=await c();console.log("AdBlocker detected:",e),t(e)}})()}),[a]),e}},40901:(e,t,a)=>{a.d(t,{L:()=>r});var n=a(67400),i=a(50026);const r=e=>{const[t,a]=(0,n.useState)();return(0,n.useEffect)((()=>{(0,i.V5)(e).then((e=>{let{pageViewId:t}=e;a(t)})).catch((()=>{a("no-page-view-id-available")}))}),[e]),t}}}]);
//# sourceMappingURL=Metrics-importable.client.web.0a68ca54144a9727b15e.js.map