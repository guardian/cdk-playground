"use strict";(self.webpackChunk_guardian_dotcom_rendering=self.webpackChunk_guardian_dotcom_rendering||[]).push([[5904],{76193:(e,t,n)=>{n.r(t),n.d(t,{Metrics:()=>W});var r=n(22820),a=n(74184),i=n(18247),o=n(57820),c=n(16346),u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=Math.pow(10,t);return Math.round(e*n)/n},s={},d=new Set,f=!1,l=!1,p=function(){l||void 0!==s.fcp&&(l=navigator.sendBeacon("https://feast-events.guardianapis.com/web-vitals",JSON.stringify(s)),d.size>0&&d.forEach((function(e){(0,c.Rm)(e,l?"Core Web Vitals payload successfully queued for transfer":"Failed to queue Core Web Vitals payload for transfer")})))},v=function(e){switch(e.name){case"CLS":s.cls=u(e.value),s.cls_target=e.attribution.largestShiftTarget;break;case"INP":s.inp=u(e.value),s.inp_target=e.attribution.interactionTarget;break;case"LCP":s.lcp=u(e.value),s.lcp_target=e.attribution.element;break;case"FCP":s.fcp=u(e.value);break;case"FID":s.fid=u(e.value);break;case"TTFB":s.ttfb=u(e.value)}},b=function(e){switch(e.type){case"visibilitychange":return void("hidden"===document.visibilityState&&p());case"pagehide":return void p()}},h=function(){var e=(0,i.A)(o.mark((function e(){var t,r,a,i,c,u,s;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.e(4501).then(n.bind(n,6882));case 2:t=e.sent,r=t.onCLS,a=t.onFCP,i=t.onFID,c=t.onLCP,u=t.onTTFB,s=t.onINP,r(v,{reportAllChanges:!1}),s(v),c(v),a(v),i(v),u(v),addEventListener("visibilitychange",b),addEventListener("pagehide",b);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),w=function(){var e=(0,i.A)(o.mark((function e(t){var n,r,a,i,c,u,l,p;return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.browserId,r=t.pageViewId,a=t.sampling,i=void 0===a?.01:a,c=t.isDev,u=t.team,!f){e.next=4;break}return console.warn("initCoreWebVitals already initialised","use the bypassCoreWebVitalsSampling method instead"),e.abrupt("return");case 4:if(f=!0,u&&d.add(u),s.stage=c?"CODE":"PROD",s.browser_id=n,s.page_view_id=r,n&&r||console.warn("browserId or pageViewId missing from Core Web Vitals.","Resulting data cannot be joined to page view tables",{browserId:n,pageViewId:r}),(i<0||i>1)&&console.warn("Core Web Vitals sampling is outside the 0 to 1 range: ",i),0===i&&console.warn("Core Web Vitals are sampled at 0%"),1===i&&console.warn("Core Web Vitals are sampled at 100%"),l=Math.random()<i,p="#bypassCoreWebVitalsSampling"===window.location.hash,!l&&!p){e.next=17;break}return e.abrupt("return",h());case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=(0,i.A)(o.mark((function e(t){return o.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f){e.next=3;break}return console.warn("initCoreWebVitals not yet initialised"),e.abrupt("return");case 3:return t&&d.add(t),e.abrupt("return",h());case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=n(64361),k=n(5240),A=n(65656),y=n(67400),C=n(14247),I=n(5819),x=n(66049),S=n(7854),V=n(86588),E=n(78561),_=n(7693),M=Math.random()<.01,T=[I.l,C.K],W=function(e){var t,n=e.commercialMetricsEnabled,i=e.tests,o=null===(t=(0,x.H)())||void 0===t?void 0:t.api,c=(0,S.g)(),u=(0,V.t)(),s=(0,_.U)().renderingTarget,d=function(){var e=(0,y.useState)(),t=(0,r.A)(e,2),n=t[0],a=t[1];return(0,y.useEffect)((function(){var e=(0,m.R)({name:"bwid",shouldMemoize:!0}),t=(0,k.K)(e)?e:"no-browser-id-available";a(t)}),[]),n}(),f=(0,E.L)(s),l=function(){var e=(0,y.useState)(),t=(0,r.A)(e,2),n=t[0],a=t[1];return(0,y.useEffect)((function(){a(!!window.guardian.config.page.isDev||"m.code.dev-theguardian.com"===window.location.hostname||"localhost"===window.location.hostname||"preview.gutools.co.uk"===window.location.hostname)}),[]),n}(),p=Object.keys(i).length>0,v=(0,y.useCallback)((function(e){return M||p||T.some((function(t){return e.runnableTest(t)}))}),[p]);return(0,y.useEffect)((function(){if(!((0,A.b)(o)||(0,A.b)(d)||(0,A.b)(l)||(0,A.b)(f))){var e=v(o),t=Number.MIN_VALUE;w({browserId:d,pageViewId:f,isDev:l,sampling:t,team:"dotcom"}),(e||l)&&g("commercial")}}),[o,d,l,f,v]),(0,y.useEffect)((function(){if(n&&!(0,A.b)(o)&&!((0,A.b)(c)||(0,A.b)(d)||(0,A.b)(l)||(0,A.b)(f))){var e=v(o);a.W6.get().setProperty("detectedAdBlocker",u),(0,a.q5)({pageViewId:f,browserId:d,isDev:l,adBlockerInUse:c}).then((function(){(e||l)&&(0,a.XZ)()})).catch((function(e){return console.error("Error initialising commercial metrics: ".concat(String(e)))}))}}),[o,c,u,d,n,l,f,v]),null}},14247:(e,t,n)=>{n.d(t,{K:()=>r});var r={id:"AdBlockAsk",author:"@guardian/commercial-dev",start:"2024-04-10",expiry:"2024-05-31",audience:.1,audienceOffset:.1,audienceCriteria:"",successMeasure:"",description:"Show new ad block ask component in ad slots when we detect ad blocker usage",variants:[{id:"control",test:function(){}},{id:"variant",test:function(){}}],canRun:function(){return!0}}},5819:(e,t,n)=>{n.d(t,{l:()=>r});var r={id:"IntegrateIma",start:"2022-07-14",expiry:"2024-02-28",author:"Zeke Hunter-Green",description:"Test the commercial impact of replacing YouTube ads with Interactive Media Ads on first-party videos",audience:0,audienceOffset:.1,audienceCriteria:"Opt in",successMeasure:"IMA integration works as expected without adversely affecting pages with videos",canRun:function(){return!0},variants:[{id:"control",test:function(){}},{id:"variant",test:function(){}}]}},66049:(e,t,n)=>{n.d(t,{H:()=>c,z:()=>u});var r=n(29273),a=n(53994),i=new Promise((function(){})),o="ab-tests",c=function(){return(0,a.A)(o,(function(){return i})).data},u=function(e){var t=e.api,n=e.participations;(0,r.Tk)(o,{api:t,participations:n},!1)}},7854:(e,t,n)=>{n.d(t,{g:()=>o});var r=n(22820),a=n(74184),i=n(67400),o=function(){var e=(0,i.useState)(),t=(0,r.A)(e,2),n=t[0],o=t[1];return(0,i.useEffect)((function(){(0,a.hO)().then((function(e){o(e)}))}),[]),n}},86588:(e,t,n)=>{n.d(t,{t:()=>p});var r,a=n(18247),i=n(22820),o=n(57820),c=n.n(o),u=n(63854),s=n(67400),d=function(){var e=(0,a.A)(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://www3.doubleclick.net",{method:"HEAD",mode:"no-cors",cache:"no-store",signal:AbortSignal.timeout(t)});case 3:if(!e.sent.redirected){e.next=6;break}return e.abrupt("return",!1);case 6:return e.abrupt("return",!0);case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),f=function(){var e=(0,a.A)(c().mark((function e(t){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://www.theguardian.com",{method:"HEAD",mode:"no-cors",cache:"no-store",signal:AbortSignal.timeout(t)});case 3:return e.abrupt("return",!0);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=(0,a.A)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=2;break}return e.abrupt("return",r);case 2:return r=Promise.all([d(1e3),f(250)]).then((function(e){var t=(0,i.A)(e,2),n=t[0],r=t[1];return!n&&r})),e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),p=function(){var e=(0,s.useState)(!1),t=(0,i.A)(e,2),n=t[0],r=t[1],o=(0,s.useState)(!1),d=(0,i.A)(o,2),f=d[0],p=d[1];return(0,s.useEffect)((function(){(0,u.Ym)((function(e){if(e.tcfv2)return p((0,u.gS)("googletag",e));p(!0)}))}),[]),(0,s.useEffect)((function(){var e=function(){var e=(0,a.A)(c().mark((function e(){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!f){e.next=6;break}return e.next=3,l();case 3:t=e.sent,console.log("AdBlocker detected:",t),r(t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[f]),n}},78561:(e,t,n)=>{n.d(t,{L:()=>o});var r=n(22820),a=n(67400),i=n(85918),o=function(e){var t=(0,a.useState)(),n=(0,r.A)(t,2),o=n[0],c=n[1];return(0,a.useEffect)((function(){(0,i.V5)(e).then((function(e){var t=e.pageViewId;c(t)})).catch((function(){c("no-page-view-id-available")}))}),[e]),o}}}]);
//# sourceMappingURL=Metrics-importable.client.web.legacy.9aeb9ddb0161a8ed8bc5.js.map