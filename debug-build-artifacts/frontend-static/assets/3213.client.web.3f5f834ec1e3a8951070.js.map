{"version":3,"file":"3213.client.web.3f5f834ec1e3a8951070.js","mappings":"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","sources":["webpack://@guardian/dotcom-rendering/../node_modules/.pnpm/lodash.debounce@4.0.8/node_modules/lodash.debounce/index.js","webpack://@guardian/dotcom-rendering/./src/lib/articleCount.ts","webpack://@guardian/dotcom-rendering/./src/lib/braze/forceBrazeMessage.ts","webpack://@guardian/dotcom-rendering/./src/lib/braze/taylorReport.ts","webpack://@guardian/dotcom-rendering/./src/lib/contributions.ts","webpack://@guardian/dotcom-rendering/./src/lib/dailyArticleCount.ts","webpack://@guardian/dotcom-rendering/./src/lib/fetchEmail.ts","webpack://@guardian/dotcom-rendering/./src/lib/getIdapiUserData.ts","webpack://@guardian/dotcom-rendering/./src/lib/messagePicker.ts","webpack://@guardian/dotcom-rendering/./src/lib/setAutomat.ts","webpack://@guardian/dotcom-rendering/./src/lib/useAuthStatus.ts","webpack://@guardian/dotcom-rendering/./src/lib/hasCurrentBrazeUser.ts","webpack://@guardian/dotcom-rendering/./src/lib/getBrazeUuid.ts","webpack://@guardian/dotcom-rendering/./src/lib/braze/hasRequiredConsents.ts","webpack://@guardian/dotcom-rendering/./src/lib/braze/checkBrazeDependencies.ts","webpack://@guardian/dotcom-rendering/./src/lib/braze/initialiseAppboy.ts","webpack://@guardian/dotcom-rendering/./src/lib/braze/buildBrazeMessaging.ts","webpack://@guardian/dotcom-rendering/./src/lib/useBraze.ts","webpack://@guardian/dotcom-rendering/./src/lib/useCountryCode.ts","webpack://@guardian/dotcom-rendering/./src/lib/useIsInView.ts","webpack://@guardian/dotcom-rendering/./src/lib/useOnce.ts"],"sourcesContent":["/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** Used as the `TypeError` message for \"Functions\" methods. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/** Used to match leading and trailing whitespace. */\nvar reTrim = /^\\s+|\\s+$/g;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        result = wait - timeSinceLastCall;\n\n    return maxing ? nativeMin(result, maxWait - timeSinceLastInvoke) : result;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return !!value && (type == 'object' || type == 'function');\n}\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && objectToString.call(value) == symbolTag);\n}\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = value.replace(reTrim, '');\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nmodule.exports = debounce;\n","import { storage } from '@guardian/libs';\nimport {\n\tgetWeeklyArticleHistory,\n\tincrementWeeklyArticleCount,\n} from '@guardian/support-dotcom-components';\nimport type { WeeklyArticleHistory } from '@guardian/support-dotcom-components/dist/dotcom/types';\nimport { useEffect, useState } from 'react';\nimport { hasOptedOutOfWeeklyArticleCount } from '../lib/contributions';\nimport type { DailyArticleHistory } from '../lib/dailyArticleCount';\nimport {\n\tgetDailyArticleCount,\n\tincrementDailyArticleCount,\n} from '../lib/dailyArticleCount';\nimport type { TagType } from '../types/tag';\n\nexport interface ArticleCounts {\n\tweeklyArticleHistory: WeeklyArticleHistory;\n\tdailyArticleHistory: DailyArticleHistory;\n}\n\nexport const shouldIncrementArticleCount = (contentType: string): boolean => {\n\t// See https://github.com/guardian/frontend/blob/9c8707d894c858dd17de1c7c1499f6b91f5287bc/common/app/model/DotcomContentType.scala#L29\n\treturn [\n\t\t'article',\n\t\t'liveblog',\n\t\t'gallery',\n\t\t'video',\n\t\t'interactive',\n\t\t'audio',\n\t].includes(contentType.toLowerCase());\n};\n\n/**\n * This function is used to get the daily article counts.\n * It will increment the count if the contentType is listed in the shouldIncrementArticleCount function.\n * This will return and increment the dailyArticleCount for unconsented and consented users.\n *\n * @param {string} contentType\n * @return {*}  {(DailyArticleHistory | undefined)}\n */\nexport const getDailyArticleCounts = (\n\tcontentType: string,\n): DailyArticleHistory | undefined => {\n\tif (!window.guardian.dailyArticleCount) {\n\t\tif (shouldIncrementArticleCount(contentType)) {\n\t\t\tincrementDailyArticleCount();\n\t\t}\n\t\twindow.guardian.dailyArticleCount = getDailyArticleCount();\n\t}\n\n\treturn window.guardian.dailyArticleCount;\n};\n\n/**\n * This function is used to get the weekly article counts\n * It will increment the count if the contentType is listed in the shouldIncrementArticleCount function.\n * This will return and increment the weeklyArticleCount for only consented users.\n *\n * @param {string} pageId\n * @param {TagType[]} tags\n * @param {string} contentType\n * @return {*}  {(Promise<WeeklyArticleHistory | undefined>)}\n */\nexport const getWeeklyArticleCounts = async (\n\tpageId: string,\n\ttags: TagType[],\n\tcontentType: string,\n): Promise<WeeklyArticleHistory | undefined> => {\n\tif (await hasOptedOutOfWeeklyArticleCount()) return undefined;\n\n\tif (!window.guardian.weeklyArticleCount) {\n\t\tif (shouldIncrementArticleCount(contentType)) {\n\t\t\t// hasOptedOut needs to be done before we check if articleCount is set in the window\n\t\t\t// This is because a potential race condition where one invocation of getArticleCounts\n\t\t\t// is waiting for hasOptedOut another invocation might receive it and increment the article count.\n\n\t\t\tconst keywordAndToneTagIds: string[] = tags\n\t\t\t\t.filter((tag) =>\n\t\t\t\t\t['tone', 'keyword'].includes(tag.type.toLowerCase()),\n\t\t\t\t)\n\t\t\t\t.map((tag) => tag.id);\n\t\t\tincrementWeeklyArticleCount(\n\t\t\t\tstorage.local,\n\t\t\t\tpageId,\n\t\t\t\tkeywordAndToneTagIds,\n\t\t\t);\n\t\t}\n\t\twindow.guardian.weeklyArticleCount = getWeeklyArticleHistory(\n\t\t\tstorage.local,\n\t\t);\n\t}\n\n\treturn window.guardian.weeklyArticleCount;\n};\n\nexport const getArticleCounts = async (\n\tpageId: string,\n\ttags: TagType[],\n\tcontentType: string,\n): Promise<ArticleCounts | undefined> => {\n\tgetDailyArticleCounts(contentType);\n\tawait getWeeklyArticleCounts(pageId, tags, contentType);\n\n\treturn {\n\t\tdailyArticleHistory: window.guardian.dailyArticleCount ?? [],\n\t\tweeklyArticleHistory: window.guardian.weeklyArticleCount ?? [],\n\t};\n};\n\nexport const useArticleCounts = (\n\tpageId: string,\n\ttags: TagType[],\n\tcontentType: string,\n): ArticleCounts | undefined | 'Pending' => {\n\tconst [articleCounts, setArticleCounts] = useState<\n\t\tArticleCounts | undefined | 'Pending'\n\t>('Pending');\n\n\tuseEffect(() => {\n\t\tgetArticleCounts(pageId, tags, contentType)\n\t\t\t.then(setArticleCounts)\n\t\t\t.catch(() => setArticleCounts(undefined));\n\t}, [contentType, pageId, tags]);\n\n\treturn articleCounts;\n};\n","const FORCE_BRAZE_ALLOWLIST = [\n\t'preview.gutools.co.uk',\n\t'preview.code.dev-gutools.co.uk',\n\tprocess.env.HOSTNAME ?? 'localhost',\n\t'm.thegulocal.com',\n];\n\ntype Meta = {\n\tdataFromBraze: {\n\t\t[key: string]: string;\n\t};\n\tlogImpressionWithBraze: () => void;\n\tlogButtonClickWithBraze: (id: number) => void;\n};\n\nexport const getBrazeMetaFromUrlFragment = (): Meta | null => {\n\tif (window.location.hash) {\n\t\t// This is intended for use on development domains for preview purposes.\n\t\t// It won't run in PROD.\n\n\t\tconst key = 'force-braze-message';\n\n\t\tconst hashString = window.location.hash;\n\n\t\tif (hashString.includes(key)) {\n\t\t\tif (!FORCE_BRAZE_ALLOWLIST.includes(window.location.hostname)) {\n\t\t\t\tconsole.log(`${key} is not supported on this domain`);\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst forcedMessage = hashString.slice(\n\t\t\t\thashString.indexOf(`${key}=`) + key.length + 1,\n\t\t\t\thashString.length,\n\t\t\t);\n\n\t\t\ttry {\n\t\t\t\tconst dataFromBraze = JSON.parse(\n\t\t\t\t\tdecodeURIComponent(forcedMessage),\n\t\t\t\t);\n\n\t\t\t\treturn {\n\t\t\t\t\tdataFromBraze,\n\t\t\t\t\tlogImpressionWithBraze: () => {},\n\t\t\t\t\tlogButtonClickWithBraze: () => {},\n\t\t\t\t};\n\t\t\t} catch (e) {\n\t\t\t\tconst error = e as Error;\n\t\t\t\t// Parsing failed. Log a message and fall through.\n\n\t\t\t\tconsole.log(`There was an error with ${key}: `, error.message);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn null;\n};\n","import type { TagType } from '../../types/tag';\n\nconst tagId = 'news/series/cotton-capital';\n\nexport const suppressForTaylorReport = (tags: TagType[]): boolean =>\n\twindow.guardian.config.switches.brazeTaylorReport === true &&\n\t!tags.find((tag) => tag.id === tagId);\n","import {\n\tgetCookie,\n\tisUndefined,\n\tonConsentChange,\n\tstorage,\n} from '@guardian/libs';\nimport type { HeaderPayload } from '@guardian/support-dotcom-components/dist/dotcom/types';\nimport { useEffect, useState } from 'react';\nimport type { ArticleDeprecated } from '../types/article';\nimport type { DCRFrontType } from '../types/front';\nimport type { DCRNewslettersPageType } from '../types/newslettersPage';\nimport type { DCRTagPageType } from '../types/tagPage';\n\n// User Attributes API cookies (created on sign-in)\nexport const HIDE_SUPPORT_MESSAGING_COOKIE = 'gu_hide_support_messaging';\nexport const RECURRING_CONTRIBUTOR_COOKIE = 'gu_recurring_contributor';\nexport const OPT_OUT_OF_ARTICLE_COUNT_COOKIE = 'gu_article_count_opt_out';\n\n// Support Frontend cookie (created when a contribution is made)\nexport const SUPPORT_ONE_OFF_CONTRIBUTION_COOKIE =\n\t'gu.contributions.contrib-timestamp';\n\n//  Local storage keys\nconst WEEKLY_ARTICLE_COUNT_KEY = 'gu.history.weeklyArticleCount';\nexport const NO_RR_BANNER_KEY = 'gu.noRRBanner';\n\n// See https://github.com/guardian/support-dotcom-components/blob/main/module-versions.md\nexport const MODULES_VERSION = 'v3';\n\n// Returns true if we should hide support messaging because the user is a supporter.\n// Checks the cookie that is set by the User Attributes API upon signing in.\n// Value computed server-side and looks at all of the user's active products,\n// including but not limited to recurring & one-off contributions,\n// paper & digital subscriptions, as well as user tiers (GU supporters/staff/partners/patrons).\n// https://github.com/guardian/members-data-api/blob/3a72dc00b9389968d91e5930686aaf34d8040c52/membership-attribute-service/app/models/Attributes.scala\nexport const hasSupporterCookie = (\n\tisSignedIn: boolean,\n): boolean | 'Pending' => {\n\tconst cookie = getCookie({ name: HIDE_SUPPORT_MESSAGING_COOKIE });\n\tswitch (cookie) {\n\t\tcase 'true':\n\t\t\treturn true;\n\t\tcase 'false':\n\t\t\treturn false;\n\t\tdefault:\n\t\t\t/**\n\t\t\t * If cookie is not present but user is signed in, we do not want to show any messaging.\n\t\t\t * This is because of a race condition on the first page view after signing in, where\n\t\t\t * we may be awaiting the response from the API to find out if they're a supporter.\n\t\t\t */\n\t\t\tif (isSignedIn) {\n\t\t\t\treturn 'Pending';\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t}\n};\n\n// looks at the SUPPORT_ONE_OFF_CONTRIBUTION_COOKIE (set by support-frontend when making one-off contribution)\n// and returns a Unix epoch int of the date if it exists.\nexport const getLastOneOffContributionTimestamp = (): number | undefined => {\n\t// Support cookies - expects Unix epoch\n\tconst contributionDateFromSupport = getCookie({\n\t\tname: SUPPORT_ONE_OFF_CONTRIBUTION_COOKIE,\n\t});\n\n\tif (!contributionDateFromSupport) {\n\t\treturn undefined;\n\t}\n\n\t// Parse dates into common a number\n\tconst parsedDateFromSupport = contributionDateFromSupport\n\t\t? parseInt(contributionDateFromSupport, 10)\n\t\t: 0;\n\n\treturn parsedDateFromSupport || undefined; // This guards against 'parsedDateFromSupport' being NaN\n};\n\nconst dateDiffDays = (from: number, to: number): number => {\n\tconst oneDayMs = 1000 * 60 * 60 * 24;\n\tconst diffMs = to - from;\n\treturn Math.floor(diffMs / oneDayMs);\n};\n\nconst AskPauseDays = 90;\n\nexport const isRecentOneOffContributor = (): boolean => {\n\tconst lastContributionDate = getLastOneOffContributionTimestamp();\n\tif (!isUndefined(lastContributionDate)) {\n\t\tconst now = Date.now();\n\t\treturn dateDiffDays(lastContributionDate, now) <= AskPauseDays;\n\t}\n\n\treturn false;\n};\n\nexport const shouldHideSupportMessaging = (\n\tisSignedIn: boolean,\n): boolean | 'Pending' => {\n\tconst hasCookie = hasSupporterCookie(isSignedIn);\n\tif (hasCookie === 'Pending') {\n\t\treturn 'Pending';\n\t} else {\n\t\treturn hasCookie || isRecentOneOffContributor();\n\t}\n};\n\nexport const REQUIRED_CONSENTS_FOR_ARTICLE_COUNT = [1, 3, 7];\nconst REQUIRED_CONSENTS_FOR_BROWSER_ID = [1, 3, 5, 7];\n\nexport const hasArticleCountOptOutCookie = (): boolean =>\n\tgetCookie({ name: OPT_OUT_OF_ARTICLE_COUNT_COOKIE }) !== null;\n\nconst removeWeeklyArticleCountsFromLocalStorage = () =>\n\tstorage.local.remove(WEEKLY_ARTICLE_COUNT_KEY);\n\nexport const hasCmpConsentForWeeklyArticleCount = (): Promise<boolean> => {\n\treturn new Promise((resolve) => {\n\t\tif (getCookie({ name: 'gu-cmp-disabled', shouldMemoize: true })) {\n\t\t\tresolve(true);\n\t\t}\n\t\tonConsentChange(({ usnat, tcfv2, aus }) => {\n\t\t\tif (usnat ?? aus) {\n\t\t\t\tresolve(true);\n\t\t\t} else if (tcfv2) {\n\t\t\t\tconst hasRequiredConsents =\n\t\t\t\t\tREQUIRED_CONSENTS_FOR_ARTICLE_COUNT.every(\n\t\t\t\t\t\t(consent) => tcfv2.consents[consent],\n\t\t\t\t\t);\n\n\t\t\t\tif (!hasRequiredConsents) {\n\t\t\t\t\tremoveWeeklyArticleCountsFromLocalStorage();\n\t\t\t\t}\n\t\t\t\tresolve(hasRequiredConsents);\n\t\t\t}\n\t\t});\n\t});\n};\n\nexport const hasOptedOutOfArticleCount = async (): Promise<boolean> => {\n\tconst hasCmpConsent = await hasCmpConsentForWeeklyArticleCount();\n\treturn !hasCmpConsent || hasArticleCountOptOutCookie();\n};\n\nexport const hasOptedOutOfWeeklyArticleCount = async (): Promise<boolean> => {\n\tconst hasCmpConsent = await hasCmpConsentForWeeklyArticleCount();\n\treturn !hasCmpConsent || hasArticleCountOptOutCookie();\n};\n\n// A hook to find out if a user has opted out of article counting\nexport const useHasOptedOutOfArticleCount = (): boolean | 'Pending' => {\n\tconst [hasOptedOut, setHasOptedOut] = useState<boolean | 'Pending'>(\n\t\t'Pending',\n\t);\n\n\tuseEffect(() => {\n\t\thasOptedOutOfArticleCount()\n\t\t\t.then(setHasOptedOut)\n\t\t\t.catch(() => setHasOptedOut(true));\n\t}, []);\n\n\treturn hasOptedOut;\n};\n\nexport const hasCmpConsentForBrowserId = (): Promise<boolean> =>\n\tnew Promise((resolve) => {\n\t\tif (getCookie({ name: 'gu-cmp-disabled', shouldMemoize: true })) {\n\t\t\tresolve(true);\n\t\t}\n\t\tonConsentChange(({ usnat, tcfv2, aus }) => {\n\t\t\tif (usnat ?? aus) {\n\t\t\t\tresolve(true);\n\t\t\t} else if (tcfv2) {\n\t\t\t\tconst hasRequiredConsents =\n\t\t\t\t\tREQUIRED_CONSENTS_FOR_BROWSER_ID.every(\n\t\t\t\t\t\t(consent) => tcfv2.consents[consent],\n\t\t\t\t\t);\n\t\t\t\tresolve(hasRequiredConsents);\n\t\t\t}\n\t\t});\n\t});\n\nconst twentyMins = 20 * 60000;\nexport const withinLocalNoBannerCachePeriod = (): boolean =>\n\t!!storage.local.get(NO_RR_BANNER_KEY);\n\nexport const setLocalNoBannerCachePeriod = (now: number = Date.now()): void =>\n\tstorage.local.set(NO_RR_BANNER_KEY, true, now + twentyMins);\n\n// Returns true if banner was closed in the last hour\nconst ONE_HOUR_IN_MS = 1000 * 60 * 60;\nexport const recentlyClosedBanner = (\n\tlastClosedAt?: string,\n\tnow = Date.now(),\n): boolean => {\n\tif (lastClosedAt) {\n\t\treturn now - new Date(lastClosedAt).getTime() < ONE_HOUR_IN_MS;\n\t}\n\treturn false;\n};\n\nexport const getContributionsServiceUrl = (\n\tconfig:\n\t\t| ArticleDeprecated\n\t\t| DCRFrontType\n\t\t| DCRTagPageType\n\t\t| DCRNewslettersPageType,\n): string => process.env.SDC_URL ?? config.contributionsServiceUrl;\n\ntype PurchaseInfo = HeaderPayload['targeting']['purchaseInfo'];\nexport const getPurchaseInfo = (): PurchaseInfo => {\n\tconst purchaseInfoRaw = getCookie({\n\t\tname: 'GU_CO_COMPLETE',\n\t\tshouldMemoize: true,\n\t});\n\n\tif (!purchaseInfoRaw) {\n\t\treturn undefined;\n\t}\n\n\tlet purchaseInfo: PurchaseInfo;\n\n\ttry {\n\t\tpurchaseInfo = JSON.parse(decodeURIComponent(purchaseInfoRaw));\n\t} catch {} // eslint-disable-line no-empty -- silently handle error\n\n\treturn purchaseInfo;\n};\n","import { isObject, storage } from '@guardian/libs';\n\nexport interface DailyArticle {\n\tday: number;\n\tcount: number;\n}\n\nexport type DailyArticleHistory = Array<DailyArticle>;\n\nexport const DailyArticleCountKey = 'gu.history.dailyArticleCount';\n\nconst isValidHistory = (history: unknown): history is DailyArticleHistory =>\n\tArray.isArray(history) &&\n\thistory.every(\n\t\t(daily) =>\n\t\t\tisObject(daily) &&\n\t\t\t'day' in daily &&\n\t\t\t'count' in daily &&\n\t\t\ttypeof daily.day === 'number' &&\n\t\t\ttypeof daily.count === 'number',\n\t);\n\n// Returns undefined if no daily article count in local storage\nexport const getDailyArticleCount = (): DailyArticleHistory | undefined => {\n\ttry {\n\t\tconst dailyCount = storage.local.get(DailyArticleCountKey);\n\n\t\tif (!isValidHistory(dailyCount)) {\n\t\t\tthrow new Error('Invalid gu.history.dailyArticleCount value');\n\t\t}\n\n\t\treturn dailyCount;\n\t} catch (e) {\n\t\t// error parsing the string, so remove the key\n\t\tstorage.local.remove(DailyArticleCountKey);\n\t\treturn undefined;\n\t}\n};\n\nexport const getToday = (): number => Math.floor(Date.now() / 86_400_000);\n\nexport const incrementDailyArticleCount = (): void => {\n\t// get the daily article count from local storage\n\tconst dailyArticleCount = getDailyArticleCount() ?? [];\n\n\t// calculate days since unix epoch for today date\n\tconst today = getToday();\n\n\t// check if latest day is today and increment if so\n\tif (dailyArticleCount[0]?.day === today) {\n\t\tdailyArticleCount[0].count += 1;\n\t} else {\n\t\t// else set new day\n\t\tdailyArticleCount.unshift({ day: today, count: 1 });\n\n\t\t// remove any days older than 60\n\t\tconst cutOff = today - 60;\n\n\t\tconst firstOldDayIndex = dailyArticleCount.findIndex(\n\t\t\t(dailyCount) => dailyCount.day && dailyCount.day < cutOff,\n\t\t);\n\n\t\tif (firstOldDayIndex > 0) {\n\t\t\tdailyArticleCount.splice(firstOldDayIndex);\n\t\t}\n\t}\n\n\t// set the latest article count\n\tstorage.local.set(DailyArticleCountKey, dailyArticleCount);\n};\n","import type { IdApiUserData } from './getIdapiUserData';\nimport { getIdApiUserData } from './getIdapiUserData';\nimport { eitherInOktaTestOrElse } from './identity';\n\nconst getEmail = async (ajaxUrl: string): Promise<string | undefined> =>\n\t// TODO Okta: Remove either when at 100% in oktaVariant test, and just use idToken\n\teitherInOktaTestOrElse(\n\t\t(authState) => authState.idToken?.claims.email,\n\t\t() =>\n\t\t\tgetIdApiUserData(ajaxUrl)\n\t\t\t\t.then((data: IdApiUserData) => data.user?.primaryEmailAddress)\n\t\t\t\t.catch((error) => {\n\t\t\t\t\twindow.guardian.modules.sentry.reportError(\n\t\t\t\t\t\terror,\n\t\t\t\t\t\t'getEmail',\n\t\t\t\t\t);\n\t\t\t\t\treturn undefined;\n\t\t\t\t}),\n\t);\n\n/**\n * Attempts to fetch a signed in user's email address either from okta token or falling back to IdApi request.\n * Returns null if no email address is found or if the request times out after 1 second.\n * @param {string} idapiUrl - Idapi url available from window.guardian.config.page\n */\nexport const lazyFetchEmailWithTimeout =\n\t(idapiUrl: string): (() => Promise<string | null>) =>\n\t() => {\n\t\treturn new Promise((resolve) => {\n\t\t\tsetTimeout(() => resolve(null), 1000);\n\t\t\tvoid getEmail(idapiUrl).then((email) => {\n\t\t\t\tif (email) {\n\t\t\t\t\tresolve(email);\n\t\t\t\t} else {\n\t\t\t\t\tresolve(null);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t};\n","import { joinUrl } from '@guardian/libs';\n\nexport interface IdApiUserData {\n\tuser?: {\n\t\tprimaryEmailAddress?: string;\n\t\tprivateFields?: {\n\t\t\tbrazeUuid?: string;\n\t\t};\n\t};\n}\n\nexport interface IdApiUserIdentifiers {\n\tid: string;\n\tbrazeUuid: string;\n\tpuzzleId: string;\n\tgoogleTagId: string;\n}\n\nfunction checkForErrors(response: Response) {\n\tif (!response.ok) {\n\t\tthrow Error(\n\t\t\tresponse.statusText ||\n\t\t\t\t`getIdApiUserData | An api call returned HTTP status ${response.status}`,\n\t\t);\n\t}\n\treturn response;\n}\n\nconst callApi = (url: string) => {\n\treturn fetch(url, {\n\t\tcredentials: 'include',\n\t})\n\t\t.then(checkForErrors)\n\t\t.then((response) => response.json());\n};\n\nconst cache: {\n\tidapiUserMeResponse?: Promise<IdApiUserData>;\n\tidapiUserIdentifiersResponse?: Promise<IdApiUserIdentifiers>;\n} = {};\n\nexport const getIdApiUserData = (ajaxUrl: string): Promise<IdApiUserData> => {\n\tif (!cache.idapiUserMeResponse) {\n\t\tconst url = joinUrl(ajaxUrl, 'user/me');\n\t\tcache.idapiUserMeResponse = callApi(url);\n\t}\n\treturn cache.idapiUserMeResponse;\n};\n\nexport const getIdapiUserIdentifiers = (\n\tajaxUrl: string,\n): Promise<IdApiUserIdentifiers> => {\n\tif (!cache.idapiUserIdentifiersResponse) {\n\t\tconst url = joinUrl(ajaxUrl, 'user/me/identifiers');\n\t\tcache.idapiUserIdentifiersResponse = callApi(url);\n\t}\n\treturn cache.idapiUserIdentifiersResponse;\n};\n","import { isUndefined, startPerformanceMeasure } from '@guardian/libs';\nimport { getOphan } from '../client/ophan/ophan';\nimport type { RenderingTarget } from '../types/renderingTarget';\n\nexport type MaybeFC = React.FC | null;\ntype ShowMessage<T> = (meta: T) => MaybeFC;\n\ninterface ShouldShow<T> {\n\tshow: true;\n\tmeta: T;\n}\ninterface ShouldNotShow {\n\tshow: false;\n}\nexport type CanShowResult<T> = ShouldShow<T> | ShouldNotShow;\n\ntype Candidate<T> = {\n\tid: string;\n\tshow: ShowMessage<T>;\n\tcanShow: () => Promise<CanShowResult<T>>;\n};\n\nexport type CandidateConfig<T> = {\n\tcandidate: Candidate<T>;\n\ttimeoutMillis: number | null;\n\treportTiming?: boolean;\n};\n\ntype CandidateConfigWithTimeout<T> = CandidateConfig<T> & {\n\tcancelTimeout: () => void;\n};\n\nexport type SlotConfig = {\n\tcandidates: CandidateConfig<any>[];\n\tname: string;\n};\n\nconst recordMessageTimeoutInOphan = async (\n\tcandidateId: string,\n\tslotName: string,\n\trenderingTarget: RenderingTarget,\n) => {\n\tconst ophan = await getOphan(renderingTarget);\n\tophan.record({\n\t\t// @ts-expect-error -- Type 'string' is not assignable to type 'ComponentV2'.\n\t\t// the relevant team should remove this call as it is dropped by Ophan\n\t\t// see https://github.com/guardian/dotcom-rendering/pull/11438 further context\n\t\tcomponent: `${slotName}-picker-timeout-dcr`,\n\t\tvalue: candidateId,\n\t});\n};\n\nconst timeoutify = <T>(\n\tcandidateConfig: CandidateConfig<T>,\n\tslotName: string,\n\trenderingTarget: RenderingTarget,\n): CandidateConfigWithTimeout<T> => {\n\tlet timer: number | undefined;\n\n\tconst canShow = (): Promise<CanShowResult<T>> =>\n\t\tnew Promise((resolve) => {\n\t\t\tconst perfName = `messagePicker-canShow-${candidateConfig.candidate.id}`;\n\t\t\tconst { endPerformanceMeasure } = startPerformanceMeasure(\n\t\t\t\t'tx',\n\t\t\t\tperfName,\n\t\t\t);\n\n\t\t\tif (candidateConfig.timeoutMillis !== null) {\n\t\t\t\ttimer = window.setTimeout(() => {\n\t\t\t\t\tvoid recordMessageTimeoutInOphan(\n\t\t\t\t\t\tcandidateConfig.candidate.id,\n\t\t\t\t\t\tslotName,\n\t\t\t\t\t\trenderingTarget,\n\t\t\t\t\t);\n\t\t\t\t\tresolve({ show: false });\n\t\t\t\t}, candidateConfig.timeoutMillis);\n\t\t\t}\n\n\t\t\tcandidateConfig.candidate\n\t\t\t\t.canShow()\n\t\t\t\t.then((result) => {\n\t\t\t\t\tresolve(result);\n\n\t\t\t\t\tconst canShowTimeTaken = endPerformanceMeasure();\n\n\t\t\t\t\tif (candidateConfig.reportTiming) {\n\t\t\t\t\t\tvoid getOphan(renderingTarget).then((ophan) => {\n\t\t\t\t\t\t\tophan.record({\n\t\t\t\t\t\t\t\t// @ts-expect-error -- the relevant team should remove this call as it is dropped by Ophan\n\t\t\t\t\t\t\t\t// see https://github.com/guardian/dotcom-rendering/pull/11438 further context\n\t\t\t\t\t\t\t\tcomponent: perfName,\n\t\t\t\t\t\t\t\tvalue: canShowTimeTaken,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t\tconsole.error(`timeoutify candidate - error: ${String(e)}`),\n\t\t\t\t);\n\t\t});\n\n\tconst cancelTimeout = () => !isUndefined(timer) && clearTimeout(timer);\n\n\treturn {\n\t\t...candidateConfig,\n\t\tcandidate: {\n\t\t\t...candidateConfig.candidate,\n\t\t\tcanShow,\n\t\t},\n\t\tcancelTimeout,\n\t};\n};\n\nconst clearAllTimeouts = (messages: CandidateConfigWithTimeout<any>[]) =>\n\tmessages.map((m) => m.cancelTimeout());\n\nconst defaultShow = () => null;\n\ninterface PendingMessage<T> {\n\tcandidateConfig: CandidateConfigWithTimeout<T>;\n\tcanShow: Promise<CanShowResult<T>>;\n}\n\ninterface WinningMessage<T> {\n\tmeta: T;\n\tcandidate: Candidate<T>;\n}\n\nexport const pickMessage = (\n\t{ candidates, name }: SlotConfig,\n\trenderingTarget: RenderingTarget,\n): Promise<() => MaybeFC> =>\n\tnew Promise((resolve) => {\n\t\tconst candidateConfigsWithTimeout = candidates.map((c) =>\n\t\t\ttimeoutify(c, name, renderingTarget),\n\t\t);\n\t\tconst results: PendingMessage<any>[] = candidateConfigsWithTimeout.map(\n\t\t\t(candidateConfig) => ({\n\t\t\t\tcandidateConfig,\n\t\t\t\tcanShow: candidateConfig.candidate.canShow(),\n\t\t\t}),\n\t\t);\n\n\t\tconst winnerResult = results.reduce<\n\t\t\tPromise<WinningMessage<any> | null>\n\t\t>(async (winningMessageSoFar, { candidateConfig, canShow }) => {\n\t\t\tif (await winningMessageSoFar) {\n\t\t\t\treturn winningMessageSoFar;\n\t\t\t}\n\n\t\t\tconst result = await canShow;\n\t\t\tcandidateConfig.cancelTimeout();\n\t\t\tif (result.show) {\n\t\t\t\treturn {\n\t\t\t\t\tcandidate: candidateConfig.candidate,\n\t\t\t\t\tmeta: result.meta,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn winningMessageSoFar;\n\t\t}, Promise.resolve(null));\n\n\t\twinnerResult\n\t\t\t.then((winner) => {\n\t\t\t\tclearAllTimeouts(candidateConfigsWithTimeout);\n\n\t\t\t\tif (winner === null) {\n\t\t\t\t\tresolve(defaultShow);\n\t\t\t\t} else {\n\t\t\t\t\tconst { candidate, meta } = winner;\n\t\t\t\t\tresolve(() => candidate.show(meta));\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((e) =>\n\t\t\t\tconsole.error(`pickMessage winner - error: ${String(e)}`),\n\t\t\t);\n\t});\n","import * as emotionReact from '@emotion/react';\nimport * as emotionReactJsxRuntime from '@emotion/react/jsx-runtime';\nimport React from 'react';\n\nlet hasAutomatBeenSet = false;\n\nexport const setAutomat = (): void => {\n\tif (!hasAutomatBeenSet) {\n\t\twindow.guardian.automat = {\n\t\t\temotionReact,\n\t\t\temotionReactJsxRuntime,\n\t\t\treact: React,\n\t\t};\n\t\thasAutomatBeenSet = true;\n\t}\n};\n","import { useEffect, useState } from 'react';\nimport type { AuthStatus } from './identity';\nimport {\n\teitherInOktaTestOrElse,\n\tgetSignedInStatusWithCookies,\n\tgetSignedInStatusWithOkta,\n} from './identity';\n\n/**\n * A hook to find out if a user is signed in.\n * Returns `'Pending'` until status is known.\n * Always returns `'Pending'` during server-side rendering.\n * */\nexport const useIsSignedIn = (): boolean | 'Pending' => {\n\tconst authStatus = useAuthStatus();\n\tswitch (authStatus.kind) {\n\t\tcase 'Pending':\n\t\t\treturn 'Pending';\n\t\tcase 'SignedInWithCookies':\n\t\tcase 'SignedInWithOkta':\n\t\t\treturn true;\n\t\tcase 'SignedOutWithCookies':\n\t\tcase 'SignedOutWithOkta':\n\t\t\treturn false;\n\t}\n};\n\nexport const useAuthStatus = (): AuthStatus => {\n\tconst [authStatus, setAuthStatus] = useState<AuthStatus>({\n\t\tkind: 'Pending',\n\t});\n\n\tuseEffect(() => {\n\t\teitherInOktaTestOrElse(\n\t\t\t(oktaAuthState) => {\n\t\t\t\tsetAuthStatus(getSignedInStatusWithOkta(oktaAuthState));\n\t\t\t},\n\t\t\t() => setAuthStatus(getSignedInStatusWithCookies()),\n\t\t).catch((error) => {\n\t\t\tconsole.error(error);\n\t\t});\n\t}, []);\n\n\treturn authStatus;\n};\n","import { storage } from '@guardian/libs';\n\nconst KEY = 'gu.brazeUserSet';\n\nconst hasCurrentBrazeUser = (): boolean => {\n\treturn storage.local.getRaw(KEY) === 'true';\n};\n\nconst setHasCurrentBrazeUser = (): void => {\n\tstorage.local.setRaw(KEY, 'true');\n};\n\nconst clearHasCurrentBrazeUser = (): void => {\n\tstorage.local.remove(KEY);\n};\n\nexport {\n\thasCurrentBrazeUser,\n\tsetHasCurrentBrazeUser,\n\tclearHasCurrentBrazeUser,\n};\n","import type { IdApiUserIdentifiers } from './getIdapiUserData';\nimport { getIdapiUserIdentifiers } from './getIdapiUserData';\nimport { eitherInOktaTestOrElse } from './identity';\n\nexport const getBrazeUuid = async (ajaxUrl: string): Promise<string | void> =>\n\t// TODO Okta: Remove either when at 100% in oktaVariant test, and just use idToken\n\teitherInOktaTestOrElse(\n\t\t(authState) => authState.idToken?.claims.braze_uuid,\n\t\t() =>\n\t\t\tgetIdapiUserIdentifiers(ajaxUrl)\n\t\t\t\t.then((data: IdApiUserIdentifiers) => data.brazeUuid)\n\t\t\t\t.catch((error) => {\n\t\t\t\t\twindow.guardian.modules.sentry.reportError(\n\t\t\t\t\t\terror,\n\t\t\t\t\t\t'getBrazeUuid',\n\t\t\t\t\t);\n\t\t\t\t}),\n\t);\n","import { getConsentFor, onConsentChange } from '@guardian/libs';\n\nconst hasRequiredConsents = (): Promise<boolean> =>\n\tnew Promise((resolve, reject) => {\n\t\tonConsentChange((state) => {\n\t\t\ttry {\n\t\t\t\tresolve(getConsentFor('braze', state));\n\t\t\t} catch (e) {\n\t\t\t\treject(e);\n\t\t\t}\n\t\t});\n\t});\n\nexport { hasRequiredConsents };\n","import { getBrazeUuid } from '../getBrazeUuid';\nimport { hasRequiredConsents } from './hasRequiredConsents';\n\ntype SuccessResult = {\n\tisSuccessful: true;\n\tdata: ResultData;\n};\n\ntype FailureResult = {\n\tisSuccessful: false;\n\tfailure: {\n\t\tfield: string;\n\t\tdata: any;\n\t};\n\tdata: ResultData;\n};\n\ntype DependenciesResult = SuccessResult | FailureResult;\n\ntype ResultData = { [key: string]: string | boolean };\n\ntype DependencyResult = {\n\tname: string;\n\tvalue: Promise<string | boolean | null | undefined | void>;\n};\nconst buildFailureResponse = (name: string, value: any, data: ResultData) => ({\n\tisSuccessful: false,\n\tfailure: {\n\t\tfield: name,\n\t\tdata: value,\n\t},\n\tdata,\n});\n\nconst buildDependencies = (\n\tisSignedIn: boolean,\n\tidApiUrl: string,\n): DependencyResult[] => {\n\treturn [\n\t\t{\n\t\t\tname: 'apiKey',\n\t\t\tvalue: Promise.resolve(window.guardian.config.page.brazeApiKey),\n\t\t},\n\t\t{\n\t\t\tname: 'brazeSwitch',\n\t\t\tvalue: Promise.resolve(window.guardian.config.switches.brazeSwitch),\n\t\t},\n\t\t{\n\t\t\tname: 'brazeUuid',\n\t\t\tvalue: isSignedIn ? getBrazeUuid(idApiUrl) : Promise.resolve(null),\n\t\t},\n\t\t{\n\t\t\tname: 'consent',\n\t\t\tvalue: hasRequiredConsents(),\n\t\t},\n\t\t{\n\t\t\tname: 'isNotPaidContent',\n\t\t\tvalue: Promise.resolve(!window.guardian.config.page.isPaidContent),\n\t\t},\n\t];\n};\n\nconst checkBrazeDependencies = async (\n\tisSignedIn: boolean,\n\tidApiUrl: string,\n): Promise<DependenciesResult> => {\n\tconst dependencies = buildDependencies(isSignedIn, idApiUrl);\n\n\tconst data: ResultData = {};\n\n\t// I think we could possibly clean this up a bit when we can use\n\t// Promise.allSettled reliably (it's not available in our current Node\n\t// version and polyfill.io doesn't have a polyfill yet).\n\tfor (const { name, value } of dependencies) {\n\t\ttry {\n\t\t\tconst result = await value;\n\n\t\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions -- TODO: Complex types, look into this further\n\t\t\tif (result) {\n\t\t\t\tdata[name] = result;\n\t\t\t} else {\n\t\t\t\treturn buildFailureResponse(name, result, data);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\treturn buildFailureResponse(\n\t\t\t\tname,\n\t\t\t\te instanceof Error ? e.message : e,\n\t\t\t\tdata,\n\t\t\t);\n\t\t}\n\t}\n\n\treturn {\n\t\tisSuccessful: true,\n\t\tdata,\n\t};\n};\n\nexport { checkBrazeDependencies };\n","import type appboy from '@braze/web-sdk-core';\nimport { isUndefined, log } from '@guardian/libs';\n\nconst SDK_OPTIONS: appboy.InitializationOptions = {\n\tenableLogging: true,\n\tnoCookies: true,\n\tbaseUrl: 'https://sdk.fra-01.braze.eu/api/v3',\n\tsessionTimeoutInSeconds: 1,\n\tminimumIntervalBetweenTriggerActionsInSeconds: 0,\n\tdevicePropertyAllowlist: [],\n};\n\nconst initialiseAppboy = async (apiKey: string): Promise<typeof appboy> => {\n\tconst importedAppboy = (await import(\n\t\t/* webpackChunkName: \"braze-web-sdk-core\" */ '@braze/web-sdk-core'\n\t)) as unknown as typeof appboy;\n\n\timportedAppboy.setLogger((message) => log('tx', message));\n\timportedAppboy.initialize(apiKey, SDK_OPTIONS);\n\n\treturn importedAppboy;\n};\n\nconst getInitialisedAppboy = (() => {\n\tlet cache: Promise<typeof appboy>;\n\n\treturn (apiKey: string): Promise<typeof appboy> => {\n\t\tif (isUndefined(cache)) {\n\t\t\tcache = initialiseAppboy(apiKey);\n\t\t}\n\n\t\treturn cache;\n\t};\n})();\n\nexport { getInitialisedAppboy };\n","import type {\n\tBrazeCardsInterface,\n\tBrazeMessagesInterface,\n} from '@guardian/braze-components/logic';\nimport {\n\tBrazeCards,\n\tBrazeMessages,\n\tcanRenderBrazeMsg,\n\tLocalMessageCache,\n\tNullBrazeCards,\n\tNullBrazeMessages,\n} from '@guardian/braze-components/logic';\nimport { log, startPerformanceMeasure, storage } from '@guardian/libs';\nimport { getOphan } from '../../client/ophan/ophan';\nimport type { RenderingTarget } from '../../types/renderingTarget';\nimport {\n\tclearHasCurrentBrazeUser,\n\thasCurrentBrazeUser,\n\tsetHasCurrentBrazeUser,\n} from '../hasCurrentBrazeUser';\nimport { checkBrazeDependencies } from './checkBrazeDependencies';\nimport { getInitialisedAppboy } from './initialiseAppboy';\n\nconst maybeWipeUserData = async (\n\tapiKey?: string,\n\tbrazeUuid?: null | string,\n\tconsent?: boolean,\n\tbrazeSwitch?: boolean,\n): Promise<void> => {\n\tconst hasCurrentBrazeUserValue = hasCurrentBrazeUser();\n\tconst userHasLoggedOut = !brazeUuid && hasCurrentBrazeUserValue;\n\tconst userHasRemovedConsent = !consent && hasCurrentBrazeUserValue;\n\tconst brazeHasBeenDisabled = !brazeSwitch && hasCurrentBrazeUserValue;\n\n\tif (userHasLoggedOut || userHasRemovedConsent || brazeHasBeenDisabled) {\n\t\ttry {\n\t\t\tif (apiKey) {\n\t\t\t\tconst appboy = await getInitialisedAppboy(apiKey);\n\t\t\t\tappboy.wipeData();\n\t\t\t}\n\t\t\tLocalMessageCache.clear();\n\t\t\tclearHasCurrentBrazeUser();\n\t\t} catch (error) {\n\t\t\twindow.guardian.modules.sentry.reportError(\n\t\t\t\t// @ts-expect-error\n\t\t\t\terror,\n\t\t\t\t'braze-maybeWipeUserData',\n\t\t\t);\n\t\t}\n\t}\n};\n\nexport const buildBrazeMessaging = async (\n\tidApiUrl: string,\n\tisSignedIn: boolean,\n\trenderingTarget: RenderingTarget,\n): Promise<{\n\tbrazeMessages: BrazeMessagesInterface;\n\tbrazeCards: BrazeCardsInterface;\n}> => {\n\tif (!storage.local.isAvailable()) {\n\t\t// we require local storage for using any message channel so that we know\n\t\t// when to clear up user data from the device on logout\n\t\treturn {\n\t\t\tbrazeMessages: new NullBrazeMessages(),\n\t\t\tbrazeCards: new NullBrazeCards(),\n\t\t};\n\t}\n\n\tconst dependenciesResult = await checkBrazeDependencies(\n\t\tisSignedIn,\n\t\tidApiUrl,\n\t);\n\n\tif (!dependenciesResult.isSuccessful) {\n\t\tconst { failure, data } = dependenciesResult;\n\n\t\tlog(\n\t\t\t'tx',\n\t\t\t`Not attempting to show Braze messages. Dependency ${\n\t\t\t\tfailure.field\n\t\t\t} failed with ${String(failure.data)}.`,\n\t\t);\n\n\t\tawait maybeWipeUserData(\n\t\t\tdata.apiKey as string | undefined,\n\t\t\tdata.brazeUuid as string | null | undefined,\n\t\t\tdata.consent as boolean | undefined,\n\t\t\tdata.brazeSwitch as boolean | undefined,\n\t\t);\n\n\t\treturn {\n\t\t\tbrazeMessages: new NullBrazeMessages(),\n\t\t\tbrazeCards: new NullBrazeCards(),\n\t\t};\n\t}\n\n\ttry {\n\t\tconst { endPerformanceMeasure } = startPerformanceMeasure(\n\t\t\t'tx',\n\t\t\t'braze-sdk-load',\n\t\t);\n\n\t\tconst appboy = await getInitialisedAppboy(\n\t\t\tdependenciesResult.data.apiKey as string,\n\t\t);\n\n\t\tconst sdkLoadTimeTaken = endPerformanceMeasure();\n\t\tconst ophan = await getOphan(renderingTarget);\n\t\tophan.record({\n\t\t\t// @ts-expect-error -- the relevant team should remove this call as it is dropped by Ophan\n\t\t\t// see https://github.com/guardian/dotcom-rendering/pull/11438 further context\n\t\t\tcomponent: 'braze-sdk-load-timing',\n\t\t\tvalue: sdkLoadTimeTaken,\n\t\t});\n\n\t\tconst errorHandler = (error: Error, desc: string) => {\n\t\t\twindow.guardian.modules.sentry.reportError(error, desc);\n\t\t};\n\n\t\tsetHasCurrentBrazeUser();\n\t\tappboy.changeUser(dependenciesResult.data.brazeUuid as string);\n\t\tappboy.openSession();\n\n\t\tconst brazeCards = window.guardian.config.switches.brazeContentCards\n\t\t\t? new BrazeCards(appboy, errorHandler)\n\t\t\t: new NullBrazeCards();\n\t\tconst brazeMessages = new BrazeMessages(\n\t\t\tappboy,\n\t\t\tLocalMessageCache,\n\t\t\terrorHandler,\n\t\t\tcanRenderBrazeMsg,\n\t\t);\n\t\treturn { brazeMessages, brazeCards };\n\t} catch {\n\t\treturn {\n\t\t\tbrazeMessages: new NullBrazeMessages(),\n\t\t\tbrazeCards: new NullBrazeCards(),\n\t\t};\n\t}\n};\n","import type {\n\tBrazeCardsInterface,\n\tBrazeMessagesInterface,\n} from '@guardian/braze-components/logic';\nimport {\n\tNullBrazeCards,\n\tNullBrazeMessages,\n} from '@guardian/braze-components/logic';\nimport useSWRImmutable from 'swr/immutable';\nimport type { RenderingTarget } from '../types/renderingTarget';\nimport { buildBrazeMessaging } from './braze/buildBrazeMessaging';\nimport { useAuthStatus } from './useAuthStatus';\n\n/**\n * Returns brazeMessaging as BrazeMessagesInterface and BrazeCardsInterface\n *\n * BrazeMessages is used to show single-impression messages (like ad impressions).\n * In contrast, BrazeCards can provide persistent user notifications.\n *\n * We're using useSWRImmutable to ensure this call is only made once\n * [doc]: https://swr.vercel.app/docs/revalidation#disable-automatic-revalidations\n */\nexport const useBraze = (\n\tidApiUrl: string,\n\trenderingTarget: RenderingTarget,\n): {\n\tbrazeMessages: BrazeMessagesInterface | undefined;\n\tbrazeCards: BrazeCardsInterface | undefined;\n} => {\n\tconst authStatus = useAuthStatus();\n\tconst isSignedIn =\n\t\tauthStatus.kind === 'SignedInWithOkta' ||\n\t\tauthStatus.kind === 'SignedInWithCookies';\n\n\tconst { data, error } = useSWRImmutable(\n\t\tauthStatus.kind !== 'Pending' ? 'braze-message' : null,\n\t\t() => buildBrazeMessaging(idApiUrl, isSignedIn, renderingTarget),\n\t);\n\n\tif (error) {\n\t\treturn {\n\t\t\tbrazeMessages: new NullBrazeMessages(),\n\t\t\tbrazeCards: new NullBrazeCards(),\n\t\t};\n\t}\n\n\treturn {\n\t\tbrazeMessages: data?.brazeMessages,\n\t\tbrazeCards: data?.brazeCards,\n\t};\n};\n","import { type CountryCode, isNonNullable } from '@guardian/libs';\nimport { useEffect, useState } from 'react';\nimport { getLocaleCode } from './getCountryCode';\n\nexport const useCountryCode = (feature: string): CountryCode | undefined => {\n\tconst [countryCode, setCountryCode] = useState<CountryCode>();\n\n\tuseEffect(() => {\n\t\tgetLocaleCode()\n\t\t\t.then((cc) => {\n\t\t\t\tif (isNonNullable(cc)) setCountryCode(cc);\n\t\t\t})\n\t\t\t.catch((e) => {\n\t\t\t\tconst msg = `Error fetching country code: ${String(e)}`;\n\t\t\t\twindow.guardian.modules.sentry.reportError(\n\t\t\t\t\tnew Error(msg),\n\t\t\t\t\tfeature,\n\t\t\t\t);\n\t\t\t});\n\t}, [feature]);\n\n\treturn countryCode;\n};\n","import libDebounce from 'lodash.debounce';\nimport { useCallback, useEffect, useRef, useState } from 'react';\n\n/**\n * This file was copied into the source development kitchen from the following repository:\n * https://github.com/guardian/csnx/blob/main/libs/%40guardian/source-development-kitchen/src/react-components/ticker/useIsInView.ts\n *\n * Note: This version of the file uses `lodash.debounce`, whereas the original version does not.\n * As a result, we now have two versions of the `useIsInView` hookone with `lodash.debounce` and one without.\n *\n * A discussion is needed to determine the best approach for consolidating these two versions into a single file.\n * Consider whether the use of `lodash.debounce` is necessary, and if so, integrate it into the consolidated version.\n */\n\ntype Options = {\n\t/**\n\t * Defaults to `undefined` (falsy),\n\t * which trigger a change the instantaneously.\n\t *\n\t * If `true`, debounce triggers by 200ms.\n\t * Enabling debouncing ensures the target element intersects\n\t * for at least 200ms before the callback is executed\n\t */\n\tdebounce?: true;\n\t/**\n\t * Defaults to `undefined` (falsy),\n\t * which only trigger on the first intersection.\n\t *\n\t * If `true`, trigger the hook on all intersections.\n\t */\n\trepeat?: true;\n\t/** Set the initial HTML Element, if known. */\n\tnode?: HTMLElement;\n};\n\n/**\n * Custom hook around the `IntersectionObserver`.\n *\n * @returns a tuple containing `[isInView, setNode]`\n */\nconst useIsInView = (\n\toptions: IntersectionObserverInit & Options,\n): [boolean, React.Dispatch<React.SetStateAction<HTMLElement | null>>] => {\n\tconst [isInView, setIsInView] = useState<boolean>(false);\n\tconst [node, setNode] = useState<HTMLElement | null>(options.node ?? null);\n\n\tconst observer = useRef<IntersectionObserver | null>(null);\n\n\tconst intersectionObserverCallback =\n\t\tuseCallback<IntersectionObserverCallback>(\n\t\t\t([entry]) => {\n\t\t\t\tif (!entry) return;\n\n\t\t\t\tif (entry.isIntersecting) {\n\t\t\t\t\tsetIsInView(true);\n\t\t\t\t} else if (options.repeat) {\n\t\t\t\t\tsetIsInView(false);\n\t\t\t\t}\n\t\t\t},\n\t\t\t[options.repeat],\n\t\t);\n\n\tconst intersectionCallback = options.debounce\n\t\t? libDebounce(intersectionObserverCallback, 200)\n\t\t: intersectionObserverCallback;\n\n\tuseEffect(() => {\n\t\toptions.node && setNode(options.node);\n\t}, [options.node]);\n\n\tuseEffect(() => {\n\t\tif (!node) return;\n\t\t// Check for browser support https://caniuse.com/intersectionobserver\n\t\tif (!('IntersectionObserver' in window)) return;\n\n\t\tobserver.current = new window.IntersectionObserver(\n\t\t\tintersectionCallback,\n\t\t\toptions,\n\t\t);\n\n\t\tobserver.current.observe(node);\n\n\t\treturn () => observer.current?.disconnect();\n\t}, [node, options, intersectionCallback]);\n\n\tuseEffect(() => {\n\t\tif (!options.repeat && isInView) observer.current?.disconnect();\n\t}, [isInView, options.repeat]);\n\n\treturn [isInView, setNode];\n};\n\nexport { useIsInView };\n","import { isUndefined } from '@guardian/libs';\nimport { useEffect, useState } from 'react';\nimport type { NonEmptyArray } from './tuple';\n\n/**\n * Ensures that the given task is only run once and only after all items in waitFor are defined\n * @param {Function} task - The task to execute once\n * @param {Array} waitFor - An array of variables that must be defined before the task is executed\n * */\nexport const useOnce = (\n\ttask: () => void,\n\twaitFor: NonEmptyArray<unknown>,\n): void => {\n\tconst [alreadyRun, setAlreadyRun] = useState(false);\n\tconst isReady = waitFor.every((dep) => !isUndefined(dep));\n\tuseEffect(() => {\n\t\tif (!alreadyRun && isReady) {\n\t\t\ttask();\n\t\t\tsetAlreadyRun(true);\n\t\t}\n\t}, [alreadyRun, isReady, task]);\n};\n"],"names":["reTrim","reIsBadHex","reIsBinary","reIsOctal","freeParseInt","parseInt","freeGlobal","g","Object","freeSelf","self","root","Function","objectToString","prototype","toString","nativeMax","Math","max","nativeMin","min","now","Date","isObject","value","type","toNumber","isObjectLike","call","isSymbol","other","valueOf","replace","isBinary","test","slice","module","exports","func","wait","options","lastArgs","lastThis","maxWait","result","timerId","lastCallTime","lastInvokeTime","leading","maxing","trailing","TypeError","invokeFunc","time","args","thisArg","undefined","apply","shouldInvoke","timeSinceLastCall","timerExpired","trailingEdge","setTimeout","remainingWait","debounced","isInvoking","arguments","this","leadingEdge","cancel","clearTimeout","flush","shouldIncrementArticleCount","contentType","includes","toLowerCase","getArticleCounts","async","pageId","tags","window","guardian","dailyArticleCount","incrementDailyArticleCount","getDailyArticleCount","getDailyArticleCounts","hasOptedOutOfWeeklyArticleCount","weeklyArticleCount","keywordAndToneTagIds","filter","tag","map","id","incrementWeeklyArticleCount","storage","local","getWeeklyArticleHistory","getWeeklyArticleCounts","dailyArticleHistory","weeklyArticleHistory","useArticleCounts","articleCounts","setArticleCounts","useState","useEffect","then","catch","FORCE_BRAZE_ALLOWLIST","getBrazeMetaFromUrlFragment","location","hash","key","hashString","hostname","console","log","forcedMessage","indexOf","length","dataFromBraze","JSON","parse","decodeURIComponent","logImpressionWithBraze","logButtonClickWithBraze","e","error","message","suppressForTaylorReport","config","switches","brazeTaylorReport","find","HIDE_SUPPORT_MESSAGING_COOKIE","RECURRING_CONTRIBUTOR_COOKIE","SUPPORT_ONE_OFF_CONTRIBUTION_COOKIE","NO_RR_BANNER_KEY","shouldHideSupportMessaging","isSignedIn","hasCookie","getCookie","name","hasSupporterCookie","lastContributionDate","contributionDateFromSupport","getLastOneOffContributionTimestamp","isUndefined","from","to","diffMs","floor","dateDiffDays","isRecentOneOffContributor","REQUIRED_CONSENTS_FOR_ARTICLE_COUNT","REQUIRED_CONSENTS_FOR_BROWSER_ID","hasArticleCountOptOutCookie","hasCmpConsentForWeeklyArticleCount","Promise","resolve","shouldMemoize","onConsentChange","usnat","tcfv2","aus","hasRequiredConsents","every","consent","consents","remove","hasOptedOutOfArticleCount","useHasOptedOutOfArticleCount","hasOptedOut","setHasOptedOut","hasCmpConsentForBrowserId","withinLocalNoBannerCachePeriod","get","setLocalNoBannerCachePeriod","set","recentlyClosedBanner","lastClosedAt","getTime","getPurchaseInfo","purchaseInfoRaw","purchaseInfo","DailyArticleCountKey","dailyCount","history","Array","isArray","daily","day","count","Error","getToday","today","unshift","cutOff","firstOldDayIndex","findIndex","splice","lazyFetchEmailWithTimeout","idapiUrl","ajaxUrl","eitherInOktaTestOrElse","authState","idToken","claims","email","getIdApiUserData","data","user","primaryEmailAddress","modules","sentry","reportError","getEmail","checkForErrors","response","ok","statusText","status","callApi","url","fetch","credentials","json","cache","idapiUserMeResponse","joinUrl","getIdapiUserIdentifiers","idapiUserIdentifiersResponse","defaultShow","pickMessage","renderingTarget","candidates","candidateConfigsWithTimeout","c","candidateConfig","slotName","timer","candidate","canShow","perfName","endPerformanceMeasure","startPerformanceMeasure","timeoutMillis","candidateId","getOphan","record","component","recordMessageTimeoutInOphan","show","canShowTimeTaken","reportTiming","ophan","String","cancelTimeout","timeoutify","winnerResult","reduce","winningMessageSoFar","meta","winner","m","hasAutomatBeenSet","setAutomat","automat","emotionReact","emotionReactJsxRuntime","react","React","useIsSignedIn","useAuthStatus","kind","authStatus","setAuthStatus","oktaAuthState","getSignedInStatusWithOkta","getSignedInStatusWithCookies","KEY","getBrazeUuid","braze_uuid","brazeUuid","buildFailureResponse","isSuccessful","failure","field","SDK_OPTIONS","enableLogging","noCookies","baseUrl","sessionTimeoutInSeconds","minimumIntervalBetweenTriggerActionsInSeconds","devicePropertyAllowlist","getInitialisedAppboy","apiKey","importedAppboy","setLogger","initialize","initialiseAppboy","buildBrazeMessaging","idApiUrl","isAvailable","brazeMessages","NullBrazeMessages","brazeCards","NullBrazeCards","dependenciesResult","dependencies","page","brazeApiKey","brazeSwitch","reject","state","getConsentFor","isPaidContent","buildDependencies","checkBrazeDependencies","hasCurrentBrazeUserValue","getRaw","wipeData","LocalMessageCache","clear","maybeWipeUserData","appboy","sdkLoadTimeTaken","errorHandler","desc","setRaw","changeUser","openSession","brazeContentCards","BrazeCards","BrazeMessages","canRenderBrazeMsg","useBraze","useSWRImmutable","useCountryCode","feature","countryCode","setCountryCode","getLocaleCode","cc","isNonNullable","msg","useIsInView","isInView","setIsInView","node","setNode","observer","useRef","intersectionObserverCallback","useCallback","entry","isIntersecting","repeat","intersectionCallback","debounce","libDebounce","current","IntersectionObserver","observe","disconnect","useOnce","task","waitFor","alreadyRun","setAlreadyRun","isReady","dep"],"sourceRoot":""}