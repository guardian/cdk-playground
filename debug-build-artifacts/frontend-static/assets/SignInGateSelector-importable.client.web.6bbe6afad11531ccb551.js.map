{"version":3,"file":"SignInGateSelector-importable.client.web.6bbe6afad11531ccb551.js","mappings":"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","sources":["webpack://@guardian/dotcom-rendering/../node_modules/.pnpm/lodash.debounce@4.0.8/node_modules/lodash.debounce/index.js","webpack://@guardian/dotcom-rendering/./src/components/SignInGate/componentEventTracking.tsx","webpack://@guardian/dotcom-rendering/./src/components/SignInGate/dismissGate.ts","webpack://@guardian/dotcom-rendering/./src/components/SignInGate/displayRule.ts","webpack://@guardian/dotcom-rendering/./src/components/SignInGate/gates/main-control.ts","webpack://@guardian/dotcom-rendering/./src/components/Lazy.tsx","webpack://@guardian/dotcom-rendering/./src/components/SignInGate/gates/main-variant.tsx","webpack://@guardian/dotcom-rendering/./src/components/SignInGate/signInGate.ts","webpack://@guardian/dotcom-rendering/./src/components/SignInGate/types.ts","webpack://@guardian/dotcom-rendering/./src/components/SignInGateSelector.importable.tsx","webpack://@guardian/dotcom-rendering/./src/lib/parser/parseCheckoutOutCookieData.ts","webpack://@guardian/dotcom-rendering/./src/lib/parser/jsonParser.ts","webpack://@guardian/dotcom-rendering/./src/experiments/tests/sign-in-gate-main-control.ts","webpack://@guardian/dotcom-rendering/./src/experiments/tests/sign-in-gate-main-variant.ts","webpack://@guardian/dotcom-rendering/./src/lib/dailyArticleCount.ts","webpack://@guardian/dotcom-rendering/./src/lib/querystring.ts","webpack://@guardian/dotcom-rendering/./src/lib/useAB.ts","webpack://@guardian/dotcom-rendering/./src/lib/useAuthStatus.ts","webpack://@guardian/dotcom-rendering/./src/lib/useCountryCode.ts","webpack://@guardian/dotcom-rendering/./src/lib/useIsInView.ts","webpack://@guardian/dotcom-rendering/./src/lib/useOnce.ts","webpack://@guardian/dotcom-rendering/./src/lib/usePageViewId.ts","webpack://@guardian/dotcom-rendering/./src/lib/useSignInGateSelector.ts"],"sourcesContent":["/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** Used as the `TypeError` message for \"Functions\" methods. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/** Used to match leading and trailing whitespace. */\nvar reTrim = /^\\s+|\\s+$/g;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        result = wait - timeSinceLastCall;\n\n    return maxing ? nativeMin(result, maxWait - timeSinceLastInvoke) : result;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return !!value && (type == 'object' || type == 'function');\n}\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && objectToString.call(value) == symbolTag);\n}\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = value.replace(reTrim, '');\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nmodule.exports = debounce;\n","import type { ComponentEvent } from '@guardian/ophan-tracker-js';\nimport { getOphan } from '../../client/ophan/ophan';\nimport { isServer } from '../../lib/isServer';\nimport type { RenderingTarget } from '../../types/renderingTarget';\nimport type { CurrentSignInGateABTest } from './types';\n\nexport type ComponentEventParams = {\n\tcomponentType: string;\n\tcomponentId?: string;\n\tabTestName: string;\n\tabTestVariant: string;\n\tviewId?: string;\n\tbrowserId?: string;\n};\n\n// ophan helper methods\nconst submitComponentEventTracking = async (\n\tcomponentEvent: ComponentEvent,\n\trenderingTarget: RenderingTarget,\n) => {\n\tif (isServer) return;\n\n\tconst ophan = await getOphan(renderingTarget);\n\tophan.record({ componentEvent });\n};\n\nexport const submitViewEventTracking = (\n\tcomponentEvent: Omit<ComponentEvent, 'action'>,\n\trenderingTarget: RenderingTarget,\n) =>\n\tvoid submitComponentEventTracking(\n\t\t{\n\t\t\t...componentEvent,\n\t\t\taction: 'VIEW',\n\t\t},\n\t\trenderingTarget,\n\t);\n\nconst submitClickEventTracking = (\n\tcomponentEvent: Omit<ComponentEvent, 'action'>,\n\trenderingTarget: RenderingTarget,\n) =>\n\tvoid submitComponentEventTracking(\n\t\t{\n\t\t\t...componentEvent,\n\t\t\taction: 'CLICK',\n\t\t},\n\t\trenderingTarget,\n\t);\n\nexport const withComponentId = (id?: string): ComponentEvent['component'] => ({\n\tcomponentType: 'SIGN_IN_GATE',\n\tid,\n});\n\nexport const trackLink = (\n\tcomponentId: string,\n\tvalue: string,\n\trenderingTarget: RenderingTarget,\n\tabTest?: CurrentSignInGateABTest,\n): void => {\n\tconst component = withComponentId(componentId);\n\n\tsubmitClickEventTracking(\n\t\t{\n\t\t\tcomponent,\n\t\t\tabTest,\n\t\t\tvalue,\n\t\t},\n\t\trenderingTarget,\n\t);\n};\n","import { isObject, isString, isUndefined, storage } from '@guardian/libs';\n\nconst localStorageKey = `gu.prefs.sign-in-gate`;\n\n/** We use this key for storing the date the gate was dismissed against */\nconst localStorageDismissedDateKey = (\n\tvariant: string,\n\tname: string,\n): string => {\n\treturn `${name}-${variant}`;\n};\n\n/** We use this key for storing the gate dismissed count against */\nconst localStorageDismissedCountKey = (\n\tvariant: string,\n\tname: string,\n): string => {\n\treturn `gate-dismissed-count-${name}-${variant}`;\n};\n\nconst isKeyValuePair = (\n\tobject: Record<string | number | symbol, unknown>,\n): object is Record<string, string | number> =>\n\tObject.entries(object).every(\n\t\t([key, value]) =>\n\t\t\tisString(key) && ['string', 'number'].includes(typeof value),\n\t);\n\n// Invalid json stored against `localStorageKey` should not break signin gate for a user forever\nconst getSigninGatePrefsSafely = (): Record<string, string | number> => {\n\tconst prefs = storage.local.get(localStorageKey);\n\treturn isObject(prefs) && isKeyValuePair(prefs) ? prefs : {};\n};\n\nconst setSigninGatePrefs = (prefs: Record<string, string | number>) => {\n\tstorage.local.set(localStorageKey, prefs);\n};\n\n/**\n * set in user preferences that the user has dismissed the gate, set the value to the current ISO date string\n * name is optional, but can be used to differentiate between multiple sign in gate tests\n *\n *\n * This is set in local storage with the following shape:\n *\n * key:   gu.prefs.sign-in-gate\n * value: {\"testVariantName\":\"2020-07-01T10:55:09.085Z\"}\n *\n * We set the value using the key, which remains constant\n * and add an entry to the object with the testname and variant, and use current ISO date string as the value\n */\nexport const setUserDismissedGate = (variant: string, name: string): void => {\n\tconst prefs = getSigninGatePrefsSafely();\n\tprefs[localStorageDismissedDateKey(variant, name)] =\n\t\tnew Date().toISOString();\n\tsetSigninGatePrefs(prefs);\n};\n\nexport const unsetUserDismissedGate = (variant: string, name: string): void => {\n\tconst prefs = getSigninGatePrefsSafely();\n\tdelete prefs[localStorageDismissedDateKey(variant, name)];\n\tsetSigninGatePrefs(prefs);\n};\n\n/**\n * Check if the user has dismissed the gate by checking the user preferences,\n * name is optional, but can be used to differentiate between multiple sign in gate tests\n *\n * This is set in local storage with the following shape:\n *\n * key:   gu.prefs.sign-in-gate\n * value: {\"testVariantName\":\"2020-07-01T10:55:09.085Z\"}\n *\n * We extract the value using the key, which remains constant\n * and the from within the value object we look up the variant we are looking for\n */\nexport const hasUserDismissedGate = (\n\tvariant: string,\n\tname: string,\n\tdismissalWindow?: number, // represents hours - only use if the gate should reshow after X hrs (dismissal window)\n): boolean => {\n\tconst prefs = getSigninGatePrefsSafely();\n\tconst pref = prefs[localStorageDismissedDateKey(variant, name)];\n\t// checks if a dismissal occurred within a given window timeframe in hours\n\tif (!isUndefined(dismissalWindow)) {\n\t\t// checks if prefs is empty, ie. the user has not dismissed gate before.\n\t\tif (isUndefined(pref) || typeof pref === 'number') {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst hours = (Date.now() - new Date(pref).getTime()) / 36e5; //  36e5 is the scientific notation for 60*60*1000, which converts the milliseconds difference into hours.\n\n\t\tif (hours >= dismissalWindow) {\n\t\t\tunsetUserDismissedGate(variant, name);\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\treturn !(pref == null);\n};\n\nconst retrieveDismissedCount = (variant: string, name: string): number => {\n\tconst prefs = getSigninGatePrefsSafely();\n\tconst dismissed = prefs[localStorageDismissedCountKey(variant, name)];\n\n\treturn typeof dismissed === 'number' && dismissed > 0 ? dismissed : 0;\n};\n\n/** Test whether the user has dismissed the gate variant more than `count` times */\nexport const hasUserDismissedGateMoreThanCount = (\n\tvariant: string,\n\tname: string,\n\tcount: number,\n): boolean => {\n\treturn retrieveDismissedCount(variant, name) > count;\n};\n\n/** Increment the number of times a user has dismissed this gate variant */\nexport const incrementUserDismissedGateCount = (\n\tvariant: string,\n\tname: string,\n): void => {\n\tconst prefs = getSigninGatePrefsSafely();\n\tconst key = localStorageDismissedCountKey(variant, name);\n\tprefs[key] = retrieveDismissedCount(variant, name) + 1;\n\tsetSigninGatePrefs(prefs);\n};\n","// use the dailyArticleCount from the local storage to see how many articles the user has viewed in a day\nimport { onConsent } from '@guardian/libs';\nimport type { ConsentState, CountryCode } from '@guardian/libs';\nimport type { DailyArticle } from '../../lib/dailyArticleCount';\nimport { getDailyArticleCount } from '../../lib/dailyArticleCount';\nimport type { TagType } from '../../types/tag';\nimport { hasUserDismissedGateMoreThanCount } from './dismissGate';\nimport type { CanShowGateProps } from './types';\n\n// in our case if this is the n-numbered article or higher the user has viewed then set the gate\nexport const isNPageOrHigherPageView = (n = 2): boolean => {\n\t// get daily read article count array from local storage\n\tconst [dailyCount = {} as DailyArticle] = getDailyArticleCount() ?? [];\n\n\tconst { count = 0 } = dailyCount;\n\n\treturn count >= n;\n};\n\n// determine if the useragent is running iOS 9 (known to be buggy for sign in flow)\nexport const isIOS9 = (): boolean => {\n\t// get the browser user agent\n\tconst ua = navigator.userAgent;\n\t// check useragent if the device is an iOS device\n\tconst appleDevice = /(iPhone|iPod|iPad)/i.test(ua);\n\t// check useragent if the os is version 9\n\tconst os = /(CPU OS 9_)/i.test(ua);\n\n\t// if both true, then it's an apple ios 9 device\n\treturn appleDevice && os;\n};\n\n// hide the sign in gate on article types that are not supported\nexport const isValidContentType = (contentType: string): boolean => {\n\t// It's safer to definitively *include* types as we\n\t// know new types will not break the sign-in-gate going forward\n\tconst validTypes = ['Article'];\n\n\treturn validTypes.some((type: string): boolean => contentType === type);\n};\n\n// hide the sign in gate on certain sections of the site, e.g info, about, help etc.\nexport const isValidSection = (sectionId?: string): boolean => {\n\tconst invalidSections = [\n\t\t'about',\n\t\t'info',\n\t\t'membership',\n\t\t'help',\n\t\t'guardian-live-australia',\n\t\t'gnm-archive',\n\t];\n\n\t// we check for invalid section by reducing the above array, and then NOT the result so we know\n\t// its a valid section\n\treturn !invalidSections.some(\n\t\t(section: string): boolean => sectionId === section,\n\t);\n};\n\n// hide the sign in gate for certain tags on the site\nexport const isValidTag = (tags: TagType[]): boolean => {\n\tconst invalidTags = ['info/newsletter-sign-up'];\n\n\treturn !invalidTags.some((invalidTag) =>\n\t\ttags.map((tag) => tag.id).includes(invalidTag),\n\t);\n};\n\n// check CMP banner consents\nexport const hasRequiredConsents = (): Promise<boolean> =>\n\tonConsent()\n\t\t.then(({ canTarget }: ConsentState) => canTarget)\n\t\t.catch(() => false);\n\nexport const canShowSignInGate = ({\n\tisSignedIn,\n\tcurrentTest,\n\tcontentType,\n\tsectionId,\n\ttags,\n\tisPaidContent,\n\tisPreview,\n}: CanShowGateProps): Promise<boolean> =>\n\tPromise.resolve(\n\t\t!isSignedIn &&\n\t\t\t!hasUserDismissedGateMoreThanCount(\n\t\t\t\tcurrentTest.variant,\n\t\t\t\tcurrentTest.name,\n\t\t\t\t5,\n\t\t\t) &&\n\t\t\tisNPageOrHigherPageView(3) &&\n\t\t\tisValidContentType(contentType) &&\n\t\t\tisValidSection(sectionId) &&\n\t\t\tisValidTag(tags) &&\n\t\t\t// hide the sign in gate on isPaidContent\n\t\t\t!isPaidContent &&\n\t\t\t// hide the sign in gate on internal tools preview &&\n\t\t\t!isPreview &&\n\t\t\t!isIOS9(),\n\t);\n\nexport const canShowSignInGateMandatory: ({\n\tisSignedIn,\n\tcurrentTest,\n\tcontentType,\n\tsectionId,\n\ttags,\n\tisPaidContent,\n\tisPreview,\n\tcurrentLocaleCode,\n}: CanShowGateProps) => Promise<boolean> = async ({\n\tisSignedIn,\n\tcurrentTest,\n\tcontentType,\n\tsectionId,\n\ttags,\n\tisPaidContent,\n\tisPreview,\n\tcurrentLocaleCode,\n}: CanShowGateProps) => {\n\treturn await canShowSignInGate({\n\t\tisSignedIn,\n\t\tcurrentTest,\n\t\tcontentType,\n\t\tsectionId,\n\t\ttags,\n\t\tisPaidContent,\n\t\tisPreview,\n\t\tcurrentLocaleCode,\n\t});\n};\n\nconst US_REGION_CODES: (CountryCode | undefined)[] = [\n\t'US',\n\t'AS',\n\t'GU',\n\t'MP',\n\t'PR',\n\t'VI',\n];\n\nexport const canShowSignInGateWithOffers = ({\n\tisSignedIn,\n\tcurrentTest,\n\tcontentType,\n\tsectionId,\n\ttags,\n\tisPaidContent,\n\tisPreview,\n\tcurrentLocaleCode,\n}: CanShowGateProps): Promise<boolean> =>\n\tPromise.resolve(\n\t\t!isSignedIn &&\n\t\t\t!hasUserDismissedGateMoreThanCount(\n\t\t\t\tcurrentTest.variant,\n\t\t\t\tcurrentTest.name,\n\t\t\t\t5,\n\t\t\t) &&\n\t\t\tisNPageOrHigherPageView(3) &&\n\t\t\tisValidContentType(contentType) &&\n\t\t\tisValidSection(sectionId) &&\n\t\t\tisValidTag(tags) &&\n\t\t\t// hide the sign in gate on isPaidContent\n\t\t\t!isPaidContent &&\n\t\t\t// hide the sign in gate on internal tools preview &&\n\t\t\t!isPreview &&\n\t\t\t!isIOS9() &&\n\t\t\t// hide the sign in gate for AU and US readers\n\t\t\t!['AU', ...US_REGION_CODES].includes(currentLocaleCode),\n\t);\n","import { hasUserDismissedGate } from '../dismissGate';\nimport {\n\tisIOS9,\n\tisNPageOrHigherPageView,\n\tisValidContentType,\n\tisValidSection,\n\tisValidTag,\n} from '../displayRule';\nimport type { CanShowGateProps, SignInGateComponent } from '../types';\n\nconst canShow = ({\n\tisSignedIn,\n\tcurrentTest,\n\tcontentType,\n\tsectionId,\n\ttags,\n\tisPaidContent,\n\tisPreview,\n}: CanShowGateProps): Promise<boolean> =>\n\tPromise.resolve(\n\t\t!isSignedIn &&\n\t\t\t!hasUserDismissedGate(currentTest.variant, currentTest.name) &&\n\t\t\tisNPageOrHigherPageView(3) &&\n\t\t\tisValidContentType(contentType) &&\n\t\t\tisValidSection(sectionId) &&\n\t\t\tisValidTag(tags) &&\n\t\t\t// hide the sign in gate on isPaidContent\n\t\t\t!isPaidContent &&\n\t\t\t// hide the sign in gate on internal tools preview\n\t\t\t!isPreview &&\n\t\t\t!isIOS9(),\n\t);\n\nexport const signInGateComponent: SignInGateComponent = {\n\tcanShow,\n};\n","import { css } from '@emotion/react';\nimport { useIsInView } from '../lib/useIsInView';\n\ntype Props = {\n\tchildren: JSX.Element;\n\tmargin: number;\n\tdisableFlexStyles?: boolean;\n};\n\n// Ensure the ref wrapper expands. This is used for componenents like\n// MostViewedRightWrapper that needs to check it's parent's height\nconst flexGrowStyles = css`\n\tdisplay: flex;\n\tflex-grow: 1;\n`;\n\nexport const Lazy = ({ children, margin, disableFlexStyles }: Props) => {\n\tconst [hasBeenSeen, setRef] = useIsInView({\n\t\trootMargin: `${margin}px`,\n\t});\n\n\t// Without this check below typescript complains because it thinks\n\t// setRef could be false.\n\tif (typeof setRef !== 'function') {\n\t\treturn null;\n\t}\n\n\t// Why do we check to see if we're disabled here? Because we\n\t// use this as a flag to know when a component is\n\t// being loaded as part of a Chromatic story or not so that\n\t// we can prevent lazy loading our storybook snapshots that we\n\t// use for visual regression\n\tconst renderChildren = hasBeenSeen || Lazy.disabled;\n\treturn (\n\t\t<div ref={setRef} css={!disableFlexStyles && flexGrowStyles}>\n\t\t\t{renderChildren && <>{children}</>}\n\t\t</div>\n\t);\n};\n\nLazy.disabled = false;\n","import { isUndefined, startPerformanceMeasure } from '@guardian/libs';\nimport React, { Suspense } from 'react';\nimport { Lazy } from '../../Lazy';\nimport { canShowSignInGate } from '../displayRule';\nimport type { SignInGateComponent } from '../types';\n\nconst SignInGateMain = React.lazy(() => {\n\tconst { endPerformanceMeasure } = startPerformanceMeasure(\n\t\t'identity',\n\t\t'SignInGateMain',\n\t);\n\treturn import(\n\t\t/* webpackChunkName: \"SignInGateMain\" */ '../gateDesigns/SignInGateMain'\n\t).then((module) => {\n\t\tendPerformanceMeasure();\n\t\treturn { default: module.SignInGateMain };\n\t});\n});\n\nconst SignInGateMainCheckoutComplete = React.lazy(() => {\n\tconst { endPerformanceMeasure } = startPerformanceMeasure(\n\t\t'identity',\n\t\t'SignInGateMainCheckoutComplete',\n\t);\n\treturn import(\n\t\t/* webpackChunkName: \"SignInGateMainCheckoutComplete\" */ '../gateDesigns/SignInGateMainCheckoutComplete'\n\t).then((module) => {\n\t\tendPerformanceMeasure();\n\t\treturn { default: module.SignInGateMainCheckoutComplete };\n\t});\n});\n\n/**\n * GATE PERSONALISATION:\n *\n * If the GU_CO_COMPLETE cookie is present, personalise the sign in gate based on the userType\n * and product information in the cookie value.\n * AB tracking will be registered as part of the main gate AB test, but the component Id string\n * in Ophan ComponentEventTracking will have `_personalised_${userType}_${product}` appended.\n * This occurs in the SignInGateSelector.importable.tsx file\n * There is a feature switch called `personaliseSignInGateAfterCheckout` which can be set in the\n * admin tools, and depending on the state of that switch will determine which variant of the\n * gate to show.\n */\nexport const signInGateComponent: SignInGateComponent = {\n\tgate: ({\n\t\tophanComponentId,\n\t\tdismissGate,\n\t\tguUrl,\n\t\tsignInUrl,\n\t\tregisterUrl,\n\t\tabTest,\n\t\tcheckoutCompleteCookieData,\n\t\tpersonaliseSignInGateAfterCheckoutSwitch,\n\t}) => {\n\t\treturn (\n\t\t\t<Lazy margin={300}>\n\t\t\t\t<Suspense fallback={<></>}>\n\t\t\t\t\t{personaliseSignInGateAfterCheckoutSwitch &&\n\t\t\t\t\t!isUndefined(checkoutCompleteCookieData) ? (\n\t\t\t\t\t\t<SignInGateMainCheckoutComplete\n\t\t\t\t\t\t\tophanComponentId={ophanComponentId}\n\t\t\t\t\t\t\tdismissGate={dismissGate}\n\t\t\t\t\t\t\tguUrl={guUrl}\n\t\t\t\t\t\t\tsignInUrl={signInUrl}\n\t\t\t\t\t\t\tregisterUrl={registerUrl}\n\t\t\t\t\t\t\tabTest={abTest}\n\t\t\t\t\t\t\tcheckoutCompleteCookieData={\n\t\t\t\t\t\t\t\tcheckoutCompleteCookieData\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<SignInGateMain\n\t\t\t\t\t\t\tophanComponentId={ophanComponentId}\n\t\t\t\t\t\t\tdismissGate={dismissGate}\n\t\t\t\t\t\t\tguUrl={guUrl}\n\t\t\t\t\t\t\tsignInUrl={signInUrl}\n\t\t\t\t\t\t\tregisterUrl={registerUrl}\n\t\t\t\t\t\t\tabTest={abTest}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\t\t\t\t</Suspense>\n\t\t\t</Lazy>\n\t\t);\n\t},\n\tcanShow: canShowSignInGate,\n};\n","import type { ABTest } from '@guardian/ab-core';\n// Sign in Gate A/B Tests\nimport { signInGateMainControl } from '../../experiments/tests/sign-in-gate-main-control';\nimport { signInGateMainVariant } from '../../experiments/tests/sign-in-gate-main-variant';\n// Sign in Gate Types\nimport { signInGateComponent as gateMainControl } from './gates/main-control';\nimport { signInGateComponent as gateMainVariant } from './gates/main-variant';\nimport type { SignInGateTestMap } from './types';\n\n/* When adding a new test, you need to add the test name to the tests array below,\n   and add a entry for each variant that maps it to a SignInGateComponent in\n   signInGateTestVariantToGateMapping, and in turn match each test id to an component\n   id in signInGateTestIdToComponentId\n*/\nexport const signInGateTests: ReadonlyArray<ABTest> = [\n\tsignInGateMainVariant,\n\tsignInGateMainControl,\n];\n\nexport const signInGateTestVariantToGateMapping: SignInGateTestMap = {\n\t'main-control-5': gateMainControl,\n\t'main-variant-5': gateMainVariant,\n};\n\n// Component Id does not need to match gate test name, as ab test info passed separately to ophan\n// Consider Id name relevant to the gate component or design. Use snake_case\nexport const signInGateTestIdToComponentId: { [key: string]: string } = {\n\tSignInGateMainVariant: 'main_variant_5',\n\tSignInGateMainControl: 'main_control_5',\n};\n","import type { CountryCode } from '@guardian/libs';\nimport { isObject, isOneOf, isString } from '@guardian/libs';\nimport type { TagType } from '../../types/tag';\n\nexport type CanShowGateProps = {\n\tisSignedIn: boolean;\n\tcurrentTest: CurrentSignInGateABTest;\n\tcontentType: string;\n\tsectionId?: string;\n\ttags: TagType[];\n\tisPaidContent: boolean;\n\tisPreview?: boolean;\n\tcurrentLocaleCode: CountryCode | undefined;\n};\n\nexport type SignInGateComponent = {\n\tgate?: (props: SignInGateProps) => JSX.Element;\n\tcanShow: ({\n\t\tisSignedIn,\n\t\tcurrentTest,\n\t}: CanShowGateProps) => Promise<boolean>;\n};\n\nexport const ALL_USER_TYPES = ['new', 'guest', 'current'] as const;\nexport type UserType = (typeof ALL_USER_TYPES)[number];\n\nexport const isUserType = isOneOf(ALL_USER_TYPES);\n\nexport const ALL_PRODUCTS = [\n\t'Contribution',\n\t'SupporterPlus',\n\t'Paper',\n\t'GuardianWeekly',\n] as const;\nexport type Product = (typeof ALL_PRODUCTS)[number];\n\nexport const isProduct = isOneOf(ALL_PRODUCTS);\nexport interface CheckoutCompleteCookieData {\n\tuserType: UserType;\n\tproduct: Product;\n}\n\nexport function isCheckoutCompleteCookieData(\n\tobj: unknown,\n): obj is CheckoutCompleteCookieData {\n\treturn (\n\t\tisObject(obj) &&\n\t\tisString(obj.userType) &&\n\t\tisUserType(obj.userType) &&\n\t\tisString(obj.product) &&\n\t\tisProduct(obj.product)\n\t);\n}\nexport type SignInGateProps = {\n\tsignInUrl: string;\n\tregisterUrl: string;\n\tguUrl: string;\n\tdismissGate: () => void;\n\tophanComponentId: string;\n\tabTest?: CurrentSignInGateABTest;\n\tisMandatory?: boolean;\n\tcheckoutCompleteCookieData?: CheckoutCompleteCookieData;\n\tpersonaliseSignInGateAfterCheckoutSwitch?: boolean;\n};\n\nexport interface SignInGateCustomizableTextProps extends SignInGateProps {\n\ttitle: string;\n\tsubtitle: string;\n\tbody: string | JSX.Element;\n}\n\nexport type CurrentSignInGateABTest = {\n\tname: string;\n\tvariant: string;\n\tid: string;\n};\n\nexport type SignInGateTestMap = { [name: string]: SignInGateComponent };\n","import { getCookie, isUndefined } from '@guardian/libs';\nimport { useEffect, useState } from 'react';\nimport { parseCheckoutCompleteCookieData } from '../lib/parser/parseCheckoutOutCookieData';\nimport { constructQuery } from '../lib/querystring';\nimport { useAuthStatus } from '../lib/useAuthStatus';\nimport { useCountryCode } from '../lib/useCountryCode';\nimport { useOnce } from '../lib/useOnce';\nimport { usePageViewId } from '../lib/usePageViewId';\nimport { useSignInGateSelector } from '../lib/useSignInGateSelector';\nimport type { Switches } from '../types/config';\nimport type { TagType } from '../types/tag';\nimport { useConfig } from './ConfigContext';\nimport type { ComponentEventParams } from './SignInGate/componentEventTracking';\nimport {\n\tsubmitViewEventTracking,\n\twithComponentId,\n} from './SignInGate/componentEventTracking';\nimport {\n\tincrementUserDismissedGateCount,\n\tsetUserDismissedGate,\n} from './SignInGate/dismissGate';\nimport { signInGateTestIdToComponentId } from './SignInGate/signInGate';\nimport type {\n\tCheckoutCompleteCookieData,\n\tCurrentSignInGateABTest,\n\tSignInGateComponent,\n} from './SignInGate/types';\n\ntype Props = {\n\tcontentType: string;\n\tsectionId?: string;\n\ttags: TagType[];\n\tisPaidContent: boolean;\n\tisPreview: boolean;\n\thost?: string;\n\tpageId: string;\n\tidUrl?: string;\n\tswitches: Switches;\n};\n\n// interface for the component which shows the sign in gate\ninterface ShowSignInGateProps {\n\tsetShowGate: React.Dispatch<React.SetStateAction<boolean>>;\n\tabTest: CurrentSignInGateABTest;\n\tcomponentId: string;\n\tsignInUrl: string;\n\tregisterUrl: string;\n\tgateVariant: SignInGateComponent;\n\thost: string;\n\tcheckoutCompleteCookieData?: CheckoutCompleteCookieData;\n\tpersonaliseSignInGateAfterCheckoutSwitch?: boolean;\n}\n\nconst dismissGate = (\n\tsetShowGate: React.Dispatch<React.SetStateAction<boolean>>,\n\tcurrentAbTestValue: CurrentSignInGateABTest,\n) => {\n\tsetShowGate(false);\n\tsetUserDismissedGate(currentAbTestValue.variant, currentAbTestValue.name);\n\tincrementUserDismissedGateCount(\n\t\tcurrentAbTestValue.variant,\n\t\tcurrentAbTestValue.name,\n\t);\n};\n\n// function to generate the profile.theguardian.com url with tracking params\n// and the return url (link to current article page)\nconst generateGatewayUrl = (\n\ttab: 'register' | 'signin',\n\t{\n\t\tpageId,\n\t\tpageViewId,\n\t\tidUrl,\n\t\thost,\n\t\tcurrentTest,\n\t\tcomponentId,\n\t}: {\n\t\tpageId: string;\n\t\tpageViewId: string;\n\t\tidUrl: string;\n\t\thost: string;\n\t\tcurrentTest: CurrentSignInGateABTest;\n\t\tcomponentId?: string;\n\t},\n) => {\n\t// url of the article, return user here after sign in/registration\n\tconst returnUrl = `${host}/${pageId}`;\n\n\t// set the component event params to be included in the query\n\tconst queryParams: ComponentEventParams = {\n\t\tcomponentType: 'signingate',\n\t\tcomponentId,\n\t\tabTestName: currentTest.name,\n\t\tabTestVariant: currentTest.variant,\n\t\tbrowserId:\n\t\t\tgetCookie({ name: 'bwid', shouldMemoize: true }) ?? undefined,\n\t\tviewId: pageViewId,\n\t};\n\n\treturn `${idUrl}/${tab}?returnUrl=${returnUrl}&componentEventParams=${encodeURIComponent(\n\t\tconstructQuery(queryParams),\n\t)}`;\n};\n\n// component which shows the sign in gate\n// fires a VIEW ophan component event\n// and show the gate component if it exists\nconst ShowSignInGate = ({\n\tabTest,\n\tcomponentId,\n\tsetShowGate,\n\tsignInUrl,\n\tregisterUrl,\n\tgateVariant,\n\thost,\n\tcheckoutCompleteCookieData,\n\tpersonaliseSignInGateAfterCheckoutSwitch,\n}: ShowSignInGateProps) => {\n\tconst { renderingTarget } = useConfig();\n\n\t// use effect hook to fire view event tracking only on initial render\n\tuseEffect(() => {\n\t\tsubmitViewEventTracking(\n\t\t\t{\n\t\t\t\tcomponent: withComponentId(componentId),\n\t\t\t\tabTest,\n\t\t\t},\n\t\t\trenderingTarget,\n\t\t);\n\t}, [abTest, componentId, renderingTarget]);\n\n\t// some sign in gate ab test variants may not need to show a gate\n\t// therefore the gate is optional\n\t// this is because we want a section of the audience to never see the gate\n\t// but still fire a view event if they are eligible to see the gate\n\tif (gateVariant.gate) {\n\t\treturn gateVariant.gate({\n\t\t\tguUrl: host,\n\t\t\tsignInUrl,\n\t\t\tregisterUrl,\n\t\t\tdismissGate: () => {\n\t\t\t\tdismissGate(setShowGate, abTest);\n\t\t\t},\n\t\t\tabTest,\n\t\t\tophanComponentId: componentId,\n\t\t\tcheckoutCompleteCookieData,\n\t\t\tpersonaliseSignInGateAfterCheckoutSwitch,\n\t\t});\n\t}\n\t// return nothing if no gate needs to be shown\n\treturn <></>;\n};\n\nconst useCheckoutCompleteCookieData = () => {\n\tconst [data, setData] = useState<CheckoutCompleteCookieData>();\n\n\tuseEffect(() => {\n\t\tconst rawCookie = getCookie({\n\t\t\tname: 'GU_CO_COMPLETE',\n\t\t\tshouldMemoize: true,\n\t\t});\n\n\t\tif (rawCookie === null) return;\n\n\t\tconst parsedCookieData = parseCheckoutCompleteCookieData(rawCookie);\n\n\t\tif (parsedCookieData) setData(parsedCookieData);\n\t}, []);\n\n\treturn data;\n};\n\n/**\n * Component with conditional logic which determines if a sign in gate\n * should be shown on the current page.\n *\n * ## Why does this need to be an Island?\n *\n * The sign-in gate logic is entirely client-side\n *\n * ---\n *\n * (No visual story exists)\n */\nexport const SignInGateSelector = ({\n\tcontentType,\n\tsectionId = '',\n\ttags,\n\tisPaidContent,\n\tisPreview,\n\thost = 'https://theguardian.com/',\n\tpageId,\n\tidUrl = 'https://profile.theguardian.com',\n\tswitches,\n}: Props) => {\n\tconst authStatus = useAuthStatus();\n\tconst isSignedIn =\n\t\tauthStatus.kind === 'SignedInWithOkta' ||\n\t\tauthStatus.kind === 'SignedInWithCookies';\n\tconst [isGateDismissed, setIsGateDismissed] = useState<boolean | undefined>(\n\t\tundefined,\n\t);\n\tconst [gateVariant, setGateVariant] = useState<\n\t\tSignInGateComponent | undefined\n\t>(undefined);\n\tconst [currentTest, setCurrentTest] = useState<\n\t\tCurrentSignInGateABTest | undefined\n\t>(undefined);\n\tconst [canShowGate, setCanShowGate] = useState(false);\n\n\tconst { renderingTarget } = useConfig();\n\tconst gateSelector = useSignInGateSelector();\n\tconst pageViewId = usePageViewId(renderingTarget);\n\n\t// START: Checkout Complete Personalisation\n\tconst [personaliseSwitch, setPersonaliseSwitch] = useState(false);\n\tconst checkoutCompleteCookieData = useCheckoutCompleteCookieData();\n\n\tconst personaliseComponentId = (\n\t\tcurrentComponentId: string | undefined,\n\t): string | undefined => {\n\t\tif (!currentComponentId) return undefined;\n\t\tif (!checkoutCompleteCookieData) return currentComponentId;\n\t\tconst { userType, product } = checkoutCompleteCookieData;\n\t\treturn `${currentComponentId}_personalised_${userType}_${product}`;\n\t};\n\tconst shouldPersonaliseComponentId = (): boolean => {\n\t\treturn personaliseSwitch && !!checkoutCompleteCookieData;\n\t};\n\tconst { personaliseSignInGateAfterCheckout } = switches;\n\t// END: Checkout Complete Personalisation\n\n\tconst countryCode = useCountryCode('sign-in-gate-selector');\n\n\tuseOnce(() => {\n\t\t// this hook will fire when the sign in gate is dismissed\n\t\t// which will happen when the showGate state is set to false\n\t\t// this only happens within the dismissGate method\n\t\tif (isGateDismissed) {\n\t\t\tdocument.dispatchEvent(\n\t\t\t\tnew CustomEvent('article:sign-in-gate-dismissed'),\n\t\t\t);\n\t\t}\n\t}, [isGateDismissed]);\n\n\tuseOnce(() => {\n\t\tconst [gateSelectorVariant, gateSelectorTest] = gateSelector as [\n\t\t\tSignInGateComponent | null,\n\t\t\tCurrentSignInGateABTest | null,\n\t\t];\n\t\tif (gateSelectorVariant && gateSelectorTest) {\n\t\t\tsetGateVariant(gateSelectorVariant);\n\t\t\tsetCurrentTest(gateSelectorTest);\n\t\t}\n\t}, [gateSelector]);\n\n\tuseEffect(() => {\n\t\tif (personaliseSignInGateAfterCheckout) {\n\t\t\tsetPersonaliseSwitch(personaliseSignInGateAfterCheckout);\n\t\t} else {\n\t\t\tsetPersonaliseSwitch(false);\n\t\t}\n\t}, [personaliseSignInGateAfterCheckout]);\n\n\tuseEffect(() => {\n\t\tif (gateVariant && currentTest) {\n\t\t\tvoid gateVariant\n\t\t\t\t.canShow({\n\t\t\t\t\tisSignedIn: !!isSignedIn,\n\t\t\t\t\tcurrentTest,\n\t\t\t\t\tcontentType,\n\t\t\t\t\tsectionId,\n\t\t\t\t\ttags,\n\t\t\t\t\tisPaidContent,\n\t\t\t\t\tisPreview,\n\t\t\t\t\tcurrentLocaleCode: countryCode,\n\t\t\t\t})\n\t\t\t\t.then(setCanShowGate);\n\t\t}\n\t}, [\n\t\tcurrentTest,\n\t\tgateVariant,\n\t\tisSignedIn,\n\t\tcontentType,\n\t\tsectionId,\n\t\ttags,\n\t\tisPaidContent,\n\t\tisPreview,\n\t\tcountryCode,\n\t]);\n\n\tif (!currentTest || !gateVariant || isUndefined(pageViewId)) {\n\t\treturn null;\n\t}\n\tconst signInGateComponentId = signInGateTestIdToComponentId[currentTest.id];\n\n\tconst componentId = shouldPersonaliseComponentId()\n\t\t? personaliseComponentId(signInGateComponentId)\n\t\t: signInGateComponentId;\n\n\tconst ctaUrlParams = {\n\t\tpageId,\n\t\thost,\n\t\tpageViewId,\n\t\tidUrl,\n\t\tcurrentTest,\n\t\tcomponentId,\n\t} satisfies Parameters<typeof generateGatewayUrl>[1];\n\n\treturn (\n\t\t<>\n\t\t\t{/* Sign In Gate Display Logic */}\n\t\t\t{!isGateDismissed && canShowGate && !!componentId && (\n\t\t\t\t<ShowSignInGate\n\t\t\t\t\tabTest={currentTest}\n\t\t\t\t\tcomponentId={componentId}\n\t\t\t\t\t// eslint-disable-next-line @typescript-eslint/strict-boolean-expressions -- Odd react types, should review\n\t\t\t\t\tsetShowGate={(show) => setIsGateDismissed(!show)}\n\t\t\t\t\tsignInUrl={generateGatewayUrl('signin', ctaUrlParams)}\n\t\t\t\t\tregisterUrl={generateGatewayUrl('register', ctaUrlParams)}\n\t\t\t\t\tgateVariant={gateVariant}\n\t\t\t\t\thost={host}\n\t\t\t\t\tcheckoutCompleteCookieData={checkoutCompleteCookieData}\n\t\t\t\t\tpersonaliseSignInGateAfterCheckoutSwitch={personaliseSwitch}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</>\n\t);\n};\n","import type { CheckoutCompleteCookieData } from '../../components/SignInGate/types';\nimport { isCheckoutCompleteCookieData } from '../../components/SignInGate/types';\nimport { safeJsonParse } from './jsonParser';\n\nexport const parseCheckoutCompleteCookieData = (\n\tcheckoutCompleteStr: string,\n): CheckoutCompleteCookieData | undefined => {\n\tconst decodedCookieString = decodeURIComponent(checkoutCompleteStr);\n\tif (decodedCookieString === checkoutCompleteStr) return undefined;\n\tconst parseResult = safeJsonParse(isCheckoutCompleteCookieData)(\n\t\tdecodeURIComponent(checkoutCompleteStr),\n\t);\n\treturn !parseResult.hasError ? parseResult.parsed : undefined;\n};\n","export const safeJsonParse =\n\t<T>(guard: (o: unknown) => o is T) =>\n\t(text: string): ParseResult<T> => {\n\t\ttry {\n\t\t\tconst parsed = JSON.parse(text) as unknown;\n\t\t\treturn guard(parsed)\n\t\t\t\t? { parsed, hasError: false }\n\t\t\t\t: { hasError: true };\n\t\t} catch (_) {\n\t\t\treturn { hasError: true };\n\t\t}\n\t};\n\ntype ParseResult<T> =\n\t| { parsed: T; hasError: false }\n\t| { parsed?: undefined; hasError: true };\n","import type { ABTest } from '@guardian/ab-core';\n\nexport const signInGateMainControl: ABTest = {\n\tid: 'SignInGateMainControl',\n\tstart: '2020-05-20',\n\texpiry: '2025-12-01',\n\tauthor: 'Mahesh Makani',\n\tdescription:\n\t\t'Show sign in gate to 100% of users on 3rd article view of simple article templates, and show a further 5 times after the first dismissal, with higher priority over banners and epic. Control Audience.',\n\taudience: 0.1,\n\taudienceOffset: 0.9,\n\tsuccessMeasure: 'N/A - User does not see gate, only to compare to variant.',\n\taudienceCriteria:\n\t\t'3rd article of the day, lower priority than consent banner, simple articles (not gallery, live etc.), not signed in, not shown after dismiss, not on help, info sections etc. Exclude iOS 9 and guardian-live-australia. Suppresses other banners, and appears over epics',\n\tdataLinkNames: 'SignInGateMain',\n\tidealOutcome:\n\t\t'Increase the number of users signed in whilst running at a reasonable scale',\n\tshowForSensitive: false,\n\tcanRun: () => true,\n\tvariants: [\n\t\t{\n\t\t\tid: 'main-control-5',\n\t\t\ttest: (): void => {},\n\t\t},\n\t],\n};\n","import type { ABTest } from '@guardian/ab-core';\n\nexport const signInGateMainVariant: ABTest = {\n\tid: 'SignInGateMainVariant',\n\tstart: '2020-06-09',\n\texpiry: '2025-12-01',\n\tauthor: 'Mahesh Makani',\n\tdescription:\n\t\t'Show sign in gate to 100% of users on 3rd article view of simple article templates, and show a further 5 times after the first dismissal, with higher priority over banners and epic. Main/Variant Audience.',\n\taudience: 0.9,\n\taudienceOffset: 0.0,\n\tsuccessMeasure: 'Users sign in or create a Guardian account',\n\taudienceCriteria:\n\t\t'3rd article of the day, lower priority than consent banner, simple articles (not gallery, live etc.), not signed in, not shown after dismiss, not on help, info sections etc. Exclude iOS 9 and guardian-live-australia. Suppresses other banners, and appears over epics',\n\tdataLinkNames: 'SignInGateMain',\n\tidealOutcome:\n\t\t'Increase the number of users signed in whilst running at a reasonable scale',\n\tshowForSensitive: false,\n\tcanRun: () => true,\n\tvariants: [\n\t\t{\n\t\t\tid: 'main-variant-5',\n\t\t\ttest: (): void => {},\n\t\t},\n\t],\n};\n","import { isObject, storage } from '@guardian/libs';\n\nexport interface DailyArticle {\n\tday: number;\n\tcount: number;\n}\n\nexport type DailyArticleHistory = Array<DailyArticle>;\n\nexport const DailyArticleCountKey = 'gu.history.dailyArticleCount';\n\nconst isValidHistory = (history: unknown): history is DailyArticleHistory =>\n\tArray.isArray(history) &&\n\thistory.every(\n\t\t(daily) =>\n\t\t\tisObject(daily) &&\n\t\t\t'day' in daily &&\n\t\t\t'count' in daily &&\n\t\t\ttypeof daily.day === 'number' &&\n\t\t\ttypeof daily.count === 'number',\n\t);\n\n// Returns undefined if no daily article count in local storage\nexport const getDailyArticleCount = (): DailyArticleHistory | undefined => {\n\ttry {\n\t\tconst dailyCount = storage.local.get(DailyArticleCountKey);\n\n\t\tif (!isValidHistory(dailyCount)) {\n\t\t\tthrow new Error('Invalid gu.history.dailyArticleCount value');\n\t\t}\n\n\t\treturn dailyCount;\n\t} catch (e) {\n\t\t// error parsing the string, so remove the key\n\t\tstorage.local.remove(DailyArticleCountKey);\n\t\treturn undefined;\n\t}\n};\n\nexport const getToday = (): number => Math.floor(Date.now() / 86_400_000);\n\nexport const incrementDailyArticleCount = (): void => {\n\t// get the daily article count from local storage\n\tconst dailyArticleCount = getDailyArticleCount() ?? [];\n\n\t// calculate days since unix epoch for today date\n\tconst today = getToday();\n\n\t// check if latest day is today and increment if so\n\tif (dailyArticleCount[0]?.day === today) {\n\t\tdailyArticleCount[0].count += 1;\n\t} else {\n\t\t// else set new day\n\t\tdailyArticleCount.unshift({ day: today, count: 1 });\n\n\t\t// remove any days older than 60\n\t\tconst cutOff = today - 60;\n\n\t\tconst firstOldDayIndex = dailyArticleCount.findIndex(\n\t\t\t(dailyCount) => dailyCount.day && dailyCount.day < cutOff,\n\t\t);\n\n\t\tif (firstOldDayIndex > 0) {\n\t\t\tdailyArticleCount.splice(firstOldDayIndex);\n\t\t}\n\t}\n\n\t// set the latest article count\n\tstorage.local.set(DailyArticleCountKey, dailyArticleCount);\n};\n","const constructQuery = (query: {\n\t[key: string]:\n\t\t| string\n\t\t| string[]\n\t\t| number\n\t\t| number[]\n\t\t| boolean\n\t\t| boolean[]\n\t\t| undefined;\n}): string =>\n\tObject.keys(query)\n\t\t.map((param: string) => {\n\t\t\tconst value = query[param] ?? 'undefined';\n\t\t\tconst queryValue = Array.isArray(value)\n\t\t\t\t? value.map((v) => encodeURIComponent(v)).join(',')\n\t\t\t\t: encodeURIComponent(value);\n\t\t\treturn `${param}=${queryValue}`;\n\t\t})\n\t\t.join('&');\n\nexport { constructQuery };\n","import type { ABTestAPI, Participations } from '@guardian/ab-core';\nimport { mutate } from 'swr';\nimport useSWRImmutable from 'swr/immutable';\n\ntype ABTests = {\n\tapi: ABTestAPI;\n\tparticipations: Participations;\n};\n\nconst apiPromise = new Promise<ABTests>(() => {});\nconst key = 'ab-tests';\n\n/**\n * A hook which returns the AB Test Api when available,\n * or undefined otherwise.\n *\n * Leverages an immutable SWR to satisfy all requests to the\n * AB Core. As soon as the tests are available, all instances of\n * the useAB hook will render.\n */\nexport const useAB = (): ABTests | undefined => {\n\tconst { data } = useSWRImmutable(key, () => apiPromise);\n\treturn data;\n};\n\nexport const setABTests = ({ api, participations }: ABTests): void => {\n\tvoid mutate(key, { api, participations }, false);\n};\n","import { useEffect, useState } from 'react';\nimport type { AuthStatus } from './identity';\nimport {\n\teitherInOktaTestOrElse,\n\tgetSignedInStatusWithCookies,\n\tgetSignedInStatusWithOkta,\n} from './identity';\n\n/**\n * A hook to find out if a user is signed in.\n * Returns `'Pending'` until status is known.\n * Always returns `'Pending'` during server-side rendering.\n * */\nexport const useIsSignedIn = (): boolean | 'Pending' => {\n\tconst authStatus = useAuthStatus();\n\tswitch (authStatus.kind) {\n\t\tcase 'Pending':\n\t\t\treturn 'Pending';\n\t\tcase 'SignedInWithCookies':\n\t\tcase 'SignedInWithOkta':\n\t\t\treturn true;\n\t\tcase 'SignedOutWithCookies':\n\t\tcase 'SignedOutWithOkta':\n\t\t\treturn false;\n\t}\n};\n\nexport const useAuthStatus = (): AuthStatus => {\n\tconst [authStatus, setAuthStatus] = useState<AuthStatus>({\n\t\tkind: 'Pending',\n\t});\n\n\tuseEffect(() => {\n\t\teitherInOktaTestOrElse(\n\t\t\t(oktaAuthState) => {\n\t\t\t\tsetAuthStatus(getSignedInStatusWithOkta(oktaAuthState));\n\t\t\t},\n\t\t\t() => setAuthStatus(getSignedInStatusWithCookies()),\n\t\t).catch((error) => {\n\t\t\tconsole.error(error);\n\t\t});\n\t}, []);\n\n\treturn authStatus;\n};\n","import { type CountryCode, isNonNullable } from '@guardian/libs';\nimport { useEffect, useState } from 'react';\nimport { getLocaleCode } from './getCountryCode';\n\nexport const useCountryCode = (feature: string): CountryCode | undefined => {\n\tconst [countryCode, setCountryCode] = useState<CountryCode>();\n\n\tuseEffect(() => {\n\t\tgetLocaleCode()\n\t\t\t.then((cc) => {\n\t\t\t\tif (isNonNullable(cc)) setCountryCode(cc);\n\t\t\t})\n\t\t\t.catch((e) => {\n\t\t\t\tconst msg = `Error fetching country code: ${String(e)}`;\n\t\t\t\twindow.guardian.modules.sentry.reportError(\n\t\t\t\t\tnew Error(msg),\n\t\t\t\t\tfeature,\n\t\t\t\t);\n\t\t\t});\n\t}, [feature]);\n\n\treturn countryCode;\n};\n","import libDebounce from 'lodash.debounce';\nimport { useCallback, useEffect, useRef, useState } from 'react';\n\n/**\n * This file was copied into the source development kitchen from the following repository:\n * https://github.com/guardian/csnx/blob/main/libs/%40guardian/source-development-kitchen/src/react-components/ticker/useIsInView.ts\n *\n * Note: This version of the file uses `lodash.debounce`, whereas the original version does not.\n * As a result, we now have two versions of the `useIsInView` hook—one with `lodash.debounce` and one without.\n *\n * A discussion is needed to determine the best approach for consolidating these two versions into a single file.\n * Consider whether the use of `lodash.debounce` is necessary, and if so, integrate it into the consolidated version.\n */\n\ntype Options = {\n\t/**\n\t * Defaults to `undefined` (falsy),\n\t * which trigger a change the instantaneously.\n\t *\n\t * If `true`, debounce triggers by 200ms.\n\t * Enabling debouncing ensures the target element intersects\n\t * for at least 200ms before the callback is executed\n\t */\n\tdebounce?: true;\n\t/**\n\t * Defaults to `undefined` (falsy),\n\t * which only trigger on the first intersection.\n\t *\n\t * If `true`, trigger the hook on all intersections.\n\t */\n\trepeat?: true;\n\t/** Set the initial HTML Element, if known. */\n\tnode?: HTMLElement;\n};\n\n/**\n * Custom hook around the `IntersectionObserver`.\n *\n * @returns a tuple containing `[isInView, setNode]`\n */\nconst useIsInView = (\n\toptions: IntersectionObserverInit & Options,\n): [boolean, React.Dispatch<React.SetStateAction<HTMLElement | null>>] => {\n\tconst [isInView, setIsInView] = useState<boolean>(false);\n\tconst [node, setNode] = useState<HTMLElement | null>(options.node ?? null);\n\n\tconst observer = useRef<IntersectionObserver | null>(null);\n\n\tconst intersectionObserverCallback =\n\t\tuseCallback<IntersectionObserverCallback>(\n\t\t\t([entry]) => {\n\t\t\t\tif (!entry) return;\n\n\t\t\t\tif (entry.isIntersecting) {\n\t\t\t\t\tsetIsInView(true);\n\t\t\t\t} else if (options.repeat) {\n\t\t\t\t\tsetIsInView(false);\n\t\t\t\t}\n\t\t\t},\n\t\t\t[options.repeat],\n\t\t);\n\n\tconst intersectionCallback = options.debounce\n\t\t? libDebounce(intersectionObserverCallback, 200)\n\t\t: intersectionObserverCallback;\n\n\tuseEffect(() => {\n\t\toptions.node && setNode(options.node);\n\t}, [options.node]);\n\n\tuseEffect(() => {\n\t\tif (!node) return;\n\t\t// Check for browser support https://caniuse.com/intersectionobserver\n\t\tif (!('IntersectionObserver' in window)) return;\n\n\t\tobserver.current = new window.IntersectionObserver(\n\t\t\tintersectionCallback,\n\t\t\toptions,\n\t\t);\n\n\t\tobserver.current.observe(node);\n\n\t\treturn () => observer.current?.disconnect();\n\t}, [node, options, intersectionCallback]);\n\n\tuseEffect(() => {\n\t\tif (!options.repeat && isInView) observer.current?.disconnect();\n\t}, [isInView, options.repeat]);\n\n\treturn [isInView, setNode];\n};\n\nexport { useIsInView };\n","import { isUndefined } from '@guardian/libs';\nimport { useEffect, useState } from 'react';\nimport type { NonEmptyArray } from './tuple';\n\n/**\n * Ensures that the given task is only run once and only after all items in waitFor are defined\n * @param {Function} task - The task to execute once\n * @param {Array} waitFor - An array of variables that must be defined before the task is executed\n * */\nexport const useOnce = (\n\ttask: () => void,\n\twaitFor: NonEmptyArray<unknown>,\n): void => {\n\tconst [alreadyRun, setAlreadyRun] = useState(false);\n\tconst isReady = waitFor.every((dep) => !isUndefined(dep));\n\tuseEffect(() => {\n\t\tif (!alreadyRun && isReady) {\n\t\t\ttask();\n\t\t\tsetAlreadyRun(true);\n\t\t}\n\t}, [alreadyRun, isReady, task]);\n};\n","import { useEffect, useState } from 'react';\nimport { getOphan } from '../client/ophan/ophan';\nimport type { RenderingTarget } from '../types/renderingTarget';\n\nexport const usePageViewId = (\n\trenderingTarget: RenderingTarget,\n): string | undefined => {\n\tconst [id, setId] = useState<string>();\n\n\tuseEffect(() => {\n\t\tgetOphan(renderingTarget)\n\t\t\t.then(({ pageViewId }) => {\n\t\t\t\tsetId(pageViewId);\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tsetId('no-page-view-id-available');\n\t\t\t});\n\t}, [renderingTarget]);\n\n\treturn id;\n};\n","import type { ABTest, Runnable } from '@guardian/ab-core';\nimport {\n\tsignInGateTests,\n\tsignInGateTestVariantToGateMapping,\n} from '../components/SignInGate/signInGate';\nimport type {\n\tCurrentSignInGateABTest,\n\tSignInGateComponent,\n} from '../components/SignInGate/types';\nimport { useAB } from './useAB';\n\n/**\n * @description\n * A custom hook to make which selects the sign in gate (component and ab test)\n * to be displayed on the current page\n * */\nexport const useSignInGateSelector = ():\n\t| undefined\n\t| [SignInGateComponent | null, CurrentSignInGateABTest | null] => {\n\tconst ab = useAB()?.api;\n\tif (!ab) return undefined;\n\n\tconst test: Runnable<ABTest> | null = ab.firstRunnableTest(signInGateTests);\n\n\tif (!test) {\n\t\treturn [null, null];\n\t}\n\n\tconst currentTest: CurrentSignInGateABTest = {\n\t\tname: test.dataLinkNames ?? test.id,\n\t\tvariant: test.variantToRun.id,\n\t\tid: test.id,\n\t};\n\n\tconst gateVariant = signInGateTestVariantToGateMapping[currentTest.variant];\n\n\tif (!gateVariant) {\n\t\treturn [null, null];\n\t}\n\n\treturn [gateVariant, currentTest];\n};\n"],"names":["reTrim","reIsBadHex","reIsBinary","reIsOctal","freeParseInt","parseInt","freeGlobal","g","Object","freeSelf","self","root","Function","objectToString","prototype","toString","nativeMax","Math","max","nativeMin","min","now","Date","isObject","value","type","toNumber","isObjectLike","call","isSymbol","other","valueOf","replace","isBinary","test","slice","module","exports","func","wait","options","lastArgs","lastThis","maxWait","result","timerId","lastCallTime","lastInvokeTime","leading","maxing","trailing","TypeError","invokeFunc","time","args","thisArg","undefined","apply","shouldInvoke","timeSinceLastCall","timerExpired","trailingEdge","setTimeout","remainingWait","debounced","isInvoking","arguments","this","leadingEdge","cancel","clearTimeout","flush","submitComponentEventTracking","async","componentEvent","renderingTarget","isServer","getOphan","record","submitViewEventTracking","action","withComponentId","id","componentType","trackLink","componentId","abTest","submitClickEventTracking","component","localStorageKey","localStorageDismissedDateKey","variant","name","localStorageDismissedCountKey","getSigninGatePrefsSafely","prefs","storage","local","get","object","entries","every","key","isString","includes","setSigninGatePrefs","set","setUserDismissedGate","toISOString","hasUserDismissedGate","dismissalWindow","pref","isUndefined","getTime","unsetUserDismissedGate","retrieveDismissedCount","dismissed","hasUserDismissedGateMoreThanCount","count","incrementUserDismissedGateCount","isNPageOrHigherPageView","n","getDailyArticleCount","dailyCount","isIOS9","ua","navigator","userAgent","appleDevice","os","isValidContentType","contentType","some","isValidSection","sectionId","section","isValidTag","tags","invalidTag","map","tag","signInGateComponent","canShow","isSignedIn","currentTest","isPaidContent","isPreview","Promise","resolve","flexGrowStyles","css","Lazy","children","margin","disableFlexStyles","hasBeenSeen","setRef","useIsInView","rootMargin","renderChildren","disabled","div","ref","SignInGateMain","React","endPerformanceMeasure","startPerformanceMeasure","then","default","SignInGateMainCheckoutComplete","gate","ophanComponentId","dismissGate","guUrl","signInUrl","registerUrl","checkoutCompleteCookieData","personaliseSignInGateAfterCheckoutSwitch","Suspense","fallback","signInGateTests","signInGateMainVariant","signInGateMainControl","signInGateTestVariantToGateMapping","gateMainControl","gateMainVariant","signInGateTestIdToComponentId","SignInGateMainVariant","SignInGateMainControl","isUserType","isOneOf","isProduct","isCheckoutCompleteCookieData","obj","userType","product","generateGatewayUrl","tab","pageId","pageViewId","idUrl","host","returnUrl","getCookie","queryParams","abTestName","abTestVariant","browserId","shouldMemoize","viewId","encodeURIComponent","constructQuery","ShowSignInGate","setShowGate","gateVariant","useConfig","useEffect","currentAbTestValue","SignInGateSelector","switches","authStatus","useAuthStatus","kind","isGateDismissed","setIsGateDismissed","useState","setGateVariant","setCurrentTest","canShowGate","setCanShowGate","gateSelector","useSignInGateSelector","usePageViewId","personaliseSwitch","setPersonaliseSwitch","data","setData","rawCookie","parsedCookieData","checkoutCompleteStr","decodeURIComponent","parseResult","guard","text","parsed","JSON","parse","hasError","_","parseCheckoutCompleteCookieData","useCheckoutCompleteCookieData","personaliseSignInGateAfterCheckout","countryCode","useCountryCode","useOnce","document","dispatchEvent","CustomEvent","gateSelectorVariant","gateSelectorTest","currentLocaleCode","signInGateComponentId","currentComponentId","personaliseComponentId","ctaUrlParams","show","start","expiry","author","description","audience","audienceOffset","successMeasure","audienceCriteria","dataLinkNames","idealOutcome","showForSensitive","canRun","variants","DailyArticleCountKey","history","Array","isArray","daily","day","Error","e","remove","getToday","floor","incrementDailyArticleCount","dailyArticleCount","today","unshift","cutOff","firstOldDayIndex","findIndex","splice","query","keys","param","queryValue","v","join","apiPromise","useAB","useSWRImmutable","setABTests","api","participations","mutate","useIsSignedIn","setAuthStatus","eitherInOktaTestOrElse","oktaAuthState","getSignedInStatusWithOkta","getSignedInStatusWithCookies","catch","error","console","feature","setCountryCode","getLocaleCode","cc","isNonNullable","msg","String","window","guardian","modules","sentry","reportError","isInView","setIsInView","node","setNode","observer","useRef","intersectionObserverCallback","useCallback","entry","isIntersecting","repeat","intersectionCallback","debounce","libDebounce","current","IntersectionObserver","observe","disconnect","task","waitFor","alreadyRun","setAlreadyRun","isReady","dep","setId","ab","firstRunnableTest","variantToRun"],"sourceRoot":""}