"use strict";(self.webpackChunk_guardian_dotcom_rendering=self.webpackChunk_guardian_dotcom_rendering||[]).push([[9339],{74935:(e,t,n)=>{n.r(t),n.d(t,{SetABTests:()=>B});var r=n(62335),i=n(22820),a=n(73745),s=n(58201),o=n(42376),c=n(31880);function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f=function(e){var t=e.mvtMaxValue,n=void 0===t?1e6:t,r=e.mvtId,i=e.pageIsSensitive,a=e.abTestSwitches,s=e.forcedTestVariants,o=e.forcedTestException,u=e.arrayOfTestObjects,f=void 0===u?[]:u,l=function(e){var t,c,u=function(e){var t,i=n*e.audienceOffset,a=i+n*e.audience;return r&&r>i&&r<=a&&null!==(t=e.variants[r%e.variants.length])&&void 0!==t?t:null}(e),f=function(e,t){var n,r,i,a=e.id,s=null==t||null===(n=t[a])||void 0===n?void 0:n.variant;return!!s&&(r=s,null!==(i=e.variants.find((function(e){return e.id===r})))&&void 0!==i&&i)}(e,s),l=f||u;return o!==e.id&&(f||function(e){var t,n=(t=e.expiry,(new Date).valueOf()>new Date(t).setHours(23,59,59,59)),r=!!e.showForSensitive,s=a["ab".concat(e.id)]&&!!a["ab".concat(e.id)],o=e.canRun();return(!i||r)&&!!s&&!n&&o}(e))&&l&&(f||(c="notintest"!==(t=l).id,t.canRun?t.canRun()&&c:c))?d(d({},e),{},{variantToRun:l}):null},p=function(e){return e.reduce((function(e,t){var n=l(t);return n?[].concat((0,c.A)(e),[n]):e}),[])};return{allRunnableTests:p,runnableTest:l,firstRunnableTest:function(e){var t;return null!==(t=e.map((function(e){return l(e)})).find((function(e){return null!==e})))&&void 0!==t?t:null},isUserInVariant:function(e,t){return p(f).some((function(n){return n.id===e&&n.variantToRun.id===t}))}}},l=function(e,t){return t({abTestRegister:e})},p=function(e,t){var n={variantName:e.id,complete:t};return e.campaignCode&&(n.campaignCodes=[e.campaignCode]),n},v=function(e){return e.variants.every((function(e){return"function"==typeof e.impression}))},h=function(e,t,n){return function(i){var a=i.variantToRun,s=e?a.success:a.impression;if(s)try{s(function(e,t,n,i){var a=(0,r.A)({},e.id,p(t,n));return function(){return l(a,i)}}(i,a,e,n))}catch(e){t(e)}}},b=Object.defineProperty,g=function(e,t,n){return function(e,t,n){return t in e?b(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n}(e,"symbol"!==(0,o.A)(t)?t+"":t,n)},m=function(){return(0,s.A)((function e(t){var n=t.abTestSwitches,r=t.arrayOfTestObjects,i=t.errorReporter,s=t.forcedTestException,o=t.forcedTestVariants,c=t.mvtId,u=t.mvtMaxValue,d=t.ophanRecord,b=t.pageIsSensitive,m=t.serverSideTests;(0,a.A)(this,e),g(this,"_core"),g(this,"_ophan"),this._core=f({abTestSwitches:n,arrayOfTestObjects:r,forcedTestException:s,forcedTestVariants:o,mvtId:c,mvtMaxValue:u,pageIsSensitive:b}),this._ophan=function(e){var t=e.serverSideTests,n=e.errorReporter,r=e.ophanRecord;return{registerCompleteEvents:function(e){return e.forEach(h(!0,n,r))},registerImpressionEvents:function(e){return e.filter(v).forEach(h(!1,n,r))},trackABTests:function(e){return l(function(e,t,n){try{var r={},i=Object.keys(n).filter((function(e){return!!n[e]}));return e.filter((function(e){return!v(e)})).forEach((function(e){r[e.id]=p(e.variantToRun,!1)})),i.forEach((function(e){r["ab".concat(e)]=p({id:"inTest",test:function(){}},!1)})),r}catch(e){return t(e),{}}}(e,n,t),r)}}}({errorReporter:i,ophanRecord:d,serverSideTests:m})}),[{key:"allRunnableTests",get:function(){return this._core.allRunnableTests}},{key:"firstRunnableTest",get:function(){return this._core.firstRunnableTest}},{key:"runnableTest",get:function(){return this._core.runnableTest}},{key:"isUserInVariant",get:function(){return this._core.isUserInVariant}},{key:"registerCompleteEvents",get:function(){return this._ophan.registerCompleteEvents}},{key:"registerImpressionEvents",get:function(){return this._ophan.registerImpressionEvents}},{key:"trackABTests",get:function(){return this._ophan.trackABTests}}])}(),O=n(64361),y=n(65656),w=n(16346),T=n(67400),j=n(85918),k=n(95671),S=n(14247),R=n(5819),P=n(19857),A=n(97745),E=[k.i,A.k,P.k,{id:"ConsentlessAds",author:"@guardian/commercial-dev",start:"2022-08-11",expiry:"2023-06-01",audience:0,audienceOffset:0,audienceCriteria:"All pageviews",successMeasure:"Testing Opt Out ads in production",description:"Use consentless ad stack rather than consented / standalone",variants:[{id:"control",test:function(){}},{id:"variant",test:function(){}}],canRun:function(){return!0}},R.l,{id:"MpuWhenNoEpic",author:"@commercial-dev",start:"2023-11-22",expiry:"2024-04-30",audience:.1,audienceOffset:.05,audienceCriteria:"",successMeasure:"",description:"Test MPU when there is no epic at the end of Article on the page.",variants:[{id:"control",test:function(){}},{id:"variant",test:function(){}}],canRun:function(){return!0}},S.K,{id:"OptimiseSpacefinderInline",author:"@commercial-dev",start:"2024-08-08",expiry:"2024-09-13",audience:.05,audienceOffset:0,audienceCriteria:"",successMeasure:"",description:"Test new spacefinder rules for inline1 ads on desktop.",variants:[{id:"control",test:function(){}},{id:"variant",test:function(){}}],canRun:function(){return!0}},{id:"UsaExpandableMarketingCard",start:"2024-10-02",expiry:"2024-12-18",author:"dotcom.platform@guardian.co.uk",description:"Test the impact of showing the user a component that highlights the Guardians journalism.",audience:.4,audienceOffset:0,audienceCriteria:"US-based users that see the US edition.",successMeasure:"Users are more likely to engage with the site.",canRun:function(){return!0},variants:[{id:"control",test:function(){}},{id:"variant-free",test:function(){}},{id:"variant-bubble",test:function(){}},{id:"variant-billionaire",test:function(){}}]},{id:"OnwardsContentArticle",start:"2024-12-05",expiry:"2025-01-29",author:"dotcom.platform@guardian.co.uk",description:"Test the impact of showing the galleries onwards content component on article pages.",audience:.5,audienceOffset:.5,audienceCriteria:"Article pages",successMeasure:"Users are more likely to click a link in the onward content component.",canRun:function(){return!0},variants:[{id:"control",test:function(){}},{id:"variant",test:function(){}}]}];function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _=n(66049),D=n(7693);function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach((function(t){(0,r.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var G=1e6,N=function(e){if(e){var t=Number(e);if(!Number.isNaN(t)&&!(t<1||t>G))return t}},B=function(e){var t=e.isDev,n=e.pageIsSensitive,a=e.abTestSwitches,s=e.forcedTestVariants,o=e.serverSideTests,c=(0,D.U)().renderingTarget,u=(0,T.useState)(),d=(0,i.A)(u,2),f=d[0],l=d[1];return(0,T.useEffect)((function(){(0,j.V5)(c).then(l).catch((function(e){console.log("There was an error retrieving the ophan window object",e)}))}),[c]),(0,T.useEffect)((function(){var e;if(f){var c=t&&null!==(e=N((0,O.R)({name:"GU_mvt_id_local",shouldMemoize:!0})))&&void 0!==e?e:N((0,O.R)({name:"GU_mvt_id",shouldMemoize:!0}));(0,y.b)(c)&&console.error("There is no MVT ID set, see SetABTests.importable.tsx");var u,d=U(U({},s),(u=window.location.hash).startsWith("#ab")?u.replace("#ab-","").split(",").reduce((function(e,t){var n=t.split("="),a=(0,i.A)(n,2),s=a[0],o=a[1];return s&&o?x(x({},e),{},(0,r.A)({},s,{variant:o})):e}),{}):{}),l=new m({mvtId:null!=c?c:-1,mvtMaxValue:G,pageIsSensitive:n,abTestSwitches:a,arrayOfTestObjects:E,forcedTestVariants:d,ophanRecord:f.record,serverSideTests:o,errorReporter:function(e){return window.guardian.modules.sentry.reportError(e instanceof Error?e:Error(String(e)),"ab-tests")}}),p=l.allRunnableTests(E),v=p.reduce((function(e,t){var n=t.id,i=t.variantToRun;return I(I({},e),(0,r.A)({},n,{variant:i.id}))}),{});(0,_.z)({api:l,participations:v}),l.trackABTests(p),l.registerImpressionEvents(p),l.registerCompleteEvents(p),(0,w.Rm)("dotcom","AB tests initialised")}}),[a,s,t,n,f,o]),null}},95671:(e,t,n)=>{n.d(t,{i:()=>r});var r={id:"AbTestTest",start:"2020-05-20",expiry:"2023-12-01",author:"gtrufitt",description:"This Test",audience:1e-4,audienceOffset:0,successMeasure:"It works",audienceCriteria:"Everyone",idealOutcome:"It works",showForSensitive:!0,canRun:function(){return!0},variants:[{id:"control",test:function(){},impression:function(e){e()},success:function(e){e()}},{id:"variant",test:function(){},impression:function(e){e()},success:function(e){e()}}]}},14247:(e,t,n)=>{n.d(t,{K:()=>r});var r={id:"AdBlockAsk",author:"@guardian/commercial-dev",start:"2024-04-10",expiry:"2024-05-31",audience:.1,audienceOffset:.1,audienceCriteria:"",successMeasure:"",description:"Show new ad block ask component in ad slots when we detect ad blocker usage",variants:[{id:"control",test:function(){}},{id:"variant",test:function(){}}],canRun:function(){return!0}}},5819:(e,t,n)=>{n.d(t,{l:()=>r});var r={id:"IntegrateIma",start:"2022-07-14",expiry:"2024-02-28",author:"Zeke Hunter-Green",description:"Test the commercial impact of replacing YouTube ads with Interactive Media Ads on first-party videos",audience:0,audienceOffset:.1,audienceCriteria:"Opt in",successMeasure:"IMA integration works as expected without adversely affecting pages with videos",canRun:function(){return!0},variants:[{id:"control",test:function(){}},{id:"variant",test:function(){}}]}},19857:(e,t,n)=>{n.d(t,{k:()=>r});var r={id:"SignInGateMainControl",start:"2020-05-20",expiry:"2025-12-01",author:"Mahesh Makani",description:"Show sign in gate to 100% of users on 3rd article view of simple article templates, and show a further 5 times after the first dismissal, with higher priority over banners and epic. Control Audience.",audience:.1,audienceOffset:.9,successMeasure:"N/A - User does not see gate, only to compare to variant.",audienceCriteria:"3rd article of the day, lower priority than consent banner, simple articles (not gallery, live etc.), not signed in, not shown after dismiss, not on help, info sections etc. Exclude iOS 9 and guardian-live-australia. Suppresses other banners, and appears over epics",dataLinkNames:"SignInGateMain",idealOutcome:"Increase the number of users signed in whilst running at a reasonable scale",showForSensitive:!1,canRun:function(){return!0},variants:[{id:"main-control-5",test:function(){}}]}},97745:(e,t,n)=>{n.d(t,{k:()=>r});var r={id:"SignInGateMainVariant",start:"2020-06-09",expiry:"2025-12-01",author:"Mahesh Makani",description:"Show sign in gate to 100% of users on 3rd article view of simple article templates, and show a further 5 times after the first dismissal, with higher priority over banners and epic. Main/Variant Audience.",audience:.9,audienceOffset:0,successMeasure:"Users sign in or create a Guardian account",audienceCriteria:"3rd article of the day, lower priority than consent banner, simple articles (not gallery, live etc.), not signed in, not shown after dismiss, not on help, info sections etc. Exclude iOS 9 and guardian-live-australia. Suppresses other banners, and appears over epics",dataLinkNames:"SignInGateMain",idealOutcome:"Increase the number of users signed in whilst running at a reasonable scale",showForSensitive:!1,canRun:function(){return!0},variants:[{id:"main-variant-5",test:function(){}}]}},66049:(e,t,n)=>{n.d(t,{H:()=>o,z:()=>c});var r=n(29273),i=n(53994),a=new Promise((function(){})),s="ab-tests",o=function(){return(0,i.A)(s,(function(){return a})).data},c=function(e){var t=e.api,n=e.participations;(0,r.Tk)(s,{api:t,participations:n},!1)}}}]);
//# sourceMappingURL=SetABTests-importable.client.web.legacy.078edf5c0448cfefeaea.js.map