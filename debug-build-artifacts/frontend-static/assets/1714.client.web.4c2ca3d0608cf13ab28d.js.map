{"version":3,"file":"1714.client.web.4c2ca3d0608cf13ab28d.js","mappings":"qPAcA,MAGMA,EAA+B,CACpCC,cAAe,+BACfC,cAAe,iCACfC,OAAQ,2BACRC,gBAAiB,+BCjBjB,kB,sGAWD,MAAMC,EACLC,GAE6CC,IAC5C,MAAOC,EAAQC,IAAaC,EAAAA,EAAAA,WAAS,GAE/BC,EAAU,KDGuB,IAACC,EAVRC,EAUQD,ECFbL,EAAYO,cDRPD,EAWRb,EAA6BY,GAVtDG,EAAAA,EAAQC,MAAMC,IAAI,YAAiB,OAALJ,IAAQ,IAAIK,MAAOC,eCQ/CV,GAAU,GACVW,SAASC,KAAKC,OAAO,ECfjB,IACNC,EDmBC,OCnBDA,EDiBmBZ,GCfnBa,EAAAA,EAAAA,YAAU,KACT,SAASC,EAAoBC,IAEM,WAAdA,EAAMC,KAAkC,QAAdD,EAAMC,MAEnDJ,EAAaG,EAEf,CAIA,OAFAE,OAAOC,iBAAiB,UAAWJ,GAE5B,IAAMG,OAAOE,oBAAoB,UAAWL,EAAoB,GACrE,CAACF,IDKIf,GACN,SAACF,E,sUAAAA,CAAAA,CAAgBK,QAASA,GAAaJ,KAEvC,yBE5BF,kB,8aAkDM,MAoSMwB,EAAgB,CAC5BC,EACAC,IAEA5B,EAzRA,EACC2B,EACAC,IAEA1B,IACA,MAAM,SACL2B,EAAQ,qBACRC,EAAoB,QACpBxB,EAAO,QACPyB,EAAO,cACPC,EAAa,YACbC,EAAW,OACXC,EAAM,WACNC,EAAU,cACVC,EAAa,eACbC,EAAc,YACdC,EAAW,qBACXC,EAAoB,6BACpBC,EAA4B,kBAC5BC,EAAiB,OACjBC,EAAM,cACNjC,EAAa,gBACbV,GACGG,GAEGyC,EAAaC,IAAWC,EAAAA,EAAAA,GAAY,CAC1CC,UAAU,EACVC,UAAW,KAGZ5B,EAAAA,EAAAA,YAAU,KACLwB,GAAeb,GAClBA,GACCkB,EAAAA,EAAAA,IACCnB,EACAA,EAASoB,cAGZ,GACE,CAACN,EAAab,EAAsBD,KAEvCV,EAAAA,EAAAA,YAAU,KACLW,GACHA,GACCoB,EAAAA,EAAAA,IACCrB,EACAA,EAASoB,cAGZ,GACE,CAACnB,EAAsBD,IAE1B,MAAMsB,EAAcf,EAAcgB,iBAiB5BC,EACLC,GAEOA,EAAMC,KAAKC,IACjBC,EAAAA,EAAAA,GAAoBD,EAAGL,EAAa,YAQhCO,EA7GR,SAAyB9B,GACxB,MAAO,CACN+B,MAAO,GAAY,OAAT/B,EAAS,YACnBgC,IAAK,GAAY,OAAThC,EAAS,UACjBiC,aAAc,GAAY,OAATjC,EAAS,oBAC1BkC,OAAQ,GAAY,OAATlC,EAAS,cACpB9B,OAAQ,GAAY,OAAT8B,EAAS,cACpBmC,YAAa,GAAY,OAATnC,EAAS,mBACzBoC,YAAa,GAAY,OAATpC,EAAS,mBACzBqC,cAAe,GAAY,OAATrC,EAAS,qBAE7B,CAkGuBsC,CAAgBtC,GAG/BuC,EACLC,IAEA,MAAMC,EAAoBT,IACrBU,EAAAA,EAAAA,IAAaV,EAAIW,SACb,CACNC,QAAQC,EAAAA,EAAAA,IACPb,EAAIW,QACJ1C,GAED6C,QAASd,EAAIe,MAIO,oBAAlBlE,GAAuCV,EACnC,CACNyE,QAAQI,EAAAA,EAAAA,IACPhB,EAAIW,QACJxE,EACA8B,GAED6C,QAASd,EAAIe,MAIR,CACNH,QAAQK,EAAAA,EAAAA,IACPjB,EAAIW,QACJ1C,EACAsB,EACAlB,GAEDyC,QAASd,EAAIe,MAoBTG,EAAaV,EAAcR,IAC9BS,EAAiBD,EAAcR,KAC/B,KACGC,EAAeO,EAAcP,aAnBD,CACjCA,GAEIA,EAAakB,OAASC,EAAAA,GAAiBC,OACnC,CACNF,KAAMC,EAAAA,GAAiBC,OACvBrB,IAAKS,EAAiBR,EAAaD,MAI9B,CACNmB,KAAMC,EAAAA,GAAiBE,sBACvBC,gBAAgBC,EAAAA,EAAAA,IAAkBnD,IAQjCoD,CAA0BjB,EAAcP,cACxC,KAEGyB,EACLlB,EAAcmB,kBACdC,EAAAA,EAAAA,IACCpB,EAAcmB,gBACdtD,EACAC,GACCuD,OAEGC,GAAeF,EAAAA,EAAAA,IACpBpB,EAAcuB,QACd1D,EACAC,GACCuD,OAEIG,EA5KiC,EACzCtC,EACAqB,KAEA,MAAMkB,EAAW,GAOjB,OALa,MAATvC,EACHuC,EAASC,QAAQxC,GACC,MAARqB,GACVkB,EAASC,KAAKnB,GAERkB,CAAQ,EA8DQE,CAoGpB3B,EAAc4B,WACd5B,EAAc6B,aAnGK1C,KAAKC,IACxBgC,EAAAA,EAAAA,IACChC,EACAvB,EACAC,GACCuD,SAiGGS,EACuCN,EApF1BO,MAAM3C,IAAM4C,EAAAA,EAAAA,IAAmC5C,QAqF9D8B,IACFc,EAAAA,EAAAA,IAAmCd,MACjCI,IACFU,EAAAA,EAAAA,IAAmCV,GAE/BW,EAA0BX,GAC7BjC,EAAAA,EAAAA,GAAoBiC,EAAcvC,EAAa,UAC/C,KAEGmD,EAAkChB,GACrC7B,EAAAA,EAAAA,GACA6B,EACAnC,EACA,UAEA,KAEH,GAAI+C,EACH,MAAMK,MAAM,kDAGb,MAAO,CACNhB,gBAAiBe,EACjBN,WAAY3C,EAAmBuC,GAC/BD,QAASU,EACTvB,aACAjB,eACA,EAGI2C,EAAkB,CAACC,EAAqB9C,IACtC,KACN,MAAM+C,GAAsBC,EAAAA,EAAAA,IAC3B9E,EACA4E,GAEG3E,GACHA,EAAqB4E,GAElB/C,GACHrD,GACD,EAIIsG,EAAaJ,EAAgB9C,EAAaE,KAAK,GAC/CiD,EAAsBL,EAC3B9C,EAAaG,cACb,GAEKiD,EAAqBN,EAC1B9C,EAAaK,aACb,GAEKgD,EAAqBP,EAC1B9C,EAAaM,aACb,GAEKgD,EAAuBR,EAC5B9C,EAAaO,eACb,GAEKgD,EAAeT,EAAgB9C,EAAaC,OAAO,GACnDuD,EAAgBV,EAAgB9C,EAAaI,QAAQ,GACrDqD,EAAgBX,EAAgB9C,EAAa5D,QAAQ,GAE3D,IACC,MAAMsH,EAAkBrF,GAAWoC,EAAqBpC,GAClDsF,EACLrF,GAAiBmC,EAAqBnC,GAEvC,GAAIoF,EAAiB,CACpB,MAAME,EAA2B,CAChCV,aACAC,sBACAU,iBAAkB,CACjBT,qBACAC,qBACAC,wBAEDC,eACAE,gBACAD,gBACAnF,QAAS,CACRyF,YAAaJ,EACbpF,cAAeqF,QAAAA,EAAyBD,GAEzCnF,cACAE,aACAE,iBACAC,cACAF,gBACAG,uBACAC,+BACAC,oBACAZ,WACAC,uBACAY,UAGD,OACC,SAAC+E,MAAAA,CAAIC,IAAK9E,E,UACT,SAACjB,EAAAA,EAAAA,CAAAA,EAAW2F,KAGf,CACD,CAAE,MAAOK,GACRC,QAAQC,IAAIF,EACb,CAEA,OAAO,yBAOMG,CAAenG,EAAQC,IAOzBmG,EAAyB,CACrCpG,EACAC,IAEQ0F,IACP,GAVe,CAACA,GACFU,EAAAA,EAAaC,UAAUX,GACxBY,QAQTC,CAASb,GAAQ,CACpB,MAAMc,EAAS1G,EAAcC,EAAQC,GACrC,OAAO,SAACwG,EAAAA,EAAAA,CAAAA,EAAWd,GACpB,CACA,OAAO,wB,kRC1WR,gB,++CA0BD,MAAMe,GAAeC,EAAAA,EAAAA,KAAGA,IACHC,EAAAA,GAAM,MAerBC,GAAaF,EAAAA,EAAAA,KAAGA,KAIhBG,GAAcH,EAAAA,EAAAA,KAAGA,KAIjBI,GAAgBJ,EAAAA,EAAAA,KAAGA,IACtBK,EAAAA,IAEOC,EAAAA,GAAQ,KACPC,EAAAA,EAAM,GACdC,EAAAA,GAAMC,QACGF,EAAAA,EAAM,IAIZG,GAAmBV,EAAAA,EAAAA,KAAGA,IACzBW,EAAAA,IACOC,EAAAA,GAAS,KACRL,EAAAA,EAAM,IAGXM,GAAeb,EAAAA,EAAAA,KAAGA,IACrBc,EAAAA,GACOR,EAAAA,GAAQ,KAaAC,EAAAA,EAAM,GACRK,EAAAA,GAAS,MAKnBG,GAAUf,EAAAA,EAAAA,KAAGA,IACRO,EAAAA,EAAM,IAGXS,GAAchB,EAAAA,EAAAA,KAAGA,IACPO,EAAAA,EAAM,IAGhBU,GAAOjB,EAAAA,EAAAA,KAAGA,IAERO,EAAAA,EAAM,IAMRW,EAAyDlC,IAC9D,MAAM,QAAE3B,EAAO,WAAEK,EAAU,WAAElB,EAAU,aAAEjB,GACxCyD,EAAMvF,QAAQyF,aACRiC,KAAeC,GAAW1D,EAEjC,OACC,SAAC2D,EAAAA,EAASA,CAACC,aAAcvB,E,UACxB,UAACwB,EAAAA,EAAOA,C,WACP,SAACC,EAAAA,EAAMA,CAACC,MAAO,CAAC,EAAG,EAAG,EAAG,EAAG,GAAIH,aAAcnB,E,SAC5C,OAEF,UAACqB,EAAAA,EAAMA,CAACC,MAAO,CAAC,EAAG,GAAI,GAAI,GAAI,IAAKH,aAAcpB,E,WACjD,SAACwB,KAAAA,CAAG1B,IAAKI,E,SAAgB/C,KACzB,SAACsE,KAAAA,CAAG3B,IAAKU,E,SAAmBS,KAC5B,SAAChC,MAAAA,CAAIa,IAAKa,E,SAAeO,KAEzB,SAACjC,MAAAA,CAAIa,IAAKe,E,UACT,UAACa,EAAAA,EAAaA,CAACC,MAAOC,EAAAA,G,UACpBtF,IACA,SAACuF,EAAAA,EAAUA,CACVC,SAAS,UACTC,KAAMzF,EAAWN,OACjBgG,QAASlD,EAAMV,WACf6D,KAAK,Q,SAEJ3F,EAAWJ,UAGbb,GACAA,EAAakB,OACZC,EAAAA,GAAiBC,SACjB,SAACyF,EAAAA,EAAMA,CACNJ,SAAS,UACTG,KAAK,QACLD,QAASlD,EAAML,aACf2C,aAAcN,E,SAEbzF,EAAaD,IAAIc,gBAMvB,SAAC+C,MAAAA,CAAIa,IAAKiB,E,UACT,SAACoB,EAAAA,EAAsBA,CAAAA,Y,EAQvBC,GAAclJ,EAAAA,EAAAA,IAAc8H,EAAoB,yBAChDqB,GAAY9C,EAAAA,EAAAA,IACjByB,EACA,wB","sources":["webpack://@guardian/dotcom-rendering/./src/components/marketing/banners/utils/localStorage.ts","webpack://@guardian/dotcom-rendering/./src/components/marketing/banners/utils/withCloseable.tsx","webpack://@guardian/dotcom-rendering/./src/components/marketing/hooks/useEscapeShortcut.ts","webpack://@guardian/dotcom-rendering/./src/components/marketing/banners/common/BannerWrapper.tsx","webpack://@guardian/dotcom-rendering/./src/components/marketing/banners/signInPrompt/SignInPromptBanner.tsx"],"sourcesContent":["/**\n * @file\n * This file was migrated from:\n * https://github.com/guardian/support-dotcom-components/blob/0a2439b701586a7a2cc60dce10b4d96cf7a828db/packages/modules/src/modules/banners/localStorage.ts\n */\nimport { storage } from '@guardian/libs';\nimport type { BannerChannel } from '@guardian/support-dotcom-components/dist/shared/types';\n\ntype BannerLastClosedAt =\n\t| 'engagementBannerLastClosedAt'\n\t| 'subscriptionBannerLastClosedAt'\n\t| 'signInBannerLastClosedAt'\n\t| 'abandonedBasketLastClosedAt';\n\nconst setBannerClosedTimestamp = (name: BannerLastClosedAt): void =>\n\tstorage.local.set(`gu.prefs.${name}`, new Date().toISOString());\n\nconst bannerChannelToLastClosedMap = {\n\tcontributions: 'engagementBannerLastClosedAt',\n\tsubscriptions: 'subscriptionBannerLastClosedAt',\n\tsignIn: 'signInBannerLastClosedAt',\n\tabandonedBasket: 'abandonedBasketLastClosedAt',\n} as const satisfies Record<BannerChannel, BannerLastClosedAt>;\n\nexport const setChannelClosedTimestamp = (channel: BannerChannel): void => {\n\tsetBannerClosedTimestamp(bannerChannelToLastClosedMap[channel]);\n};\n","/**\n * @file\n * This file was migrated from:\n * https://github.com/guardian/support-dotcom-components/blob/0a2439b701586a7a2cc60dce10b4d96cf7a828db/packages/modules/src/modules/banners/hocs/withCloseable.tsx\n */\nimport type { BannerProps } from '@guardian/support-dotcom-components/dist/shared/types';\nimport { useState } from 'react';\nimport { useEscapeShortcut } from '../../hooks/useEscapeShortcut';\nimport type { ReactComponent } from '../../lib/ReactComponent';\nimport { setChannelClosedTimestamp } from './localStorage';\n\nexport interface CloseableBannerProps extends BannerProps {\n\tonClose: () => void;\n}\n\nconst withCloseable = (\n\tCloseableBanner: ReactComponent<CloseableBannerProps>,\n): ReactComponent<BannerProps> => {\n\tconst Banner: ReactComponent<BannerProps> = (bannerProps: BannerProps) => {\n\t\tconst [isOpen, setIsOpen] = useState(true);\n\n\t\tconst onClose = (): void => {\n\t\t\tsetChannelClosedTimestamp(bannerProps.bannerChannel);\n\t\t\tsetIsOpen(false);\n\t\t\tdocument.body.focus();\n\t\t};\n\n\t\tuseEscapeShortcut(onClose);\n\n\t\treturn isOpen ? (\n\t\t\t<CloseableBanner onClose={onClose} {...bannerProps} />\n\t\t) : (\n\t\t\t<></>\n\t\t);\n\t};\n\treturn Banner;\n};\n\nexport { withCloseable };\n","/**\n * @file\n * This file was migrated from:\n * https://github.com/guardian/support-dotcom-components/blob/0a2439b701586a7a2cc60dce10b4d96cf7a828db/packages/modules/src/hooks/useEscapeShortcut.ts\n */\nimport { useEffect } from 'react';\n\n// Pass a function to run when the user hits the escape key\n// Useful for enabling a keyboard shortcut for dismissing banners\nexport function useEscapeShortcut(\n\teventHandler: (event: KeyboardEvent) => void,\n): void {\n\tuseEffect(() => {\n\t\tfunction handleEscapeKeydown(event: KeyboardEvent) {\n\t\t\t// IE key name is 'Esc', because IE\n\t\t\tconst isEscapeKey = event.key === 'Escape' || event.key === 'Esc';\n\t\t\tif (isEscapeKey) {\n\t\t\t\teventHandler(event);\n\t\t\t}\n\t\t}\n\n\t\twindow.addEventListener('keydown', handleEscapeKeydown);\n\n\t\treturn () => window.removeEventListener('keydown', handleEscapeKeydown);\n\t}, [eventHandler]);\n}\n","/**\n * @file\n * This file was migrated from:\n * https://github.com/guardian/support-dotcom-components/blob/0a2439b701586a7a2cc60dce10b4d96cf7a828db/packages/modules/src/modules/banners/common/BannerWrapper.tsx\n */\nimport {\n\tbannerSchema,\n\tcontainsNonArticleCountPlaceholder,\n\tgetReminderFields,\n\treplaceNonArticleCountPlaceholders,\n\tSecondaryCtaType,\n} from '@guardian/support-dotcom-components';\nimport type {\n\tBannerContent,\n\tBannerProps,\n\tCta,\n\tSecondaryCta,\n} from '@guardian/support-dotcom-components/dist/shared/types';\nimport { useEffect } from 'react';\nimport { useIsInView } from '../../../../lib/useIsInView';\nimport type { ReactComponent } from '../../lib/ReactComponent';\nimport { replaceArticleCount } from '../../lib/replaceArticleCount';\nimport {\n\taddAbandonedBasketAndTrackingParamsToUrl,\n\taddRegionIdAndTrackingParamsToSupportUrl,\n\taddTrackingParamsToProfileUrl,\n\tcreateClickEventFromTracking,\n\tcreateInsertEventFromTracking,\n\tcreateViewEventFromTracking,\n\tisProfileUrl,\n} from '../../lib/tracking';\nimport type { CloseableBannerProps } from '../utils/withCloseable';\nimport { withCloseable } from '../utils/withCloseable';\nimport type {\n\tBannerEnrichedCta,\n\tBannerEnrichedSecondaryCta,\n\tBannerId,\n\tBannerRenderedContent,\n\tBannerRenderProps,\n} from './types';\n\nfunction getComponentIds(bannerId: BannerId) {\n\treturn {\n\t\tclose: `${bannerId} : close`,\n\t\tcta: `${bannerId} : cta`,\n\t\tsecondaryCta: `${bannerId} : secondary-cta`,\n\t\tnotNow: `${bannerId} : not now`,\n\t\tsignIn: `${bannerId} : sign in`,\n\t\treminderCta: `${bannerId} : reminder-cta`,\n\t\treminderSet: `${bannerId} : reminder-set`,\n\t\treminderClose: `${bannerId} : reminder-close`,\n\t};\n}\n\nexport const getParagraphsOrMessageText = (\n\tparas: string[] | undefined,\n\ttext: string | undefined,\n): string[] => {\n\tconst bodyCopy = [];\n\n\tif (paras != null) {\n\t\tbodyCopy.push(...paras);\n\t} else if (text != null) {\n\t\tbodyCopy.push(text);\n\t}\n\treturn bodyCopy;\n};\n\nconst withBannerData =\n\t(\n\t\tBanner: ReactComponent<BannerRenderProps>,\n\t\tbannerId: BannerId,\n\t): ReactComponent<CloseableBannerProps> =>\n\t(bannerProps) => {\n\t\tconst {\n\t\t\ttracking,\n\t\t\tsubmitComponentEvent,\n\t\t\tonClose,\n\t\t\tcontent,\n\t\t\tmobileContent,\n\t\t\tcountryCode,\n\t\t\tprices,\n\t\t\tfetchEmail,\n\t\t\tarticleCounts,\n\t\t\ttickerSettings,\n\t\t\tisSupporter,\n\t\t\tseparateArticleCount,\n\t\t\tseparateArticleCountSettings,\n\t\t\tchoiceCardAmounts,\n\t\t\tdesign,\n\t\t\tbannerChannel,\n\t\t\tabandonedBasket,\n\t\t} = bannerProps;\n\n\t\tconst [hasBeenSeen, setNode] = useIsInView({\n\t\t\tdebounce: true,\n\t\t\tthreshold: 0,\n\t\t});\n\n\t\tuseEffect(() => {\n\t\t\tif (hasBeenSeen && submitComponentEvent) {\n\t\t\t\tsubmitComponentEvent(\n\t\t\t\t\tcreateViewEventFromTracking(\n\t\t\t\t\t\ttracking,\n\t\t\t\t\t\ttracking.campaignCode,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\t\t}, [hasBeenSeen, submitComponentEvent, tracking]);\n\n\t\tuseEffect(() => {\n\t\t\tif (submitComponentEvent) {\n\t\t\t\tsubmitComponentEvent(\n\t\t\t\t\tcreateInsertEventFromTracking(\n\t\t\t\t\t\ttracking,\n\t\t\t\t\t\ttracking.campaignCode,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\t\t}, [submitComponentEvent, tracking]);\n\n\t\tconst numArticles = articleCounts.forTargetedWeeks;\n\n\t\tconst cleanParagraphsOrMessageText = (\n\t\t\tparas: string[] | undefined,\n\t\t\ttext: string | undefined,\n\t\t): string[] => {\n\t\t\tconst originalCopy = getParagraphsOrMessageText(paras, text);\n\n\t\t\treturn originalCopy.map((p) =>\n\t\t\t\treplaceNonArticleCountPlaceholders(\n\t\t\t\t\tp,\n\t\t\t\t\tcountryCode,\n\t\t\t\t\tprices,\n\t\t\t\t).trim(),\n\t\t\t);\n\t\t};\n\n\t\tconst finaliseParagraphs = (\n\t\t\tparas: string[],\n\t\t): (Array<JSX.Element> | JSX.Element)[] => {\n\t\t\treturn paras.map((p) =>\n\t\t\t\treplaceArticleCount(p, numArticles, 'banner'),\n\t\t\t);\n\t\t};\n\n\t\tconst paragraphsContainNonArticleCountPlaceholder = (\n\t\t\tparas: string[],\n\t\t): boolean => paras.some((p) => containsNonArticleCountPlaceholder(p));\n\n\t\tconst componentIds = getComponentIds(bannerId);\n\n\t\t// For safety, this function throws if not all placeholders are replaced\n\t\tconst buildRenderedContent = (\n\t\t\tbannerContent: BannerContent,\n\t\t): BannerRenderedContent => {\n\t\t\tconst buildEnrichedCta = (cta: Cta): BannerEnrichedCta => {\n\t\t\t\tif (isProfileUrl(cta.baseUrl)) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tctaUrl: addTrackingParamsToProfileUrl(\n\t\t\t\t\t\t\tcta.baseUrl,\n\t\t\t\t\t\t\ttracking,\n\t\t\t\t\t\t),\n\t\t\t\t\t\tctaText: cta.text,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (bannerChannel === 'abandonedBasket' && abandonedBasket) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tctaUrl: addAbandonedBasketAndTrackingParamsToUrl(\n\t\t\t\t\t\t\tcta.baseUrl,\n\t\t\t\t\t\t\tabandonedBasket,\n\t\t\t\t\t\t\ttracking,\n\t\t\t\t\t\t),\n\t\t\t\t\t\tctaText: cta.text,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tctaUrl: addRegionIdAndTrackingParamsToSupportUrl(\n\t\t\t\t\t\tcta.baseUrl,\n\t\t\t\t\t\ttracking,\n\t\t\t\t\t\tnumArticles,\n\t\t\t\t\t\tcountryCode,\n\t\t\t\t\t),\n\t\t\t\t\tctaText: cta.text,\n\t\t\t\t};\n\t\t\t};\n\n\t\t\tconst buildEnrichedSecondaryCta = (\n\t\t\t\tsecondaryCta: SecondaryCta,\n\t\t\t): BannerEnrichedSecondaryCta => {\n\t\t\t\tif (secondaryCta.type === SecondaryCtaType.Custom) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttype: SecondaryCtaType.Custom,\n\t\t\t\t\t\tcta: buildEnrichedCta(secondaryCta.cta),\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\ttype: SecondaryCtaType.ContributionsReminder,\n\t\t\t\t\treminderFields: getReminderFields(countryCode),\n\t\t\t\t};\n\t\t\t};\n\n\t\t\tconst primaryCta = bannerContent.cta\n\t\t\t\t? buildEnrichedCta(bannerContent.cta)\n\t\t\t\t: null;\n\t\t\tconst secondaryCta = bannerContent.secondaryCta\n\t\t\t\t? buildEnrichedSecondaryCta(bannerContent.secondaryCta)\n\t\t\t\t: null;\n\n\t\t\tconst cleanHighlightedText =\n\t\t\t\tbannerContent.highlightedText &&\n\t\t\t\treplaceNonArticleCountPlaceholders(\n\t\t\t\t\tbannerContent.highlightedText,\n\t\t\t\t\tcountryCode,\n\t\t\t\t\tprices,\n\t\t\t\t).trim();\n\n\t\t\tconst cleanHeading = replaceNonArticleCountPlaceholders(\n\t\t\t\tbannerContent.heading,\n\t\t\t\tcountryCode,\n\t\t\t\tprices,\n\t\t\t).trim();\n\n\t\t\tconst cleanParagraphs = cleanParagraphsOrMessageText(\n\t\t\t\tbannerContent.paragraphs,\n\t\t\t\tbannerContent.messageText,\n\t\t\t);\n\n\t\t\tconst copyHasPlaceholder =\n\t\t\t\tparagraphsContainNonArticleCountPlaceholder(cleanParagraphs) ||\n\t\t\t\t(!!cleanHighlightedText &&\n\t\t\t\t\tcontainsNonArticleCountPlaceholder(cleanHighlightedText)) ||\n\t\t\t\t(!!cleanHeading &&\n\t\t\t\t\tcontainsNonArticleCountPlaceholder(cleanHeading));\n\n\t\t\tconst headingWithArticleCount = cleanHeading\n\t\t\t\t? replaceArticleCount(cleanHeading, numArticles, 'banner')\n\t\t\t\t: null;\n\n\t\t\tconst highlightedTextWithArticleCount = cleanHighlightedText\n\t\t\t\t? replaceArticleCount(\n\t\t\t\t\t\tcleanHighlightedText,\n\t\t\t\t\t\tnumArticles,\n\t\t\t\t\t\t'banner',\n\t\t\t\t  )\n\t\t\t\t: null;\n\n\t\t\tif (copyHasPlaceholder) {\n\t\t\t\tthrow Error('Banner copy contains placeholders, abandoning.');\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\thighlightedText: highlightedTextWithArticleCount,\n\t\t\t\tparagraphs: finaliseParagraphs(cleanParagraphs),\n\t\t\t\theading: headingWithArticleCount,\n\t\t\t\tprimaryCta,\n\t\t\t\tsecondaryCta,\n\t\t\t};\n\t\t};\n\n\t\tconst clickHandlerFor = (componentId: string, close: boolean) => {\n\t\t\treturn (): void => {\n\t\t\t\tconst componentClickEvent = createClickEventFromTracking(\n\t\t\t\t\ttracking,\n\t\t\t\t\tcomponentId,\n\t\t\t\t);\n\t\t\t\tif (submitComponentEvent) {\n\t\t\t\t\tsubmitComponentEvent(componentClickEvent);\n\t\t\t\t}\n\t\t\t\tif (close) {\n\t\t\t\t\tonClose();\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\n\t\tconst onCtaClick = clickHandlerFor(componentIds.cta, true);\n\t\tconst onSecondaryCtaClick = clickHandlerFor(\n\t\t\tcomponentIds.secondaryCta,\n\t\t\ttrue,\n\t\t);\n\t\tconst onReminderCtaClick = clickHandlerFor(\n\t\t\tcomponentIds.reminderCta,\n\t\t\tfalse,\n\t\t);\n\t\tconst onReminderSetClick = clickHandlerFor(\n\t\t\tcomponentIds.reminderSet,\n\t\t\tfalse,\n\t\t);\n\t\tconst onReminderCloseClick = clickHandlerFor(\n\t\t\tcomponentIds.reminderClose,\n\t\t\tfalse,\n\t\t);\n\t\tconst onCloseClick = clickHandlerFor(componentIds.close, true);\n\t\tconst onNotNowClick = clickHandlerFor(componentIds.notNow, true);\n\t\tconst onSignInClick = clickHandlerFor(componentIds.signIn, false);\n\n\t\ttry {\n\t\t\tconst renderedContent = content && buildRenderedContent(content);\n\t\t\tconst renderedMobileContent =\n\t\t\t\tmobileContent && buildRenderedContent(mobileContent);\n\n\t\t\tif (renderedContent) {\n\t\t\t\tconst props: BannerRenderProps = {\n\t\t\t\t\tonCtaClick,\n\t\t\t\t\tonSecondaryCtaClick,\n\t\t\t\t\treminderTracking: {\n\t\t\t\t\t\tonReminderCtaClick,\n\t\t\t\t\t\tonReminderSetClick,\n\t\t\t\t\t\tonReminderCloseClick,\n\t\t\t\t\t},\n\t\t\t\t\tonCloseClick,\n\t\t\t\t\tonSignInClick,\n\t\t\t\t\tonNotNowClick,\n\t\t\t\t\tcontent: {\n\t\t\t\t\t\tmainContent: renderedContent,\n\t\t\t\t\t\tmobileContent: renderedMobileContent ?? renderedContent,\n\t\t\t\t\t},\n\t\t\t\t\tcountryCode,\n\t\t\t\t\tfetchEmail,\n\t\t\t\t\ttickerSettings,\n\t\t\t\t\tisSupporter,\n\t\t\t\t\tarticleCounts,\n\t\t\t\t\tseparateArticleCount,\n\t\t\t\t\tseparateArticleCountSettings,\n\t\t\t\t\tchoiceCardAmounts,\n\t\t\t\t\ttracking,\n\t\t\t\t\tsubmitComponentEvent,\n\t\t\t\t\tdesign,\n\t\t\t\t};\n\n\t\t\t\treturn (\n\t\t\t\t\t<div ref={setNode}>\n\t\t\t\t\t\t<Banner {...props} />\n\t\t\t\t\t</div>\n\t\t\t\t);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconsole.log(err);\n\t\t}\n\n\t\treturn <></>;\n\t};\n\nexport const bannerWrapper = (\n\tBanner: ReactComponent<BannerRenderProps>,\n\tbannerId: BannerId,\n): ReactComponent<BannerProps> =>\n\twithCloseable(withBannerData(Banner, bannerId));\n\nconst validate = (props: unknown): props is BannerProps => {\n\tconst result = bannerSchema.safeParse(props);\n\treturn result.success;\n};\n\nexport const validatedBannerWrapper = (\n\tBanner: ReactComponent<BannerRenderProps>,\n\tbannerId: BannerId,\n): ReactComponent<BannerProps> => {\n\treturn (props: BannerProps) => {\n\t\tif (validate(props)) {\n\t\t\tconst Module = bannerWrapper(Banner, bannerId);\n\t\t\treturn <Module {...props} />;\n\t\t}\n\t\treturn <></>;\n\t};\n};\n","/**\n * @file\n * This file was migrated from:\n * https://github.com/guardian/support-dotcom-components/blob/0a2439b701586a7a2cc60dce10b4d96cf7a828db/packages/modules/src/modules/banners/signInPrompt/SignInPromptBanner.tsx\n */\nimport { css, ThemeProvider } from '@emotion/react';\nimport {\n\tbrand,\n\tbrandAlt,\n\theadlineBold20,\n\theadlineBold34,\n\theadlineMedium20,\n\tneutral,\n\tspace,\n\tuntil,\n} from '@guardian/source/foundations';\nimport {\n\tButton,\n\tbuttonThemeBrand,\n\tColumn,\n\tColumns,\n\tContainer,\n\tLinkButton,\n\tSvgRoundelBrandInverse,\n} from '@guardian/source/react-components';\nimport { SecondaryCtaType } from '@guardian/support-dotcom-components';\nimport type { ReactComponent } from '../../lib/ReactComponent';\nimport { bannerWrapper, validatedBannerWrapper } from '../common/BannerWrapper';\nimport type { BannerRenderProps } from '../common/types';\n\nconst bannerStyles = css`\n\tbackground-color: ${brand[400]};\n\n\t::before {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\tposition: fixed;\n\t\ttop: 0;\n\t\tright: 0;\n\t\tbottom: 0;\n\t\tleft: 0;\n\t\tbackground: rgb(0, 0, 0, 0.3);\n\t\tz-index: -1;\n\t}\n`;\n\nconst mainColumn = css`\n\tposition: relative;\n`;\n\nconst asideColumn = css`\n\tmargin-right: 10px;\n`;\n\nconst headingStyles = css`\n\t${headlineBold34}\n\tfont-size: 32px;\n\tcolor: ${neutral[100]};\n\tmargin: ${space[1]}px 0 0;\n\t${until.phablet} {\n\t\tmargin: ${space[1]}px 45px 0 0;\n\t}\n`;\n\nconst subHeadingStyles = css`\n\t${headlineBold20};\n\tcolor: ${brandAlt[400]};\n\tmargin: ${space[2]}px 0;\n`;\n\nconst bulletStyles = css`\n\t${headlineMedium20};\n\tcolor: ${neutral[100]};\n\tdisplay: flex;\n\tflex-direction: column;\n\n\tspan:not(:first-of-type) {\n\t\tmargin-top: 10px;\n\t}\n\n\tspan::before {\n\t\tcontent: '';\n\t\tdisplay: inline-block;\n\t\twidth: 15px;\n\t\theight: 15px;\n\t\tmargin-right: ${space[2]}px;\n\t\tbackground: ${brandAlt[400]};\n\t\tborder-radius: 50%;\n\t}\n`;\n\nconst actions = css`\n\tmargin: ${space[5]}px 0;\n`;\n\nconst closeButton = css`\n\tmargin-left: ${space[5]}px;\n`;\n\nconst logo = css`\n\tposition: absolute;\n\ttop: ${space[2]}px;\n\tright: 0px;\n\twidth: 42px;\n\theight: 42px;\n`;\n\nconst SignInPromptBanner: ReactComponent<BannerRenderProps> = (props) => {\n\tconst { heading, paragraphs, primaryCta, secondaryCta } =\n\t\tprops.content.mainContent;\n\tconst [subheading, ...bullets] = paragraphs;\n\n\treturn (\n\t\t<Container cssOverrides={bannerStyles}>\n\t\t\t<Columns>\n\t\t\t\t<Column width={[0, 0, 0, 2, 3]} cssOverrides={asideColumn}>\n\t\t\t\t\t{' '}\n\t\t\t\t</Column>\n\t\t\t\t<Column width={[4, 12, 12, 12, 13]} cssOverrides={mainColumn}>\n\t\t\t\t\t<h1 css={headingStyles}>{heading}</h1>\n\t\t\t\t\t<h2 css={subHeadingStyles}>{subheading}</h2>\n\t\t\t\t\t<div css={bulletStyles}>{bullets}</div>\n\n\t\t\t\t\t<div css={actions}>\n\t\t\t\t\t\t<ThemeProvider theme={buttonThemeBrand}>\n\t\t\t\t\t\t\t{primaryCta && (\n\t\t\t\t\t\t\t\t<LinkButton\n\t\t\t\t\t\t\t\t\tpriority=\"primary\"\n\t\t\t\t\t\t\t\t\thref={primaryCta.ctaUrl}\n\t\t\t\t\t\t\t\t\tonClick={props.onCtaClick}\n\t\t\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{primaryCta.ctaText}\n\t\t\t\t\t\t\t\t</LinkButton>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{secondaryCta &&\n\t\t\t\t\t\t\t\tsecondaryCta.type ===\n\t\t\t\t\t\t\t\t\tSecondaryCtaType.Custom && (\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tpriority=\"subdued\"\n\t\t\t\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t\t\t\t\tonClick={props.onCloseClick}\n\t\t\t\t\t\t\t\t\t\tcssOverrides={closeButton}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t{secondaryCta.cta.ctaText}\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</ThemeProvider>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<div css={logo}>\n\t\t\t\t\t\t<SvgRoundelBrandInverse />\n\t\t\t\t\t</div>\n\t\t\t\t</Column>\n\t\t\t</Columns>\n\t\t</Container>\n\t);\n};\n\nconst unvalidated = bannerWrapper(SignInPromptBanner, 'sign-in-prompt-banner');\nconst validated = validatedBannerWrapper(\n\tSignInPromptBanner,\n\t'sign-in-prompt-banner',\n);\n\nexport {\n\tvalidated as SignInPromptBanner,\n\tunvalidated as SignInPromptBannerUnvalidated,\n};\n"],"names":["bannerChannelToLastClosedMap","contributions","subscriptions","signIn","abandonedBasket","withCloseable","CloseableBanner","bannerProps","isOpen","setIsOpen","useState","onClose","channel","name","bannerChannel","storage","local","set","Date","toISOString","document","body","focus","eventHandler","useEffect","handleEscapeKeydown","event","key","window","addEventListener","removeEventListener","bannerWrapper","Banner","bannerId","tracking","submitComponentEvent","content","mobileContent","countryCode","prices","fetchEmail","articleCounts","tickerSettings","isSupporter","separateArticleCount","separateArticleCountSettings","choiceCardAmounts","design","hasBeenSeen","setNode","useIsInView","debounce","threshold","createViewEventFromTracking","campaignCode","createInsertEventFromTracking","numArticles","forTargetedWeeks","finaliseParagraphs","paras","map","p","replaceArticleCount","componentIds","close","cta","secondaryCta","notNow","reminderCta","reminderSet","reminderClose","getComponentIds","buildRenderedContent","bannerContent","buildEnrichedCta","isProfileUrl","baseUrl","ctaUrl","addTrackingParamsToProfileUrl","ctaText","text","addAbandonedBasketAndTrackingParamsToUrl","addRegionIdAndTrackingParamsToSupportUrl","primaryCta","type","SecondaryCtaType","Custom","ContributionsReminder","reminderFields","getReminderFields","buildEnrichedSecondaryCta","cleanHighlightedText","highlightedText","replaceNonArticleCountPlaceholders","trim","cleanHeading","heading","cleanParagraphs","bodyCopy","push","getParagraphsOrMessageText","paragraphs","messageText","copyHasPlaceholder","some","containsNonArticleCountPlaceholder","headingWithArticleCount","highlightedTextWithArticleCount","Error","clickHandlerFor","componentId","componentClickEvent","createClickEventFromTracking","onCtaClick","onSecondaryCtaClick","onReminderCtaClick","onReminderSetClick","onReminderCloseClick","onCloseClick","onNotNowClick","onSignInClick","renderedContent","renderedMobileContent","props","reminderTracking","mainContent","div","ref","err","console","log","withBannerData","validatedBannerWrapper","bannerSchema","safeParse","success","validate","Module","bannerStyles","css","brand","mainColumn","asideColumn","headingStyles","headlineBold34","neutral","space","until","phablet","subHeadingStyles","headlineBold20","brandAlt","bulletStyles","headlineMedium20","actions","closeButton","logo","SignInPromptBanner","subheading","bullets","Container","cssOverrides","Columns","Column","width","h1","h2","ThemeProvider","theme","buttonThemeBrand","LinkButton","priority","href","onClick","size","Button","SvgRoundelBrandInverse","unvalidated","validated"],"sourceRoot":""}