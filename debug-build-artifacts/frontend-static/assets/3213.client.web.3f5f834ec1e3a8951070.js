(self.webpackChunk_guardian_dotcom_rendering=self.webpackChunk_guardian_dotcom_rendering||[]).push([[3213],{44165:(e,t,n)=>{var r=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,i=/^0o[0-7]+$/i,s=parseInt,c="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,u="object"==typeof self&&self&&self.Object===Object&&self,d=c||u||Function("return this")(),l=Object.prototype.toString,f=Math.max,w=Math.min,g=function(){return d.Date.now()};function m(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function v(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==l.call(e)}(e))return NaN;if(m(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=m(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(r,"");var n=a.test(e);return n||i.test(e)?s(e.slice(2),n?2:8):o.test(e)?NaN:+e}e.exports=function(e,t,n){var r,o,a,i,s,c,u=0,d=!1,l=!1,p=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function h(t){var n=r,a=o;return r=o=void 0,u=t,i=e.apply(a,n)}function y(e){var n=e-c;return void 0===c||n>=t||n<0||l&&e-u>=a}function b(){var e=g();if(y(e))return z(e);s=setTimeout(b,function(e){var n=t-(e-c);return l?w(n,a-(e-u)):n}(e))}function z(e){return s=void 0,p&&r?h(e):(r=o=void 0,i)}function O(){var e=g(),n=y(e);if(r=arguments,o=this,c=e,n){if(void 0===s)return function(e){return u=e,s=setTimeout(b,t),d?h(e):i}(c);if(l)return s=setTimeout(b,t),h(c)}return void 0===s&&(s=setTimeout(b,t)),i}return t=v(t)||0,m(n)&&(d=!!n.leading,a=(l="maxWait"in n)?f(v(n.maxWait)||0,t):a,p="trailing"in n?!!n.trailing:p),O.cancel=function(){void 0!==s&&clearTimeout(s),u=0,r=c=o=s=void 0},O.flush=function(){return void 0===s?i:z(g())},O}},99952:(e,t,n)=>{"use strict";n.d(t,{af:()=>d,r2:()=>u});var r=n(61082),o=n(29995),a=n(67400),i=n(36226),s=n(15901);const c=e=>["article","liveblog","gallery","video","interactive","audio"].includes(e.toLowerCase()),u=async(e,t,n)=>{var a,u;return(e=>{window.guardian.dailyArticleCount||(c(e)&&(0,s.Q_)(),window.guardian.dailyArticleCount=(0,s.L3)()),window.guardian.dailyArticleCount})(n),await(async(e,t,n)=>{if(!await(0,i.yw)()){if(!window.guardian.weeklyArticleCount){if(c(n)){const n=t.filter((e=>["tone","keyword"].includes(e.type.toLowerCase()))).map((e=>e.id));(0,o.sB)(r.I.local,e,n)}window.guardian.weeklyArticleCount=(0,o.sQ)(r.I.local)}return window.guardian.weeklyArticleCount}})(e,t,n),{dailyArticleHistory:null!==(a=window.guardian.dailyArticleCount)&&void 0!==a?a:[],weeklyArticleHistory:null!==(u=window.guardian.weeklyArticleCount)&&void 0!==u?u:[]}},d=(e,t,n)=>{const[r,o]=(0,a.useState)("Pending");return(0,a.useEffect)((()=>{u(e,t,n).then(o).catch((()=>o(void 0)))}),[n,e,t]),r}},3002:(e,t,n)=>{"use strict";n.d(t,{B:()=>o});const r=["preview.gutools.co.uk","preview.code.dev-gutools.co.uk","localhost","m.thegulocal.com"],o=()=>{if(window.location.hash){const e="force-braze-message",t=window.location.hash;if(t.includes(e)){if(!r.includes(window.location.hostname))return console.log("".concat(e," is not supported on this domain")),null;const n=t.slice(t.indexOf("".concat(e,"="))+e.length+1,t.length);try{return{dataFromBraze:JSON.parse(decodeURIComponent(n)),logImpressionWithBraze:()=>{},logButtonClickWithBraze:()=>{}}}catch(t){const n=t;console.log("There was an error with ".concat(e,": "),n.message)}}}return null}},70451:(e,t,n)=>{"use strict";n.d(t,{O:()=>r});const r=e=>!0===window.guardian.config.switches.brazeTaylorReport&&!e.find((e=>"news/series/cotton-capital"===e.id))},36226:(e,t,n)=>{"use strict";n.d(t,{Jj:()=>p,Pp:()=>u,VF:()=>d,Vi:()=>c,Xr:()=>b,_f:()=>O,h3:()=>f,mG:()=>y,mV:()=>v,n8:()=>z,q6:()=>S,tZ:()=>P,yw:()=>h});var r=n(18411),o=n(9474),a=n(61082),i=n(9092),s=n(67400);const c="gu_hide_support_messaging",u="gu_recurring_contributor",d="gu.contributions.contrib-timestamp",l="gu.noRRBanner",f=e=>{const t=(e=>{switch((0,r.R)({name:c})){case"true":return!0;case"false":return!1;default:return!!e&&"Pending"}})(e);return"Pending"===t?"Pending":t||(()=>{const e=(()=>{const e=(0,r.R)({name:d});if(e)return(e?parseInt(e,10):0)||void 0})();return!(0,o.b)(e)&&((e,t)=>{const n=Date.now()-e;return Math.floor(n/864e5)})(e)<=90})()},w=[1,3,7],g=[1,3,5,7],m=()=>null!==(0,r.R)({name:"gu_article_count_opt_out"}),v=()=>new Promise((e=>{(0,r.R)({name:"gu-cmp-disabled",shouldMemoize:!0})&&e(!0),(0,i.Ym)((t=>{let{usnat:n,tcfv2:r,aus:o}=t;if(null!=n?n:o)e(!0);else if(r){const t=w.every((e=>r.consents[e]));t||a.I.local.remove("gu.history.weeklyArticleCount"),e(t)}}))})),p=async()=>!await v()||m(),h=async()=>!await v()||m(),y=()=>{const[e,t]=(0,s.useState)("Pending");return(0,s.useEffect)((()=>{p().then(t).catch((()=>t(!0)))}),[]),e},b=()=>new Promise((e=>{(0,r.R)({name:"gu-cmp-disabled",shouldMemoize:!0})&&e(!0),(0,i.Ym)((t=>{let{usnat:n,tcfv2:r,aus:o}=t;if(null!=n?n:o)e(!0);else if(r){const t=g.every((e=>r.consents[e]));e(t)}}))})),z=()=>!!a.I.local.get(l),O=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();return a.I.local.set(l,!0,e+12e5)},P=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();return!!e&&t-new Date(e).getTime()<36e5},S=()=>{const e=(0,r.R)({name:"GU_CO_COMPLETE",shouldMemoize:!0});if(!e)return;let t;try{t=JSON.parse(decodeURIComponent(e))}catch(e){}return t}},15901:(e,t,n)=>{"use strict";n.d(t,{Gq:()=>s,L3:()=>i,Q_:()=>c});var r=n(85770),o=n(61082);const a="gu.history.dailyArticleCount",i=()=>{try{const t=o.I.local.get(a);if(e=t,!Array.isArray(e)||!e.every((e=>(0,r.G)(e)&&"day"in e&&"count"in e&&"number"==typeof e.day&&"number"==typeof e.count)))throw new Error("Invalid gu.history.dailyArticleCount value");return t}catch(e){return void o.I.local.remove(a)}var e},s=()=>Math.floor(Date.now()/864e5),c=()=>{var e,t;const n=null!==(t=i())&&void 0!==t?t:[],r=s();if((null===(e=n[0])||void 0===e?void 0:e.day)===r)n[0].count+=1;else{n.unshift({day:r,count:1});const e=r-60,t=n.findIndex((t=>t.day&&t.day<e));t>0&&n.splice(t)}o.I.local.set(a,n)}},38169:(e,t,n)=>{"use strict";n.d(t,{w:()=>a});var r=n(47513),o=n(97656);const a=e=>()=>new Promise((t=>{setTimeout((()=>t(null)),1e3),(async e=>(0,o.kU)((e=>{var t;return null===(t=e.idToken)||void 0===t?void 0:t.claims.email}),(()=>(0,r.J)(e).then((e=>{var t;return null===(t=e.user)||void 0===t?void 0:t.primaryEmailAddress})).catch((e=>{window.guardian.modules.sentry.reportError(e,"getEmail")})))))(e).then((e=>{t(e||null)}))}))},47513:(e,t,n)=>{"use strict";n.d(t,{J:()=>s,h:()=>c});var r=n(88482);function o(e){if(!e.ok)throw Error(e.statusText||"getIdApiUserData | An api call returned HTTP status ".concat(e.status));return e}const a=e=>fetch(e,{credentials:"include"}).then(o).then((e=>e.json())),i={},s=e=>{if(!i.idapiUserMeResponse){const t=(0,r.w)(e,"user/me");i.idapiUserMeResponse=a(t)}return i.idapiUserMeResponse},c=e=>{if(!i.idapiUserIdentifiersResponse){const t=(0,r.w)(e,"user/me/identifiers");i.idapiUserIdentifiersResponse=a(t)}return i.idapiUserIdentifiersResponse}},59820:(e,t,n)=>{"use strict";n.d(t,{h:()=>d});var r=n(88793),o=n(9474),a=n(50026);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){i(e,t,n[t])}))}return e}function c(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const u=()=>null,d=(e,t)=>{let{candidates:n,name:i}=e;return new Promise((e=>{const d=n.map((e=>((e,t,n)=>{let i;return c(s({},e),{candidate:c(s({},e.candidate),{canShow:()=>new Promise((o=>{const s="messagePicker-canShow-".concat(e.candidate.id),{endPerformanceMeasure:c}=(0,r.h)("tx",s);null!==e.timeoutMillis&&(i=window.setTimeout((()=>{(async(e,t,n)=>{(await(0,a.V5)(n)).record({component:"".concat(t,"-picker-timeout-dcr"),value:e})})(e.candidate.id,t,n),o({show:!1})}),e.timeoutMillis)),e.candidate.canShow().then((t=>{o(t);const r=c();e.reportTiming&&(0,a.V5)(n).then((e=>{e.record({component:s,value:r})}))})).catch((e=>console.error("timeoutify candidate - error: ".concat(String(e)))))}))}),cancelTimeout:()=>!(0,o.b)(i)&&clearTimeout(i)})})(e,i,t))),l=d.map((e=>({candidateConfig:e,canShow:e.candidate.canShow()}))).reduce((async(e,t)=>{let{candidateConfig:n,canShow:r}=t;if(await e)return e;const o=await r;return n.cancelTimeout(),o.show?{candidate:n.candidate,meta:o.meta}:e}),Promise.resolve(null));l.then((t=>{if(d.map((e=>e.cancelTimeout())),null===t)e(u);else{const{candidate:n,meta:r}=t;e((()=>n.show(r)))}})).catch((e=>console.error("pickMessage winner - error: ".concat(String(e)))))}))}},20522:(e,t,n)=>{"use strict";n.d(t,{q:()=>s});var r=n(24017),o=n(50484),a=n(67400);let i=!1;const s=()=>{i||(window.guardian.automat={emotionReact:r,emotionReactJsxRuntime:o,react:a.default},i=!0)}},14374:(e,t,n)=>{"use strict";n.d(t,{T:()=>a,w:()=>i});var r=n(67400),o=n(97656);const a=()=>{switch(i().kind){case"Pending":return"Pending";case"SignedInWithCookies":case"SignedInWithOkta":return!0;case"SignedOutWithCookies":case"SignedOutWithOkta":return!1}},i=()=>{const[e,t]=(0,r.useState)({kind:"Pending"});return(0,r.useEffect)((()=>{(0,o.kU)((e=>{t((0,o.dx)(e))}),(()=>t((0,o.Hn)()))).catch((e=>{console.error(e)}))}),[]),e}},37438:(e,t,n)=>{"use strict";n.d(t,{m:()=>b});var r=n(6506),o=n(53994),a=n(61082),i=n(60439),s=n(88793),c=n(50026);const u="gu.brazeUserSet";var d=n(47513),l=n(97656);const f=async e=>(0,l.kU)((e=>{var t;return null===(t=e.idToken)||void 0===t?void 0:t.claims.braze_uuid}),(()=>(0,d.h)(e).then((e=>e.brazeUuid)).catch((e=>{window.guardian.modules.sentry.reportError(e,"getBrazeUuid")}))));var w=n(9092);const g=(e,t,n)=>({isSuccessful:!1,failure:{field:e,data:t},data:n});var m=n(9474);const v={enableLogging:!0,noCookies:!0,baseUrl:"https://sdk.fra-01.braze.eu/api/v3",sessionTimeoutInSeconds:1,minimumIntervalBetweenTriggerActionsInSeconds:0,devicePropertyAllowlist:[]},p=(()=>{let e;return t=>((0,m.b)(e)&&(e=(async e=>{const t=await n.e(7659).then(n.t.bind(n,14844,23));return t.setLogger((e=>(0,i.Rm)("tx",e))),t.initialize(e,v),t})(t)),e)})(),h=async(e,t,n)=>{if(!a.I.local.isAvailable())return{brazeMessages:new r._v,brazeCards:new r.ho};const o=await(async(e,t)=>{const n=((e,t)=>[{name:"apiKey",value:Promise.resolve(window.guardian.config.page.brazeApiKey)},{name:"brazeSwitch",value:Promise.resolve(window.guardian.config.switches.brazeSwitch)},{name:"brazeUuid",value:e?f(t):Promise.resolve(null)},{name:"consent",value:new Promise(((e,t)=>{(0,w.Ym)((n=>{try{e((0,w.gS)("braze",n))}catch(e){t(e)}}))}))},{name:"isNotPaidContent",value:Promise.resolve(!window.guardian.config.page.isPaidContent)}])(e,t),r={};for(const{name:e,value:t}of n)try{const n=await t;if(!n)return g(e,n,r);r[e]=n}catch(t){return g(e,t instanceof Error?t.message:t,r)}return{isSuccessful:!0,data:r}})(t,e);if(!o.isSuccessful){const{failure:e,data:t}=o;return(0,i.Rm)("tx","Not attempting to show Braze messages. Dependency ".concat(e.field," failed with ").concat(String(e.data),".")),await(async(e,t,n,o)=>{const i="true"===a.I.local.getRaw(u);if(!t&&i||!n&&i||!o&&i)try{e&&(await p(e)).wipeData(),r.tP.clear(),a.I.local.remove(u)}catch(e){window.guardian.modules.sentry.reportError(e,"braze-maybeWipeUserData")}})(t.apiKey,t.brazeUuid,t.consent,t.brazeSwitch),{brazeMessages:new r._v,brazeCards:new r.ho}}try{const{endPerformanceMeasure:e}=(0,s.h)("tx","braze-sdk-load"),t=await p(o.data.apiKey),i=e();(await(0,c.V5)(n)).record({component:"braze-sdk-load-timing",value:i});const d=(e,t)=>{window.guardian.modules.sentry.reportError(e,t)};a.I.local.setRaw(u,"true"),t.changeUser(o.data.brazeUuid),t.openSession();const l=window.guardian.config.switches.brazeContentCards?new r.ue(t,d):new r.ho;return{brazeMessages:new r.xK(t,r.tP,d,r.Aw),brazeCards:l}}catch(e){return{brazeMessages:new r._v,brazeCards:new r.ho}}};var y=n(14374);const b=(e,t)=>{const n=(0,y.w)(),a="SignedInWithOkta"===n.kind||"SignedInWithCookies"===n.kind,{data:i,error:s}=(0,o.A)("Pending"!==n.kind?"braze-message":null,(()=>h(e,a,t)));return s?{brazeMessages:new r._v,brazeCards:new r.ho}:{brazeMessages:null==i?void 0:i.brazeMessages,brazeCards:null==i?void 0:i.brazeCards}}},75747:(e,t,n)=>{"use strict";n.d(t,{F:()=>i});var r=n(9786),o=n(67400),a=n(2899);const i=e=>{const[t,n]=(0,o.useState)();return(0,o.useEffect)((()=>{(0,a.C)().then((e=>{(0,r.R)(e)&&n(e)})).catch((t=>{const n="Error fetching country code: ".concat(String(t));window.guardian.modules.sentry.reportError(new Error(n),e)}))}),[e]),t}},58452:(e,t,n)=>{"use strict";n.d(t,{E:()=>i});var r=n(44165),o=n.n(r),a=n(67400);const i=e=>{const[t,n]=(0,a.useState)(!1);var r;const[i,s]=(0,a.useState)(null!==(r=e.node)&&void 0!==r?r:null),c=(0,a.useRef)(null),u=(0,a.useCallback)((t=>{let[r]=t;r&&(r.isIntersecting?n(!0):e.repeat&&n(!1))}),[e.repeat]),d=e.debounce?o()(u,200):u;return(0,a.useEffect)((()=>{e.node&&s(e.node)}),[e.node]),(0,a.useEffect)((()=>{if(i&&"IntersectionObserver"in window)return c.current=new window.IntersectionObserver(d,e),c.current.observe(i),()=>{var e;return null===(e=c.current)||void 0===e?void 0:e.disconnect()}}),[i,e,d]),(0,a.useEffect)((()=>{var n;!e.repeat&&t&&(null===(n=c.current)||void 0===n||n.disconnect())}),[t,e.repeat]),[t,s]}},53399:(e,t,n)=>{"use strict";n.d(t,{H:()=>a});var r=n(9474),o=n(67400);const a=(e,t)=>{const[n,a]=(0,o.useState)(!1),i=t.every((e=>!(0,r.b)(e)));(0,o.useEffect)((()=>{!n&&i&&(e(),a(!0))}),[n,i,e])}}}]);
//# sourceMappingURL=3213.client.web.3f5f834ec1e3a8951070.js.map