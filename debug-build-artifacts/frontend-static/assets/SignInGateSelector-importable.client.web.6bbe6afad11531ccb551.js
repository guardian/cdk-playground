(self.webpackChunk_guardian_dotcom_rendering=self.webpackChunk_guardian_dotcom_rendering||[]).push([[7171],{44165:(e,t,n)=>{var r=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,a=/^0o[0-7]+$/i,s=parseInt,c="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,u="object"==typeof self&&self&&self.Object===Object&&self,d=c||u||Function("return this")(),l=Object.prototype.toString,p=Math.max,f=Math.min,g=function(){return d.Date.now()};function h(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function v(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==l.call(e)}(e))return NaN;if(h(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=h(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(r,"");var n=o.test(e);return n||a.test(e)?s(e.slice(2),n?2:8):i.test(e)?NaN:+e}e.exports=function(e,t,n){var r,i,o,a,s,c,u=0,d=!1,l=!1,m=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function b(t){var n=r,o=i;return r=i=void 0,u=t,a=e.apply(o,n)}function y(e){var n=e-c;return void 0===c||n>=t||n<0||l&&e-u>=o}function w(){var e=g();if(y(e))return I(e);s=setTimeout(w,function(e){var n=t-(e-c);return l?f(n,o-(e-u)):n}(e))}function I(e){return s=void 0,m&&r?b(e):(r=i=void 0,a)}function S(){var e=g(),n=y(e);if(r=arguments,i=this,c=e,n){if(void 0===s)return function(e){return u=e,s=setTimeout(w,t),d?b(e):a}(c);if(l)return s=setTimeout(w,t),b(c)}return void 0===s&&(s=setTimeout(w,t)),a}return t=v(t)||0,h(n)&&(d=!!n.leading,o=(l="maxWait"in n)?p(v(n.maxWait)||0,t):o,m="trailing"in n?!!n.trailing:m),S.cancel=function(){void 0!==s&&clearTimeout(s),u=0,r=c=i=s=void 0},S.flush=function(){return void 0===s?a:I(g())},S}},84496:(e,t,n)=>{"use strict";n.d(t,{_q:()=>l,b3:()=>d,di:()=>u});var r=n(50026),i=n(46546);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){o(e,t,n[t])}))}return e}function s(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}const c=async(e,t)=>{i.S||(await(0,r.V5)(t)).record({componentEvent:e})},u=(e,t)=>{c(s(a({},e),{action:"VIEW"}),t)},d=e=>({componentType:"SIGN_IN_GATE",id:e}),l=(e,t,n,r)=>{((e,t)=>{c(s(a({},e),{action:"CLICK"}),t)})({component:d(e),abTest:r,value:t},n)}},76749:(e,t,n)=>{"use strict";n.d(t,{QA:()=>p,Y_:()=>f,_Q:()=>v,rS:()=>h});var r=n(72762),i=n(61082),o=n(85770),a=n(9474);const s="gu.prefs.sign-in-gate",c=(e,t)=>"".concat(t,"-").concat(e),u=(e,t)=>"gate-dismissed-count-".concat(t,"-").concat(e),d=()=>{const e=i.I.local.get(s);return(0,o.G)(e)&&(t=e,Object.entries(t).every((e=>{let[t,n]=e;return(0,r.K)(t)&&["string","number"].includes(typeof n)})))?e:{};var t},l=e=>{i.I.local.set(s,e)},p=(e,t)=>{const n=d();n[c(e,t)]=(new Date).toISOString(),l(n)},f=(e,t,n)=>{const r=d()[c(e,t)];return(0,a.b)(n)?!(null==r):!(0,a.b)(r)&&"number"!=typeof r&&!((Date.now()-new Date(r).getTime())/36e5>=n&&(((e,t)=>{const n=d();delete n[c(e,t)],l(n)})(e,t),1))},g=(e,t)=>{const n=d()[u(e,t)];return"number"==typeof n&&n>0?n:0},h=(e,t,n)=>g(e,t)>n,v=(e,t)=>{const n=d();n[u(e,t)]=g(e,t)+1,l(n)}},28621:(e,t,n)=>{"use strict";n.d(t,{ez:()=>T,fU:()=>j,xc:()=>k});var r=n(11733),i=n(52197),o=n(76749),a=n(15901);const s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;var t;const[n={}]=null!==(t=(0,a.L3)())&&void 0!==t?t:[],{count:r=0}=n;return r>=e},c=()=>{const e=navigator.userAgent,t=/(iPhone|iPod|iPad)/i.test(e),n=/(CPU OS 9_)/i.test(e);return t&&n},u=e=>["Article"].some((t=>e===t)),d=e=>!["about","info","membership","help","guardian-live-australia","gnm-archive"].some((t=>e===t)),l=e=>!["info/newsletter-sign-up"].some((t=>e.map((e=>e.id)).includes(t))),p={canShow:e=>{let{isSignedIn:t,currentTest:n,contentType:r,sectionId:i,tags:a,isPaidContent:p,isPreview:f}=e;return Promise.resolve(!t&&!(0,o.Y_)(n.variant,n.name)&&s(3)&&u(r)&&d(i)&&l(a)&&!p&&!f&&!c())}};var f=n(50484),g=n(88793),h=n(9474),v=n(67400),m=n(24017),b=n(58452);function y(){const e=(t=["\n\tdisplay: flex;\n\tflex-grow: 1;\n"],n||(n=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(n)}})));var t,n;return y=function(){return e},e}const w=(0,m.css)(y()),I=e=>{let{children:t,margin:n,disableFlexStyles:r}=e;const[i,o]=(0,b.E)({rootMargin:"".concat(n,"px")});if("function"!=typeof o)return null;const a=i||I.disabled;return(0,f.jsx)("div",{ref:o,css:!r&&w,children:a&&(0,f.jsx)(f.Fragment,{children:t})})};I.disabled=!1;const S=v.default.lazy((()=>{const{endPerformanceMeasure:e}=(0,g.h)("identity","SignInGateMain");return Promise.all([n.e(4684),n.e(9787)]).then(n.bind(n,95589)).then((t=>(e(),{default:t.SignInGateMain})))})),C=v.default.lazy((()=>{const{endPerformanceMeasure:e}=(0,g.h)("identity","SignInGateMainCheckoutComplete");return Promise.all([n.e(4684),n.e(6382)]).then(n.bind(n,35219)).then((t=>(e(),{default:t.SignInGateMainCheckoutComplete})))})),O={gate:e=>{let{ophanComponentId:t,dismissGate:n,guUrl:r,signInUrl:i,registerUrl:o,abTest:a,checkoutCompleteCookieData:s,personaliseSignInGateAfterCheckoutSwitch:c}=e;return(0,f.jsx)(I,{margin:300,children:(0,f.jsx)(v.Suspense,{fallback:(0,f.jsx)(f.Fragment,{}),children:c&&!(0,h.b)(s)?(0,f.jsx)(C,{ophanComponentId:t,dismissGate:n,guUrl:r,signInUrl:i,registerUrl:o,abTest:a,checkoutCompleteCookieData:s}):(0,f.jsx)(S,{ophanComponentId:t,dismissGate:n,guUrl:r,signInUrl:i,registerUrl:o,abTest:a})})})},canShow:e=>{let{isSignedIn:t,currentTest:n,contentType:r,sectionId:i,tags:a,isPaidContent:p,isPreview:f}=e;return Promise.resolve(!t&&!(0,o.rS)(n.variant,n.name,5)&&s(3)&&u(r)&&d(i)&&l(a)&&!p&&!f&&!c())}},k=[i.k,r.k],j={"main-control-5":p,"main-variant-5":O},T={SignInGateMainVariant:"main_variant_5",SignInGateMainControl:"main_control_5"}},44940:(e,t,n)=>{"use strict";n.r(t),n.d(t,{SignInGateSelector:()=>k});var r=n(50484),i=n(18411),o=n(9474),a=n(67400),s=n(92582),c=n(85770),u=n(72762);const d=(0,s.E)(["new","guest","current"]),l=(0,s.E)(["Contribution","SupporterPlus","Paper","GuardianWeekly"]);function p(e){return(0,c.G)(e)&&(0,u.K)(e.userType)&&d(e.userType)&&(0,u.K)(e.product)&&l(e.product)}var f=n(41124),g=n(14374),h=n(75747),v=n(53399),m=n(40901),b=n(89810),y=n(15593),w=n(84496),I=n(76749),S=n(28621);const C=(e,t)=>{let{pageId:n,pageViewId:r,idUrl:o,host:a,currentTest:s,componentId:c}=t;const u="".concat(a,"/").concat(n);var d;const l={componentType:"signingate",componentId:c,abTestName:s.name,abTestVariant:s.variant,browserId:null!==(d=(0,i.R)({name:"bwid",shouldMemoize:!0}))&&void 0!==d?d:void 0,viewId:r};return"".concat(o,"/").concat(e,"?returnUrl=").concat(u,"&componentEventParams=").concat(encodeURIComponent((0,f.G)(l)))},O=e=>{let{abTest:t,componentId:n,setShowGate:i,signInUrl:o,registerUrl:s,gateVariant:c,host:u,checkoutCompleteCookieData:d,personaliseSignInGateAfterCheckoutSwitch:l}=e;const{renderingTarget:p}=(0,y.U)();return(0,a.useEffect)((()=>{(0,w.di)({component:(0,w.b3)(n),abTest:t},p)}),[t,n,p]),c.gate?c.gate({guUrl:u,signInUrl:o,registerUrl:s,dismissGate:()=>{((e,t)=>{e(!1),(0,I.QA)(t.variant,t.name),(0,I._Q)(t.variant,t.name)})(i,t)},abTest:t,ophanComponentId:n,checkoutCompleteCookieData:d,personaliseSignInGateAfterCheckoutSwitch:l}):(0,r.jsx)(r.Fragment,{})},k=e=>{let{contentType:t,sectionId:n="",tags:s,isPaidContent:c,isPreview:u,host:d="https://theguardian.com/",pageId:l,idUrl:f="https://profile.theguardian.com",switches:w}=e;const I=(0,g.w)(),k="SignedInWithOkta"===I.kind||"SignedInWithCookies"===I.kind,[j,T]=(0,a.useState)(void 0),[P,E]=(0,a.useState)(void 0),[U,G]=(0,a.useState)(void 0),[x,M]=(0,a.useState)(!1),{renderingTarget:_}=(0,y.U)(),A=(0,b.M)(),D=(0,m.L)(_),[R,N]=(0,a.useState)(!1),V=(()=>{const[e,t]=(0,a.useState)();return(0,a.useEffect)((()=>{const e=(0,i.R)({name:"GU_CO_COMPLETE",shouldMemoize:!0});if(null===e)return;const n=(e=>{if(decodeURIComponent(e)===e)return;const t=(n=p,e=>{try{const t=JSON.parse(e);return n(t)?{parsed:t,hasError:!1}:{hasError:!0}}catch(e){return{hasError:!0}}})(decodeURIComponent(e));var n;return t.hasError?void 0:t.parsed})(e);n&&t(n)}),[]),e})(),{personaliseSignInGateAfterCheckout:F}=w,L=(0,h.F)("sign-in-gate-selector");if((0,v.H)((()=>{j&&document.dispatchEvent(new CustomEvent("article:sign-in-gate-dismissed"))}),[j]),(0,v.H)((()=>{const[e,t]=A;e&&t&&(E(e),G(t))}),[A]),(0,a.useEffect)((()=>{N(F||!1)}),[F]),(0,a.useEffect)((()=>{P&&U&&P.canShow({isSignedIn:!!k,currentTest:U,contentType:t,sectionId:n,tags:s,isPaidContent:c,isPreview:u,currentLocaleCode:L}).then(M)}),[U,P,k,t,n,s,c,u,L]),!U||!P||(0,o.b)(D))return null;const W=S.ez[U.id],z=R&&V?(e=>{if(!e)return;if(!V)return e;const{userType:t,product:n}=V;return"".concat(e,"_personalised_").concat(t,"_").concat(n)})(W):W,H={pageId:l,host:d,pageViewId:D,idUrl:f,currentTest:U,componentId:z};return(0,r.jsx)(r.Fragment,{children:!j&&x&&!!z&&(0,r.jsx)(O,{abTest:U,componentId:z,setShowGate:e=>T(!e),signInUrl:C("signin",H),registerUrl:C("register",H),gateVariant:P,host:d,checkoutCompleteCookieData:V,personaliseSignInGateAfterCheckoutSwitch:R})})}},11733:(e,t,n)=>{"use strict";n.d(t,{k:()=>r});const r={id:"SignInGateMainControl",start:"2020-05-20",expiry:"2025-12-01",author:"Mahesh Makani",description:"Show sign in gate to 100% of users on 3rd article view of simple article templates, and show a further 5 times after the first dismissal, with higher priority over banners and epic. Control Audience.",audience:.1,audienceOffset:.9,successMeasure:"N/A - User does not see gate, only to compare to variant.",audienceCriteria:"3rd article of the day, lower priority than consent banner, simple articles (not gallery, live etc.), not signed in, not shown after dismiss, not on help, info sections etc. Exclude iOS 9 and guardian-live-australia. Suppresses other banners, and appears over epics",dataLinkNames:"SignInGateMain",idealOutcome:"Increase the number of users signed in whilst running at a reasonable scale",showForSensitive:!1,canRun:()=>!0,variants:[{id:"main-control-5",test:()=>{}}]}},52197:(e,t,n)=>{"use strict";n.d(t,{k:()=>r});const r={id:"SignInGateMainVariant",start:"2020-06-09",expiry:"2025-12-01",author:"Mahesh Makani",description:"Show sign in gate to 100% of users on 3rd article view of simple article templates, and show a further 5 times after the first dismissal, with higher priority over banners and epic. Main/Variant Audience.",audience:.9,audienceOffset:0,successMeasure:"Users sign in or create a Guardian account",audienceCriteria:"3rd article of the day, lower priority than consent banner, simple articles (not gallery, live etc.), not signed in, not shown after dismiss, not on help, info sections etc. Exclude iOS 9 and guardian-live-australia. Suppresses other banners, and appears over epics",dataLinkNames:"SignInGateMain",idealOutcome:"Increase the number of users signed in whilst running at a reasonable scale",showForSensitive:!1,canRun:()=>!0,variants:[{id:"main-variant-5",test:()=>{}}]}},15901:(e,t,n)=>{"use strict";n.d(t,{Gq:()=>s,L3:()=>a,Q_:()=>c});var r=n(85770),i=n(61082);const o="gu.history.dailyArticleCount",a=()=>{try{const t=i.I.local.get(o);if(e=t,!Array.isArray(e)||!e.every((e=>(0,r.G)(e)&&"day"in e&&"count"in e&&"number"==typeof e.day&&"number"==typeof e.count)))throw new Error("Invalid gu.history.dailyArticleCount value");return t}catch(e){return void i.I.local.remove(o)}var e},s=()=>Math.floor(Date.now()/864e5),c=()=>{var e,t;const n=null!==(t=a())&&void 0!==t?t:[],r=s();if((null===(e=n[0])||void 0===e?void 0:e.day)===r)n[0].count+=1;else{n.unshift({day:r,count:1});const e=r-60,t=n.findIndex((t=>t.day&&t.day<e));t>0&&n.splice(t)}i.I.local.set(o,n)}},41124:(e,t,n)=>{"use strict";n.d(t,{G:()=>r});const r=e=>Object.keys(e).map((t=>{var n;const r=null!==(n=e[t])&&void 0!==n?n:"undefined",i=Array.isArray(r)?r.map((e=>encodeURIComponent(e))).join(","):encodeURIComponent(r);return"".concat(t,"=").concat(i)})).join("&")},67061:(e,t,n)=>{"use strict";n.d(t,{H:()=>s,z:()=>c});var r=n(29273),i=n(53994);const o=new Promise((()=>{})),a="ab-tests",s=()=>{const{data:e}=(0,i.A)(a,(()=>o));return e},c=e=>{let{api:t,participations:n}=e;(0,r.Tk)(a,{api:t,participations:n},!1)}},14374:(e,t,n)=>{"use strict";n.d(t,{T:()=>o,w:()=>a});var r=n(67400),i=n(97656);const o=()=>{switch(a().kind){case"Pending":return"Pending";case"SignedInWithCookies":case"SignedInWithOkta":return!0;case"SignedOutWithCookies":case"SignedOutWithOkta":return!1}},a=()=>{const[e,t]=(0,r.useState)({kind:"Pending"});return(0,r.useEffect)((()=>{(0,i.kU)((e=>{t((0,i.dx)(e))}),(()=>t((0,i.Hn)()))).catch((e=>{console.error(e)}))}),[]),e}},75747:(e,t,n)=>{"use strict";n.d(t,{F:()=>a});var r=n(9786),i=n(67400),o=n(2899);const a=e=>{const[t,n]=(0,i.useState)();return(0,i.useEffect)((()=>{(0,o.C)().then((e=>{(0,r.R)(e)&&n(e)})).catch((t=>{const n="Error fetching country code: ".concat(String(t));window.guardian.modules.sentry.reportError(new Error(n),e)}))}),[e]),t}},58452:(e,t,n)=>{"use strict";n.d(t,{E:()=>a});var r=n(44165),i=n.n(r),o=n(67400);const a=e=>{const[t,n]=(0,o.useState)(!1);var r;const[a,s]=(0,o.useState)(null!==(r=e.node)&&void 0!==r?r:null),c=(0,o.useRef)(null),u=(0,o.useCallback)((t=>{let[r]=t;r&&(r.isIntersecting?n(!0):e.repeat&&n(!1))}),[e.repeat]),d=e.debounce?i()(u,200):u;return(0,o.useEffect)((()=>{e.node&&s(e.node)}),[e.node]),(0,o.useEffect)((()=>{if(a&&"IntersectionObserver"in window)return c.current=new window.IntersectionObserver(d,e),c.current.observe(a),()=>{var e;return null===(e=c.current)||void 0===e?void 0:e.disconnect()}}),[a,e,d]),(0,o.useEffect)((()=>{var n;!e.repeat&&t&&(null===(n=c.current)||void 0===n||n.disconnect())}),[t,e.repeat]),[t,s]}},53399:(e,t,n)=>{"use strict";n.d(t,{H:()=>o});var r=n(9474),i=n(67400);const o=(e,t)=>{const[n,o]=(0,i.useState)(!1),a=t.every((e=>!(0,r.b)(e)));(0,i.useEffect)((()=>{!n&&a&&(e(),o(!0))}),[n,a,e])}},40901:(e,t,n)=>{"use strict";n.d(t,{L:()=>o});var r=n(67400),i=n(50026);const o=e=>{const[t,n]=(0,r.useState)();return(0,r.useEffect)((()=>{(0,i.V5)(e).then((e=>{let{pageViewId:t}=e;n(t)})).catch((()=>{n("no-page-view-id-available")}))}),[e]),t}},89810:(e,t,n)=>{"use strict";n.d(t,{M:()=>o});var r=n(28621),i=n(67061);const o=()=>{var e;const t=null===(e=(0,i.H)())||void 0===e?void 0:e.api;if(!t)return;const n=t.firstRunnableTest(r.xc);if(!n)return[null,null];var o;const a={name:null!==(o=n.dataLinkNames)&&void 0!==o?o:n.id,variant:n.variantToRun.id,id:n.id},s=r.fU[a.variant];return s?[s,a]:[null,null]}}}]);
//# sourceMappingURL=SignInGateSelector-importable.client.web.6bbe6afad11531ccb551.js.map