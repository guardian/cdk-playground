{"version":3,"file":"FetchOnwardsData-importable.client.web.195f9e437b7bbff6a034.js","mappings":"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","sources":["webpack://@guardian/dotcom-rendering/./src/components/FetchOnwardsData.importable.tsx","webpack://@guardian/dotcom-rendering/./src/components/Placeholder.tsx","webpack://@guardian/dotcom-rendering/./src/lib/decideTrail.ts","webpack://@guardian/dotcom-rendering/./src/lib/getDataLinkName.ts"],"sourcesContent":["import { css } from '@emotion/react';\nimport { isNonNullable } from '@guardian/libs';\nimport { ArticleDesign, type ArticleFormat } from '../lib/articleFormat';\nimport { decideTrail } from '../lib/decideTrail';\nimport { useApi } from '../lib/useApi';\nimport { addDiscussionIds } from '../lib/useCommentCount';\nimport { palette } from '../palette';\nimport type { OnwardsSource } from '../types/onwards';\nimport type { FETrailType, TrailType } from '../types/trails';\nimport { Carousel } from './Carousel.importable';\nimport { Placeholder } from './Placeholder';\n\ntype Props = {\n\turl: string;\n\tlimit: number; // Limit the number of items shown (the api often returns more)\n\tonwardsSource: OnwardsSource;\n\tformat: ArticleFormat;\n\tdiscussionApiUrl: string;\n\tabsoluteServerTimes: boolean;\n};\n\ntype OnwardsResponse = {\n\ttrails: FETrailType[];\n\theading: string;\n\tdisplayname: string;\n\tdescription: string;\n};\n\nconst minHeight = css`\n\tmin-height: 300px;\n`;\n\nexport const FetchOnwardsData = ({\n\turl,\n\tlimit,\n\tonwardsSource,\n\tformat,\n\tdiscussionApiUrl,\n\tabsoluteServerTimes,\n}: Props) => {\n\tconst { data, error } = useApi<OnwardsResponse>(url);\n\n\tconst buildTrails = (\n\t\ttrails: FETrailType[],\n\t\ttrailLimit: number,\n\t): TrailType[] => {\n\t\treturn trails.slice(0, trailLimit).map(decideTrail);\n\t};\n\n\tif (error) {\n\t\t// Send the error to Sentry and then prevent the element from rendering\n\t\twindow.guardian.modules.sentry.reportError(error, 'onwards-lower');\n\t\treturn null;\n\t}\n\n\tif (!data?.trails) {\n\t\treturn (\n\t\t\t<Placeholder\n\t\t\t\theight={340} // best guess at typical height\n\t\t\t\tshouldShimmer={false}\n\t\t\t\tbackgroundColor={palette('--article-background')}\n\t\t\t/>\n\t\t);\n\t}\n\n\taddDiscussionIds(\n\t\tdata.trails\n\t\t\t.map((trail) => trail.discussion?.discussionId)\n\t\t\t.filter(isNonNullable),\n\t);\n\n\treturn (\n\t\t<div css={minHeight}>\n\t\t\t<Carousel\n\t\t\t\theading={data.heading || data.displayname} // Sometimes the api returns heading as 'displayName'\n\t\t\t\ttrails={buildTrails(data.trails, limit)}\n\t\t\t\tdescription={data.description}\n\t\t\t\tonwardsSource={onwardsSource}\n\t\t\t\tformat={format}\n\t\t\t\tleftColSize={\n\t\t\t\t\tformat.design === ArticleDesign.LiveBlog ||\n\t\t\t\t\tformat.design === ArticleDesign.DeadBlog\n\t\t\t\t\t\t? 'wide'\n\t\t\t\t\t\t: 'compact'\n\t\t\t\t}\n\t\t\t\tdiscussionApiUrl={discussionApiUrl}\n\t\t\t\tabsoluteServerTimes={absoluteServerTimes}\n\t\t\t/>\n\t\t</div>\n\t);\n};\n","import { css, keyframes } from '@emotion/react';\nimport { isUndefined } from '@guardian/libs';\nimport { palette, space } from '@guardian/source/foundations';\n\nconst BACKGROUND_COLOUR = palette.neutral[93];\n\ntype Props = {\n\theight: number;\n\trootId?: string;\n\twidth?: number;\n\tspaceBelow?: 1 | 2 | 3 | 4 | 5 | 6 | 9;\n\tspaceLeft?: 1 | 2 | 3 | 4 | 5 | 6 | 9;\n\tshouldShimmer?: boolean;\n\tbackgroundColor?: string;\n};\n\nconst shimmer = keyframes`\n  0% {\n    background-position: -1500px 0;\n  }\n  100% {\n    background-position: 1500px 0;\n  }\n`;\n\nconst shimmerStyles = (backgroundColor: string) => css`\n\tanimation: ${shimmer} 2s infinite linear;\n\tbackground: linear-gradient(\n\t\tto right,\n\t\t${backgroundColor} 4%,\n\t\twhite 25%,\n\t\t${backgroundColor} 36%\n\t);\n\tbackground-size: 1500px 100%;\n`;\n\nexport const Placeholder = ({\n\theight,\n\trootId,\n\twidth,\n\tspaceBelow,\n\tspaceLeft,\n\tshouldShimmer = true,\n\tbackgroundColor = BACKGROUND_COLOUR,\n}: Props) => (\n\t<div\n\t\tid={rootId}\n\t\tcss={css`\n\t\t\tflex-grow: 1;\n\t\t`}\n\t\tdata-name=\"placeholder\"\n\t>\n\t\t<div\n\t\t\tcss={css`\n\t\t\t\tmin-height: ${height}px;\n\t\t\t\twidth: ${!isUndefined(width) ? `${width}px` : '100%'};\n\t\t\t\tmargin-bottom: ${spaceBelow && space[spaceBelow]}px;\n\t\t\t\tmargin-left: ${spaceLeft && space[spaceLeft]}px;\n\t\t\t\tbackground-color: ${backgroundColor};\n\n\t\t\t\t${shouldShimmer && shimmerStyles(backgroundColor)}\n\t\t\t`}\n\t\t/>\n\t</div>\n);\n","import type { DCRFrontImage } from '../types/front';\nimport type { FETrailType, TrailType } from '../types/trails';\nimport { type ArticleFormat, decideFormat } from './articleFormat';\nimport { getDataLinkNameCard } from './getDataLinkName';\n\nexport const decideTrail = (trail: FETrailType, index = 0): TrailType => {\n\tconst format: ArticleFormat = decideFormat(trail.format);\n\tconst image: DCRFrontImage | undefined = trail.image\n\t\t? {\n\t\t\t\tsrc: trail.image,\n\t\t\t\taltText: '', // TODO: Do we get this from frontend?\n\t\t  }\n\t\t: undefined;\n\n\treturn {\n\t\t...trail,\n\t\timage,\n\t\tformat,\n\t\tdataLinkName: getDataLinkNameCard(format, '0', index),\n\t};\n};\n","import type { FEFrontCardStyle } from '../types/front';\nimport type { RichLinkCardType } from '../types/layout';\nimport {\n\tArticleDesign,\n\ttype ArticleFormat,\n\tArticleSpecial,\n} from './articleFormat';\n\n/**\n * TODO: missing \"podcast\"\n */\nconst getLinkType = (\n\t{ theme, design }: ArticleFormat,\n\tcardStyle?: FEFrontCardStyle,\n): RichLinkCardType => {\n\tif (cardStyle === 'ExternalLink') return 'external';\n\tif (cardStyle === 'Feature') return 'feature';\n\n\tswitch (theme) {\n\t\tcase ArticleSpecial.SpecialReport:\n\t\t\treturn 'special-report';\n\t\tdefault:\n\t\t\tswitch (design) {\n\t\t\t\tcase ArticleDesign.Analysis:\n\t\t\t\t\treturn 'analysis';\n\t\t\t\tcase ArticleDesign.LiveBlog:\n\t\t\t\t\treturn 'live';\n\t\t\t\tcase ArticleDesign.DeadBlog:\n\t\t\t\t\treturn 'dead';\n\t\t\t\tcase ArticleDesign.Feature:\n\t\t\t\t\treturn 'feature';\n\t\t\t\tcase ArticleDesign.Editorial:\n\t\t\t\t\treturn 'editorial';\n\t\t\t\tcase ArticleDesign.Comment:\n\t\t\t\t\treturn 'comment';\n\t\t\t\tcase ArticleDesign.Gallery:\n\t\t\t\tcase ArticleDesign.Audio:\n\t\t\t\tcase ArticleDesign.Video:\n\t\t\t\t\treturn 'media';\n\t\t\t\tcase ArticleDesign.Review:\n\t\t\t\t\treturn 'review';\n\t\t\t\tcase ArticleDesign.Letter:\n\t\t\t\t\treturn 'letters';\n\n\t\t\t\tdefault:\n\t\t\t\t\treturn 'news';\n\t\t\t}\n\t}\n};\n\nexport type Group = `${number}` | `${number}+`;\n\n/**\n * Get the `data-link-name` attribute for a card.\n * Used by Ophan for understanding reader journeys. E.g:\n * - `feature | card-2+ | card-@1`\n * - `news | group-0 | card-@5`\n *\n * @see {JSX.IntrinsicAttributes}\n */\nexport const getDataLinkNameCard = (\n\tformat: ArticleFormat,\n\tgroup: Group,\n\tindex: number,\n\tcardStyle?: FEFrontCardStyle,\n): string =>\n\t[\n\t\tgetLinkType(format, cardStyle),\n\t\t`group-${group}`,\n\t\t`card-@${Math.max(index + 1, 1)}`,\n\t].join(' | ');\n"],"names":["minHeight","css","FetchOnwardsData","url","limit","onwardsSource","format","discussionApiUrl","absoluteServerTimes","data","error","useApi","window","guardian","modules","sentry","reportError","trails","addDiscussionIds","map","trail","discussion","discussionId","filter","isNonNullable","div","Carousel","heading","displayname","trailLimit","slice","decideTrail","description","leftColSize","design","ArticleDesign","LiveBlog","DeadBlog","Placeholder","height","shouldShimmer","backgroundColor","palette","BACKGROUND_COLOUR","neutral","shimmer","keyframes","shimmerStyles","rootId","width","spaceBelow","spaceLeft","id","data-name","isUndefined","space","index","decideFormat","image","src","altText","undefined","dataLinkName","getDataLinkNameCard","getLinkType","cardStyle","theme","ArticleSpecial","SpecialReport","Analysis","Feature","Editorial","Comment","Gallery","Audio","Video","Review","Letter","group","Math","max","join"],"sourceRoot":""}