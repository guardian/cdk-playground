{"version":3,"file":"SetABTests-importable.client.web.legacy.078edf5c0448cfefeaea.js","mappings":"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","sources":["webpack://@guardian/dotcom-rendering/../node_modules/.pnpm/@guardian+ab-core@8.0.0_tslib@2.6.2_typescript@5.5.3/node_modules/@guardian/ab-core/dist/core.js","webpack://@guardian/dotcom-rendering/../node_modules/.pnpm/@guardian+ab-core@8.0.0_tslib@2.6.2_typescript@5.5.3/node_modules/@guardian/ab-core/dist/time.js","webpack://@guardian/dotcom-rendering/../node_modules/.pnpm/@guardian+ab-core@8.0.0_tslib@2.6.2_typescript@5.5.3/node_modules/@guardian/ab-core/dist/ophan.js","webpack://@guardian/dotcom-rendering/../node_modules/.pnpm/@guardian+ab-core@8.0.0_tslib@2.6.2_typescript@5.5.3/node_modules/@guardian/ab-core/dist/ab.js","webpack://@guardian/dotcom-rendering/./src/experiments/ab-tests.ts","webpack://@guardian/dotcom-rendering/./src/experiments/tests/consentless-ads.ts","webpack://@guardian/dotcom-rendering/./src/experiments/tests/mpu-when-no-epic.ts","webpack://@guardian/dotcom-rendering/./src/experiments/tests/optimise-spacefinder-inline.ts","webpack://@guardian/dotcom-rendering/./src/experiments/tests/usa-expandable-marketing-card.ts","webpack://@guardian/dotcom-rendering/./src/experiments/tests/onwards-content-article.ts","webpack://@guardian/dotcom-rendering/./src/lib/getAbUrlHash.ts","webpack://@guardian/dotcom-rendering/./src/components/SetABTests.importable.tsx","webpack://@guardian/dotcom-rendering/./src/experiments/lib/ab-participations.ts","webpack://@guardian/dotcom-rendering/./src/experiments/tests/ab-test-test.ts","webpack://@guardian/dotcom-rendering/./src/experiments/tests/ad-block-ask.ts","webpack://@guardian/dotcom-rendering/./src/experiments/tests/integrate-ima.ts","webpack://@guardian/dotcom-rendering/./src/experiments/tests/sign-in-gate-main-control.ts","webpack://@guardian/dotcom-rendering/./src/experiments/tests/sign-in-gate-main-variant.ts","webpack://@guardian/dotcom-rendering/./src/lib/useAB.ts"],"sourcesContent":["import { isExpired } from './time.js';\nconst initCore = ({ mvtMaxValue = 1e6, mvtId, pageIsSensitive, abTestSwitches, forcedTestVariants, forcedTestException, arrayOfTestObjects = [] }) => {\n    const variantCanBeRun = (variant) => {\n        const isInTest = variant.id !== \"notintest\";\n        if (variant.canRun) {\n            return variant.canRun() && isInTest;\n        }\n        else {\n            return isInTest;\n        }\n    };\n    const testCanBeRun = (test) => {\n        const expired = isExpired(test.expiry);\n        const testShouldShowForSensitive = !!test.showForSensitive;\n        const isTestOn = abTestSwitches[`ab${test.id}`] && !!abTestSwitches[`ab${test.id}`];\n        const canTestBeRun = test.canRun();\n        return (pageIsSensitive ? testShouldShowForSensitive : true) && !!isTestOn && !expired && canTestBeRun;\n    };\n    const computeVariantFromMvtCookie = (test) => {\n        const smallestTestId = mvtMaxValue * test.audienceOffset;\n        const largestTestId = smallestTestId + mvtMaxValue * test.audience;\n        if (mvtId && mvtId > smallestTestId && mvtId <= largestTestId) {\n            return test.variants[mvtId % test.variants.length] ?? null;\n        }\n        return null;\n    };\n    const getForcedTestVariant = (test, forcedTestVariants2) => {\n        const testId = test.id;\n        const getVariantFromIds = (test2, variantId) => test2.variants.find((variant) => variant.id === variantId) ?? false;\n        const forcedTest = forcedTestVariants2?.[testId]?.variant;\n        return forcedTest ? getVariantFromIds(test, forcedTest) : false;\n    };\n    const runnableTest = (test) => {\n        const fromCookie = computeVariantFromMvtCookie(test);\n        const variantFromForcedTest = getForcedTestVariant(test, forcedTestVariants);\n        const forcedOutOfTest = forcedTestException === test.id;\n        const variantToRun = variantFromForcedTest || fromCookie;\n        if (!forcedOutOfTest && (variantFromForcedTest || testCanBeRun(test)) && // We ignore the test's canRun if the test is forced\n            variantToRun && (variantFromForcedTest || variantCanBeRun(variantToRun))) {\n            return {\n                ...test,\n                variantToRun\n            };\n        }\n        return null;\n    };\n    const allRunnableTests = (tests) => tests.reduce((prev, currentValue) => {\n        const rt = runnableTest(currentValue);\n        return rt ? [...prev, rt] : prev;\n    }, []);\n    const firstRunnableTest = (tests) => tests.map((test) => runnableTest(test)).find((rt) => rt !== null) ?? null;\n    const isUserInVariant = (testId, variantId) => allRunnableTests(arrayOfTestObjects).some((runnableTest2) => {\n        return runnableTest2.id === testId && runnableTest2.variantToRun.id === variantId;\n    });\n    return {\n        allRunnableTests,\n        runnableTest,\n        firstRunnableTest,\n        isUserInVariant\n    };\n};\nexport { initCore };\n","const isExpired = (testExpiry) => {\n    const currentTime = ( /* @__PURE__ */new Date()).valueOf();\n    const theTestExpiry = new Date(testExpiry).setHours(23, 59, 59, 59);\n    return currentTime > theTestExpiry;\n};\nexport { isExpired };\n","const submit = (payload, ophanRecord) => ophanRecord({\n    abTestRegister: payload\n});\nconst makeABEvent = (variant, complete) => {\n    const event = {\n        variantName: variant.id,\n        complete\n    };\n    if (variant.campaignCode) {\n        event.campaignCodes = [variant.campaignCode];\n    }\n    return event;\n};\nconst defersImpression = (test) => test.variants.every((variant) => typeof variant.impression === \"function\");\nconst buildOphanSubmitter = (test, variant, complete, ophanRecord) => {\n    const data = {\n        [test.id]: makeABEvent(variant, complete)\n    };\n    return () => submit(data, ophanRecord);\n};\nconst registerCompleteEvent = (complete, errorReporter, ophanRecord) => (test) => {\n    const variant = test.variantToRun;\n    const listener = complete ? variant.success : variant.impression;\n    if (!listener) {\n        return;\n    }\n    try {\n        listener(buildOphanSubmitter(test, variant, complete, ophanRecord));\n    }\n    catch (error) {\n        errorReporter(error);\n    }\n};\nconst buildOphanPayload = (tests, errorReporter, serverSideTestObj) => {\n    try {\n        const log = {};\n        const serverSideTests = Object.keys(serverSideTestObj).filter((test) => !!serverSideTestObj[test]);\n        tests.filter((test) => !defersImpression(test)).forEach((test) => {\n            log[test.id] = makeABEvent(test.variantToRun, false);\n        });\n        serverSideTests.forEach((test) => {\n            const serverSideVariant = {\n                id: \"inTest\",\n                test: () => void 0\n            };\n            log[`ab${test}`] = makeABEvent(serverSideVariant, false);\n        });\n        return log;\n    }\n    catch (error) {\n        errorReporter(error);\n        return {};\n    }\n};\nconst initOphan = ({ serverSideTests, errorReporter, ophanRecord }) => ({\n    registerCompleteEvents: (tests) => tests.forEach(registerCompleteEvent(true, errorReporter, ophanRecord)),\n    registerImpressionEvents: (tests) => tests.filter(defersImpression).forEach(registerCompleteEvent(false, errorReporter, ophanRecord)),\n    trackABTests: (tests) => submit(buildOphanPayload(tests, errorReporter, serverSideTests), ophanRecord)\n});\nexport { initOphan };\n","import { initCore } from './core.js';\nimport { initOphan } from './ophan.js';\nvar __defProp = Object.defineProperty;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\nvar __publicField = (obj, key, value) => __defNormalProp(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\nclass AB {\n    constructor({ abTestSwitches, arrayOfTestObjects, errorReporter, forcedTestException, forcedTestVariants, mvtId, mvtMaxValue, ophanRecord, pageIsSensitive, serverSideTests }) {\n        __publicField(this, \"_core\");\n        __publicField(this, \"_ophan\");\n        this._core = initCore({\n            abTestSwitches,\n            arrayOfTestObjects,\n            forcedTestException,\n            forcedTestVariants,\n            mvtId,\n            mvtMaxValue,\n            pageIsSensitive\n        });\n        this._ophan = initOphan({\n            errorReporter,\n            ophanRecord,\n            serverSideTests\n        });\n    }\n    // CoreAPI\n    get allRunnableTests() {\n        return this._core.allRunnableTests;\n    }\n    get firstRunnableTest() {\n        return this._core.firstRunnableTest;\n    }\n    get runnableTest() {\n        return this._core.runnableTest;\n    }\n    get isUserInVariant() {\n        return this._core.isUserInVariant;\n    }\n    // OphanAPI\n    get registerCompleteEvents() {\n        return this._ophan.registerCompleteEvents;\n    }\n    get registerImpressionEvents() {\n        return this._ophan.registerImpressionEvents;\n    }\n    get trackABTests() {\n        return this._ophan.trackABTests;\n    }\n}\nexport { AB };\n","import { abTestTest } from './tests/ab-test-test';\nimport { adBlockAsk } from './tests/ad-block-ask';\nimport { consentlessAds } from './tests/consentless-ads';\nimport { integrateIma } from './tests/integrate-ima';\nimport { mpuWhenNoEpic } from './tests/mpu-when-no-epic';\nimport { onwardsContentArticle } from './tests/onwards-content-article';\nimport { optimiseSpacefinderInline } from './tests/optimise-spacefinder-inline';\nimport { signInGateMainControl } from './tests/sign-in-gate-main-control';\nimport { signInGateMainVariant } from './tests/sign-in-gate-main-variant';\nimport { UsaExpandableMarketingCard } from './tests/usa-expandable-marketing-card';\n// keep in sync with ab-tests in frontend\n// https://github.com/guardian/frontend/tree/main/static/src/javascripts/projects/common/modules/experiments/ab-tests.ts\nexport const tests = [\n    abTestTest,\n    signInGateMainVariant,\n    signInGateMainControl,\n    consentlessAds,\n    integrateIma,\n    mpuWhenNoEpic,\n    adBlockAsk,\n    optimiseSpacefinderInline,\n    UsaExpandableMarketingCard,\n    onwardsContentArticle,\n];\n","export const consentlessAds = {\n    id: 'ConsentlessAds',\n    author: '@guardian/commercial-dev',\n    start: '2022-08-11',\n    expiry: '2023-06-01',\n    audience: 0 / 100,\n    audienceOffset: 0 / 100,\n    audienceCriteria: 'All pageviews',\n    successMeasure: 'Testing Opt Out ads in production',\n    description: 'Use consentless ad stack rather than consented / standalone',\n    variants: [\n        { id: 'control', test: () => { } },\n        { id: 'variant', test: () => { } },\n    ],\n    canRun: () => true,\n};\n","export const mpuWhenNoEpic = {\n    id: 'MpuWhenNoEpic',\n    author: '@commercial-dev',\n    start: '2023-11-22',\n    expiry: '2024-04-30',\n    audience: 10 / 100,\n    audienceOffset: 5 / 100,\n    audienceCriteria: '',\n    successMeasure: '',\n    description: 'Test MPU when there is no epic at the end of Article on the page.',\n    variants: [\n        {\n            id: 'control',\n            test: () => {\n                /* no-op */\n            },\n        },\n        {\n            id: 'variant',\n            test: () => {\n                /* no-op */\n            },\n        },\n    ],\n    canRun: () => true,\n};\n","export const optimiseSpacefinderInline = {\n    id: 'OptimiseSpacefinderInline',\n    author: '@commercial-dev',\n    start: '2024-08-08',\n    expiry: '2024-09-13',\n    audience: 5 / 100,\n    audienceOffset: 0 / 100,\n    audienceCriteria: '',\n    successMeasure: '',\n    description: 'Test new spacefinder rules for inline1 ads on desktop.',\n    variants: [\n        {\n            id: 'control',\n            test: () => {\n                /* no-op */\n            },\n        },\n        {\n            id: 'variant',\n            test: () => {\n                /* no-op */\n            },\n        },\n    ],\n    canRun: () => true,\n};\n","export const UsaExpandableMarketingCard = {\n    id: 'UsaExpandableMarketingCard',\n    start: '2024-10-02',\n    expiry: '2024-12-18',\n    author: 'dotcom.platform@guardian.co.uk',\n    description: 'Test the impact of showing the user a component that highlights the Guardians journalism.',\n    audience: 40 / 100,\n    audienceOffset: 0 / 100,\n    audienceCriteria: 'US-based users that see the US edition.',\n    successMeasure: 'Users are more likely to engage with the site.',\n    canRun: () => true,\n    variants: [\n        {\n            id: 'control',\n            test: () => {\n                /* no-op */\n            },\n        },\n        {\n            id: 'variant-free',\n            test: () => {\n                /* no-op */\n            },\n        },\n        {\n            id: 'variant-bubble',\n            test: () => {\n                /* no-op */\n            },\n        },\n        {\n            id: 'variant-billionaire',\n            test: () => {\n                /* no-op */\n            },\n        },\n    ],\n};\n","export const onwardsContentArticle = {\n    id: 'OnwardsContentArticle',\n    start: '2024-12-05',\n    expiry: '2025-01-29',\n    author: 'dotcom.platform@guardian.co.uk',\n    description: 'Test the impact of showing the galleries onwards content component on article pages.',\n    audience: 50 / 100,\n    audienceOffset: 50 / 100,\n    audienceCriteria: 'Article pages',\n    successMeasure: 'Users are more likely to click a link in the onward content component.',\n    canRun: () => true,\n    variants: [\n        {\n            id: 'control',\n            test: () => {\n                /* no-op */\n            },\n        },\n        {\n            id: 'variant',\n            test: () => {\n                /* no-op */\n            },\n        },\n    ],\n};\n","export const getForcedParticipationsFromUrl = (windowHash) => {\n    if (windowHash.startsWith('#ab')) {\n        const tokens = windowHash.replace('#ab-', '').split(',');\n        return tokens.reduce((obj, token) => {\n            const [testId, variantId] = token.split('=');\n            if (testId && variantId) {\n                return {\n                    ...obj,\n                    [testId]: { variant: variantId },\n                };\n            }\n            return obj;\n        }, {});\n    }\n    return {};\n};\n","import { AB } from '@guardian/ab-core';\nimport { getCookie, isUndefined, log } from '@guardian/libs';\nimport { useEffect, useState } from 'react';\nimport { getOphan } from '../client/ophan/ophan';\nimport { tests } from '../experiments/ab-tests';\nimport { runnableTestsToParticipations } from '../experiments/lib/ab-participations';\nimport { getForcedParticipationsFromUrl } from '../lib/getAbUrlHash';\nimport { setABTests } from '../lib/useAB';\nimport { useConfig } from './ConfigContext';\nconst mvtMinValue = 1;\nconst mvtMaxValue = 1_000_000;\n/** Parse a valid MVT ID between 1 and 1,000,000 or undefined if it fails */\nconst parseMvtId = (id) => {\n    if (!id)\n        return; // null or empty string\n    const number = Number(id);\n    if (Number.isNaN(number))\n        return;\n    if (number < mvtMinValue)\n        return;\n    if (number > mvtMaxValue)\n        return;\n    return number;\n};\nconst getMvtId = () => parseMvtId(getCookie({\n    name: 'GU_mvt_id',\n    shouldMemoize: true,\n}));\n/** Check if there is a local override */\nconst getLocalMvtId = () => parseMvtId(getCookie({\n    name: 'GU_mvt_id_local',\n    shouldMemoize: true,\n}));\n/**\n * Initialises the values of `useAB` and sends relevant Ophan events.\n *\n * ## Why does this need to be an Island?\n *\n * All this logic is client-side.\n *\n * ---\n *\n * Does not render **anything**.\n */\nexport const SetABTests = ({ isDev, pageIsSensitive, abTestSwitches, forcedTestVariants, serverSideTests, }) => {\n    const { renderingTarget } = useConfig();\n    const [ophan, setOphan] = useState();\n    useEffect(() => {\n        getOphan(renderingTarget)\n            .then(setOphan)\n            .catch((e) => {\n            console.log(`There was an error retrieving the ophan window object`, e);\n        });\n    }, [renderingTarget]);\n    useEffect(() => {\n        if (!ophan)\n            return;\n        const mvtId = isDev ? getLocalMvtId() ?? getMvtId() : getMvtId();\n        if (isUndefined(mvtId)) {\n            console.error('There is no MVT ID set, see SetABTests.importable.tsx');\n        }\n        const allForcedTestVariants = {\n            ...forcedTestVariants,\n            ...getForcedParticipationsFromUrl(window.location.hash),\n        };\n        const ab = new AB({\n            mvtId: mvtId ?? -1,\n            mvtMaxValue,\n            pageIsSensitive,\n            abTestSwitches,\n            arrayOfTestObjects: tests,\n            forcedTestVariants: allForcedTestVariants,\n            ophanRecord: ophan.record,\n            serverSideTests,\n            errorReporter: (e) => window.guardian.modules.sentry.reportError(e instanceof Error ? e : Error(String(e)), 'ab-tests'),\n        });\n        const allRunnableTests = ab.allRunnableTests(tests);\n        const participations = runnableTestsToParticipations(allRunnableTests);\n        setABTests({\n            api: ab,\n            participations,\n        });\n        ab.trackABTests(allRunnableTests);\n        ab.registerImpressionEvents(allRunnableTests);\n        ab.registerCompleteEvents(allRunnableTests);\n        log('dotcom', 'AB tests initialised');\n    }, [\n        abTestSwitches,\n        forcedTestVariants,\n        isDev,\n        pageIsSensitive,\n        ophan,\n        serverSideTests,\n    ]);\n    // we donâ€™t render anything\n    return null;\n};\n","import { isObject, isString } from '@guardian/libs';\nconst isParticipations = (participations) => isObject(participations) &&\n    Object.values(participations).every((participation) => isObject(participation) && isString(participation.variant));\nconst runnableTestsToParticipations = (runnableTests) => runnableTests.reduce((participations, { id: testId, variantToRun }) => ({\n    ...participations,\n    ...{\n        [testId]: {\n            variant: variantToRun.id,\n        },\n    },\n}), {});\nexport { isParticipations, runnableTestsToParticipations };\n","export const abTestTest = {\n    id: 'AbTestTest',\n    start: '2020-05-20',\n    expiry: '2023-12-01',\n    author: 'gtrufitt',\n    description: 'This Test',\n    audience: 0.0001, // 0.01%\n    audienceOffset: 0,\n    successMeasure: 'It works',\n    audienceCriteria: 'Everyone',\n    idealOutcome: 'It works',\n    showForSensitive: true,\n    canRun: () => true,\n    variants: [\n        {\n            id: 'control',\n            test: () => { },\n            impression: (impression) => {\n                impression();\n            },\n            success: (success) => {\n                success();\n            },\n        },\n        {\n            id: 'variant',\n            test: () => { },\n            impression: (impression) => {\n                impression();\n            },\n            success: (success) => {\n                success();\n            },\n        },\n    ],\n};\n","export const adBlockAsk = {\n    id: 'AdBlockAsk',\n    author: '@guardian/commercial-dev',\n    start: '2024-04-10',\n    expiry: '2024-05-31',\n    audience: 10 / 100,\n    audienceOffset: 10 / 100,\n    audienceCriteria: '',\n    successMeasure: '',\n    description: 'Show new ad block ask component in ad slots when we detect ad blocker usage',\n    variants: [\n        {\n            id: 'control',\n            test: () => {\n                /* no-op */\n            },\n        },\n        {\n            id: 'variant',\n            test: () => {\n                /* no-op */\n            },\n        },\n    ],\n    canRun: () => true,\n};\n","export const integrateIma = {\n    id: 'IntegrateIma',\n    start: '2022-07-14',\n    expiry: '2024-02-28',\n    author: 'Zeke Hunter-Green',\n    description: 'Test the commercial impact of replacing YouTube ads with Interactive Media Ads on first-party videos',\n    // we might revisit this test so setting to zero for now\n    audience: 0 / 100,\n    audienceOffset: 10 / 100,\n    audienceCriteria: 'Opt in',\n    successMeasure: 'IMA integration works as expected without adversely affecting pages with videos',\n    canRun: () => true,\n    variants: [\n        { id: 'control', test: () => { } },\n        { id: 'variant', test: () => { } },\n    ],\n};\n","export const signInGateMainControl = {\n    id: 'SignInGateMainControl',\n    start: '2020-05-20',\n    expiry: '2025-12-01',\n    author: 'Mahesh Makani',\n    description: 'Show sign in gate to 100% of users on 3rd article view of simple article templates, and show a further 5 times after the first dismissal, with higher priority over banners and epic. Control Audience.',\n    audience: 0.1,\n    audienceOffset: 0.9,\n    successMeasure: 'N/A - User does not see gate, only to compare to variant.',\n    audienceCriteria: '3rd article of the day, lower priority than consent banner, simple articles (not gallery, live etc.), not signed in, not shown after dismiss, not on help, info sections etc. Exclude iOS 9 and guardian-live-australia. Suppresses other banners, and appears over epics',\n    dataLinkNames: 'SignInGateMain',\n    idealOutcome: 'Increase the number of users signed in whilst running at a reasonable scale',\n    showForSensitive: false,\n    canRun: () => true,\n    variants: [\n        {\n            id: 'main-control-5',\n            test: () => { },\n        },\n    ],\n};\n","export const signInGateMainVariant = {\n    id: 'SignInGateMainVariant',\n    start: '2020-06-09',\n    expiry: '2025-12-01',\n    author: 'Mahesh Makani',\n    description: 'Show sign in gate to 100% of users on 3rd article view of simple article templates, and show a further 5 times after the first dismissal, with higher priority over banners and epic. Main/Variant Audience.',\n    audience: 0.9,\n    audienceOffset: 0.0,\n    successMeasure: 'Users sign in or create a Guardian account',\n    audienceCriteria: '3rd article of the day, lower priority than consent banner, simple articles (not gallery, live etc.), not signed in, not shown after dismiss, not on help, info sections etc. Exclude iOS 9 and guardian-live-australia. Suppresses other banners, and appears over epics',\n    dataLinkNames: 'SignInGateMain',\n    idealOutcome: 'Increase the number of users signed in whilst running at a reasonable scale',\n    showForSensitive: false,\n    canRun: () => true,\n    variants: [\n        {\n            id: 'main-variant-5',\n            test: () => { },\n        },\n    ],\n};\n","import { mutate } from 'swr';\nimport useSWRImmutable from 'swr/immutable';\nconst apiPromise = new Promise(() => { });\nconst key = 'ab-tests';\n/**\n * A hook which returns the AB Test Api when available,\n * or undefined otherwise.\n *\n * Leverages an immutable SWR to satisfy all requests to the\n * AB Core. As soon as the tests are available, all instances of\n * the useAB hook will render.\n */\nexport const useAB = () => {\n    const { data } = useSWRImmutable(key, () => apiPromise);\n    return data;\n};\nexport const setABTests = ({ api, participations }) => {\n    void mutate(key, { api, participations }, false);\n};\n"],"names":["initCore","_ref","_ref$mvtMaxValue","mvtMaxValue","mvtId","pageIsSensitive","abTestSwitches","forcedTestVariants","forcedTestException","_ref$arrayOfTestObjec","arrayOfTestObjects","runnableTest","test","variant","isInTest","fromCookie","_test$variants","smallestTestId","audienceOffset","largestTestId","audience","variants","length","computeVariantFromMvtCookie","variantFromForcedTest","forcedTestVariants2","_forcedTestVariants2$","variantId","_test2$variants$find","testId","id","forcedTest","find","getForcedTestVariant","variantToRun","testExpiry","expired","expiry","Date","valueOf","setHours","testShouldShowForSensitive","showForSensitive","isTestOn","concat","canTestBeRun","canRun","testCanBeRun","_objectSpread","allRunnableTests","tests","reduce","prev","currentValue","rt","_toConsumableArray","firstRunnableTest","_tests$map$find","map","isUserInVariant","some","runnableTest2","submit","payload","ophanRecord","abTestRegister","makeABEvent","complete","event","variantName","campaignCode","campaignCodes","defersImpression","every","impression","registerCompleteEvent","errorReporter","listener","success","data","_defineProperty","buildOphanSubmitter","error","__defProp","Object","defineProperty","__publicField","obj","key","value","enumerable","configurable","writable","__defNormalProp","_typeof","AB","_createClass","serverSideTests","_classCallCheck","this","_core","_ophan","registerCompleteEvents","forEach","registerImpressionEvents","filter","trackABTests","serverSideTestObj","log","keys","buildOphanPayload","initOphan","get","abTestTest","signInGateMainVariant","signInGateMainControl","author","start","audienceCriteria","successMeasure","description","integrateIma","adBlockAsk","parseMvtId","number","Number","isNaN","SetABTests","isDev","renderingTarget","useConfig","_useState","useState","_useState2","_slicedToArray","ophan","setOphan","useEffect","getOphan","then","catch","e","console","_getLocalMvtId","getCookie","name","shouldMemoize","isUndefined","windowHash","allForcedTestVariants","window","location","hash","startsWith","replace","split","token","_token$split","_token$split2","ab","record","guardian","modules","sentry","reportError","Error","String","participations","setABTests","api","idealOutcome","dataLinkNames","apiPromise","Promise","useAB","useSWRImmutable","mutate"],"sourceRoot":""}