{"version":3,"file":"6149.client.web.3c0841906d89307f92ce.js","mappings":"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","sources":["webpack://@guardian/dotcom-rendering/./src/static/icons/camera.svg","webpack://@guardian/dotcom-rendering/./src/static/icons/video-icon.svg","webpack://@guardian/dotcom-rendering/./src/components/Caption.tsx","webpack://@guardian/dotcom-rendering/./src/components/Card/components/PlayIcon.tsx","webpack://@guardian/dotcom-rendering/./src/components/MaintainAspectRatio.tsx","webpack://@guardian/dotcom-rendering/./src/components/MediaDuration.tsx","webpack://@guardian/dotcom-rendering/./src/components/YoutubeAtom/eventEmitters.ts","webpack://@guardian/dotcom-rendering/./src/components/YoutubeAtom/YoutubeAtomPicture.tsx","webpack://@guardian/dotcom-rendering/./src/components/YoutubeAtom/YoutubeAtomOverlay.tsx","webpack://@guardian/dotcom-rendering/./src/components/YoutubeAtom/YoutubeAtomPlaceholder.tsx","webpack://@guardian/dotcom-rendering/./src/components/YoutubeAtom/loadYouTubeApi.ts","webpack://@guardian/dotcom-rendering/./src/components/YoutubeAtom/YoutubePlayer.ts","webpack://@guardian/dotcom-rendering/./src/components/YoutubeAtom/YoutubeAtomPlayer.tsx","webpack://@guardian/dotcom-rendering/./src/components/YoutubeAtom/YoutubeAtomSticky.tsx","webpack://@guardian/dotcom-rendering/./src/components/YoutubeAtom/YoutubeAtom.tsx","webpack://@guardian/dotcom-rendering/./src/components/YoutubeAtom/YoutubeAtomExpiredOverlay.tsx","webpack://@guardian/dotcom-rendering/./src/components/YoutubeBlockComponent.importable.tsx","webpack://@guardian/dotcom-rendering/./src/lib/thrift/protocols.ts","webpack://@guardian/dotcom-rendering/./src/lib/thrift/nativeConnection.ts","webpack://@guardian/dotcom-rendering/./src/lib/bridgetApi.ts","webpack://@guardian/dotcom-rendering/./src/lib/getSourceImageUrl_temp_fix.ts","webpack://@guardian/dotcom-rendering/./src/lib/useAB.ts","webpack://@guardian/dotcom-rendering/./src/lib/useAdTargeting.ts","webpack://@guardian/dotcom-rendering/./src/lib/useIsInView.ts"],"sourcesContent":["var _path;\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nimport * as React from \"react\";\nvar SvgCamera = function SvgCamera(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 18,\n    height: 13,\n    viewBox: \"0 0 18 13\"\n  }, props), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M18 3.5v8l-1.5 1.5h-15l-1.5-1.5v-8l1.5-1.5h3.5l2-2h4l2 2h3.5l1.5 1.5zm-9 7.5c1.9 0 3.5-1.6 3.5-3.5s-1.6-3.5-3.5-3.5-3.5 1.6-3.5 3.5 1.6 3.5 3.5 3.5z\"\n  })));\n};\nexport default SvgCamera;","var _path;\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nimport * as React from \"react\";\nvar SvgVideoIcon = function SvgVideoIcon(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 36,\n    height: 23,\n    viewBox: \"0 0 36 23\"\n  }, props), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M3.2 0l-3.2 3.3v16.4l3.3 3.3h18.7v-23h-18.8m30.4 1l-8.6 8v5l8.6 8h2.4v-21h-2.4\"\n  })));\n};\nexport default SvgVideoIcon;","import { css } from '@emotion/react';\nimport {\n\tfrom,\n\tspace,\n\ttextSans12,\n\ttextSans14,\n\tuntil,\n} from '@guardian/source/foundations';\nimport {\n\tArticleDesign,\n\tArticleDisplay,\n\ttype ArticleFormat,\n\tArticleSpecial,\n} from '../lib/articleFormat';\nimport { palette } from '../palette';\nimport CameraSvg from '../static/icons/camera.svg';\nimport VideoSvg from '../static/icons/video-icon.svg';\nimport type { MediaType } from '../types/layout';\n\ntype Props = {\n\tcaptionText?: string;\n\tformat: ArticleFormat;\n\tpadCaption?: boolean;\n\tcredit?: string;\n\tdisplayCredit?: boolean;\n\tshouldLimitWidth?: boolean;\n\tisOverlaid?: boolean;\n\tisLeftCol?: boolean;\n\tmediaType?: MediaType;\n\tisMainMedia?: boolean;\n};\n\ntype IconProps = {\n\tformat: ArticleFormat;\n};\n\nconst captionStyle = css`\n\t${textSans14};\n\tline-height: 135%;\n\tpadding-top: 6px;\n\toverflow-wrap: break-word;\n\tcolor: ${palette('--caption-text')};\n`;\n\nconst bottomMarginStyles = css`\n\tmargin-bottom: 6px;\n`;\n\nconst overlaidBottomPadding = (format: ArticleFormat) => {\n\tif (\n\t\tformat.display === ArticleDisplay.Showcase &&\n\t\tformat.design === ArticleDesign.Review\n\t) {\n\t\treturn css`\n\t\t\tpadding-bottom: 2.5rem;\n\t\t`;\n\t}\n\treturn css`\n\t\tpadding-bottom: 0.375rem;\n\t`;\n};\n\nconst overlaidStyles = (format: ArticleFormat) => css`\n\tposition: absolute;\n\tleft: 0;\n\tright: 0;\n\tbottom: 0;\n\tbackground: rgba(18, 18, 18, 0.8);\n\n\tspan {\n\t\tcolor: ${palette('--caption-overlay-text')};\n\t\tfont-size: 0.75rem;\n\t\tline-height: 1rem;\n\t}\n\n\tsvg {\n\t\tfill: currentcolor;\n\t}\n\tcolor: ${palette('--caption-overlay-text')};\n\tfont-size: 0.75rem;\n\tline-height: 1rem;\n\tpadding-top: 0.375rem;\n\tpadding-right: 2.5rem;\n\tpadding-left: 0.75rem;\n\t${overlaidBottomPadding(format)};\n\n\tflex-grow: 1;\n\tmin-height: 2.25rem;\n`;\n\nconst limitedWidth = css`\n\t${from.leftCol} {\n\t\twidth: 140px;\n\t\t/* use absolute position here to allow the article text to push up alongside\n           the caption when it is limited in width */\n\t\tposition: absolute;\n\t}\n\t${from.wide} {\n\t\twidth: 220px;\n\t}\n`;\n\nconst veryLimitedWidth = css`\n\t${from.leftCol} {\n\t\twidth: 120px;\n\t\t/* use absolute position here to allow the article text to push up alongside\n           the caption when it is limited in width */\n\t\tposition: absolute;\n\t}\n\t${from.wide} {\n\t\twidth: 184px;\n\t}\n`;\n\nconst captionPadding = css`\n\tpadding-left: 10px;\n\tpadding-right: 10px;\n`;\n\nconst tabletCaptionPadding = css`\n\t${until.desktop} {\n\t\t${captionPadding}\n\t}\n`;\n\nconst bigLeftMargin = css`\n\twidth: inherit;\n\tmargin-left: ${space[9]}px;\n\t${until.wide} {\n\t\tmargin-left: 20px;\n\t\tmargin-right: 20px;\n\t}\n\t${until.mobileLandscape} {\n\t\tmargin-left: 10px;\n\t\tmargin-right: 10px;\n\t}\n`;\n\nconst hideIconBelowLeftCol = css`\n\t${until.leftCol} {\n\t\tdisplay: none;\n\t}\n`;\n\nconst pictureRatio = (13 / 18) * 100;\nconst videoRatio = (23 / 36) * 100;\n\nconst iconStyle = css`\n\tfill: ${palette('--caption-text')};\n\tmargin-right: ${space[1]}px;\n\tdisplay: inline-block;\n\tposition: relative;\n\twidth: 1em;\n\tvertical-align: baseline;\n\t::before {\n\t\tcontent: ' ';\n\t\tdisplay: block;\n\t\tpadding-top: ${pictureRatio}%;\n\t}\n\tsvg {\n\t\ttop: 0px;\n\t\tright: 0px;\n\t\tbottom: 0px;\n\t\tleft: 0px;\n\t\twidth: 100%;\n\t\tposition: absolute;\n\t\theight: 100%;\n\t}\n`;\n\nconst videoIconStyle = css`\n\twidth: 1.1em;\n\t::before {\n\t\tpadding-top: ${videoRatio}%;\n\t}\n`;\n\nconst captionLink = css`\n\ta {\n\t\tcolor: ${palette('--caption-link')};\n\t\ttext-decoration: none;\n\t}\n\ta:hover {\n\t\ttext-decoration: underline;\n\t}\n\tstrong {\n\t\tfont-weight: bold;\n\t}\n`;\n\nconst CameraIcon = ({ format }: IconProps) => {\n\treturn (\n\t\t<span\n\t\t\tcss={[\n\t\t\t\ticonStyle,\n\t\t\t\tformat.display === ArticleDisplay.Immersive &&\n\t\t\t\t\thideIconBelowLeftCol,\n\t\t\t]}\n\t\t>\n\t\t\t<CameraSvg />\n\t\t</span>\n\t);\n};\n\nconst VideoIcon = ({ format }: IconProps) => {\n\treturn (\n\t\t<span\n\t\t\tcss={[\n\t\t\t\ticonStyle,\n\t\t\t\tformat.display === ArticleDisplay.Immersive &&\n\t\t\t\t\thideIconBelowLeftCol,\n\t\t\t\tvideoIconStyle,\n\t\t\t]}\n\t\t>\n\t\t\t<VideoSvg />\n\t\t</span>\n\t);\n};\n\nexport const Caption = ({\n\tcaptionText,\n\tformat,\n\tpadCaption = false,\n\tcredit,\n\tdisplayCredit = true,\n\tshouldLimitWidth = false,\n\tisOverlaid,\n\tisLeftCol,\n\tmediaType = 'Gallery',\n\tisMainMedia = false,\n}: Props) => {\n\t// Sometimes captions come thorough as a single blank space, so we trim here to ignore those\n\tconst noCaption = !captionText?.trim();\n\tconst noCredit = !credit;\n\tconst hideCredit = !displayCredit;\n\tif (noCaption && (noCredit || hideCredit)) return null;\n\n\tconst isBlog =\n\t\tformat.design === ArticleDesign.LiveBlog ||\n\t\tformat.design === ArticleDesign.DeadBlog;\n\n\tconst defaultCaption = (\n\t\t<figcaption\n\t\t\tcss={[\n\t\t\t\tcaptionStyle,\n\t\t\t\tshouldLimitWidth && limitedWidth,\n\t\t\t\tisOverlaid ? overlaidStyles(format) : bottomMarginStyles,\n\t\t\t\tisMainMedia &&\n\t\t\t\t\t(isBlog || mediaType === 'Video') &&\n\t\t\t\t\ttabletCaptionPadding,\n\t\t\t\tpadCaption && captionPadding,\n\t\t\t]}\n\t\t\tdata-spacefinder-role=\"inline\"\n\t\t>\n\t\t\t{mediaType === 'Video' ? (\n\t\t\t\t<VideoIcon format={format} />\n\t\t\t) : (\n\t\t\t\t<CameraIcon format={format} />\n\t\t\t)}\n\t\t\t{!!captionText && (\n\t\t\t\t<span\n\t\t\t\t\tcss={captionLink}\n\t\t\t\t\tdangerouslySetInnerHTML={{\n\t\t\t\t\t\t__html: captionText || '',\n\t\t\t\t\t}}\n\t\t\t\t\tkey=\"caption\"\n\t\t\t\t/>\n\t\t\t)}\n\t\t\t{!!credit && displayCredit && ` ${credit}`}\n\t\t</figcaption>\n\t);\n\n\tswitch (format.design) {\n\t\tcase ArticleDesign.PhotoEssay:\n\t\t\tif (format.theme === ArticleSpecial.Labs && isLeftCol) {\n\t\t\t\treturn defaultCaption;\n\t\t\t}\n\t\t\treturn (\n\t\t\t\t<figcaption\n\t\t\t\t\tcss={[\n\t\t\t\t\t\tcss`\n\t\t\t\t\t\t\t${textSans12};\n\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t * Typography preset styles should not be overridden.\n\t\t\t\t\t\t\t * This has been done because the styles do not directly map to the new presets.\n\t\t\t\t\t\t\t * Please speak to your team's designer and update this to use a more appropriate preset.\n\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\tline-height: 1.15;\n\t\t\t\t\t\t\tcolor: ${isMainMedia\n\t\t\t\t\t\t\t\t? palette(\n\t\t\t\t\t\t\t\t\t\t'--caption-photo-essay-main-media-text',\n\t\t\t\t\t\t\t\t  )\n\t\t\t\t\t\t\t\t: palette('--caption-text')};\n\t\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\t\tmargin-top: ${space[3]}px;\n\t\t\t\t\t\t\tli:not(:first-child) {\n\t\t\t\t\t\t\t\tmargin-top: ${space[3]}px;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tli {\n\t\t\t\t\t\t\t\tpadding-top: ${space[2]}px;\n\t\t\t\t\t\t\t\tborder-top: 1px solid\n\t\t\t\t\t\t\t\t\t${isMainMedia\n\t\t\t\t\t\t\t\t\t\t? palette(\n\t\t\t\t\t\t\t\t\t\t\t\t'--caption-photo-essay-main-media-text',\n\t\t\t\t\t\t\t\t\t\t  )\n\t\t\t\t\t\t\t\t\t\t: palette('--caption-text')};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t`,\n\t\t\t\t\t\tbottomMarginStyles,\n\t\t\t\t\t\tpadCaption && captionPadding,\n\t\t\t\t\t\tshouldLimitWidth && veryLimitedWidth,\n\t\t\t\t\t\tshouldLimitWidth && bigLeftMargin,\n\t\t\t\t\t]}\n\t\t\t\t\tdata-spacefinder-role=\"inline\"\n\t\t\t\t>\n\t\t\t\t\t{!!captionText && (\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tcss={captionLink}\n\t\t\t\t\t\t\tdangerouslySetInnerHTML={{\n\t\t\t\t\t\t\t\t__html: captionText || '',\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tkey=\"caption\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\t\t\t\t\t{!!credit && displayCredit && ` ${credit}`}\n\t\t\t\t</figcaption>\n\t\t\t);\n\t\tdefault:\n\t\t\treturn defaultCaption;\n\t}\n};\n","import { css } from '@emotion/react';\nimport { from, palette } from '@guardian/source/foundations';\nimport type { ThemeIcon } from '@guardian/source/react-components';\nimport { SvgMediaControlsPlay } from '@guardian/source/react-components';\nimport type { ImagePositionType, ImageSizeType } from './ImageWrapper';\n\ntype PlayButtonSize = keyof typeof sizes;\n\nconst sizes = {\n\tsmall: { button: 40, icon: 32 },\n\tlarge: { button: 80, icon: 72 },\n} as const satisfies Record<string, { button: number; icon: number }>;\n\nconst iconStyles = (\n\tsize: PlayButtonSize,\n\tsizeOnMobile: Extract<PlayButtonSize, 'small' | 'large'>,\n) => css`\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tposition: absolute;\n\ttop: 50%;\n\tleft: 50%;\n\ttransform: translate(-50%, -50%);\n\tbackground-color: rgba(18, 18, 18, 0.6);\n\tborder-radius: 50%;\n\twidth: ${sizes[sizeOnMobile].button}px;\n\theight: ${sizes[sizeOnMobile].button}px;\n\t${from.tablet} {\n\t\twidth: ${sizes[size].button}px;\n\t\theight: ${sizes[size].button}px;\n\t}\n\n\tsvg {\n\t\ttransform: translateX(1px);\n\t\twidth: ${sizes[sizeOnMobile].icon}px;\n\t\theight: ${sizes[sizeOnMobile].icon}px;\n\t\t${from.tablet} {\n\t\t\twidth: ${sizes[size].icon}px;\n\t\t\theight: ${sizes[size].icon}px;\n\t\t}\n\t}\n`;\n\nconst theme = {\n\tfill: palette.neutral[100],\n} satisfies Partial<ThemeIcon>;\n\nconst getIconSizeOnDesktop = (imageSize: ImageSizeType) => {\n\tswitch (imageSize) {\n\t\tcase 'jumbo':\n\t\tcase 'large':\n\t\tcase 'carousel':\n\t\tcase 'medium':\n\t\tcase 'feature':\n\t\tcase 'feature-large':\n\t\t\treturn 'large';\n\t\tcase 'small':\n\t\t\treturn 'small';\n\t}\n};\n\nconst getIconSizeOnMobile = (imagePositionOnMobile: ImagePositionType) =>\n\timagePositionOnMobile === 'left' || imagePositionOnMobile === 'right'\n\t\t? 'small'\n\t\t: 'large';\n\nexport const PlayIcon = ({\n\timageSize,\n\timagePositionOnMobile,\n}: {\n\timageSize: ImageSizeType;\n\timagePositionOnMobile: ImagePositionType;\n}) => {\n\treturn (\n\t\t<div\n\t\t\tclassName=\"play-icon\"\n\t\t\tcss={[\n\t\t\t\ticonStyles(\n\t\t\t\t\tgetIconSizeOnDesktop(imageSize),\n\t\t\t\t\tgetIconSizeOnMobile(imagePositionOnMobile),\n\t\t\t\t),\n\t\t\t]}\n\t\t>\n\t\t\t<SvgMediaControlsPlay theme={theme} />\n\t\t</div>\n\t);\n};\n","import { css } from '@emotion/react';\nimport type { AspectRatio } from '../types/front';\n\ntype Props = {\n\theight: number;\n\twidth: number;\n\taspectRatio?: AspectRatio;\n\tchildren: React.ReactNode;\n};\n\nexport const MaintainAspectRatio = ({\n\theight,\n\twidth,\n\taspectRatio,\n\tchildren,\n}: Props) => {\n\t/* https://css-tricks.com/aspect-ratio-boxes/ */\n\tconst paddingBottom =\n\t\taspectRatio === '5:4'\n\t\t\t? `${(4 / 5) * 100}%`\n\t\t\t: `${(height / width) * 100}%`;\n\n\treturn (\n\t\t<div\n\t\t\tcss={css`\n\t\t\t\t/* position relative to contain the absolutely positioned iframe plus any Overlay image */\n\t\t\t\tposition: relative;\n\t\t\t\tpadding-bottom: ${paddingBottom};\n\t\t\t\t& > iframe,\n\t\t\t\t& > video {\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\ttop: 0;\n\t\t\t\t\tleft: 0;\n\t\t\t\t}\n\t\t\t`}\n\t\t>\n\t\t\t{children}\n\t\t</div>\n\t);\n};\n","import { css } from '@emotion/react';\nimport { space, textSansBold12 } from '@guardian/source/foundations';\nimport { Hide } from '@guardian/source/react-components';\nimport type { ImagePositionType } from './Card/components/ImageWrapper';\n\nconst durationStyles = css`\n\tposition: absolute;\n\ttop: ${space[2]}px;\n\tright: ${space[2]}px;\n\tbackground-color: rgba(0, 0, 0, 0.7);\n\twidth: fit-content;\n\tpadding: ${space[1]}px ${space[3]}px;\n\tborder-radius: ${space[3]}px;\n\tcolor: white;\n\t${textSansBold12};\n`;\n\nexport function secondsToDuration(secs?: number): string {\n\tif (typeof secs === `undefined` || secs === 0) {\n\t\treturn ``;\n\t}\n\tconst seconds = Number(secs);\n\tconst h = Math.floor(seconds / 3600);\n\tconst m = Math.floor((seconds % 3600) / 60);\n\tconst s = Math.floor((seconds % 3600) % 60);\n\n\tconst duration = [];\n\tif (h > 0) {\n\t\tduration.push(h);\n\t}\n\tif (h === 0 && m > 0 && s === 0) duration.push(`${m}:00`); // e.g 6:00\n\telse if (h > 0 && m < 10) duration.push(`0${m}`); // e.g 1:01:11\n\telse duration.push(m); // supports 0:59\n\tif (s > 0) {\n\t\tif (s < 10) duration.push(`0${s}`);\n\t\telse duration.push(s);\n\t}\n\treturn duration.join(':');\n}\n\nexport const MediaDuration = ({\n\tmediaDuration,\n\timagePositionOnDesktop,\n\timagePositionOnMobile,\n}: {\n\tmediaDuration: number;\n\timagePositionOnDesktop?: ImagePositionType;\n\timagePositionOnMobile?: ImagePositionType;\n}) => {\n\tif (imagePositionOnDesktop === 'left') {\n\t\treturn null;\n\t}\n\tif (imagePositionOnMobile === 'left') {\n\t\treturn (\n\t\t\t<Hide until=\"tablet\">\n\t\t\t\t<div css={durationStyles}>\n\t\t\t\t\t<p>{secondsToDuration(mediaDuration)}</p>\n\t\t\t\t</div>\n\t\t\t</Hide>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div css={durationStyles}>\n\t\t\t<p>{secondsToDuration(mediaDuration)}</p>\n\t\t</div>\n\t);\n};\n","import { MediaEvent } from '@guardian/bridget';\nimport { isUndefined, log } from '@guardian/libs';\nimport type { EventPayload, VideoEvent } from '@guardian/ophan-tracker-js';\nimport { getOphan } from '../../client/ophan/ophan';\nimport { getVideoClient } from '../../lib/bridgetApi';\nimport type { VideoEventKey } from './YoutubeAtom';\n\nconst getAppsMediaEvent = (\n\ttrackingEvent: VideoEventKey,\n): MediaEvent | undefined => {\n\tswitch (trackingEvent) {\n\t\tcase 'cued':\n\t\t\treturn MediaEvent.ready;\n\t\tcase 'play':\n\t\t\treturn MediaEvent.play;\n\t\tcase '25':\n\t\t\treturn MediaEvent.percent25;\n\t\tcase '50':\n\t\t\treturn MediaEvent.percent50;\n\t\tcase '75':\n\t\t\treturn MediaEvent.percent75;\n\t\tcase 'end':\n\t\t\treturn MediaEvent.end;\n\t\tdefault:\n\t\t\treturn undefined;\n\t}\n};\n\nconst ophanTrackerWeb = (id: string) => {\n\treturn (trackingEvent: VideoEventKey): void => {\n\t\tvoid getOphan('Web').then((ophan) => {\n\t\t\tconst event = {\n\t\t\t\tvideo: {\n\t\t\t\t\tid: `gu-video-youtube-${id}`,\n\t\t\t\t\teventType: `video:content:${trackingEvent}`,\n\t\t\t\t} satisfies VideoEvent,\n\t\t\t} satisfies EventPayload;\n\t\t\tlog('dotcom', {\n\t\t\t\tfrom: 'YoutubeAtom event emitter web',\n\t\t\t\tid,\n\t\t\t\tevent,\n\t\t\t});\n\t\t\tophan.record(event);\n\t\t});\n\t};\n};\n\nconst ophanTrackerApps = (id: string) => {\n\treturn (trackingEvent: VideoEventKey): void => {\n\t\tconst appsMediaEvent = getAppsMediaEvent(trackingEvent);\n\t\tif (!isUndefined(appsMediaEvent)) {\n\t\t\tconst event = {\n\t\t\t\tvideoId: id,\n\t\t\t\tevent: appsMediaEvent,\n\t\t\t};\n\t\t\tlog('dotcom', {\n\t\t\t\tfrom: 'YoutubeAtom event emitter apps',\n\t\t\t\tid,\n\t\t\t\tevent,\n\t\t\t});\n\t\t\tvoid getVideoClient().sendVideoEvent(event);\n\t\t}\n\t};\n};\n\nexport { ophanTrackerApps, ophanTrackerWeb };\n","import { css } from '@emotion/react';\nimport { breakpoints } from '@guardian/source/foundations';\nimport { getSourceImageUrl } from '../../lib/getSourceImageUrl_temp_fix';\nimport { generateSources, getFallbackSource, Sources } from '../Picture';\n\ntype Props = {\n\timage: string;\n\talt: string;\n\theight: number;\n\twidth: number;\n\taspectRatio?: string;\n};\n\nexport const YoutubeAtomPicture = ({\n\timage,\n\talt,\n\theight,\n\twidth,\n\taspectRatio,\n}: Props) => {\n\tconst sources = generateSources(\n\t\tgetSourceImageUrl(image),\n\t\t[\n\t\t\t{ breakpoint: breakpoints.mobile, width: 465 },\n\t\t\t{ breakpoint: breakpoints.mobileLandscape, width: 645 },\n\t\t\t{ breakpoint: breakpoints.phablet, width: 620 },\n\t\t\t{ breakpoint: breakpoints.tablet, width: 700 },\n\t\t\t{ breakpoint: breakpoints.desktop, width: 620 },\n\t\t],\n\t\taspectRatio,\n\t);\n\tconst fallbackSource = getFallbackSource(sources);\n\n\treturn (\n\t\t<picture itemProp=\"contentUrl\">\n\t\t\t<Sources sources={sources} />\n\n\t\t\t<img\n\t\t\t\talt={alt}\n\t\t\t\tsrc={fallbackSource.lowResUrl}\n\t\t\t\theight={height}\n\t\t\t\twidth={width}\n\t\t\t\t// https://stackoverflow.com/questions/10844205/html-5-strange-img-always-adds-3px-margin-at-bottom\n\t\t\t\t// why did we add the css `vertical-align: middle;` to the img tag\n\t\t\t\tcss={css`\n\t\t\t\t\tvertical-align: middle;\n\t\t\t\t`}\n\t\t\t/>\n\t\t</picture>\n\t);\n};\n","import { css } from '@emotion/react';\nimport { isUndefined } from '@guardian/libs';\nimport {\n\tfrom,\n\theadlineMedium17,\n\theadlineMedium20,\n\tpalette as sourcePalette,\n\tspace,\n\ttextSansBold12,\n} from '@guardian/source/foundations';\nimport type { ArticleFormat } from '../../lib/articleFormat';\nimport { palette } from '../../palette';\nimport type { AspectRatio } from '../../types/front';\nimport type {\n\tImagePositionType,\n\tImageSizeType,\n} from '../Card/components/ImageWrapper';\nimport { PlayIcon } from '../Card/components/PlayIcon';\nimport { FormatBoundary } from '../FormatBoundary';\nimport { Kicker } from '../Kicker';\nimport { secondsToDuration } from '../MediaDuration';\nimport { YoutubeAtomPicture } from './YoutubeAtomPicture';\n\nexport type VideoCategory = 'live' | 'documentary' | 'explainer';\n\ntype Props = {\n\tuniqueId: string;\n\toverrideImage?: string;\n\tposterImage?: string;\n\theight: number;\n\twidth: number;\n\talt: string;\n\tduration?: number; // in seconds\n\ttitle?: string;\n\tonClick: () => void;\n\tvideoCategory?: VideoCategory;\n\tkicker?: string;\n\tformat: ArticleFormat;\n\tshowTextOverlay?: boolean;\n\timageSize: ImageSizeType;\n\timagePositionOnMobile: ImagePositionType;\n\taspectRatio?: AspectRatio;\n};\n\nconst overlayStyles = css`\n\tbackground-size: cover;\n\tbackground-position: 49% 49%;\n\tbackground-repeat: no-repeat;\n\ttext-align: center;\n\theight: 100%;\n\twidth: 100%;\n\tposition: absolute;\n\tmax-height: 100vh;\n\tcursor: pointer;\n\tborder: 0;\n\tpadding: 0;\n\n\timg {\n\t\twidth: 100%;\n\t\theight: 100%;\n\t}\n\n\t.play-icon {\n\t\ttransition: transform 300ms;\n\t}\n\n\t/* We scale the play icon on hover and focus to indicate it's playable content. */\n\t:focus .play-icon,\n\t:hover .play-icon {\n\t\ttransform: translate(-50%, -50%) scale(1.15);\n\t}\n`;\n\nconst pillStyles = css`\n\tposition: absolute;\n\ttop: ${space[2]}px;\n\tright: ${space[2]}px;\n\t${textSansBold12};\n\tbackground-color: rgba(0, 0, 0, 0.7);\n\tcolor: ${sourcePalette.neutral[100]};\n\tborder-radius: ${space[3]}px;\n\tpadding: 0 6px;\n\tdisplay: inline-flex;\n`;\n\nconst pillItemStyles = css`\n\t/* Target all but the first element, and add a border */\n\t:nth-of-type(n + 2) {\n\t\tborder-left: 1px solid rgba(255, 255, 255, 0.5);\n\t}\n`;\n\nconst pillTextStyles = css`\n\tline-height: ${space[4]}px;\n\tpadding: ${space[1]}px 6px;\n`;\n\nconst liveStyles = css`\n\t::before {\n\t\tcontent: '';\n\t\twidth: 9px;\n\t\theight: 9px;\n\t\tborder-radius: 50%;\n\t\tbackground-color: ${sourcePalette.news[500]};\n\t\tdisplay: inline-block;\n\t\tposition: relative;\n\t\tmargin-right: 0.1875rem;\n\t}\n`;\n\nconst textOverlayStyles = css`\n\tposition: absolute;\n\tbackground: linear-gradient(\n\t\t180deg,\n\t\trgba(0, 0, 0, 0) 0%,\n\t\trgba(0, 0, 0, 0.7) 25%\n\t);\n\twidth: 100%;\n\tbottom: 0;\n\tcolor: ${sourcePalette.neutral[100]};\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: flex-start;\n\ttext-align: start;\n\tpadding: ${space[2]}px;\n\tpadding-top: ${space[9]}px;\n`;\n\nconst titleStyles = css`\n\t${headlineMedium17};\n\t${from.tablet} {\n\t\t${headlineMedium20};\n\t}\n`;\nconst capitalise = (str: string): string =>\n\tstr.charAt(0).toUpperCase() + str.slice(1);\n\nexport const YoutubeAtomOverlay = ({\n\tuniqueId,\n\toverrideImage,\n\tposterImage,\n\theight,\n\twidth,\n\talt,\n\tduration,\n\ttitle,\n\tonClick,\n\tvideoCategory,\n\tkicker,\n\tformat,\n\tshowTextOverlay,\n\timageSize,\n\timagePositionOnMobile,\n\taspectRatio,\n}: Props) => {\n\tconst id = `youtube-overlay-${uniqueId}`;\n\tconst hasDuration = !isUndefined(duration) && duration > 0;\n\tconst showPill = !!videoCategory || hasDuration;\n\tconst isLive = videoCategory === 'live';\n\tconst image = overrideImage ?? posterImage;\n\tconst hidePillOnMobile =\n\t\timagePositionOnMobile === 'right' || imagePositionOnMobile === 'left';\n\n\treturn (\n\t\t<FormatBoundary format={format}>\n\t\t\t<button\n\t\t\t\tdata-testid={id}\n\t\t\t\tonClick={onClick}\n\t\t\t\tcss={overlayStyles}\n\t\t\t\taria-label={title ? `Play video: ${title}` : `Play video`}\n\t\t\t\ttype=\"button\"\n\t\t\t>\n\t\t\t\t{!!image && (\n\t\t\t\t\t<YoutubeAtomPicture\n\t\t\t\t\t\timage={image}\n\t\t\t\t\t\talt={alt}\n\t\t\t\t\t\theight={height}\n\t\t\t\t\t\twidth={width}\n\t\t\t\t\t\taspectRatio={aspectRatio}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t\t{showPill && (\n\t\t\t\t\t<div\n\t\t\t\t\t\tcss={\n\t\t\t\t\t\t\thidePillOnMobile\n\t\t\t\t\t\t\t\t? css`\n\t\t\t\t\t\t\t\t\t\tdisplay: none;\n\t\t\t\t\t\t\t\t  `\n\t\t\t\t\t\t\t\t: pillStyles\n\t\t\t\t\t\t}\n\t\t\t\t\t>\n\t\t\t\t\t\t{!!videoCategory && (\n\t\t\t\t\t\t\t<div css={pillItemStyles}>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tcss={[pillTextStyles, isLive && liveStyles]}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{capitalise(videoCategory)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{!!hasDuration && (\n\t\t\t\t\t\t\t<div css={pillItemStyles}>\n\t\t\t\t\t\t\t\t<div css={pillTextStyles}>\n\t\t\t\t\t\t\t\t\t{secondsToDuration(duration)}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t\t<PlayIcon\n\t\t\t\t\timageSize={imageSize}\n\t\t\t\t\timagePositionOnMobile={imagePositionOnMobile}\n\t\t\t\t/>\n\t\t\t\t{showTextOverlay && (\n\t\t\t\t\t<div css={textOverlayStyles}>\n\t\t\t\t\t\t{!!kicker && (\n\t\t\t\t\t\t\t<Kicker\n\t\t\t\t\t\t\t\ttext={kicker}\n\t\t\t\t\t\t\t\tcolor={palette('--youtube-overlay-kicker')}\n\t\t\t\t\t\t\t\tfontWeight=\"bold\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t<div css={titleStyles}>{title}</div>\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t</button>\n\t\t</FormatBoundary>\n\t);\n};\n","import { css } from '@emotion/react';\n\n/**\n * The placeholder component is used to render a black rectangle\n * until the player is ready\n *\n * Otherwise the container may visibly flash white between the\n * overlay image being removed and the player becoming ready\n */\nexport const YoutubeAtomPlaceholder = ({\n\tuniqueId,\n}: {\n\tuniqueId: string;\n}): JSX.Element => {\n\tconst id = `youtube-placeholder-${uniqueId}`;\n\treturn (\n\t\t<div\n\t\t\tdata-name={id}\n\t\t\tdata-testid={id}\n\t\t\tcss={[\n\t\t\t\tcss`\n\t\t\t\t\twidth: 100%;\n\t\t\t\t\theight: 100%;\n\t\t\t\t\tposition: absolute;\n\t\t\t\t\ttop: 0;\n\t\t\t\t\tleft: 0;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\tflex-grow: 1;\n\t\t\t\t\tbackground-color: black;\n\t\t\t\t`,\n\t\t\t]}\n\t\t></div>\n\t);\n};\n","import { loadScript, log } from '@guardian/libs';\n\nlet scriptsPromise: Promise<Array<Event | undefined | void>> | undefined;\nlet youTubeAPIPromise: Promise<typeof YT> | undefined;\n\nconst loadScriptAndCatch = (src: string) =>\n\tloadScript(src).catch((e) => {\n\t\tlog('dotcom', `loadYouTubeAPI: failed to load script ${src}`, e);\n\t});\n\nconst loadScripts = (enableIma = false) => {\n\t/**\n\t * loadScripts can be called multiple times on pages with more than one video\n\t * Only attempt to load scripts if this is the first call and otherwise return the same promise\n\t */\n\tif (scriptsPromise) {\n\t\treturn scriptsPromise;\n\t}\n\tif (enableIma) {\n\t\tlog('dotcom', 'loadYouTubeAPI: loading YouTube & IMA script');\n\t\tscriptsPromise = Promise.all([\n\t\t\tloadScriptAndCatch('https://www.youtube.com/iframe_api?ima=1'),\n\t\t\tloadScriptAndCatch(\n\t\t\t\t'https://imasdk.googleapis.com/js/sdkloader/ima3.js',\n\t\t\t),\n\t\t]);\n\t} else {\n\t\tlog('dotcom', 'loadYouTubeAPI: loading YouTube script');\n\t\tscriptsPromise = Promise.all([\n\t\t\tloadScriptAndCatch('https://www.youtube.com/iframe_api'),\n\t\t]);\n\t}\n\treturn scriptsPromise;\n};\n\n/**\n * The YouTube IFrame API will call `window.onYouTubeIframeAPIReady` when it is ready\n */\nconst getYouTubeAPIPromise = (): Promise<typeof YT> => {\n\t/**\n\t * youtubeAPIReady can be called multiple times on pages with more than one video\n\t * Only set window.onYouTubeIframeAPIReady if this is the first call and otherwise return the same promise\n\t */\n\tif (youTubeAPIPromise) {\n\t\treturn youTubeAPIPromise;\n\t}\n\n\tyouTubeAPIPromise = new Promise((resolve) => {\n\t\twindow.onYouTubeIframeAPIReady = () => {\n\t\t\tlog('dotcom', 'loadYouTubeAPI: resolving YouTube API promise');\n\t\t\tresolve(window.YT);\n\t\t};\n\t});\n\treturn youTubeAPIPromise;\n};\n\nconst loadYouTubeAPI = (enableIma = false): Promise<typeof YT> => {\n\t/* If another part of the code has already loaded youtube api, return early. */\n\t// eslint-disable-next-line @typescript-eslint/no-unnecessary-condition -- @types/youtube insists that window.YT cannot be undefined. This is very much untrue.\n\tif (window.YT?.Player instanceof Function) {\n\t\tlog('dotcom', 'loadYouTubeAPI: returning existing window.YT');\n\t\treturn Promise.resolve(window.YT);\n\t}\n\n\t/* Create youtubeAPI promise before loading scripts so that\n\t * window.onYouTubeIframeAPIReady is guaranteed to be defined\n\t * when the YouYube script laods and calls it.\n\t */\n\tconst youtubeAPI = getYouTubeAPIPromise();\n\n\treturn loadScripts(enableIma).then(() => youtubeAPI);\n};\n\nexport { loadYouTubeAPI };\n","import { log } from '@guardian/libs';\nimport type { google } from './ima';\nimport { loadYouTubeAPI } from './loadYouTubeApi';\n\ndeclare global {\n\t// eslint-disable-next-line @typescript-eslint/no-namespace -- YT types are in a namespace\n\tnamespace YT {\n\t\texport class ImaManager {\n\t\t\tgetAdsLoader: () => google.ima.AdsLoader;\n\t\t\tgetAdsManager: () => google.ima.AdsManager;\n\t\t}\n\t\texport const createPlayerForPublishers: (\n\t\t\tid: string,\n\t\t\tmakeAdsRequestCallback: (\n\t\t\t\tadsRequest: { adTagUrl: string },\n\t\t\t\tadsRenderingSettings: google.ima.AdsRenderingSettings,\n\t\t\t) => void,\n\t\t\tconfig: {\n\t\t\t\tyoutubeOptions: PlayerOptions;\n\t\t\t},\n\t\t\tonPlayerReadyCallback: (\n\t\t\t\tplayer: Player,\n\t\t\t\timaManager: ImaManager,\n\t\t\t) => void,\n\t\t) => void;\n\t\texport interface Events {\n\t\t\tonFullscreenToggled?: () => void;\n\t\t}\n\t}\n}\n\ntype EmbedConfig = {\n\tembedConfig: {\n\t\trelatedChannels: string[];\n\t\tadsConfig: { disableAds: true };\n\t\tenableIma: boolean;\n\t\tdisableRelatedVideos: boolean;\n\t};\n};\n\ntype PlayerOptions = YT.PlayerOptions & EmbedConfig;\n\ntype PlayerListenerName = keyof YT.Events;\n\ntype PlayerReadyCallback = () => void;\n\ntype AdsRequestCallback = (\n\tadsRequest: { adTagUrl: string },\n\tadsRenderingSettings: google.ima.AdsRenderingSettings,\n) => void;\n\ntype SetPlayerResolve = {\n\tplayer: YT.Player;\n\timaManager?: YT.ImaManager;\n};\n\ntype YouTubePlayerArgs = {\n\tid: string;\n\tyoutubeOptions: PlayerOptions;\n\tonReadyListener: PlayerReadyCallback;\n\tenableIma: boolean;\n\timaAdsRequestCallback?: AdsRequestCallback;\n\timaAdManagerListeners?: (imaManager: YT.ImaManager) => void;\n};\n\nconst noop = () => {\n\treturn;\n};\n\nclass YouTubePlayer {\n\tplayerPromise: Promise<SetPlayerResolve>;\n\tprivate player?: YT.Player;\n\n\tconstructor({\n\t\tid,\n\t\tyoutubeOptions,\n\t\tonReadyListener,\n\t\tenableIma,\n\t\timaAdsRequestCallback = noop,\n\t\timaAdManagerListeners = noop,\n\t}: YouTubePlayerArgs) {\n\t\tthis.playerPromise = this.setPlayer(\n\t\t\tid,\n\t\t\tyoutubeOptions,\n\t\t\tonReadyListener,\n\t\t\tenableIma,\n\t\t\timaAdsRequestCallback,\n\t\t\timaAdManagerListeners,\n\t\t);\n\t}\n\n\tprivate async setPlayer(\n\t\tid: string,\n\t\tyoutubeOptions: PlayerOptions,\n\t\tonReadyListener: PlayerReadyCallback,\n\t\tenableIma: boolean,\n\t\timaAdsRequestCallback: AdsRequestCallback,\n\t\timaAdManagerListeners: (imaManager: YT.ImaManager) => void,\n\t) {\n\t\tconst YTAPI = await loadYouTubeAPI(enableIma);\n\t\tconst playerPromise = new Promise<SetPlayerResolve>(\n\t\t\t(resolve, reject) => {\n\t\t\t\ttry {\n\t\t\t\t\t/**\n\t\t\t\t\t * If enableIma is true, YT.createPlayerForPublishers will be called to initiate IMA ads\n\t\t\t\t\t * If enableIma is false, the standard YT.Player constructor will be called\n\t\t\t\t\t * Listeners are set appropriately for each method\n\t\t\t\t\t */\n\t\t\t\t\tif (enableIma) {\n\t\t\t\t\t\tYTAPI.createPlayerForPublishers(\n\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\timaAdsRequestCallback,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tyoutubeOptions,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t// onReady callback for YT.createPlayerForPublishers must be passed separately\n\t\t\t\t\t\t\t(player, imaManager) => {\n\t\t\t\t\t\t\t\tthis.player = player;\n\t\t\t\t\t\t\t\timaAdManagerListeners(imaManager);\n\t\t\t\t\t\t\t\tonReadyListener();\n\t\t\t\t\t\t\t\tresolve({\n\t\t\t\t\t\t\t\t\tplayer,\n\t\t\t\t\t\t\t\t\timaManager,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.player = new YTAPI.Player(id, {\n\t\t\t\t\t\t\t...youtubeOptions,\n\t\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\t\tonReady: onReadyListener,\n\t\t\t\t\t\t\t\tonStateChange:\n\t\t\t\t\t\t\t\t\tyoutubeOptions.events?.onStateChange,\n\t\t\t\t\t\t\t\tonFullscreenToggled:\n\t\t\t\t\t\t\t\t\tyoutubeOptions.events?.onFullscreenToggled,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tresolve({ player: this.player });\n\t\t\t\t\t}\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis.logError(e as Error);\n\t\t\t\t\treject(e);\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t\treturn playerPromise;\n\t}\n\n\tprivate logError(error: Error) {\n\t\tlog('dotcom', `YouTubePlayer failed to load: ${error.message}`);\n\t\twindow.guardian.modules.sentry.reportError(error, 'youtube-player');\n\t}\n\n\tgetPlayerState(): Promise<YT.PlayerState | void> {\n\t\treturn this.playerPromise\n\t\t\t.then(({ player }) => {\n\t\t\t\treturn player.getPlayerState();\n\t\t\t})\n\t\t\t.catch((e: Error) => this.logError(e));\n\t}\n\n\tplayVideo(): Promise<void> {\n\t\treturn this.playerPromise\n\t\t\t.then(({ player }) => {\n\t\t\t\tplayer.playVideo();\n\t\t\t})\n\t\t\t.catch((e: Error) => this.logError(e));\n\t}\n\n\tpauseVideo(): Promise<void> {\n\t\treturn this.playerPromise\n\t\t\t.then(({ player }) => {\n\t\t\t\tplayer.pauseVideo();\n\t\t\t})\n\t\t\t.catch((e: Error) => this.logError(e));\n\t}\n\n\tstopVideo(): Promise<void> {\n\t\treturn this.playerPromise\n\t\t\t.then(({ player }) => {\n\t\t\t\tplayer.stopVideo();\n\t\t\t})\n\t\t\t.catch((e: Error) => this.logError(e));\n\t}\n\n\tremoveEventListener<T extends YT.PlayerEvent>(\n\t\teventName: PlayerListenerName,\n\t\tlistener: YT.PlayerEventHandler<T>,\n\t): void {\n\t\t/**\n\t\t * If the YouTube API hasn't finished loading,\n\t\t * this.player may be undefined in which case removeEventListener\n\t\t * will fail silently.\n\t\t */\n\t\tthis.player?.removeEventListener<T>(eventName, listener);\n\t}\n}\n\nexport { PlayerListenerName, YouTubePlayer, YouTubePlayerArgs };\n","import { css, Global } from '@emotion/react';\nimport type { Participations } from '@guardian/ab-core';\nimport { buildImaAdTagUrl } from '@guardian/commercial';\nimport type { ConsentState } from '@guardian/libs';\nimport { log } from '@guardian/libs';\nimport {\n\tuseCallback,\n\tuseEffect,\n\tuseLayoutEffect,\n\tuseRef,\n\tuseState,\n} from 'react';\nimport { getVideoClient } from '../../lib/bridgetApi';\nimport { getZIndex } from '../../lib/getZIndex';\nimport { getAuthStatus } from '../../lib/identity';\nimport type { AdTargeting } from '../../types/commercial';\nimport type { RenderingTarget } from '../../types/renderingTarget';\nimport type { google } from './ima';\nimport type { VideoEventKey } from './YoutubeAtom';\nimport type { PlayerListenerName, YouTubePlayerArgs } from './YoutubePlayer';\nimport { YouTubePlayer } from './YoutubePlayer';\n\ntype Props = {\n\tuniqueId: string;\n\tvideoId: string;\n\theight: number;\n\twidth: number;\n\ttitle?: string;\n\torigin?: string;\n\teventEmitters: Array<(event: VideoEventKey) => void>;\n\tautoPlay: boolean;\n\tonReady: () => void;\n\tpauseVideo: boolean;\n\tdeactivateVideo: () => void;\n\tenableAds: boolean;\n\tadTargeting: AdTargeting;\n\tconsentState: ConsentState;\n\tabTestParticipations: Participations;\n\trenderingTarget: RenderingTarget;\n};\n\ntype CustomPlayEventDetail = { uniqueId: string };\nconst customPlayEventName = 'video:play';\n\ntype ProgressEvents = {\n\thasSentPlayEvent: boolean;\n\thasSent25Event: boolean;\n\thasSent50Event: boolean;\n\thasSent75Event: boolean;\n\thasSentEndEvent: boolean;\n};\n\n/**\n *  Player listeners e.g.\n *  name: onReady, onStateChange, etc...\n *  listener: YT.PlayerEventHandler<PlayerEvent>, YT.PlayerEventHandler<OnStateChangeEvent>\n */\ntype PlayerListener<T extends PlayerListenerName> = {\n\tname: T;\n\tlistener: NonNullable<YT.Events[T]>;\n};\n\ntype PlayerListeners = Array<PlayerListener<PlayerListenerName>>;\n\n/**\n * Given a YT.PlayerEventHandler, (e.g. PlayerEventHandler<OnStateChangeEvent>)\n * return its event type (e.g. OnStateChangeEvent)\n */\ntype ExtractEventType<T> = T extends YT.PlayerEventHandler<infer X> ? X : never;\n\nconst imaPlayerStyles = css`\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n`;\n\nconst fullscreenStyles = (id: string) => css`\n\thtml {\n\t\toverflow: hidden;\n\t}\n\tiframe#${id} {\n\t\tposition: fixed;\n\t\ttop: 0;\n\t\t/* override vw and vh with vsw and vsh if supported */\n\t\twidth: 100vw;\n\t\theight: 100vh;\n\t\t/* stylelint-disable-next-line declaration-block-no-duplicate-properties */\n\t\twidth: 100svw;\n\t\t/* stylelint-disable-next-line declaration-block-no-duplicate-properties */\n\t\theight: 100svh;\n\t\tz-index: ${getZIndex('youTubeFullscreen')};\n\t}\n`;\n\n/**\n * We set the external_fullscreen configuration property depending on\n * whether the native layer needs to delegate fullscreen styling to\n * the webview.\n *\n * This is true for Android but not for iOS which handles fullscreen\n * natively. The Bridget method setFullscreen returns a value to\n * indicate this requirement. We use it here by passing a value of\n * false for fullscreen when intialising the player to determine\n * the value we need to pass for external_fullscreen.\n *\n * external_fullscreen is allowed listed on our CODE and PROD domains.\n */\nconst setAppsConfiguration = async (\n\tbasePlayerConfiguration: YouTubePlayerArgs,\n\trenderingTarget: RenderingTarget,\n) => {\n\tif (renderingTarget === 'Apps') {\n\t\tconst requiresWebFullscreen =\n\t\t\tawait getVideoClient().setFullscreen(false);\n\t\tconst updatedConfiguration = {\n\t\t\t...basePlayerConfiguration,\n\t\t\texternal_fullscreen: requiresWebFullscreen ? 1 : 0,\n\t\t};\n\t\treturn updatedConfiguration;\n\t}\n\treturn basePlayerConfiguration;\n};\n\n/**\n * Dispatches a custom play event so that other players listening\n * for this event will stop playing\n */\nconst dispatchCustomPlayEvent = (uniqueId: string) => {\n\tdocument.dispatchEvent(\n\t\tnew CustomEvent(customPlayEventName, {\n\t\t\tdetail: { uniqueId },\n\t\t}),\n\t);\n};\n\n/**\n * Create an onStateChange listener that will invoke all eventEmitters\n * on the following events:\n *\n * - play\n * - pause\n * - cued\n * - ended\n * - 25% progress\n * - 50% progress\n * - 75% progress\n *\n * progressEvents are refs stored by the main component\n */\nconst createOnStateChangeListener =\n\t(\n\t\tvideoId: string,\n\t\tuniqueId: string,\n\t\tprogressEvents: ProgressEvents,\n\t\teventEmitters: Props['eventEmitters'],\n\t): YT.PlayerEventHandler<YT.OnStateChangeEvent> =>\n\t(event) => {\n\t\tconst loggerFrom = 'YoutubeAtomPlayer onStateChange';\n\t\tlog('dotcom', {\n\t\t\tfrom: loggerFrom,\n\t\t\tvideoId,\n\t\t\tevent,\n\t\t});\n\n\t\t/**\n\t\t * event.target is the actual underlying YT player\n\t\t */\n\t\tconst player = event.target;\n\n\t\tif (event.data === YT.PlayerState.PLAYING) {\n\t\t\t/**\n\t\t\t * Emit video play event so other components\n\t\t\t * get aware when a video is played\n\t\t\t */\n\t\t\tdispatchCustomPlayEvent(uniqueId);\n\n\t\t\tif (!progressEvents.hasSentPlayEvent) {\n\t\t\t\tlog('dotcom', {\n\t\t\t\t\tfrom: loggerFrom,\n\t\t\t\t\tvideoId,\n\t\t\t\t\tmsg: 'start play',\n\t\t\t\t\tevent,\n\t\t\t\t});\n\t\t\t\tfor (const eventEmitter of eventEmitters) eventEmitter('play');\n\t\t\t\tprogressEvents.hasSentPlayEvent = true;\n\n\t\t\t\t/**\n\t\t\t\t * Set a timeout to check progress again in the future\n\t\t\t\t */\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tcheckProgress();\n\t\t\t\t}, 3000);\n\t\t\t} else {\n\t\t\t\tlog('dotcom', {\n\t\t\t\t\tfrom: loggerFrom,\n\t\t\t\t\tvideoId,\n\t\t\t\t\tmsg: 'resume',\n\t\t\t\t\tevent,\n\t\t\t\t});\n\t\t\t\tfor (const eventEmitter of eventEmitters) {\n\t\t\t\t\teventEmitter('resume');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst checkProgress = () => {\n\t\t\t\tconst currentTime = player.getCurrentTime();\n\t\t\t\tconst duration = player.getDuration();\n\n\t\t\t\tif (!duration || !currentTime) return;\n\n\t\t\t\tconst percentPlayed = (currentTime / duration) * 100;\n\n\t\t\t\tif (!progressEvents.hasSent25Event && 25 < percentPlayed) {\n\t\t\t\t\tlog('dotcom', {\n\t\t\t\t\t\tfrom: loggerFrom,\n\t\t\t\t\t\tvideoId,\n\t\t\t\t\t\tmsg: 'played 25%',\n\t\t\t\t\t\tevent,\n\t\t\t\t\t});\n\t\t\t\t\tfor (const eventEmitter of eventEmitters) {\n\t\t\t\t\t\teventEmitter('25');\n\t\t\t\t\t}\n\t\t\t\t\tprogressEvents.hasSent25Event = true;\n\t\t\t\t}\n\n\t\t\t\tif (!progressEvents.hasSent50Event && 50 < percentPlayed) {\n\t\t\t\t\tlog('dotcom', {\n\t\t\t\t\t\tfrom: loggerFrom,\n\t\t\t\t\t\tvideoId,\n\t\t\t\t\t\tmsg: 'played 50%',\n\t\t\t\t\t\tevent,\n\t\t\t\t\t});\n\t\t\t\t\tfor (const eventEmitter of eventEmitters) {\n\t\t\t\t\t\teventEmitter('50');\n\t\t\t\t\t}\n\t\t\t\t\tprogressEvents.hasSent50Event = true;\n\t\t\t\t}\n\n\t\t\t\tif (!progressEvents.hasSent75Event && 75 < percentPlayed) {\n\t\t\t\t\tlog('dotcom', {\n\t\t\t\t\t\tfrom: loggerFrom,\n\t\t\t\t\t\tvideoId,\n\t\t\t\t\t\tmsg: 'played 75%',\n\t\t\t\t\t\tevent,\n\t\t\t\t\t});\n\t\t\t\t\tfor (const eventEmitter of eventEmitters) {\n\t\t\t\t\t\teventEmitter('75');\n\t\t\t\t\t}\n\t\t\t\t\tprogressEvents.hasSent75Event = true;\n\t\t\t\t}\n\n\t\t\t\tconst currentPlayerState = player.getPlayerState();\n\n\t\t\t\tif (currentPlayerState !== YT.PlayerState.ENDED) {\n\t\t\t\t\t/**\n\t\t\t\t\t * Set a timeout to check progress again in the future\n\t\t\t\t\t */\n\t\t\t\t\tsetTimeout(() => checkProgress(), 3000);\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t};\n\t\t}\n\n\t\tif (event.data === YT.PlayerState.PAUSED) {\n\t\t\tlog('dotcom', {\n\t\t\t\tfrom: loggerFrom,\n\t\t\t\tvideoId,\n\t\t\t\tmsg: 'pause',\n\t\t\t\tevent,\n\t\t\t});\n\t\t\tfor (const eventEmitter of eventEmitters) eventEmitter('pause');\n\t\t}\n\n\t\tif (event.data === YT.PlayerState.CUED) {\n\t\t\tlog('dotcom', {\n\t\t\t\tfrom: loggerFrom,\n\t\t\t\tvideoId,\n\t\t\t\tmsg: 'cued',\n\t\t\t\tevent,\n\t\t\t});\n\t\t\tfor (const eventEmitter of eventEmitters) eventEmitter('cued');\n\t\t\tprogressEvents.hasSentPlayEvent = false;\n\t\t}\n\n\t\tif (\n\t\t\tevent.data === YT.PlayerState.ENDED &&\n\t\t\t!progressEvents.hasSentEndEvent\n\t\t) {\n\t\t\tlog('dotcom', {\n\t\t\t\tfrom: loggerFrom,\n\t\t\t\tvideoId,\n\t\t\t\tmsg: 'ended',\n\t\t\t\tevent,\n\t\t\t});\n\t\t\tfor (const eventEmitter of eventEmitters) eventEmitter('end');\n\t\t\tprogressEvents.hasSentEndEvent = true;\n\t\t\tprogressEvents.hasSentPlayEvent = false;\n\t\t}\n\t};\n\n/**\n * Creates an onReady listener\n */\nconst createOnReadyListener =\n\t(\n\t\tvideoId: string,\n\t\tonReadyCallback: () => void,\n\t\tsetPlayerReady: () => void,\n\t) =>\n\t() => {\n\t\tlog('dotcom', {\n\t\t\tfrom: 'YoutubeAtomPlayer onReady',\n\t\t\tvideoId,\n\t\t\tmsg: 'Ready',\n\t\t});\n\t\t/**\n\t\t * Callback to notify parent YoutubeAtom that the player is ready\n\t\t */\n\t\tonReadyCallback();\n\n\t\t/**\n\t\t * Callback to set value of playerReady ref\n\t\t */\n\t\tsetPlayerReady();\n\t};\n\n/**\n * Creates a callback that the IMA manager will use to build an IMA ad request\n * and sets ad rendering settings\n */\nconst createImaAdsRequestCallback = (\n\tadTargeting: AdTargeting | undefined,\n\tconsentState: ConsentState,\n\tabTestParticipations: Participations,\n\tisSignedIn: boolean,\n) => {\n\tconst adTargetingEnabled = adTargeting && !adTargeting.disableAds;\n\tconst adUnit =\n\t\tadTargetingEnabled && adTargeting.adUnit ? adTargeting.adUnit : '';\n\tconst customParams = adTargetingEnabled ? adTargeting.customParams : {};\n\n\tconst adsRequestCallback = (\n\t\tadsRequest: { adTagUrl: string },\n\t\tadsRenderingSettings: google.ima.AdsRenderingSettings,\n\t) => {\n\t\tadsRequest.adTagUrl = buildImaAdTagUrl({\n\t\t\tadUnit,\n\t\t\tcustomParams,\n\t\t\tconsentState,\n\t\t\tclientSideParticipations: abTestParticipations,\n\t\t\tisSignedIn,\n\t\t});\n\t\tadsRenderingSettings.useStyledNonLinearAds = true;\n\t\tif (window.google) {\n\t\t\tadsRenderingSettings.uiElements = [\n\t\t\t\twindow.google.ima.UiElements.AD_ATTRIBUTION,\n\t\t\t\twindow.google.ima.UiElements.COUNTDOWN,\n\t\t\t] as const;\n\t\t}\n\t};\n\n\treturn adsRequestCallback;\n};\n\n/**\n * Creates listeners for the IMA manager\n */\nconst createImaManagerListeners = (uniqueId: string) => {\n\treturn (imaManager: YT.ImaManager) => {\n\t\tconst onAdsManagerLoaded = () => {\n\t\t\tif (window.google) {\n\t\t\t\timaManager\n\t\t\t\t\t.getAdsManager()\n\t\t\t\t\t.addEventListener(\n\t\t\t\t\t\twindow.google.ima.AdEvent.Type.Started,\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tdispatchCustomPlayEvent(uniqueId);\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t}\n\t\t};\n\n\t\tif (window.google) {\n\t\t\timaManager\n\t\t\t\t.getAdsLoader()\n\t\t\t\t.addEventListener(\n\t\t\t\t\twindow.google.ima.AdsManagerLoadedEvent.Type\n\t\t\t\t\t\t.AdsManagerLoaded,\n\t\t\t\t\tonAdsManagerLoaded,\n\t\t\t\t\tfalse,\n\t\t\t\t);\n\t\t}\n\t};\n};\n\nconst isSignedIn = async (): Promise<boolean> => {\n\ttry {\n\t\tconst authStatus = await getAuthStatus();\n\t\treturn (\n\t\t\tauthStatus.kind === 'SignedInWithCookies' ||\n\t\t\tauthStatus.kind === 'SignedInWithOkta'\n\t\t);\n\t} catch (error: unknown) {\n\t\tif (error instanceof Error) {\n\t\t\twindow.guardian.modules.sentry.reportError(\n\t\t\t\terror,\n\t\t\t\t'youtube-atom-player-is-signed-in',\n\t\t\t);\n\t\t}\n\t}\n\treturn false;\n};\n\nexport const YoutubeAtomPlayer = ({\n\tuniqueId,\n\tvideoId,\n\theight,\n\twidth,\n\ttitle,\n\torigin,\n\teventEmitters,\n\tautoPlay,\n\tonReady,\n\tpauseVideo,\n\tdeactivateVideo,\n\tenableAds,\n\tadTargeting,\n\tconsentState,\n\tabTestParticipations,\n\trenderingTarget,\n}: Props): JSX.Element => {\n\t/**\n\t * useRef for player and progressEvents\n\t * Provides mutable persistent state for the player across renders\n\t * Does not cause re-renders on update\n\t */\n\tconst player = useRef<YouTubePlayer>();\n\tconst progressEvents = useRef<ProgressEvents>({\n\t\thasSentPlayEvent: false,\n\t\thasSent25Event: false,\n\t\thasSent50Event: false,\n\t\thasSent75Event: false,\n\t\thasSentEndEvent: false,\n\t});\n\n\tconst [playerReady, setPlayerReady] = useState<boolean>(false);\n\tconst [isFullscreen, setIsFullscreen] = useState<boolean>(false);\n\tconst [applyFullscreenStyles, setApplyFullscreenStyles] =\n\t\tuseState<boolean>(false);\n\tconst playerReadyCallback = useCallback(() => setPlayerReady(true), []);\n\tconst playerListeners = useRef<PlayerListeners>([]);\n\t/**\n\t * A map ref with a key of eventname and a value of eventHandler\n\t */\n\tconst customListeners = useRef<\n\t\tRecord<string, (event: CustomEventInit<CustomPlayEventDetail>) => void>\n\t>({});\n\n\tconst adsManager = useRef<google.ima.AdsManager>();\n\n\tconst id = `youtube-player-${uniqueId}`;\n\n\t/**\n\t * Initialise player useEffect\n\t */\n\tuseEffect(\n\t\t() => {\n\t\t\tif (!player.current) {\n\t\t\t\tlog('dotcom', {\n\t\t\t\t\tfrom: 'YoutubeAtomPlayer initialise',\n\t\t\t\t\tvideoId,\n\t\t\t\t});\n\n\t\t\t\tconst onReadyListener = createOnReadyListener(\n\t\t\t\t\tvideoId,\n\t\t\t\t\tonReady,\n\t\t\t\t\tplayerReadyCallback,\n\t\t\t\t);\n\n\t\t\t\tconst onStateChangeListener = createOnStateChangeListener(\n\t\t\t\t\tvideoId,\n\t\t\t\t\tuniqueId,\n\t\t\t\t\tprogressEvents.current,\n\t\t\t\t\teventEmitters,\n\t\t\t\t);\n\n\t\t\t\t/**\n\t\t\t\t * Configuration for the base YouTube player\n\t\t\t\t * IMA is configured separately\n\t\t\t\t */\n\t\t\t\tconst basePlayerConfiguration: YouTubePlayerArgs = {\n\t\t\t\t\tid,\n\t\t\t\t\tyoutubeOptions: {\n\t\t\t\t\t\theight: '100%',\n\t\t\t\t\t\twidth: '100%',\n\t\t\t\t\t\tvideoId,\n\t\t\t\t\t\tplayerVars: {\n\t\t\t\t\t\t\tcontrols: 1,\n\t\t\t\t\t\t\tfs: 1,\n\t\t\t\t\t\t\tmodestbranding: 1,\n\t\t\t\t\t\t\torigin,\n\t\t\t\t\t\t\tplaysinline: 1,\n\t\t\t\t\t\t\trel: 0,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tembedConfig: {\n\t\t\t\t\t\t\trelatedChannels: [],\n\t\t\t\t\t\t\t// Since IMA ads the YouTube player API no longer accepts ad configuration\n\t\t\t\t\t\t\tadsConfig: { disableAds: true },\n\t\t\t\t\t\t\tenableIma: enableAds,\n\t\t\t\t\t\t\t// YouTube recommends disabling related videos when IMA ads are enabled\n\t\t\t\t\t\t\tdisableRelatedVideos: enableAds,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tevents: {\n\t\t\t\t\t\t\tonStateChange: onStateChangeListener,\n\t\t\t\t\t\t\tonFullscreenToggled: () => {\n\t\t\t\t\t\t\t\tif (renderingTarget === 'Apps') {\n\t\t\t\t\t\t\t\t\tlog('dotcom', {\n\t\t\t\t\t\t\t\t\t\tfrom: 'YoutubeAtomPlayer fullscreen',\n\t\t\t\t\t\t\t\t\t\tvideoId,\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tsetIsFullscreen((prev) => !prev);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tonReadyListener,\n\t\t\t\t\tenableIma: enableAds,\n\t\t\t\t};\n\n\t\t\t\tconst basePlayerConfigurationWithApps = setAppsConfiguration(\n\t\t\t\t\tbasePlayerConfiguration,\n\t\t\t\t\trenderingTarget,\n\t\t\t\t);\n\n\t\t\t\tvoid Promise.allSettled([\n\t\t\t\t\tbasePlayerConfigurationWithApps,\n\t\t\t\t\tisSignedIn(),\n\t\t\t\t]).then(([playerConfigurationResult, isSignedInResult]) => {\n\t\t\t\t\tconst playerConfiguration =\n\t\t\t\t\t\tplayerConfigurationResult.status === 'fulfilled'\n\t\t\t\t\t\t\t? playerConfigurationResult.value\n\t\t\t\t\t\t\t: basePlayerConfiguration;\n\t\t\t\t\tconst isSignedInValue =\n\t\t\t\t\t\tisSignedInResult.status === 'fulfilled'\n\t\t\t\t\t\t\t? isSignedInResult.value\n\t\t\t\t\t\t\t: false;\n\t\t\t\t\tif (enableAds) {\n\t\t\t\t\t\tplayer.current = new YouTubePlayer({\n\t\t\t\t\t\t\t...playerConfiguration,\n\t\t\t\t\t\t\timaAdsRequestCallback: createImaAdsRequestCallback(\n\t\t\t\t\t\t\t\tadTargeting,\n\t\t\t\t\t\t\t\tconsentState,\n\t\t\t\t\t\t\t\tabTestParticipations,\n\t\t\t\t\t\t\t\tisSignedInValue,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\timaAdManagerListeners:\n\t\t\t\t\t\t\t\tcreateImaManagerListeners(uniqueId),\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tplayer.current = new YouTubePlayer(playerConfiguration);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t/**\n\t\t\t\t * Pause the current video when another video is played\n\t\t\t\t * Triggered by the CustomEvent sent by each player on play\n\t\t\t\t */\n\t\t\t\tconst handleCustomPlayEvent = (\n\t\t\t\t\tevent: CustomEventInit<CustomPlayEventDetail>,\n\t\t\t\t) => {\n\t\t\t\t\tif (event.detail) {\n\t\t\t\t\t\tconst playedVideoId = event.detail.uniqueId;\n\t\t\t\t\t\tconst thisVideoId = uniqueId;\n\n\t\t\t\t\t\tif (playedVideoId !== thisVideoId) {\n\t\t\t\t\t\t\tconst playerStatePromise =\n\t\t\t\t\t\t\t\tplayer.current?.getPlayerState();\n\t\t\t\t\t\t\tvoid playerStatePromise?.then((playerState) => {\n\t\t\t\t\t\t\t\tif (playerState === YT.PlayerState.PLAYING) {\n\t\t\t\t\t\t\t\t\tvoid player.current?.pauseVideo();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t// pause ima ads playing on other videos\n\t\t\t\t\t\t\tadsManager.current?.pause();\n\t\t\t\t\t\t\t// mark player as inactive\n\t\t\t\t\t\t\tdeactivateVideo();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\t/**\n\t\t\t\t * add listener for custom play event\n\t\t\t\t */\n\t\t\t\tdocument.addEventListener(\n\t\t\t\t\tcustomPlayEventName,\n\t\t\t\t\thandleCustomPlayEvent,\n\t\t\t\t);\n\n\t\t\t\tcustomListeners.current[customPlayEventName] =\n\t\t\t\t\thandleCustomPlayEvent;\n\n\t\t\t\tplayerListeners.current.push(\n\t\t\t\t\t{ name: 'onReady', listener: onReadyListener },\n\t\t\t\t\t{ name: 'onStateChange', listener: onStateChangeListener },\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * useEffect dependencies are mostly static but added to array for correctness\n\t\t */\n\t\t[\n\t\t\tabTestParticipations,\n\t\t\tadTargeting,\n\t\t\tautoPlay,\n\t\t\tconsentState,\n\t\t\tenableAds,\n\t\t\teventEmitters,\n\t\t\tdeactivateVideo,\n\t\t\theight,\n\t\t\tid,\n\t\t\tonReady,\n\t\t\torigin,\n\t\t\tplayerReadyCallback,\n\t\t\trenderingTarget,\n\t\t\tuniqueId,\n\t\t\tvideoId,\n\t\t\twidth,\n\t\t],\n\t);\n\n\t/**\n\t * Autoplay useEffect\n\t */\n\tuseEffect(() => {\n\t\tif (playerReady && autoPlay) {\n\t\t\t/**\n\t\t\t * Autoplay is determined by the parent\n\t\t\t * Typically true when there is a preceding overlay\n\t\t\t */\n\t\t\tlog('dotcom', {\n\t\t\t\tfrom: 'YoutubeAtomPlayer autoplay',\n\t\t\t\tvideoId,\n\t\t\t\tmsg: 'Playing video',\n\t\t\t});\n\t\t\tvoid player.current?.playVideo();\n\t\t}\n\t}, [playerReady, autoPlay, videoId]);\n\n\t/**\n\t * Player pause useEffect\n\t */\n\tuseEffect(() => {\n\t\t/**\n\t\t * if the 'pauseVideo' prop is true this should pause the video\n\t\t *\n\t\t * 'pauseVideo' is controlled by the close sticky video button\n\t\t */\n\t\tif (pauseVideo) {\n\t\t\tvoid player.current?.pauseVideo();\n\t\t}\n\t}, [pauseVideo]);\n\n\t/**\n\t * For apps rendered articles that return true for `setFullscreen` the web layer\n\t * needs to handle the application of fullscreen styles\n\t *\n\t * This is only for the YouTube player in Android web views which does not support fullscreen\n\t */\n\tuseEffect(() => {\n\t\tif (renderingTarget === 'Apps') {\n\t\t\tconst videoClient = getVideoClient();\n\t\t\tvoid videoClient.setFullscreen(isFullscreen).then((success) => {\n\t\t\t\tif (success) {\n\t\t\t\t\tsetApplyFullscreenStyles(isFullscreen);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}, [isFullscreen, renderingTarget]);\n\n\t/**\n\t * Unregister listeners useLayoutEffect\n\t */\n\tuseLayoutEffect(() => {\n\t\t/**\n\t\t * Unregister listeners before component unmount\n\t\t *\n\t\t * An empty dependency array will call its cleanup on unmount.\n\t\t *\n\t\t * Use useLayoutEffect to ensure the cleanup function is run\n\t\t * before the component is removed from the DOM. Usually clean up\n\t\t * functions will run after the render and commit phase.\n\t\t *\n\t\t * If we attempt to unregister listeners after the component is\n\t\t * removed from the DOM the YouTube API logs a warning to the console.\n\t\t */\n\n\t\tconst playerListenerNames = playerListeners.current;\n\t\tconst customListenersNames = customListeners.current;\n\n\t\treturn () => {\n\t\t\tfor (const playerListener of playerListenerNames) {\n\t\t\t\ttype T = ExtractEventType<typeof playerListener.name>;\n\t\t\t\tplayer.current?.removeEventListener<T>(\n\t\t\t\t\tplayerListener.name,\n\t\t\t\t\tplayerListener.listener,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tfor (const [eventName, eventHandler] of Object.entries(\n\t\t\t\tcustomListenersNames,\n\t\t\t)) {\n\t\t\t\tdocument.removeEventListener(eventName, eventHandler);\n\t\t\t}\n\t\t};\n\t}, []);\n\n\t/**\n\t * An element for the YouTube player to hook into the dom\n\t */\n\treturn (\n\t\t<>\n\t\t\t{applyFullscreenStyles && <Global styles={fullscreenStyles(id)} />}\n\t\t\t<div\n\t\t\t\tid={id}\n\t\t\t\tdata-testid={id}\n\t\t\t\tdata-atom-type=\"youtube\"\n\t\t\t\ttitle={title}\n\t\t\t\tcss={enableAds && imaPlayerStyles}\n\t\t\t></div>\n\t\t</>\n\t);\n};\n","import { css } from '@emotion/react';\nimport { log } from '@guardian/libs';\nimport {\n\tfrom,\n\tpalette as sourcePalette,\n\tspace,\n} from '@guardian/source/foundations';\nimport { SvgCross } from '@guardian/source/react-components';\nimport detectMobile from 'is-mobile';\nimport { useEffect, useState } from 'react';\nimport { submitComponentEvent } from '../../client/ophan/ophan';\nimport { useIsInView } from '../../lib/useIsInView';\nimport { useConfig } from '../ConfigContext';\nimport type { VideoEventKey } from './YoutubeAtom';\n\nconst buttonStyles = css`\n\tposition: absolute;\n\tleft: -36px;\n\ttop: 0;\n\tz-index: 22;\n\tbackground-color: ${sourcePalette.neutral[7]};\n\theight: 32px;\n\twidth: 32px;\n\tborder-radius: 50%;\n\tborder: 0;\n\tpadding: 0;\n\tcursor: pointer;\n\tdisplay: none;\n\tjustify-content: center;\n\talign-items: center;\n\ttransition: transform 0.2s;\n\n\t&:hover {\n\t\ttransform: scale(1.15);\n\t}\n\n\tsvg {\n\t\tfill: ${sourcePalette.neutral[100]};\n\t}\n`;\n\n/**\n * This extended hover area allows users to click the close video button more easily\n */\nconst hoverAreaStyles = (fullWidthOverlay: boolean) => {\n\tconst hoverAreaWidth = 37;\n\n\treturn css`\n\t\tposition: absolute;\n\t\ttop: -4px;\n\t\tbottom: 0;\n\t\tleft: -${hoverAreaWidth}px;\n\t\twidth: ${hoverAreaWidth}px;\n\n\t\t&:hover button {\n\t\t\tdisplay: flex;\n\t\t}\n\n\t\twidth: ${fullWidthOverlay\n\t\t\t? `calc(100% + ${hoverAreaWidth}px)`\n\t\t\t: `${hoverAreaWidth}px`};\n\t`;\n};\n\nconst stickyStyles = (showButton: boolean) => css`\n\t@keyframes fade-in-up {\n\t\tfrom {\n\t\t\ttransform: translateY(100%);\n\t\t\topacity: 0;\n\t\t}\n\n\t\tto {\n\t\t\ttransform: translateY(0%);\n\t\t\topacity: 1;\n\t\t}\n\t}\n\n\tposition: fixed;\n\tbottom: 20px;\n\twidth: 215px;\n\tz-index: 21;\n\tanimation: fade-in-up 1s ease both;\n\n\t${from.tablet} {\n\t\twidth: 300px;\n\t}\n\n\tfigcaption {\n\t\tdisplay: none;\n\t}\n\n\tbutton {\n\t\tdisplay: ${showButton ? 'flex' : 'none'};\n\t}\n\n\t&:hover button {\n\t\tdisplay: flex;\n\t}\n`;\n\nconst stickyContainerStyles = (isMainMedia?: boolean) => {\n\treturn css`\n\t\theight: 192px;\n\t\tposition: relative;\n\t\tdisplay: flex;\n\t\tjustify-content: flex-end;\n\t\tpadding-right: ${isMainMedia ? `${space[5]}px` : 0};\n\n\t\t${from.phablet} {\n\t\t\theight: 349px;\n\t\t}\n\t`;\n};\n\ntype Props = {\n\tuniqueId: string;\n\tvideoId: string;\n\teventEmitters: Array<(event: VideoEventKey) => void>;\n\tshouldStick?: boolean;\n\tsetPauseVideo: (state: boolean) => void;\n\tisActive: boolean;\n\tisMainMedia?: boolean;\n\tchildren: JSX.Element;\n\tisClosed: boolean;\n\tsetIsClosed: (state: boolean) => void;\n\tshouldPauseOutOfView: boolean;\n};\n\nconst isMobile = detectMobile({ tablet: true });\n\nexport const YoutubeAtomSticky = ({\n\tuniqueId,\n\tvideoId,\n\teventEmitters,\n\tshouldStick,\n\tsetPauseVideo,\n\tisActive,\n\tisMainMedia,\n\tchildren,\n\tisClosed,\n\tsetIsClosed,\n\tshouldPauseOutOfView,\n}: Props): JSX.Element => {\n\tconst [isSticky, setIsSticky] = useState<boolean>(false);\n\tconst [stickEventSent, setStickEventSent] = useState<boolean>(false);\n\tconst [showOverlay, setShowOverlay] = useState<boolean>(isMobile);\n\tconst { renderingTarget } = useConfig();\n\n\tconst [isIntersecting, setRef] = useIsInView({\n\t\tthreshold: 0.5,\n\t\trepeat: true,\n\t\tdebounce: true,\n\t});\n\n\t/**\n\t * Click handler for the sticky video close button\n\t */\n\tconst handleCloseClick = () => {\n\t\t// unstick the video\n\t\tsetIsSticky(false);\n\t\t// reset the sticky event sender\n\t\tsetStickEventSent(false);\n\t\t// pause the video\n\t\tsetPauseVideo(true);\n\t\t// set isClosed so that player won't restick\n\t\tsetIsClosed(true);\n\n\t\t// log a 'close' event\n\t\tlog('dotcom', {\n\t\t\tfrom: `YoutubeAtom handleCloseClick`,\n\t\t\tvideoId,\n\t\t\tmsg: 'Close',\n\t\t});\n\n\t\t// submit a 'close' event to Ophan\n\t\tvoid submitComponentEvent(\n\t\t\t{\n\t\t\t\tcomponent: {\n\t\t\t\t\tcomponentType: 'STICKY_VIDEO',\n\t\t\t\t\tid: videoId,\n\t\t\t\t},\n\t\t\t\taction: 'CLOSE',\n\t\t\t},\n\t\t\trenderingTarget,\n\t\t);\n\t};\n\n\t/**\n\t * keydown event handler\n\t *\n\t * closes sticky video when Escape key is pressed\n\t */\n\tconst handleKeydown = (e: { key: string }) => {\n\t\tif (e.key === 'Escape') {\n\t\t\thandleCloseClick();\n\t\t}\n\t};\n\n\t/**\n\t * useEffect to create keydown listener\n\t */\n\tuseEffect(() => {\n\t\twindow.addEventListener('keydown', handleKeydown);\n\t\treturn () => window.removeEventListener('keydown', handleKeydown);\n\t});\n\n\t/**\n\t * useEffect for the sticky state\n\t */\n\tuseEffect(() => {\n\t\tif (shouldStick) setIsSticky(isActive && !isIntersecting && !isClosed);\n\t}, [isIntersecting, isActive, shouldStick, isClosed]);\n\n\t/**\n\t * useEffect for the pausing youtubeAtoms that are out of view\n\t */\n\tuseEffect(() => {\n\t\t// Sticky-ness should take precedence over pausing\n\t\tif (!shouldStick && shouldPauseOutOfView) {\n\t\t\tsetPauseVideo(isActive && !isIntersecting && !isClosed);\n\t\t}\n\t}, [\n\t\tisIntersecting,\n\t\tshouldStick,\n\t\tisActive,\n\t\tshouldPauseOutOfView,\n\t\tisClosed,\n\t\tsetPauseVideo,\n\t]);\n\n\t/**\n\t * useEffect for the stick events\n\t */\n\tuseEffect(() => {\n\t\tif (isSticky && !stickEventSent) {\n\t\t\tsetStickEventSent(true);\n\n\t\t\tlog('dotcom', {\n\t\t\t\tfrom: 'YoutubeAtom stick useEffect',\n\t\t\t\tvideoId,\n\t\t\t\tmsg: 'Stick',\n\t\t\t});\n\n\t\t\tvoid submitComponentEvent(\n\t\t\t\t{\n\t\t\t\t\tcomponent: {\n\t\t\t\t\t\tcomponentType: 'STICKY_VIDEO',\n\t\t\t\t\t\tid: videoId,\n\t\t\t\t\t},\n\t\t\t\t\taction: 'STICK',\n\t\t\t\t},\n\t\t\t\trenderingTarget,\n\t\t\t);\n\t\t}\n\t}, [isSticky, stickEventSent, videoId, eventEmitters, renderingTarget]);\n\n\t/**\n\t * useEffect for mobile only sticky overlay\n\t *\n\t * this allows mobile uses to tap to reveal the close button\n\t */\n\tuseEffect(() => {\n\t\tsetShowOverlay(isMobile && isSticky);\n\t}, [isSticky]);\n\n\tconst showCloseButton = !showOverlay && isMobile;\n\n\treturn (\n\t\t<div\n\t\t\tref={setRef}\n\t\t\tcss={isSticky && stickyContainerStyles(isMainMedia)}\n\t\t\tdata-testid={`youtube-sticky-${uniqueId}`}\n\t\t\tdata-is-sticky={isSticky}\n\t\t>\n\t\t\t<div css={isSticky && stickyStyles(showCloseButton)}>\n\t\t\t\t{children}\n\t\t\t\t{isSticky && (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<span\n\t\t\t\t\t\t\tcss={hoverAreaStyles(showOverlay)}\n\t\t\t\t\t\t\tonClick={() => setShowOverlay(false)}\n\t\t\t\t\t\t\tonKeyDown={() => setShowOverlay(false)}\n\t\t\t\t\t\t\trole=\"button\"\n\t\t\t\t\t\t\ttabIndex={0}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tcss={buttonStyles}\n\t\t\t\t\t\t\tonClick={handleCloseClick}\n\t\t\t\t\t\t\tdata-testid={`youtube-sticky-close-${uniqueId}`}\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<SvgCross size=\"medium\" />\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","import type { Participations } from '@guardian/ab-core';\nimport type { ConsentState } from '@guardian/libs';\nimport { useCallback, useState } from 'react';\nimport type { ArticleFormat } from '../../lib/articleFormat';\nimport type { AdTargeting } from '../../types/commercial';\nimport type { AspectRatio } from '../../types/front';\nimport type { RenderingTarget } from '../../types/renderingTarget';\nimport type {\n\tImagePositionType,\n\tImageSizeType,\n} from '../Card/components/ImageWrapper';\nimport { MaintainAspectRatio } from '../MaintainAspectRatio';\nimport type { VideoCategory } from './YoutubeAtomOverlay';\nimport { YoutubeAtomOverlay } from './YoutubeAtomOverlay';\nimport { YoutubeAtomPlaceholder } from './YoutubeAtomPlaceholder';\nimport { YoutubeAtomPlayer } from './YoutubeAtomPlayer';\nimport { YoutubeAtomSticky } from './YoutubeAtomSticky';\n\nexport type VideoEventKey =\n\t| 'play'\n\t| '25'\n\t| '50'\n\t| '75'\n\t| 'end'\n\t| 'skip'\n\t| 'cued'\n\t| 'resume'\n\t| 'pause';\n\nexport type Props = {\n\tatomId: string;\n\tvideoId: string;\n\tuniqueId: string;\n\toverrideImage?: string | undefined;\n\tposterImage?: string | undefined;\n\tadTargeting?: AdTargeting;\n\tconsentState?: ConsentState;\n\theight?: number;\n\twidth?: number;\n\ttitle?: string;\n\talt: string;\n\tduration?: number; // in seconds\n\torigin?: string;\n\teventEmitters: Array<(event: VideoEventKey) => void>;\n\tformat: ArticleFormat;\n\tshouldStick?: boolean;\n\tisMainMedia?: boolean;\n\tabTestParticipations: Participations;\n\tvideoCategory?: VideoCategory;\n\tkicker?: string;\n\tshouldPauseOutOfView?: boolean;\n\tshowTextOverlay?: boolean;\n\timageSize: ImageSizeType;\n\timagePositionOnMobile: ImagePositionType;\n\trenderingTarget: RenderingTarget;\n\taspectRatio?: AspectRatio;\n};\n\nexport const YoutubeAtom = ({\n\tatomId,\n\tvideoId,\n\tuniqueId,\n\toverrideImage,\n\tposterImage,\n\tadTargeting,\n\tconsentState,\n\theight = 259,\n\twidth = 460,\n\talt,\n\ttitle,\n\tduration,\n\torigin,\n\teventEmitters,\n\tshouldStick,\n\tisMainMedia,\n\tabTestParticipations,\n\tvideoCategory,\n\tkicker,\n\tformat,\n\tshouldPauseOutOfView = false,\n\tshowTextOverlay = false,\n\timageSize,\n\timagePositionOnMobile,\n\trenderingTarget,\n\taspectRatio,\n}: Props): JSX.Element => {\n\tconst [overlayClicked, setOverlayClicked] = useState<boolean>(false);\n\tconst [playerReady, setPlayerReady] = useState<boolean>(false);\n\tconst [isActive, setIsActive] = useState<boolean>(false);\n\tconst [isClosed, setIsClosed] = useState<boolean>(false);\n\tconst [pauseVideo, setPauseVideo] = useState<boolean>(false);\n\n\t/**\n\t * Consent and ad targeting are initially undefined and set by subsequent re-renders\n\t */\n\tconst adTargetingEnabled =\n\t\t!!adTargeting &&\n\t\t!adTargeting.disableAds &&\n\t\t!!consentState &&\n\t\tconsentState.canTarget;\n\n\t/**\n\t * Update the isActive state based on video events\n\t *\n\t * @param {VideoEventKey} videoEvent the video event which triggers the callback\n\t */\n\tconst playerState = (videoEvent: VideoEventKey) => {\n\t\tswitch (videoEvent) {\n\t\t\tcase 'play':\n\t\t\tcase 'resume':\n\t\t\t\tsetPauseVideo(false);\n\t\t\t\tsetIsClosed(false);\n\t\t\t\tsetIsActive(true);\n\t\t\t\tbreak;\n\t\t\tcase 'end':\n\t\t\tcase 'cued':\n\t\t\t\tsetIsActive(false);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t};\n\n\t/**\n\t * Combine the videoState and tracking event emitters\n\t */\n\tconst compositeEventEmitters = [playerState, ...eventEmitters];\n\n\t/**\n\t * The loading sequence of the YoutubeAtom is as follows:\n\t *\n\t * Overlay -> Placeholder -> Player\n\t *\n\t * In detail:\n\t *\n\t * 1. Initially show the overlay if it exists\n\t * 2. When the overlay is clicked\n\t *     2.1 Remove the overlay\n\t *     2.2 Show the placeholder until the player is ready\n\t * 3. When consent and ad targeting is available render the player to initiate loading of the YouTube player\n\t * 4. When the player is ready the placeholder is removed and the YouTube player is shown\n\t */\n\n\tconst hasOverlay = !!(overrideImage ?? posterImage);\n\n\t/**\n\t * Show an overlay if:\n\t *\n\t * - It exists\n\t *\n\t * AND\n\t *\n\t * - It hasn't been clicked\n\t */\n\tconst showOverlay = hasOverlay && !overlayClicked;\n\n\t/**\n\t * Show a placeholder if:\n\t *\n\t * - We don't have an overlay OR the user has clicked the overlay\n\t *\n\t * AND\n\t *\n\t * - The player is not ready\n\t */\n\tconst showPlaceholder = (!hasOverlay || overlayClicked) && !playerReady;\n\n\tlet loadPlayer;\n\tif (!hasOverlay) {\n\t\t// load the player if there is no overlay\n\t\tloadPlayer = true;\n\t} else if (overlayClicked) {\n\t\t// load the player if the overlay has been clicked\n\t\tloadPlayer = true;\n\t} else {\n\t\tloadPlayer = false;\n\t}\n\n\t/**\n\t * Create a stable callback as it will be a useEffect dependency in YoutubeAtomPlayer\n\t */\n\tconst playerReadyCallback = useCallback(() => setPlayerReady(true), []);\n\n\treturn (\n\t\t<div\n\t\t\tdata-component=\"youtube-atom\"\n\t\t\tdata-atom-id={atomId}\n\t\t\tdata-video-id={videoId}\n\t\t\tdata-video-unique-id={uniqueId}\n\t\t>\n\t\t\t<YoutubeAtomSticky\n\t\t\t\tuniqueId={uniqueId}\n\t\t\t\tvideoId={videoId}\n\t\t\t\tshouldStick={shouldStick}\n\t\t\t\tisActive={isActive}\n\t\t\t\teventEmitters={eventEmitters}\n\t\t\t\tsetPauseVideo={setPauseVideo}\n\t\t\t\tisMainMedia={isMainMedia}\n\t\t\t\tisClosed={isClosed}\n\t\t\t\tsetIsClosed={setIsClosed}\n\t\t\t\tshouldPauseOutOfView={shouldPauseOutOfView}\n\t\t\t>\n\t\t\t\t<MaintainAspectRatio\n\t\t\t\t\theight={height}\n\t\t\t\t\twidth={width}\n\t\t\t\t\taspectRatio={aspectRatio}\n\t\t\t\t>\n\t\t\t\t\t{\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * Consent and ad targeting are initially undefined and set by subsequent re-renders\n\t\t\t\t\t\t * Wait until they are defined before rendering the player\n\t\t\t\t\t\t */\n\t\t\t\t\t\tloadPlayer && consentState && adTargeting && (\n\t\t\t\t\t\t\t<YoutubeAtomPlayer\n\t\t\t\t\t\t\t\tvideoId={videoId}\n\t\t\t\t\t\t\t\tuniqueId={uniqueId}\n\t\t\t\t\t\t\t\theight={height}\n\t\t\t\t\t\t\t\twidth={width}\n\t\t\t\t\t\t\t\ttitle={title}\n\t\t\t\t\t\t\t\torigin={origin}\n\t\t\t\t\t\t\t\teventEmitters={compositeEventEmitters}\n\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t * If there is an overlay we want to autoplay\n\t\t\t\t\t\t\t\t * If there isn't an overlay the user will use the YouTube player UI to play\n\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\tautoPlay={hasOverlay}\n\t\t\t\t\t\t\t\tonReady={playerReadyCallback}\n\t\t\t\t\t\t\t\tpauseVideo={pauseVideo}\n\t\t\t\t\t\t\t\tdeactivateVideo={() => {\n\t\t\t\t\t\t\t\t\tsetIsActive(false);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tenableAds={adTargetingEnabled}\n\t\t\t\t\t\t\t\tadTargeting={adTargeting}\n\t\t\t\t\t\t\t\tconsentState={consentState}\n\t\t\t\t\t\t\t\tabTestParticipations={abTestParticipations}\n\t\t\t\t\t\t\t\trenderingTarget={renderingTarget}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t\t{showOverlay && (\n\t\t\t\t\t\t<YoutubeAtomOverlay\n\t\t\t\t\t\t\tuniqueId={uniqueId}\n\t\t\t\t\t\t\toverrideImage={overrideImage}\n\t\t\t\t\t\t\tposterImage={posterImage}\n\t\t\t\t\t\t\theight={height}\n\t\t\t\t\t\t\twidth={width}\n\t\t\t\t\t\t\talt={alt}\n\t\t\t\t\t\t\tduration={duration}\n\t\t\t\t\t\t\ttitle={title}\n\t\t\t\t\t\t\tonClick={() => setOverlayClicked(true)}\n\t\t\t\t\t\t\tvideoCategory={videoCategory}\n\t\t\t\t\t\t\tkicker={kicker}\n\t\t\t\t\t\t\tformat={format}\n\t\t\t\t\t\t\tshowTextOverlay={showTextOverlay}\n\t\t\t\t\t\t\timageSize={imageSize}\n\t\t\t\t\t\t\timagePositionOnMobile={imagePositionOnMobile}\n\t\t\t\t\t\t\taspectRatio={aspectRatio}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\t\t\t\t\t{showPlaceholder && (\n\t\t\t\t\t\t<YoutubeAtomPlaceholder uniqueId={uniqueId} />\n\t\t\t\t\t)}\n\t\t\t\t</MaintainAspectRatio>\n\t\t\t</YoutubeAtomSticky>\n\t\t</div>\n\t);\n};\n","import { css } from '@emotion/react';\nimport { palette, space, textEgyptian17 } from '@guardian/source/foundations';\nimport { SvgAlertRound } from '@guardian/source/react-components';\nimport type { ArticleFormat } from '../../lib/articleFormat';\nimport { Caption } from '../Caption';\n\ntype Props = {\n\tformat: ArticleFormat;\n\thideCaption?: boolean;\n\tisMainMedia?: boolean;\n\tmediaTitle?: string;\n\toverrideImage?: string;\n};\n\nconst expiredOverlayStyles = (overrideImage?: string) =>\n\toverrideImage\n\t\t? css`\n\t\t\t\theight: 0px;\n\t\t\t\tposition: relative;\n\t\t\t\tbackground-image: url(${overrideImage});\n\t\t\t\tbackground-size: cover;\n\t\t\t\tbackground-position: 49% 49%;\n\t\t\t\tbackground-repeat: no-repeat;\n\t\t\t\tpadding-bottom: 56%;\n\t\t\t\tcolor: ${palette.neutral[100]};\n\t\t\t\tbackground-color: ${palette.neutral[20]};\n\t\t  `\n\t\t: undefined;\n\nconst expiredTextWrapperStyles = css`\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n\n\tpadding-top: ${space[4]}px;\n\tpadding-bottom: ${space[4]}px;\n\tpadding-left: ${space[1]}px;\n\tpadding-right: ${space[12]}px;\n\tcolor: ${palette.neutral[100]};\n\tbackground-color: ${palette.neutral[20]};\n`;\n\nconst expiredSVGWrapperStyles = css`\n\tpadding-right: ${space[1]}px;\n\tsvg {\n\t\twidth: ${space[12]}px;\n\t\theight: ${space[12]}px;\n\t\tfill: ${palette.neutral[100]};\n\t}\n`;\n\nexport const YoutubeAtomExpiredOverlay = ({\n\tformat,\n\thideCaption,\n\tisMainMedia,\n\tmediaTitle,\n\toverrideImage,\n}: Props) => {\n\treturn (\n\t\t<figure\n\t\t\tcss={css`\n\t\t\t\tmargin-top: 16px;\n\t\t\t\tmargin-bottom: 16px;\n\t\t\t`}\n\t\t>\n\t\t\t<div css={expiredOverlayStyles(overrideImage)}>\n\t\t\t\t<div css={expiredTextWrapperStyles}>\n\t\t\t\t\t<div css={expiredSVGWrapperStyles}>\n\t\t\t\t\t\t<SvgAlertRound />\n\t\t\t\t\t</div>\n\t\t\t\t\t<p\n\t\t\t\t\t\tcss={css`\n\t\t\t\t\t\t\t${textEgyptian17}\n\t\t\t\t\t\t\tline-height: 1.15;\n\t\t\t\t\t\t`}\n\t\t\t\t\t>\n\t\t\t\t\t\tThis video has been removed. This could be because it\n\t\t\t\t\t\tlaunched early, our rights have expired, there was a\n\t\t\t\t\t\tlegal issue, or for another reason.\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t{!hideCaption && (\n\t\t\t\t<Caption\n\t\t\t\t\tcaptionText={mediaTitle ?? ''}\n\t\t\t\t\tformat={format}\n\t\t\t\t\tdisplayCredit={false}\n\t\t\t\t\tmediaType=\"Video\"\n\t\t\t\t\tisMainMedia={isMainMedia}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</figure>\n\t);\n};\n","import type { ConsentState } from '@guardian/libs';\nimport { useEffect, useState } from 'react';\nimport type { ArticleFormat } from '../lib/articleFormat';\nimport { useAB } from '../lib/useAB';\nimport { useAdTargeting } from '../lib/useAdTargeting';\nimport type { AdTargeting } from '../types/commercial';\nimport type { AspectRatio } from '../types/front';\nimport { Caption } from './Caption';\nimport type {\n\tImagePositionType,\n\tImageSizeType,\n} from './Card/components/ImageWrapper';\nimport { useConfig } from './ConfigContext';\nimport { ophanTrackerApps, ophanTrackerWeb } from './YoutubeAtom/eventEmitters';\nimport { YoutubeAtom } from './YoutubeAtom/YoutubeAtom';\nimport { YoutubeAtomExpiredOverlay } from './YoutubeAtom/YoutubeAtomExpiredOverlay';\n\ntype Props = {\n\tid: string;\n\tassetId: string;\n\tindex: number;\n\tmediaTitle?: string;\n\taltText?: string;\n\texpired: boolean;\n\tformat: ArticleFormat;\n\thideCaption?: boolean;\n\toverrideImage?: string;\n\tposterImage?: {\n\t\turl: string;\n\t\twidth: number;\n\t}[];\n\tisMainMedia?: boolean;\n\theight?: number;\n\twidth?: number;\n\tduration?: number; // in seconds\n\torigin?: string;\n\tstickyVideos: boolean;\n\tkickerText?: string;\n\tpauseOffscreenVideo?: boolean;\n\tshowTextOverlay?: boolean;\n\t// If the youtube block component is used on a card, we can pass in the image size and position on mobile to get the correct styling for the play icon. If it's not used on a card, we can just pass default values to get the standard large play icon.\n\timageSize?: ImageSizeType;\n\timagePositionOnMobile?: ImagePositionType;\n\tenableAds: boolean;\n\taspectRatio?: AspectRatio;\n};\n\n/**\n * We do our own image optimization in DCR and only need 1 image. Pick the largest image available to\n * us to avoid up-scaling later.\n *\n * @param images an array of the same image at different resolutions\n * @returns largest image from images\n */\nconst getLargestImageSize = (\n\timages: {\n\t\turl: string;\n\t\twidth: number;\n\t}[],\n) => [...images].sort((a, b) => a.width - b.width).pop();\n\nconst adTargetingDisabled: AdTargeting = { disableAds: true };\n\nexport const YoutubeBlockComponent = ({\n\tid,\n\tassetId,\n\tindex,\n\tmediaTitle,\n\taltText,\n\tformat,\n\thideCaption,\n\toverrideImage,\n\tposterImage = [],\n\texpired,\n\tisMainMedia,\n\theight = 259,\n\twidth = 460,\n\tduration,\n\torigin,\n\tstickyVideos,\n\tkickerText,\n\tpauseOffscreenVideo = false,\n\tshowTextOverlay,\n\timageSize = 'large',\n\timagePositionOnMobile = 'none',\n\tenableAds,\n\taspectRatio,\n}: Props) => {\n\tconst [consentState, setConsentState] = useState<ConsentState | undefined>(\n\t\tundefined,\n\t);\n\n\tconst adTargeting = useAdTargeting(duration);\n\tconst { renderingTarget } = useConfig();\n\n\tconst abTests = useAB();\n\tconst abTestParticipations = abTests?.participations ?? {};\n\n\t/**\n\t * It's possible to have duplicate video atoms on the same page\n\t * For example liveblogs can have the same video for the main media and in a subsequent block\n\t * We need to ensure a unique id for each YouTube player on the page.\n\t */\n\tconst uniqueId = `${assetId}-${index}`;\n\n\tuseEffect(() => {\n\t\tif (renderingTarget === 'Web') {\n\t\t\tconst defineConsentState = async () => {\n\t\t\t\tconst { onConsentChange } = await import('@guardian/libs');\n\t\t\t\tonConsentChange((newConsent: ConsentState) => {\n\t\t\t\t\tsetConsentState(newConsent);\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tdefineConsentState().catch((error) => {\n\t\t\t\twindow.guardian.modules.sentry.reportError(\n\t\t\t\t\terror instanceof Error\n\t\t\t\t\t\t? error\n\t\t\t\t\t\t: new Error(`Error: unknown`),\n\t\t\t\t\t'youtube-consent',\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t\tif (renderingTarget === 'Apps') {\n\t\t\t// set the minimum unconsented state for apps\n\t\t\tsetConsentState({\n\t\t\t\tcanTarget: false,\n\t\t\t\tframework: 'tcfv2',\n\t\t\t});\n\t\t}\n\t}, [renderingTarget]);\n\n\tif (expired) {\n\t\treturn (\n\t\t\t<YoutubeAtomExpiredOverlay\n\t\t\t\tformat={format}\n\t\t\t\thideCaption={hideCaption}\n\t\t\t\tisMainMedia={isMainMedia}\n\t\t\t\tmediaTitle={mediaTitle}\n\t\t\t\toverrideImage={overrideImage}\n\t\t\t/>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div data-chromatic=\"ignore\">\n\t\t\t<YoutubeAtom\n\t\t\t\tatomId={id}\n\t\t\t\tvideoId={assetId}\n\t\t\t\tuniqueId={uniqueId}\n\t\t\t\toverrideImage={overrideImage}\n\t\t\t\tposterImage={getLargestImageSize(posterImage)?.url}\n\t\t\t\talt={altText ?? mediaTitle ?? ''}\n\t\t\t\tadTargeting={\n\t\t\t\t\tenableAds && renderingTarget === 'Web'\n\t\t\t\t\t\t? adTargeting\n\t\t\t\t\t\t: adTargetingDisabled\n\t\t\t\t}\n\t\t\t\tconsentState={consentState}\n\t\t\t\theight={height}\n\t\t\t\twidth={width}\n\t\t\t\ttitle={mediaTitle}\n\t\t\t\tduration={duration}\n\t\t\t\teventEmitters={\n\t\t\t\t\trenderingTarget === 'Web'\n\t\t\t\t\t\t? [ophanTrackerWeb(id)]\n\t\t\t\t\t\t: [ophanTrackerApps(id)]\n\t\t\t\t}\n\t\t\t\tformat={format}\n\t\t\t\torigin={process.env.NODE_ENV === 'development' ? '' : origin}\n\t\t\t\tshouldStick={renderingTarget === 'Web' ? stickyVideos : false}\n\t\t\t\tisMainMedia={isMainMedia}\n\t\t\t\tabTestParticipations={abTestParticipations}\n\t\t\t\tkicker={kickerText}\n\t\t\t\tshouldPauseOutOfView={pauseOffscreenVideo}\n\t\t\t\tshowTextOverlay={showTextOverlay}\n\t\t\t\timageSize={imageSize}\n\t\t\t\timagePositionOnMobile={imagePositionOnMobile}\n\t\t\t\trenderingTarget={renderingTarget}\n\t\t\t\taspectRatio={aspectRatio}\n\t\t\t/>\n\t\t\t{!hideCaption && (\n\t\t\t\t<Caption\n\t\t\t\t\tcaptionText={mediaTitle ?? ''}\n\t\t\t\t\tformat={format}\n\t\t\t\t\tdisplayCredit={false}\n\t\t\t\t\tmediaType=\"Video\"\n\t\t\t\t\tisMainMedia={isMainMedia}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n","import type {\n\tInt64,\n\tIThriftField,\n\tIThriftList,\n\tIThriftMap,\n\tIThriftMessage,\n\tIThriftSet,\n\tIThriftStruct,\n\tTTransport,\n\tTType,\n} from '@creditkarma/thrift-server-core';\nimport { MessageType, TProtocol } from '@creditkarma/thrift-server-core';\n\nexport abstract class TProtocolDecorator extends TProtocol {\n\tprivate concreteProtocol: TProtocol;\n\n\tconstructor(protocol: TProtocol) {\n\t\tsuper(protocol.getTransport());\n\t\tthis.concreteProtocol = protocol;\n\t}\n\n\tgetTransport(): TTransport {\n\t\treturn this.concreteProtocol.getTransport();\n\t}\n\tflush(): Buffer {\n\t\treturn this.concreteProtocol.flush();\n\t}\n\twriteMessageBegin(name: string, type: MessageType, seqid: number): void {\n\t\treturn this.concreteProtocol.writeMessageBegin(name, type, seqid);\n\t}\n\twriteMessageEnd(): void {\n\t\treturn this.concreteProtocol.writeMessageEnd();\n\t}\n\twriteStructBegin(name: string): void {\n\t\treturn this.concreteProtocol.writeStructBegin(name);\n\t}\n\twriteStructEnd(): void {\n\t\treturn this.concreteProtocol.writeStructEnd();\n\t}\n\twriteFieldBegin(name: string, type: TType, id: number): void {\n\t\treturn this.concreteProtocol.writeFieldBegin(name, type, id);\n\t}\n\twriteFieldEnd(): void {\n\t\treturn this.concreteProtocol.writeFieldEnd();\n\t}\n\twriteFieldStop(): void {\n\t\treturn this.concreteProtocol.writeFieldStop();\n\t}\n\twriteMapBegin(keyType: TType, valueType: TType, size: number): void {\n\t\treturn this.concreteProtocol.writeMapBegin(keyType, valueType, size);\n\t}\n\twriteMapEnd(): void {\n\t\treturn this.concreteProtocol.writeMapEnd();\n\t}\n\twriteListBegin(elementType: TType, size: number): void {\n\t\treturn this.concreteProtocol.writeListBegin(elementType, size);\n\t}\n\twriteListEnd(): void {\n\t\treturn this.concreteProtocol.writeListEnd();\n\t}\n\twriteSetBegin(elementType: TType, size: number): void {\n\t\treturn this.concreteProtocol.writeSetBegin(elementType, size);\n\t}\n\twriteSetEnd(): void {\n\t\treturn this.concreteProtocol.writeSetEnd();\n\t}\n\twriteBool(bool: boolean): void {\n\t\treturn this.concreteProtocol.writeBool(bool);\n\t}\n\twriteByte(b: number): void {\n\t\treturn this.concreteProtocol.writeByte(b);\n\t}\n\twriteI16(i16: number): void {\n\t\treturn this.concreteProtocol.writeI16(i16);\n\t}\n\twriteI32(i32: number): void {\n\t\treturn this.concreteProtocol.writeI32(i32);\n\t}\n\twriteI64(i64: number | Int64): void {\n\t\treturn this.concreteProtocol.writeI64(i64);\n\t}\n\twriteDouble(dbl: number): void {\n\t\treturn this.concreteProtocol.writeDouble(dbl);\n\t}\n\twriteString(arg: string): void {\n\t\treturn this.concreteProtocol.writeString(arg);\n\t}\n\twriteBinary(arg: string | Buffer): void {\n\t\treturn this.concreteProtocol.writeBinary(arg);\n\t}\n\treadMessageBegin(): IThriftMessage {\n\t\treturn this.concreteProtocol.readMessageBegin();\n\t}\n\treadMessageEnd(): void {\n\t\treturn this.concreteProtocol.readMessageEnd();\n\t}\n\treadStructBegin(): IThriftStruct {\n\t\treturn this.concreteProtocol.readStructBegin();\n\t}\n\treadStructEnd(): void {\n\t\treturn this.concreteProtocol.readStructEnd();\n\t}\n\treadFieldBegin(): IThriftField {\n\t\treturn this.concreteProtocol.readFieldBegin();\n\t}\n\treadFieldEnd(): void {\n\t\treturn this.concreteProtocol.readFieldEnd();\n\t}\n\treadMapBegin(): IThriftMap {\n\t\treturn this.concreteProtocol.readMapBegin();\n\t}\n\treadMapEnd(): void {\n\t\treturn this.concreteProtocol.readMapEnd();\n\t}\n\treadListBegin(): IThriftList {\n\t\treturn this.concreteProtocol.readListBegin();\n\t}\n\treadListEnd(): void {\n\t\treturn this.concreteProtocol.readListEnd();\n\t}\n\treadSetBegin(): IThriftSet {\n\t\treturn this.concreteProtocol.readSetBegin();\n\t}\n\treadSetEnd(): void {\n\t\treturn this.concreteProtocol.readSetEnd();\n\t}\n\treadBool(): boolean {\n\t\treturn this.concreteProtocol.readBool();\n\t}\n\treadByte(): number {\n\t\treturn this.concreteProtocol.readByte();\n\t}\n\treadI16(): number {\n\t\treturn this.concreteProtocol.readI16();\n\t}\n\treadI32(): number {\n\t\treturn this.concreteProtocol.readI32();\n\t}\n\treadI64(): Int64 {\n\t\treturn this.concreteProtocol.readI64();\n\t}\n\treadDouble(): number {\n\t\treturn this.concreteProtocol.readDouble();\n\t}\n\treadBinary(): Buffer {\n\t\treturn this.concreteProtocol.readBinary();\n\t}\n\treadString(): string {\n\t\treturn this.concreteProtocol.readString();\n\t}\n\tskip(type: TType): void {\n\t\treturn this.concreteProtocol.skip(type);\n\t}\n}\n\nexport class TMultiplexedProtocol extends TProtocolDecorator {\n\tstatic readonly separator = ':';\n\treadonly serviceName: string;\n\n\tconstructor(protocol: TProtocol, serviceName: string) {\n\t\tsuper(protocol);\n\t\tthis.serviceName = serviceName;\n\t}\n\n\twriteMessageBegin(name: string, type: MessageType, seqid: number): void {\n\t\tif (type === MessageType.CALL || type === MessageType.ONEWAY) {\n\t\t\tsuper.writeMessageBegin(\n\t\t\t\tthis.serviceName + TMultiplexedProtocol.separator + name,\n\t\t\t\ttype,\n\t\t\t\tseqid,\n\t\t\t);\n\t\t} else {\n\t\t\tsuper.writeMessageBegin(name, type, seqid);\n\t\t}\n\t}\n}\n","import type {\n\tIClientConstructor,\n\tIProtocolConstructor,\n\tITransportConstructor,\n\tProtocolType,\n\tThriftClient,\n\tTransportType,\n\tTTransport,\n} from '@creditkarma/thrift-server-core';\nimport {\n\tgetProtocol,\n\tgetTransport,\n\tTApplicationException,\n\tTApplicationExceptionType,\n\tThriftConnection,\n} from '@creditkarma/thrift-server-core';\nimport { TMultiplexedProtocol } from './protocols';\n\ndeclare global {\n\tinterface Window {\n\t\tnativeConnections?: Record<string, NativeConnection>;\n\t\tandroid?: {\n\t\t\tpostMessage: (data: string, connectionId: string) => void;\n\t\t};\n\t\twebkit?: {\n\t\t\tmessageHandlers: {\n\t\t\t\tiOSWebViewMessage: {\n\t\t\t\t\tpostMessage: (nativeMessage: NativeMessage) => void;\n\t\t\t\t};\n\t\t\t};\n\t\t};\n\t}\n}\n\nexport interface NativeMessage {\n\tdata: string;\n\tconnectionId: string;\n}\n\ninterface PromiseResponse {\n\tresolve: (response: Buffer) => void;\n\treject: (error: Error) => void;\n\ttimeoutId: NodeJS.Timeout;\n}\n\nconst ACTION_TIMEOUT_MS = 30000;\n\nfunction sendNativeMessage(nativeMessage: NativeMessage): void {\n\tif (window.android) {\n\t\twindow.android.postMessage(\n\t\t\tnativeMessage.data,\n\t\t\tnativeMessage.connectionId,\n\t\t);\n\t} else if (window.webkit) {\n\t\twindow.webkit.messageHandlers.iOSWebViewMessage.postMessage(\n\t\t\tnativeMessage,\n\t\t);\n\t} else {\n\t\tconsole.warn('No native APIs available');\n\t}\n}\n\nlet uid = 1;\nconst getUniqueConnectionId = () => `connection-${uid++}`;\n\nexport class NativeConnection extends ThriftConnection {\n\tconnectionId = getUniqueConnectionId();\n\tpromises: PromiseResponse[] = [];\n\toutBuffer: NativeMessage[] = [];\n\n\tconstructor(\n\t\tTransport: ITransportConstructor,\n\t\tProtocol: IProtocolConstructor,\n\t) {\n\t\tsuper(Transport, Protocol);\n\t\tif (typeof window !== 'undefined') {\n\t\t\twindow.nativeConnections = window.nativeConnections ?? {};\n\t\t\twindow.nativeConnections[this.connectionId] = this;\n\t\t}\n\t}\n\n\treset(oldConnectionId: string): void {\n\t\tif (oldConnectionId === this.connectionId && window.nativeConnections) {\n\t\t\tconsole.warn('Reseting connection ' + oldConnectionId);\n\t\t\tdelete window.nativeConnections[this.connectionId];\n\t\t\tfor (const promise of this.promises) {\n\t\t\t\tpromise.reject(\n\t\t\t\t\tnew TApplicationException(\n\t\t\t\t\t\tTApplicationExceptionType.UNKNOWN,\n\t\t\t\t\t\t'Timeout error',\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\t\t\tthis.promises = [];\n\t\t\tthis.connectionId = getUniqueConnectionId();\n\t\t\twindow.nativeConnections[this.connectionId] = this;\n\t\t}\n\t}\n\n\treceive(message: NativeMessage): void {\n\t\tconst resolver = this.promises.shift();\n\t\tif (resolver) {\n\t\t\tclearTimeout(resolver.timeoutId);\n\t\t\tconst data = Buffer.from(message.data, 'base64');\n\t\t\tresolver.resolve(data);\n\t\t}\n\t\tthis.sendNextMessage();\n\t}\n\n\tprivate sendNextMessage(): void {\n\t\tconst message = this.outBuffer.shift();\n\t\tif (message) {\n\t\t\tconsole.log('Sending next message');\n\t\t\tsendNativeMessage(message);\n\t\t}\n\t}\n\n\tsend(dataToSend: Buffer): Promise<Buffer> {\n\t\tconst id = this.connectionId;\n\t\t// eslint-disable-next-line @typescript-eslint/no-this-alias -- Reassign this\n\t\tconst connection = this;\n\t\treturn new Promise<Buffer>(function (res, rej): void {\n\t\t\tconnection.promises.push({\n\t\t\t\tresolve: res,\n\t\t\t\treject: rej,\n\t\t\t\ttimeoutId: setTimeout(function () {\n\t\t\t\t\tconnection.reset(id);\n\t\t\t\t}, ACTION_TIMEOUT_MS),\n\t\t\t});\n\t\t\tconst message: NativeMessage = {\n\t\t\t\tdata: dataToSend.toString('base64'),\n\t\t\t\tconnectionId: id,\n\t\t\t};\n\t\t\tif (connection.promises.length === 1) {\n\t\t\t\tconsole.log('Sending message immediately');\n\t\t\t\tsendNativeMessage(message);\n\t\t\t} else {\n\t\t\t\tconsole.log('Queing message because others in flight');\n\t\t\t\tconnection.outBuffer.push(message);\n\t\t\t}\n\t\t});\n\t}\n}\n\nexport function createAppClient<TClient extends ThriftClient<void>>(\n\tServiceClient: IClientConstructor<TClient, void>,\n\ttransport: TransportType = 'buffered',\n\tprotocol: ProtocolType = 'compact',\n): TClient {\n\tclass NamedMultiplexedProtocol extends TMultiplexedProtocol {\n\t\tconstructor(tTransport: TTransport) {\n\t\t\tconst Protocol = getProtocol(protocol);\n\t\t\tsuper(new Protocol(tTransport), ServiceClient.serviceName ?? '');\n\t\t}\n\t}\n\tconst connection = new NativeConnection(\n\t\tgetTransport(transport),\n\t\tNamedMultiplexedProtocol,\n\t);\n\treturn new ServiceClient(connection);\n}\n","import * as Acquisitions from '@guardian/bridget/Acquisitions';\nimport * as Analytics from '@guardian/bridget/Analytics';\nimport * as Commercial from '@guardian/bridget/Commercial';\nimport * as Discussion from '@guardian/bridget/Discussion';\nimport * as Environment from '@guardian/bridget/Environment';\nimport * as Gallery from '@guardian/bridget/Gallery';\nimport * as Interaction from '@guardian/bridget/Interaction';\nimport * as Metrics from '@guardian/bridget/Metrics';\nimport * as Navigation from '@guardian/bridget/Navigation';\nimport * as Newsletters from '@guardian/bridget/Newsletters';\nimport * as Notifications from '@guardian/bridget/Notifications';\nimport * as Tag from '@guardian/bridget/Tag';\nimport * as User from '@guardian/bridget/User';\nimport * as Video from '@guardian/bridget/Videos';\nimport { isUndefined } from '@guardian/libs';\nimport { createAppClient } from './thrift/nativeConnection';\n\nlet environmentClient: Environment.Client<void> | undefined = undefined;\nexport const getEnvironmentClient = (): Environment.Client<void> => {\n\tif (isUndefined(environmentClient)) {\n\t\tenvironmentClient = createAppClient<Environment.Client<void>>(\n\t\t\tEnvironment.Client,\n\t\t\t'buffered',\n\t\t\t'compact',\n\t\t);\n\t}\n\treturn environmentClient;\n};\n\nlet commercialClient: Commercial.Client<void> | undefined = undefined;\nexport const getCommercialClient = (): Commercial.Client<void> => {\n\tif (isUndefined(commercialClient)) {\n\t\tcommercialClient = createAppClient<Commercial.Client<void>>(\n\t\t\tCommercial.Client,\n\t\t\t'buffered',\n\t\t\t'compact',\n\t\t);\n\t}\n\treturn commercialClient;\n};\n\nlet acquisitionsClient: Acquisitions.Client<void> | undefined = undefined;\nexport const getAcquisitionsClient = (): Acquisitions.Client<void> => {\n\tif (!acquisitionsClient) {\n\t\tacquisitionsClient = createAppClient<Acquisitions.Client<void>>(\n\t\t\tAcquisitions.Client,\n\t\t\t'buffered',\n\t\t\t'compact',\n\t\t);\n\t}\n\treturn acquisitionsClient;\n};\n\nlet notificationsClient: Notifications.Client<void> | undefined = undefined;\nexport const getNotificationsClient = (): Notifications.Client<void> => {\n\tif (!notificationsClient) {\n\t\tnotificationsClient = createAppClient<Notifications.Client<void>>(\n\t\t\tNotifications.Client,\n\t\t\t'buffered',\n\t\t\t'compact',\n\t\t);\n\t}\n\treturn notificationsClient;\n};\n\nlet tagClient: Tag.Client<void> | undefined = undefined;\nexport const getTagClient = (): Tag.Client<void> => {\n\tif (!tagClient) {\n\t\ttagClient = createAppClient<Tag.Client<void>>(\n\t\t\tTag.Client,\n\t\t\t'buffered',\n\t\t\t'compact',\n\t\t);\n\t}\n\treturn tagClient;\n};\n\nlet userClient: User.Client<void> | undefined = undefined;\nexport const getUserClient = (): User.Client<void> => {\n\tif (!userClient) {\n\t\tuserClient = createAppClient<User.Client<void>>(\n\t\t\tUser.Client,\n\t\t\t'buffered',\n\t\t\t'compact',\n\t\t);\n\t}\n\treturn userClient;\n};\nlet galleryClient: Gallery.Client<void> | undefined = undefined;\nexport const getGalleryClient = (): Gallery.Client<void> => {\n\tif (!galleryClient) {\n\t\tgalleryClient = createAppClient<Gallery.Client<void>>(\n\t\t\tGallery.Client,\n\t\t\t'buffered',\n\t\t\t'compact',\n\t\t);\n\t}\n\treturn galleryClient;\n};\nlet videoClient: Video.Client<void> | undefined = undefined;\nexport const getVideoClient = (): Video.Client<void> => {\n\tif (!videoClient) {\n\t\tvideoClient = createAppClient<Video.Client<void>>(\n\t\t\tVideo.Client,\n\t\t\t'buffered',\n\t\t\t'compact',\n\t\t);\n\t}\n\treturn videoClient;\n};\nlet metricsClient: Metrics.Client<void> | undefined = undefined;\nexport const getMetricsClient = (): Metrics.Client<void> => {\n\tif (!metricsClient) {\n\t\tmetricsClient = createAppClient<Metrics.Client<void>>(\n\t\t\tMetrics.Client,\n\t\t\t'buffered',\n\t\t\t'compact',\n\t\t);\n\t}\n\treturn metricsClient;\n};\nlet analyticsClient: Analytics.Client<void> | undefined = undefined;\nexport const getAnalyticsClient = (): Analytics.Client<void> => {\n\tif (!analyticsClient) {\n\t\tanalyticsClient = createAppClient<Analytics.Client<void>>(\n\t\t\tAnalytics.Client,\n\t\t\t'buffered',\n\t\t\t'compact',\n\t\t);\n\t}\n\treturn analyticsClient;\n};\n\nlet navigationClient: Navigation.Client<void> | undefined = undefined;\nexport const getNavigationClient = (): Navigation.Client<void> => {\n\tif (!navigationClient) {\n\t\tnavigationClient = createAppClient<Navigation.Client<void>>(\n\t\t\tNavigation.Client,\n\t\t\t'buffered',\n\t\t\t'compact',\n\t\t);\n\t}\n\treturn navigationClient;\n};\n\nlet newslettersClient: Newsletters.Client<void> | undefined = undefined;\nexport const getNewslettersClient = (): Newsletters.Client<void> => {\n\tif (!newslettersClient) {\n\t\tnewslettersClient = createAppClient<Newsletters.Client<void>>(\n\t\t\tNewsletters.Client,\n\t\t\t'buffered',\n\t\t\t'compact',\n\t\t);\n\t}\n\treturn newslettersClient;\n};\n\nlet discussionClient: Discussion.Client<void> | undefined = undefined;\nexport const getDiscussionClient = (): Discussion.Client<void> => {\n\tif (!discussionClient) {\n\t\tdiscussionClient = createAppClient<Discussion.Client<void>>(\n\t\t\tDiscussion.Client,\n\t\t\t'buffered',\n\t\t\t'compact',\n\t\t);\n\t}\n\treturn discussionClient;\n};\n\nlet interactionClient: Interaction.Client<void> | undefined = undefined;\nexport const getInteractionClient = (): Interaction.Client<void> => {\n\tif (!interactionClient) {\n\t\tinteractionClient = createAppClient<Interaction.Client<void>>(\n\t\t\tInteraction.Client,\n\t\t\t'buffered',\n\t\t\t'compact',\n\t\t);\n\t}\n\treturn interactionClient;\n};\n","/**\n * Temporary fix\n * =============\n *\n * Find the master URL for an image if has already been signed upstream.\n *\n * DCR can handle generating a signed image URL with `generateImageURL`,\n * so this method extracts source URLS from fully signed ones. _e.g.:_\n *\n * - from\n *   `https://i.guim.co.uk/img/media/c56c6217f8fa306d89320cc7915161203b5017b1/0_166_5000_3002/master/5000.jpg?width=300&quality=85&auto=format&fit=max&s=0d205d08639b4ad6e1b86758ab451abb`\n * \t to\n *   `https://media.guim.co.uk/img/media/c56c6217f8fa306d89320cc7915161203b5017b1/0_166_5000_3002/master/5000.jpg`\n *\n * - from\n *   `https://i.guim.co.uk/img/uploads/2017/10/06/George-Monbiot,-L.png?width=173&quality=85&auto=format&fit=max&s=be5b0d3f3aa55682e4930057fc3929a3`\n *   to\n *   `https://uploads.guim.co.uk/2017/10/06/George-Monbiot,-L.png`\n *\n * @deprecated Favour updating image paths sent from frontend to sources\n */\nexport const getSourceImageUrl = (source: string): string => {\n\tconst url = new URL(source);\n\n\tconst buckets = ['/img/media/', '/img/static/', '/img/uploads/'] as const;\n\tconst prefix = buckets.find((bucket) => url.pathname.startsWith(bucket));\n\n\tif (url.hostname === 'i.guim.co.uk' && prefix) {\n\t\tconst path = url.pathname.replace(prefix, '');\n\t\tswitch (prefix) {\n\t\t\tcase '/img/media/':\n\t\t\t\treturn `https://media.guim.co.uk/${path}`;\n\t\t\tcase '/img/static/':\n\t\t\t\treturn `https://static.guim.co.uk/${path}`;\n\t\t\tcase '/img/uploads/':\n\t\t\t\treturn `https://uploads.guim.co.uk/${path}`;\n\t\t}\n\t}\n\n\treturn source;\n};\n","import type { ABTestAPI, Participations } from '@guardian/ab-core';\nimport { mutate } from 'swr';\nimport useSWRImmutable from 'swr/immutable';\n\ntype ABTests = {\n\tapi: ABTestAPI;\n\tparticipations: Participations;\n};\n\nconst apiPromise = new Promise<ABTests>(() => {});\nconst key = 'ab-tests';\n\n/**\n * A hook which returns the AB Test Api when available,\n * or undefined otherwise.\n *\n * Leverages an immutable SWR to satisfy all requests to the\n * AB Core. As soon as the tests are available, all instances of\n * the useAB hook will render.\n */\nexport const useAB = (): ABTests | undefined => {\n\tconst { data } = useSWRImmutable(key, () => apiPromise);\n\treturn data;\n};\n\nexport const setABTests = ({ api, participations }: ABTests): void => {\n\tvoid mutate(key, { api, participations }, false);\n};\n","import { log } from '@guardian/libs';\nimport { mutate } from 'swr';\nimport useSWRImmutable from 'swr/immutable';\nimport type { AdTargeting } from '../types/commercial';\n\nconst key = 'ad-targeting';\nconst apiPromise = new Promise<AdTargeting>(() => {\n\t/* this never resolves */\n});\n\n/**\n * A hook which returns the Ad Targeting for a given page.\n *\n * @param videoLength allows overriding video length, when there are multiple videos on a page\n */\nexport const useAdTargeting = (\n\tvideoLength?: number,\n): AdTargeting | undefined => {\n\tconst { data } = useSWRImmutable(key, () => apiPromise);\n\n\tif (data && !data.disableAds && typeof videoLength === 'number') {\n\t\tdata.customParams['vl'] = videoLength;\n\t\tlog(\n\t\t\t'commercial',\n\t\t\t` Ad Targeting  video length (vl) overriden to ${videoLength}`,\n\t\t);\n\t}\n\n\treturn data;\n};\n\nexport const setAdTargeting = (adTargeting: AdTargeting): void => {\n\tvoid mutate(key, adTargeting, false);\n};\n","import libDebounce from 'lodash.debounce';\nimport { useCallback, useEffect, useRef, useState } from 'react';\n\n/**\n * This file was copied into the source development kitchen from the following repository:\n * https://github.com/guardian/csnx/blob/main/libs/%40guardian/source-development-kitchen/src/react-components/ticker/useIsInView.ts\n *\n * Note: This version of the file uses `lodash.debounce`, whereas the original version does not.\n * As a result, we now have two versions of the `useIsInView` hookone with `lodash.debounce` and one without.\n *\n * A discussion is needed to determine the best approach for consolidating these two versions into a single file.\n * Consider whether the use of `lodash.debounce` is necessary, and if so, integrate it into the consolidated version.\n */\n\ntype Options = {\n\t/**\n\t * Defaults to `undefined` (falsy),\n\t * which trigger a change the instantaneously.\n\t *\n\t * If `true`, debounce triggers by 200ms.\n\t * Enabling debouncing ensures the target element intersects\n\t * for at least 200ms before the callback is executed\n\t */\n\tdebounce?: true;\n\t/**\n\t * Defaults to `undefined` (falsy),\n\t * which only trigger on the first intersection.\n\t *\n\t * If `true`, trigger the hook on all intersections.\n\t */\n\trepeat?: true;\n\t/** Set the initial HTML Element, if known. */\n\tnode?: HTMLElement;\n};\n\n/**\n * Custom hook around the `IntersectionObserver`.\n *\n * @returns a tuple containing `[isInView, setNode]`\n */\nconst useIsInView = (\n\toptions: IntersectionObserverInit & Options,\n): [boolean, React.Dispatch<React.SetStateAction<HTMLElement | null>>] => {\n\tconst [isInView, setIsInView] = useState<boolean>(false);\n\tconst [node, setNode] = useState<HTMLElement | null>(options.node ?? null);\n\n\tconst observer = useRef<IntersectionObserver | null>(null);\n\n\tconst intersectionObserverCallback =\n\t\tuseCallback<IntersectionObserverCallback>(\n\t\t\t([entry]) => {\n\t\t\t\tif (!entry) return;\n\n\t\t\t\tif (entry.isIntersecting) {\n\t\t\t\t\tsetIsInView(true);\n\t\t\t\t} else if (options.repeat) {\n\t\t\t\t\tsetIsInView(false);\n\t\t\t\t}\n\t\t\t},\n\t\t\t[options.repeat],\n\t\t);\n\n\tconst intersectionCallback = options.debounce\n\t\t? libDebounce(intersectionObserverCallback, 200)\n\t\t: intersectionObserverCallback;\n\n\tuseEffect(() => {\n\t\toptions.node && setNode(options.node);\n\t}, [options.node]);\n\n\tuseEffect(() => {\n\t\tif (!node) return;\n\t\t// Check for browser support https://caniuse.com/intersectionobserver\n\t\tif (!('IntersectionObserver' in window)) return;\n\n\t\tobserver.current = new window.IntersectionObserver(\n\t\t\tintersectionCallback,\n\t\t\toptions,\n\t\t);\n\n\t\tobserver.current.observe(node);\n\n\t\treturn () => observer.current?.disconnect();\n\t}, [node, options, intersectionCallback]);\n\n\tuseEffect(() => {\n\t\tif (!options.repeat && isInView) observer.current?.disconnect();\n\t}, [isInView, options.repeat]);\n\n\treturn [isInView, setNode];\n};\n\nexport { useIsInView };\n"],"names":["_path","_extends","Object","assign","bind","n","e","arguments","length","t","r","hasOwnProperty","call","apply","props","width","height","viewBox","d","captionStyle","css","textSans14","palette","bottomMarginStyles","overlaidStyles","format","display","ArticleDisplay","Showcase","design","ArticleDesign","Review","overlaidBottomPadding","limitedWidth","from","leftCol","wide","veryLimitedWidth","captionPadding","tabletCaptionPadding","until","desktop","bigLeftMargin","space","mobileLandscape","hideIconBelowLeftCol","iconStyle","videoIconStyle","captionLink","CameraIcon","span","Immersive","CameraSvg","VideoIcon","VideoSvg","Caption","captionText","padCaption","credit","displayCredit","shouldLimitWidth","isOverlaid","isLeftCol","mediaType","isMainMedia","trim","isBlog","LiveBlog","DeadBlog","defaultCaption","figcaption","data-spacefinder-role","dangerouslySetInnerHTML","__html","PhotoEssay","theme","ArticleSpecial","Labs","textSans12","sizes","small","button","icon","large","fill","neutral","getIconSizeOnDesktop","imageSize","getIconSizeOnMobile","imagePositionOnMobile","PlayIcon","div","className","size","sizeOnMobile","tablet","SvgMediaControlsPlay","MaintainAspectRatio","aspectRatio","children","paddingBottom","durationStyles","textSansBold12","secondsToDuration","secs","seconds","Number","h","Math","floor","m","s","duration","push","join","MediaDuration","mediaDuration","imagePositionOnDesktop","Hide","p","ophanTrackerWeb","id","trackingEvent","getOphan","then","ophan","event","video","eventType","log","record","ophanTrackerApps","appsMediaEvent","MediaEvent","ready","play","percent25","percent50","percent75","end","getAppsMediaEvent","isUndefined","videoId","getVideoClient","sendVideoEvent","YoutubeAtomPicture","image","alt","sources","generateSources","getSourceImageUrl","breakpoint","breakpoints","mobile","phablet","fallbackSource","getFallbackSource","picture","itemProp","Sources","img","src","lowResUrl","overlayStyles","pillStyles","sourcePalette","pillItemStyles","pillTextStyles","liveStyles","news","textOverlayStyles","titleStyles","headlineMedium17","headlineMedium20","YoutubeAtomOverlay","uniqueId","overrideImage","posterImage","title","onClick","videoCategory","kicker","showTextOverlay","hasDuration","showPill","isLive","hidePillOnMobile","FormatBoundary","data-testid","aria-label","type","str","charAt","toUpperCase","slice","Kicker","text","color","fontWeight","YoutubeAtomPlaceholder","data-name","scriptsPromise","youTubeAPIPromise","loadScriptAndCatch","loadScript","catch","noop","YouTubePlayer","setPlayer","youtubeOptions","onReadyListener","enableIma","imaAdsRequestCallback","imaAdManagerListeners","YTAPI","window","YT","Player","Function","Promise","resolve","youtubeAPI","onYouTubeIframeAPIReady","all","loadScripts","loadYouTubeAPI","playerPromise","reject","createPlayerForPublishers","player","imaManager","this","events","onReady","onStateChange","onFullscreenToggled","logError","error","message","guardian","modules","sentry","reportError","getPlayerState","playVideo","pauseVideo","stopVideo","removeEventListener","eventName","listener","constructor","customPlayEventName","imaPlayerStyles","fullscreenStyles","getZIndex","dispatchCustomPlayEvent","document","dispatchEvent","CustomEvent","detail","createImaAdsRequestCallback","adTargeting","consentState","abTestParticipations","isSignedIn","adTargetingEnabled","disableAds","adUnit","customParams","adsRequest","adsRenderingSettings","adTagUrl","buildImaAdTagUrl","clientSideParticipations","useStyledNonLinearAds","google","uiElements","ima","UiElements","AD_ATTRIBUTION","COUNTDOWN","createImaManagerListeners","getAdsLoader","addEventListener","AdsManagerLoadedEvent","Type","AdsManagerLoaded","getAdsManager","AdEvent","Started","async","authStatus","getAuthStatus","kind","Error","YoutubeAtomPlayer","origin","eventEmitters","autoPlay","deactivateVideo","enableAds","renderingTarget","useRef","progressEvents","hasSentPlayEvent","hasSent25Event","hasSent50Event","hasSent75Event","hasSentEndEvent","playerReady","setPlayerReady","useState","isFullscreen","setIsFullscreen","applyFullscreenStyles","setApplyFullscreenStyles","playerReadyCallback","useCallback","playerListeners","customListeners","adsManager","useEffect","current","onReadyCallback","msg","createOnReadyListener","onStateChangeListener","loggerFrom","target","data","PlayerState","PLAYING","eventEmitter","setTimeout","checkProgress","currentTime","getCurrentTime","getDuration","percentPlayed","ENDED","PAUSED","CUED","createOnStateChangeListener","basePlayerConfiguration","playerVars","controls","fs","modestbranding","playsinline","rel","embedConfig","relatedChannels","adsConfig","disableRelatedVideos","prev","basePlayerConfigurationWithApps","requiresWebFullscreen","setFullscreen","external_fullscreen","setAppsConfiguration","allSettled","playerConfigurationResult","isSignedInResult","playerConfiguration","status","value","isSignedInValue","handleCustomPlayEvent","playerStatePromise","playerState","pause","name","success","useLayoutEffect","playerListenerNames","customListenersNames","playerListener","eventHandler","entries","Global","styles","data-atom-type","buttonStyles","stickyContainerStyles","isMobile","detectMobile","YoutubeAtomSticky","shouldStick","setPauseVideo","isActive","isClosed","setIsClosed","shouldPauseOutOfView","isSticky","setIsSticky","stickEventSent","setStickEventSent","showOverlay","setShowOverlay","useConfig","isIntersecting","setRef","useIsInView","threshold","repeat","debounce","handleCloseClick","submitComponentEvent","component","componentType","action","handleKeydown","key","showCloseButton","ref","data-is-sticky","showButton","fullWidthOverlay","onKeyDown","role","tabIndex","SvgCross","YoutubeAtom","atomId","overlayClicked","setOverlayClicked","setIsActive","canTarget","compositeEventEmitters","videoEvent","hasOverlay","showPlaceholder","loadPlayer","data-component","data-atom-id","data-video-id","data-video-unique-id","expiredOverlayStyles","undefined","expiredTextWrapperStyles","expiredSVGWrapperStyles","YoutubeAtomExpiredOverlay","hideCaption","mediaTitle","figure","SvgAlertRound","textEgyptian17","adTargetingDisabled","YoutubeBlockComponent","assetId","index","altText","expired","stickyVideos","kickerText","pauseOffscreenVideo","getLargestImageSize","setConsentState","useAdTargeting","abTests","useAB","participations","onConsentChange","newConsent","defineConsentState","framework","data-chromatic","images","sort","a","b","pop","url","TProtocolDecorator","TProtocol","getTransport","concreteProtocol","flush","writeMessageBegin","seqid","writeMessageEnd","writeStructBegin","writeStructEnd","writeFieldBegin","writeFieldEnd","writeFieldStop","writeMapBegin","keyType","valueType","writeMapEnd","writeListBegin","elementType","writeListEnd","writeSetBegin","writeSetEnd","writeBool","bool","writeByte","writeI16","i16","writeI32","i32","writeI64","i64","writeDouble","dbl","writeString","arg","writeBinary","readMessageBegin","readMessageEnd","readStructBegin","readStructEnd","readFieldBegin","readFieldEnd","readMapBegin","readMapEnd","readListBegin","readListEnd","readSetBegin","readSetEnd","readBool","readByte","readI16","readI32","readI64","readDouble","readBinary","readString","skip","protocol","super","TMultiplexedProtocol","MessageType","CALL","ONEWAY","serviceName","separator","sendNativeMessage","nativeMessage","android","postMessage","connectionId","webkit","messageHandlers","iOSWebViewMessage","console","warn","uid","getUniqueConnectionId","NativeConnection","ThriftConnection","reset","oldConnectionId","nativeConnections","promise","promises","TApplicationException","TApplicationExceptionType","UNKNOWN","receive","resolver","shift","clearTimeout","timeoutId","Buffer","sendNextMessage","outBuffer","send","dataToSend","connection","res","rej","toString","Transport","Protocol","createAppClient","ServiceClient","transport","tTransport","getProtocol","environmentClient","getEnvironmentClient","Environment","Client","commercialClient","getCommercialClient","Commercial","acquisitionsClient","getAcquisitionsClient","Acquisitions","notificationsClient","getNotificationsClient","Notifications","tagClient","getTagClient","Tag","userClient","getUserClient","User","galleryClient","getGalleryClient","Gallery","videoClient","Video","analyticsClient","getAnalyticsClient","Analytics","navigationClient","getNavigationClient","Navigation","discussionClient","getDiscussionClient","Discussion","interactionClient","getInteractionClient","Interaction","source","URL","prefix","find","bucket","pathname","startsWith","hostname","path","replace","apiPromise","useSWRImmutable","setABTests","api","mutate","videoLength","setAdTargeting","options","isInView","setIsInView","node","setNode","observer","intersectionObserverCallback","entry","intersectionCallback","libDebounce","IntersectionObserver","observe","disconnect"],"sourceRoot":""}