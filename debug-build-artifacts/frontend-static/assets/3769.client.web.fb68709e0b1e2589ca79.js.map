{"version":3,"file":"3769.client.web.fb68709e0b1e2589ca79.js","mappings":"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","sources":["webpack://@guardian/dotcom-rendering/./src/lib/discussionFilters.ts","webpack://@guardian/dotcom-rendering/./src/components/DispatchContext.tsx","webpack://@guardian/dotcom-rendering/./src/components/Discussion/AbuseReportForm.tsx","webpack://@guardian/dotcom-rendering/./src/components/Discussion/Avatar.tsx","webpack://@guardian/dotcom-rendering/./src/components/Discussion/Badges.tsx","webpack://@guardian/dotcom-rendering/./src/components/Discussion/Column.tsx","webpack://@guardian/dotcom-rendering/./src/components/Discussion/Row.tsx","webpack://@guardian/dotcom-rendering/./src/components/Discussion/RecommendationCount.tsx","webpack://@guardian/dotcom-rendering/./src/lib/discussionDateFormatter.ts","webpack://@guardian/dotcom-rendering/./src/components/Discussion/Timestamp.tsx","webpack://@guardian/dotcom-rendering/./src/lib/useInterval.ts","webpack://@guardian/dotcom-rendering/./src/components/Discussion/Comment.tsx","webpack://@guardian/dotcom-rendering/./src/components/Discussion/PillarButton.tsx","webpack://@guardian/dotcom-rendering/./src/components/Discussion/Preview.tsx","webpack://@guardian/dotcom-rendering/./src/components/Discussion/FirstCommentWelcome.tsx","webpack://@guardian/dotcom-rendering/./src/components/Discussion/CommentForm.tsx","webpack://@guardian/dotcom-rendering/./src/components/Discussion/CommentReplyPreview.tsx","webpack://@guardian/dotcom-rendering/./src/components/Discussion/CommentContainer.tsx","webpack://@guardian/dotcom-rendering/./src/components/Discussion/Dropdown.tsx","webpack://@guardian/dotcom-rendering/./src/components/Discussion/Filters.tsx","webpack://@guardian/dotcom-rendering/./src/components/Discussion/LoadingComments.tsx","webpack://@guardian/dotcom-rendering/./src/components/Discussion/Pagination.tsx","webpack://@guardian/dotcom-rendering/./src/components/Discussion/TopPick.tsx","webpack://@guardian/dotcom-rendering/./src/components/Discussion/TopPicks.tsx","webpack://@guardian/dotcom-rendering/./src/components/Discussion/Comments.tsx","webpack://@guardian/dotcom-rendering/./src/components/Discussion.tsx","webpack://@guardian/dotcom-rendering/./src/components/Hide.tsx","webpack://@guardian/dotcom-rendering/./src/lib/assert-unreachable.ts","webpack://@guardian/dotcom-rendering/./src/lib/discussion.ts","webpack://@guardian/dotcom-rendering/./src/lib/json.ts","webpack://@guardian/dotcom-rendering/./src/lib/discussionApi.tsx","webpack://@guardian/dotcom-rendering/./src/lib/result.ts"],"sourcesContent":["import { isOneOf, isString, storage } from '@guardian/libs';\n\nconst orderByTypes = ['newest', 'oldest', 'recommendations'] as const;\nconst threadTypes = ['collapsed', 'expanded', 'unthreaded'] as const;\nconst pageSizeTypes = [25, 50, 100] as const;\n\ntype OrderByType = (typeof orderByTypes)[number];\ntype ThreadsType = (typeof threadTypes)[number];\ntype PageSizeType = (typeof pageSizeTypes)[number];\n\n/**\n * @see http://discussion.guardianapis.com/discussion-api/comment/3519111/context\n */\nexport type CommentContextType = {\n\tstatus: 'ok';\n\tcommentId: number;\n\tcommentAncestorId: number;\n\tdiscussionKey: string;\n\tdiscussionWebUrl: string;\n\tdiscussionApiUrl: string;\n\torderBy: OrderByType;\n\tpageSize: PageSizeType; // TODO: Review these https://trello.com/c/7v4VDNY0/1326-review-page-size-values\n\tpage: number;\n};\n\ninterface FilterOptions {\n\torderBy: OrderByType;\n\tpageSize: PageSizeType;\n\tthreads: ThreadsType;\n}\n\nconst getOrderByType = (value: unknown) =>\n\tisString(value) && isOneOf(orderByTypes)(value) ? value : 'newest';\nconst getThreadType = (value: unknown) =>\n\tisString(value) && isOneOf(threadTypes)(value) ? value : 'collapsed';\nconst getPageSizeType = (value: unknown) =>\n\ttypeof value === 'number' && isOneOf(pageSizeTypes)(value) ? value : 25;\n\n/** Retrieves stored values from local storage if available, otherwise it returns defaults */\nexport const initFiltersFromLocalStorage = (): FilterOptions => {\n\tconst orderBy: OrderByType = getOrderByType(\n\t\tstorage.local.get('gu.prefs.discussion.order'),\n\t);\n\tconst threads: ThreadsType = getThreadType(\n\t\tstorage.local.get('gu.prefs.discussion.threading'),\n\t);\n\tconst pageSize: PageSizeType = getPageSizeType(\n\t\tstorage.local.get('gu.prefs.discussion.pagesize'),\n\t);\n\n\treturn {\n\t\torderBy,\n\t\tthreads,\n\t\tpageSize,\n\t};\n};\n","import { debug } from '@guardian/libs';\nimport { createContext, useContext } from 'react';\nimport type { Dispatch } from 'react';\nimport type { CommentType, FilterOptions, ReplyType } from '../lib/discussion';\n\nexport type Action =\n\t| {\n\t\t\tisClosedForRecommendation: boolean;\n\t\t\ttype: 'commentsLoaded';\n\t\t\tcomments: Array<CommentType | ReplyType>;\n\t\t\tisClosedForComments: boolean;\n\t\t\tcommentCount: number;\n\t\t\ttopLevelCommentCount: number;\n\t  }\n\t| { type: 'expandComments' }\n\t| {\n\t\t\ttype: 'expandCommentReplies';\n\t\t\tcommentId: string;\n\t\t\tresponses: ReplyType[];\n\t  }\n\t| { type: 'addComment'; comment: CommentType }\n\t| { type: 'addReply'; comment: ReplyType }\n\t| { type: 'updateCommentPage'; commentPage: number }\n\t| { type: 'updateHashCommentId'; hashCommentId: string | undefined }\n\t| { type: 'filterChange'; filters: FilterOptions; commentPage?: number }\n\t| { type: 'setLoading'; loading: boolean }\n\t| { type: 'setTopFormUserMissing'; userNameMissing: boolean }\n\t| { type: 'setReplyFormUserMissing'; userNameMissing: boolean }\n\t| { type: 'setBottomFormUserMissing'; userNameMissing: boolean }\n\t| { type: 'setTopFormError'; error: string }\n\t| { type: 'setReplyFormError'; error: string }\n\t| { type: 'setBottomFormError'; error: string }\n\t| { type: 'setTopFormPreviewBody'; previewBody: string }\n\t| { type: 'setReplyFormPreviewBody'; previewBody: string }\n\t| { type: 'setBottomFormPreviewBody'; previewBody: string };\n\nconst DispatchContext = createContext<Dispatch<Action>>(() => {\n\tdebug(\n\t\t'dotcom',\n\t\t`The 'dispatch' function in discussion is not defined! Did you remember to include a context provider for it?`,\n\t);\n});\n\nexport const DispatchProvider = ({\n\tvalue,\n\tchildren,\n}: {\n\tvalue: Dispatch<Action>;\n\tchildren: React.ReactNode;\n}) => (\n\t<DispatchContext.Provider value={value}>\n\t\t{children}\n\t</DispatchContext.Provider>\n);\n\nexport const useDispatch = (): Dispatch<Action> => {\n\tconst context = useContext(DispatchContext);\n\treturn context;\n};\n","import { css } from '@emotion/react';\nimport { log } from '@guardian/libs';\nimport { space, textSans12 } from '@guardian/source/foundations';\nimport {\n\tButton,\n\tInlineError,\n\tInlineSuccess,\n\tOption,\n\tSelect,\n\tSvgCross,\n\tTextArea,\n\tTextInput,\n} from '@guardian/source/react-components';\nimport { useEffect, useRef, useState } from 'react';\nimport type { reportAbuse } from '../../lib/discussionApi';\nimport { palette as schemedPalette } from '../../palette';\n\ntype FormData = {\n\tcategoryId: number;\n\treason?: string;\n\temail?: string;\n};\n\nconst formWrapper = css`\n\tz-index: 1;\n\tborder: 1px solid ${schemedPalette('--discussion-border')};\n\tposition: absolute;\n\twidth: 300px;\n\ttop: 0;\n\tright: 0;\n\tdisplay: flex;\n\tflex-direction: column;\n\tpadding: ${space[3]}px;\n\tbackground-color: ${schemedPalette('--discussion-report-background')};\n\t${textSans12};\n`;\n\nconst labelColour = schemedPalette('--discussion-report-label-text');\n\nconst errorColour = schemedPalette('--discussion-report-error-text');\n\nconst buttonStyles = css`\n\tbackground-color: ${schemedPalette('--discussion-report-button')};\n`;\n\nconst errorBorderColour = css`\n\tselect,\n\tinput,\n\ttextarea {\n\t\tborder: 1px solid ${schemedPalette('--discussion-report-error-text')};\n\t}\n`;\n\nconst borderColour = css`\n\tselect,\n\tinput,\n\ttextarea {\n\t\tborder: 1px solid ${schemedPalette('--discussion-report-border')};\n\t}\n`;\n\nconst inputWrapper = css`\n\tdisplay: flex;\n\tflex-direction: column;\n\tmargin-bottom: ${space[2]}px;\n\n\tlabel {\n\t\tdisplay: block;\n\t}\n\n\tselect,\n\tinput,\n\ttextarea {\n\t\tbackground-color: ${schemedPalette('--discussion-report-background')};\n\t\tmin-height: ${space[5]}px;\n\t\twidth: 75%;\n\t\tcolor: inherit;\n\t}\n`;\n\nconst svgStyles = css`\n\tdiv {\n\t\tsvg {\n\t\t\tright: 80px;\n\t\t\tfill: ${labelColour};\n\t\t}\n\t}\n`;\n\nconst errorSvgStyles = css`\n\tspan[role='alert'] {\n\t\tsvg {\n\t\t\tfill: ${errorColour};\n\t\t}\n\t}\n`;\n\ntype Props = {\n\tcommentId: string;\n\ttoggleSetShowForm: () => void;\n\treportAbuse: ReturnType<typeof reportAbuse>;\n};\n\nexport const AbuseReportForm = ({\n\tcommentId,\n\ttoggleSetShowForm,\n\treportAbuse,\n}: Props) => {\n\tconst modalRef = useRef<HTMLDivElement>(null);\n\t// TODO: use ref once forwardRef is implemented @guardian/src-button\n\t// We want to pull out the 1st and last elements of the form, and highlight the 1st element\n\tlet firstElement: HTMLSelectElement | null = null;\n\tlet lastElement: HTMLButtonElement | null = null;\n\tuseEffect(() => {\n\t\tif (!modalRef.current) return;\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps -- https://github.com/guardian/discussion-rendering/pull/56 for where this was first introduced\n\t\tfirstElement = modalRef.current.querySelector(\n\t\t\t'select[name=\"category\"]',\n\t\t);\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps -- https://github.com/guardian/discussion-rendering/pull/56 for where this was first introduced\n\t\tlastElement = modalRef.current.querySelector(\n\t\t\t'button[custom-guardian=\"close-modal\"]',\n\t\t);\n\t}, [modalRef]);\n\t// We want to highlight the 1st element when the modal is open\n\tuseEffect(() => {\n\t\tfirstElement?.focus();\n\t}, [firstElement]);\n\n\t// We want to make sure to close the modal when a user clicks away from the modal\n\tuseEffect(() => {\n\t\tconst closeOnClickAway = (e: MouseEvent) => {\n\t\t\tif (\n\t\t\t\tmodalRef.current &&\n\t\t\t\t!modalRef.current.contains(e.target as Node)\n\t\t\t) {\n\t\t\t\ttoggleSetShowForm();\n\t\t\t}\n\t\t};\n\t\tdocument.addEventListener('mousedown', closeOnClickAway);\n\t}, [modalRef, toggleSetShowForm]);\n\n\t// We want to listen to keydown events for accessibility\n\tuseEffect(() => {\n\t\tconst keyListener = (e: KeyboardEvent) => {\n\t\t\tif (e.code === 'Escape') {\n\t\t\t\ttoggleSetShowForm();\n\t\t\t} else if (e.code === 'Tab') {\n\t\t\t\t// If firstElement or lastElement are not defined, do not continue\n\t\t\t\tif (!firstElement || !lastElement) return;\n\n\t\t\t\t// we use `e.shiftKey` internally to determine the direction of the highlighting\n\t\t\t\t// using document.activeElement and e.shiftKey we can check what should be the next element to be highlighted\n\t\t\t\tif (!e.shiftKey && document.activeElement === lastElement) {\n\t\t\t\t\tfirstElement.focus();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\n\t\t\t\tif (e.shiftKey && document.activeElement === firstElement) {\n\t\t\t\t\tlastElement.focus(); // The shift key is down so loop focus back to the last item\n\t\t\t\t\te.preventDefault();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tdocument.addEventListener('keydown', keyListener);\n\t\treturn () => document.removeEventListener('keydown', keyListener);\n\t});\n\n\tconst [formVariables, setFormVariables] = useState<FormData>({\n\t\tcategoryId: 0,\n\t\treason: '',\n\t\temail: '',\n\t});\n\n\tconst defaultErrorTexts = {\n\t\tcategoryId: '',\n\t\treason: '',\n\t\temail: '',\n\t\tresponse: '',\n\t};\n\tconst [errors, setErrors] = useState(defaultErrorTexts);\n\tconst [successMessage, setSuccessMessage] = useState<string>();\n\tconst onSubmit = (event: React.FormEvent<HTMLFormElement>) => {\n\t\tevent.preventDefault();\n\n\t\tconst { categoryId, reason, email } = formVariables;\n\n\t\t// Reset error messages\n\t\tsetErrors(defaultErrorTexts);\n\n\t\t// Error validation\n\t\tif (!categoryId) {\n\t\t\tsetErrors({\n\t\t\t\t...errors,\n\t\t\t\tcategoryId: 'You must select a category before submitting',\n\t\t\t});\n\n\t\t\treturn;\n\t\t}\n\n\t\treportAbuse({\n\t\t\tcategoryId,\n\t\t\treason,\n\t\t\temail,\n\t\t\tcommentId,\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\tif (response.kind === 'error') {\n\t\t\t\t\t// Fallback to errors returned from the API\n\t\t\t\t\tsetErrors({ ...errors, response: response.error });\n\t\t\t\t} else {\n\t\t\t\t\tsetSuccessMessage('Report submitted');\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tlog('dotcom', 'Discussion: error reporting abuse');\n\t\t\t});\n\t};\n\n\t/** If the \"Other\" or the \"Legal Issue\" categories are selected, you must supply a reason */\n\tconst legalIssueCategoryId = 3;\n\tconst otherCategoryId = 9;\n\tconst isReasonRequired =\n\t\tformVariables.categoryId === otherCategoryId ||\n\t\tformVariables.categoryId === legalIssueCategoryId;\n\n\treturn (\n\t\t<div aria-modal=\"true\" ref={modalRef}>\n\t\t\t<form css={formWrapper} onSubmit={onSubmit}>\n\t\t\t\t<div\n\t\t\t\t\tcss={[\n\t\t\t\t\t\tinputWrapper,\n\t\t\t\t\t\tsvgStyles,\n\t\t\t\t\t\terrorSvgStyles,\n\t\t\t\t\t\terrors.categoryId ? errorBorderColour : borderColour,\n\t\t\t\t\t]}\n\t\t\t\t>\n\t\t\t\t\t<Select\n\t\t\t\t\t\tlabel={'Category'}\n\t\t\t\t\t\tonChange={(e: React.ChangeEvent<HTMLSelectElement>) => {\n\t\t\t\t\t\t\tsetFormVariables({\n\t\t\t\t\t\t\t\t...formVariables,\n\t\t\t\t\t\t\t\tcategoryId: Number(e.target.value),\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\terrors.categoryId = '';\n\t\t\t\t\t\t\tsetErrors(errors);\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tvalue={formVariables.categoryId}\n\t\t\t\t\t\ttheme={{\n\t\t\t\t\t\t\ttextLabel: labelColour,\n\t\t\t\t\t\t\ttextOptional: labelColour,\n\t\t\t\t\t\t\ttextError: errorColour,\n\t\t\t\t\t\t\tborderError: errorColour,\n\t\t\t\t\t\t}}\n\t\t\t\t\t\terror={\n\t\t\t\t\t\t\terrors.categoryId ? errors.categoryId : undefined\n\t\t\t\t\t\t}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Option value=\"0\">Please select</Option>\n\t\t\t\t\t\t<Option value=\"1\">Personal abuse</Option>\n\t\t\t\t\t\t<Option value=\"2\">Off topic</Option>\n\t\t\t\t\t\t<Option value={legalIssueCategoryId}>\n\t\t\t\t\t\t\tLegal issue\n\t\t\t\t\t\t</Option>\n\t\t\t\t\t\t<Option value=\"4\">Trolling</Option>\n\t\t\t\t\t\t<Option value=\"5\">Hate speech</Option>\n\t\t\t\t\t\t<Option value=\"6\">\n\t\t\t\t\t\t\tOffensive/Threatening language\n\t\t\t\t\t\t</Option>\n\t\t\t\t\t\t<Option value=\"7\">Copyright</Option>\n\t\t\t\t\t\t<Option value=\"8\">Spam</Option>\n\t\t\t\t\t\t<Option value={otherCategoryId}>Other</Option>\n\t\t\t\t\t</Select>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tcss={[\n\t\t\t\t\t\tinputWrapper,\n\t\t\t\t\t\tsvgStyles,\n\t\t\t\t\t\terrorSvgStyles,\n\t\t\t\t\t\terrors.reason ? errorBorderColour : borderColour,\n\t\t\t\t\t]}\n\t\t\t\t>\n\t\t\t\t\t<TextArea\n\t\t\t\t\t\tid=\"reason\"\n\t\t\t\t\t\tsize={'medium'}\n\t\t\t\t\t\tlabel={'Reason'}\n\t\t\t\t\t\toptional={!isReasonRequired}\n\t\t\t\t\t\tonChange={(e: React.ChangeEvent<HTMLTextAreaElement>) =>\n\t\t\t\t\t\t\tsetFormVariables({\n\t\t\t\t\t\t\t\t...formVariables,\n\t\t\t\t\t\t\t\treason: e.target.value,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvalue={formVariables.reason}\n\t\t\t\t\t\trequired={isReasonRequired}\n\t\t\t\t\t\ttheme={{\n\t\t\t\t\t\t\ttextLabel: labelColour,\n\t\t\t\t\t\t\ttextOptional: labelColour,\n\t\t\t\t\t\t\ttextError: errorColour,\n\t\t\t\t\t\t\tborderError: errorColour,\n\t\t\t\t\t\t}}\n\t\t\t\t\t\terror={errors.reason ? errors.reason : undefined}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<div\n\t\t\t\t\tcss={[\n\t\t\t\t\t\tinputWrapper,\n\t\t\t\t\t\tsvgStyles,\n\t\t\t\t\t\terrorSvgStyles,\n\t\t\t\t\t\terrors.email ? errorBorderColour : borderColour,\n\t\t\t\t\t]}\n\t\t\t\t>\n\t\t\t\t\t<TextInput\n\t\t\t\t\t\tlabel={'Email'}\n\t\t\t\t\t\toptional={true}\n\t\t\t\t\t\tid=\"email\"\n\t\t\t\t\t\ttype=\"email\"\n\t\t\t\t\t\tonChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n\t\t\t\t\t\t\tsetFormVariables({\n\t\t\t\t\t\t\t\t...formVariables,\n\t\t\t\t\t\t\t\temail: e.target.value,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvalue={formVariables.email}\n\t\t\t\t\t\ttheme={{\n\t\t\t\t\t\t\ttextLabel: labelColour,\n\t\t\t\t\t\t\ttextOptional: labelColour,\n\t\t\t\t\t\t\ttextError: errorColour,\n\t\t\t\t\t\t\tborderError: errorColour,\n\t\t\t\t\t\t}}\n\t\t\t\t\t\terror={errors.email ? errors.email : undefined}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<div>\n\t\t\t\t\t<Button\n\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\tdata-link-name=\"Post report abuse\"\n\t\t\t\t\t\tcssOverrides={buttonStyles}\n\t\t\t\t\t>\n\t\t\t\t\t\tReport\n\t\t\t\t\t</Button>\n\n\t\t\t\t\t{!!errors.response && (\n\t\t\t\t\t\t<InlineError\n\t\t\t\t\t\t\tcssOverrides={css`\n\t\t\t\t\t\t\t\tcolor: ${errorColour};\n\t\t\t\t\t\t\t\tpadding-top: ${space[2]}px;\n\t\t\t\t\t\t\t`}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{errors.response}\n\t\t\t\t\t\t</InlineError>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{!!successMessage && (\n\t\t\t\t\t\t<InlineSuccess\n\t\t\t\t\t\t\tcssOverrides={css`\n\t\t\t\t\t\t\t\tcolor: ${schemedPalette(\n\t\t\t\t\t\t\t\t\t'--discussion-report-success-text',\n\t\t\t\t\t\t\t\t)};\n\t\t\t\t\t\t\t\tpadding-top: ${space[2]}px;\n\t\t\t\t\t\t\t`}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{successMessage}\n\t\t\t\t\t\t</InlineSuccess>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t\t<div\n\t\t\t\t\tcss={css`\n\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\tright: ${space[3]}px;\n\t\t\t\t\t\ttop: ${space[3]}px;\n\t\t\t\t\t`}\n\t\t\t\t>\n\t\t\t\t\t<Button\n\t\t\t\t\t\t// TODO: use ref once forwardRef is implemented @guardian/src-button\n\t\t\t\t\t\t// ref={lastElement}\n\t\t\t\t\t\tcustom-guardian=\"close-modal\"\n\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\ticonSide=\"right\"\n\t\t\t\t\t\ticon={<SvgCross />}\n\t\t\t\t\t\tonClick={toggleSetShowForm}\n\t\t\t\t\t\tdata-link-name=\"cancel-report-abuse\"\n\t\t\t\t\t\thideLabel={true}\n\t\t\t\t\t\tcssOverrides={buttonStyles}\n\t\t\t\t\t>\n\t\t\t\t\t\tclose report abuse modal\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t</div>\n\t);\n};\n","import { css } from '@emotion/react';\n\ntype Props = {\n\timageUrl?: string;\n\tdisplayName: string;\n\tsize: 'small' | 'medium' | 'large';\n};\n\nconst imageStyles = (size: number) => css`\n\tborder-radius: ${size + 10}px;\n\twidth: ${size}px;\n\theight: ${size}px;\n`;\n\nexport const Avatar = ({\n\timageUrl = 'https://avatar.guim.co.uk/no-user-image.gif',\n\tdisplayName,\n\tsize,\n}: Props) => {\n\tswitch (size) {\n\t\tcase 'small':\n\t\t\treturn (\n\t\t\t\t<img src={imageUrl} alt={displayName} css={imageStyles(36)} />\n\t\t\t);\n\t\tcase 'large':\n\t\t\treturn (\n\t\t\t\t<img src={imageUrl} alt={displayName} css={imageStyles(60)} />\n\t\t\t);\n\t\tcase 'medium':\n\t\tdefault:\n\t\t\treturn (\n\t\t\t\t<img src={imageUrl} alt={displayName} css={imageStyles(48)} />\n\t\t\t);\n\t}\n};\n","import { css } from '@emotion/react';\nimport { space, textSansBold12 } from '@guardian/source/foundations';\nimport { palette as themePalette } from '../../palette';\n\nconst staffBadge = css`\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n`;\n\nconst iconStyles = css`\n\tdisplay: inline-block;\n\twidth: 15px;\n\theight: 15px;\n`;\n\nconst labelText = css`\n\tdisplay: inline-block;\n\tline-height: 15px;\n\tmargin: 0 0 0 ${space[1]}px;\n\t${textSansBold12};\n`;\n\nconst staffLabel = css`\n\tcolor: ${themePalette('--discussion-staff-label-text')};\n`;\nconst guardianPickLabel = css`\n\tcolor: ${themePalette('--discussion-pick-label-text')};\n`;\n\nexport const GuardianStaff = () => (\n\t<div css={staffBadge}>\n\t\t<svg\n\t\t\twidth=\"36\"\n\t\t\theight=\"36\"\n\t\t\tviewBox=\"0 0 36 36\"\n\t\t\tcss={iconStyles}\n\t\t\tfill={themePalette('--staff-contributor-badge')}\n\t\t>\n\t\t\t<path d=\"M18 0a18 18 0 1 0 0 36 18 18 0 0 0 0-36\"></path>\n\t\t\t<path\n\t\t\t\tfill={themePalette('--staff-contributor-badge-text')}\n\t\t\t\td=\"M21.2 4.4c2.3.4 5.3 2 6.3 3.1v5.2H27L21.2 5v-.6zm-2.2.4c-4 0-6.3 5.6-6.3 13.2 0 7.7 2.2 13.3 6.3 13.3v.6c-6 .4-14.4-4.2-14-13.8A13.3 13.3 0 0 1 19 4v.7zm10.4 14.4l-1.9.9v8.6c-1 1-3.8 2.6-6.3 3.1V19.9l-2.2-.7v-.6h10.4v.6z\"\n\t\t\t></path>\n\t\t</svg>\n\t\t<p css={[labelText, staffLabel]}>Staff</p>\n\t</div>\n);\n\nexport const GuardianContributor = () => (\n\t<div css={staffBadge}>\n\t\t<svg\n\t\t\twidth=\"36\"\n\t\t\theight=\"36\"\n\t\t\tviewBox=\"0 0 36 36\"\n\t\t\tcss={iconStyles}\n\t\t\tfill={themePalette('--staff-contributor-badge')}\n\t\t>\n\t\t\t<path d=\"M18 0a18 18 0 1 0 0 36 18 18 0 0 0 0-36\"></path>\n\t\t\t<path\n\t\t\t\tfill={themePalette('--staff-contributor-badge-text')}\n\t\t\t\td=\"M21.2 4.4c2.3.4 5.3 2 6.3 3.1v5.2H27L21.2 5v-.6zm-2.2.4c-4 0-6.3 5.6-6.3 13.2 0 7.7 2.2 13.3 6.3 13.3v.6c-6 .4-14.4-4.2-14-13.8A13.3 13.3 0 0 1 19 4v.7zm10.4 14.4l-1.9.9v8.6c-1 1-3.8 2.6-6.3 3.1V19.9l-2.2-.7v-.6h10.4v.6z\"\n\t\t\t></path>\n\t\t</svg>\n\t\t<p css={[labelText, staffLabel]}>Contributor</p>\n\t</div>\n);\n\nexport const GuardianPick = () => (\n\t<div css={staffBadge}>\n\t\t<svg\n\t\t\twidth=\"36\"\n\t\t\theight=\"36\"\n\t\t\tviewBox=\"0 0 36 36\"\n\t\t\tcss={iconStyles}\n\t\t\tfill={themePalette('--staff-pick-badge')}\n\t\t>\n\t\t\t<path d=\"M18 0a18 18 0 1 0 0 36 18 18 0 0 0 0-36\"></path>\n\t\t\t<path\n\t\t\t\tfill={themePalette('--staff-pick-badge-text')}\n\t\t\t\td=\"M21.2 4.4c2.3.4 5.3 2 6.3 3.1v5.2H27L21.2 5v-.6zm-2.2.4c-4 0-6.3 5.6-6.3 13.2 0 7.7 2.2 13.3 6.3 13.3v.6c-6 .4-14.4-4.2-14-13.8A13.3 13.3 0 0 1 19 4v.7zm10.4 14.4l-1.9.9v8.6c-1 1-3.8 2.6-6.3 3.1V19.9l-2.2-.7v-.6h10.4v.6z\"\n\t\t\t></path>\n\t\t</svg>\n\t\t<p css={[labelText, guardianPickLabel]}>Guardian Pick</p>\n\t</div>\n);\n","import { css } from '@emotion/react';\n\ntype Props = { children: React.ReactNode };\n\nexport const Column = ({ children }: Props) => (\n\t<div\n\t\tcss={css`\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: column;\n\t\t`}\n\t>\n\t\t{children}\n\t</div>\n);\n","import { css, type SerializedStyles } from '@emotion/react';\n\ntype Props = {\n\tchildren: React.ReactNode;\n\twrap?: boolean;\n\tcssOverrides?: SerializedStyles | SerializedStyles[];\n};\n\nconst rowStyles = css`\n\tdisplay: flex;\n\tflex-direction: row;\n`;\n\nexport const Row = ({ children, wrap = false, cssOverrides }: Props) => (\n\t<div\n\t\tcss={[rowStyles, cssOverrides]}\n\t\tstyle={{ flexWrap: wrap ? 'wrap' : undefined }}\n\t>\n\t\t{children}\n\t</div>\n);\n","import { css } from '@emotion/react';\nimport { textSans12 } from '@guardian/source/foundations';\nimport { SvgArrowUpStraight } from '@guardian/source/react-components';\nimport type { MouseEventHandler } from 'react';\nimport { useState } from 'react';\nimport type { SignedInUser } from '../../lib/discussion';\nimport { palette as themePalette } from '../../palette';\nimport { Row } from './Row';\n\ntype Props = {\n\tcommentId: string;\n\tinitialCount: number;\n\talreadyRecommended: boolean;\n\tuser?: SignedInUser;\n\tuserMadeComment: boolean;\n\tisClosedForRecommendations: boolean;\n};\n\nconst countStyles = css`\n\t${textSans12};\n\t/**\n\t * Typography preset styles should not be overridden.\n\t * This has been done because the styles do not directly map to the new presets.\n\t * Please speak to your team's designer and update this to use a more appropriate preset.\n\t */\n\tfont-weight: 300;\n\tmin-width: 0.75rem;\n\tcolor: ${themePalette('--discussion-subdued')};\n\tmargin-right: 0.3125rem;\n`;\n\nconst buttonStyles = (recommended: boolean, isSignedIn: boolean) => css`\n\tcursor: ${recommended || !isSignedIn ? 'default' : 'pointer'};\n\twidth: 1.1875rem;\n\theight: 1.1875rem;\n\tbackground-color: ${recommended\n\t\t? themePalette('--recommendation-count-selected')\n\t\t: themePalette('--recommendation-count')};\n\tborder-radius: 62.5rem;\n\tborder: none;\n`;\n\nconst arrowStyles = (recommended: boolean) => css`\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tsvg {\n\t\tfill: ${recommended\n\t\t\t? themePalette('--recommendation-count-arrow-selected')\n\t\t\t: themePalette('--recommendation-count-arrow')};\n\t\theight: 15px;\n\t\twidth: 15px;\n\t}\n`;\n\nexport const RecommendationCount = ({\n\tcommentId,\n\tinitialCount,\n\talreadyRecommended,\n\tuser,\n\tuserMadeComment,\n\tisClosedForRecommendations,\n}: Props) => {\n\tconst [count, setCount] = useState(initialCount);\n\tconst [recommended, setRecommended] = useState(alreadyRecommended);\n\n\tconst tryToRecommend: MouseEventHandler<HTMLButtonElement> = () => {\n\t\tif (!user) return;\n\n\t\tconst newCount = count + 1;\n\t\tsetCount(newCount);\n\t\tsetRecommended(true);\n\n\t\tuser.onRecommend(commentId)\n\t\t\t.then((accepted) => {\n\t\t\t\tif (!accepted) {\n\t\t\t\t\tsetCount(newCount - 1);\n\t\t\t\t\tsetRecommended(alreadyRecommended);\n\t\t\t\t}\n\t\t\t})\n\t\t\t// TODO: do some error handling\n\t\t\t.catch(() => undefined);\n\t};\n\n\treturn (\n\t\t<Row>\n\t\t\t<div css={countStyles}>{count}</div>\n\t\t\t<button\n\t\t\t\tcss={buttonStyles(recommended, !!user)}\n\t\t\t\tonClick={tryToRecommend}\n\t\t\t\tdisabled={\n\t\t\t\t\trecommended ||\n\t\t\t\t\t!user ||\n\t\t\t\t\tuserMadeComment ||\n\t\t\t\t\tisClosedForRecommendations\n\t\t\t\t}\n\t\t\t\tdata-link-name=\"Recommend comment\"\n\t\t\t\taria-label=\"Recommend comment\"\n\t\t\t\ttype=\"button\"\n\t\t\t>\n\t\t\t\t<div css={arrowStyles(recommended)}>\n\t\t\t\t\t<SvgArrowUpStraight />\n\t\t\t\t</div>\n\t\t\t</button>\n\t\t</Row>\n\t);\n};\n","import { timeAgo } from '@guardian/libs';\n\nconst getMonthString = (month: number): string => {\n\tswitch (month) {\n\t\tcase 0:\n\t\t\treturn 'Jan';\n\t\tcase 1:\n\t\t\treturn 'Feb';\n\t\tcase 2:\n\t\t\treturn 'Mar';\n\t\tcase 3:\n\t\t\treturn 'Apr';\n\t\tcase 4:\n\t\t\treturn 'May';\n\t\tcase 5:\n\t\t\treturn 'Jun';\n\t\tcase 6:\n\t\t\treturn 'Jul';\n\t\tcase 7:\n\t\t\treturn 'Aug';\n\t\tcase 8:\n\t\t\treturn 'Sep';\n\t\tcase 9:\n\t\t\treturn 'Oct';\n\t\tcase 10:\n\t\t\treturn 'Nov';\n\t\tcase 11:\n\t\t\treturn 'Dec';\n\t\tdefault:\n\t\t\treturn '';\n\t}\n};\n\nconst isLast24Hrs = (date: Date) => {\n\tconst timeStamp = Math.round(new Date().getTime() / 1000);\n\tconst timeStampYesterday = timeStamp - 24 * 3600;\n\treturn date.getTime() >= new Date(timeStampYesterday * 1000).getTime();\n};\n\nexport const dateFormatter = (dateString: string): string | false => {\n\tconst date = new Date(dateString);\n\n\tif (isLast24Hrs(date)) {\n\t\treturn timeAgo(date.getTime(), { verbose: true, daysUntilAbsolute: 1 });\n\t}\n\n\treturn `${date.getDate()} ${getMonthString(\n\t\tdate.getMonth(),\n\t)} ${date.getFullYear()} ${date.getHours()}.${String(\n\t\tdate.getMinutes(),\n\t).padStart(2, '0')}`;\n};\n","import { css } from '@emotion/react';\nimport { textSans12 } from '@guardian/source/foundations';\nimport { useState } from 'react';\nimport { dateFormatter } from '../../lib/discussionDateFormatter';\nimport { useInterval } from '../../lib/useInterval';\nimport { palette as schemedPalette } from '../../palette';\n\ntype Props = {\n\tisoDateTime: string;\n\twebUrl: string;\n\tcommentId: string;\n\tonPermalinkClick: (commentId: string) => void;\n};\n\nconst linkStyles = css`\n\tcolor: ${schemedPalette('--discussion-subdued')};\n\ttext-decoration: none;\n\t:hover,\n\t:focus {\n\t\ttext-decoration: underline;\n\t}\n`;\nconst timeStyles = css`\n\t${textSans12};\n\t/**\n\t * Typography preset styles should not be overridden.\n\t * This has been done because the styles do not directly map to the new presets.\n\t * Please speak to your team's designer and update this to use a more appropriate preset.\n\t */\n\tfont-weight: 300;\n\tmin-width: 0.75rem;\n\tmargin-right: 0.3125rem;\n\twhite-space: nowrap;\n`;\n\nexport const Timestamp = ({\n\tisoDateTime,\n\twebUrl,\n\tcommentId,\n\tonPermalinkClick,\n}: Props) => {\n\tconst [timeAgo, setTimeAgo] = useState(dateFormatter(isoDateTime));\n\n\tuseInterval(() => {\n\t\tsetTimeAgo(dateFormatter(isoDateTime));\n\t}, 15000);\n\n\treturn (\n\t\t<a\n\t\t\thref={webUrl}\n\t\t\tcss={linkStyles}\n\t\t\tdata-link-name=\"jump-to-comment-timestamp\"\n\t\t\tonClick={(e) => {\n\t\t\t\tonPermalinkClick(commentId);\n\t\t\t\te.preventDefault();\n\t\t\t}}\n\t\t\trel=\"nofollow\"\n\t\t>\n\t\t\t<time dateTime={isoDateTime.toString()} css={timeStyles}>\n\t\t\t\t{timeAgo}\n\t\t\t</time>\n\t\t</a>\n\t);\n};\n","import { useEffect, useRef } from 'react';\n\ntype CallbackFunction = () => void;\n\n// Why do we have this custom hook?\n// https://overreacted.io/making-setinterval-declarative-with-react-hooks/\nexport const useInterval = (\n\tcallback: CallbackFunction,\n\tdelay: number,\n): void => {\n\tconst savedCallback = useRef<CallbackFunction>();\n\n\t// Remember the latest callback.\n\tuseEffect(() => {\n\t\tsavedCallback.current = callback;\n\t}, [callback]);\n\n\t// Set up the interval.\n\tuseEffect(() => {\n\t\tfunction tick() {\n\t\t\tconst currentCallback = savedCallback.current;\n\t\t\tif (currentCallback) {\n\t\t\t\tcurrentCallback();\n\t\t\t}\n\t\t}\n\t\tconst id = setInterval(tick, delay);\n\t\treturn () => clearInterval(id);\n\t}, [delay]);\n};\n","import { css } from '@emotion/react';\nimport {\n\tfrom,\n\tremSpace,\n\tspace,\n\ttextSans12,\n\ttextSans15,\n\ttextSansBold12,\n\ttextSansBold15,\n\tuntil,\n} from '@guardian/source/foundations';\nimport { Button, Link, SvgIndent } from '@guardian/source/react-components';\nimport { useState } from 'react';\nimport type {\n\tCommentType,\n\tReplyType,\n\tSignedInUser,\n\tStaff,\n} from '../../lib/discussion';\nimport type { reportAbuse } from '../../lib/discussionApi';\nimport { createAuthenticationEventParams } from '../../lib/identity-component-event';\nimport { palette as schemedPalette } from '../../palette';\nimport { AbuseReportForm } from './AbuseReportForm';\nimport { Avatar } from './Avatar';\nimport { GuardianContributor, GuardianPick, GuardianStaff } from './Badges';\nimport { Column } from './Column';\nimport { RecommendationCount } from './RecommendationCount';\nimport { Row } from './Row';\nimport { Timestamp } from './Timestamp';\n\ntype Props = {\n\tuser?: SignedInUser;\n\tcomment: CommentType | ReplyType;\n\tisClosedForComments: boolean;\n\tisClosedForRecommendations: boolean;\n\tsetCommentBeingRepliedTo: (\n\t\tcommentBeingRepliedTo?: CommentType | ReplyType,\n\t) => void;\n\tisReply: boolean;\n\twasScrolledTo?: boolean;\n\tisMuted: boolean;\n\ttoggleMuteStatus: (userId: string) => void;\n\tonPermalinkClick: (commentId: string) => void;\n\treportAbuse: ReturnType<typeof reportAbuse>;\n\tisExpanded: boolean;\n};\n\nconst commentControlsLink = css`\n\tmargin-top: -2px;\n\n\ta {\n\t\t${textSansBold15}\n\t\tmargin-right: ${space[2]}px;\n\t\tcolor: ${schemedPalette('--discussion-accent-text')};\n\t\t/*\n      We do not want underline to be applied to SVG\n      therefore we override the styles and apply them to the nested <span>\n    */\n\t\t:hover {\n\t\t\ttext-decoration: none;\n\t\t\ttext-decoration-color: none;\n\t\t\tspan {\n\t\t\t\tcolor: ${schemedPalette('--discussion-accent-text')};\n\t\t\t\ttext-decoration: underline;\n\t\t\t\ttext-decoration-color: ${schemedPalette(\n\t\t\t\t\t'--discussion-accent-text',\n\t\t\t\t)};\n\t\t\t}\n\t\t}\n\t}\n`;\n\nconst spaceBetween = css`\n\tdisplay: flex;\n\tjustify-content: space-between;\n`;\n\nconst commentCss = css`\n\tdisplay: block;\n\tclear: left;\n\t${textSans15}\n\tmargin-top: ${remSpace[2]};\n\tmargin-bottom: ${remSpace[3]};\n\tword-break: break-word;\n\n\tp {\n\t\tmargin-top: 0;\n\t\tmargin-bottom: ${space[3]}px;\n\t}\n\n\tblockquote {\n\t\tmargin-top: ${space[3]}px;\n\t\tmargin-bottom: ${space[3]}px;\n\t\tmargin-left: ${space[5]}px;\n\t\tmargin-right: ${space[5]}px;\n\t\tpadding-left: ${space[2]}px;\n\t\tcolor: ${schemedPalette('--discussion-subdued')};\n\t}\n\n\ti {\n\t\tfont-style: italic;\n\t}\n\n\tb {\n\t\tfont-weight: bold;\n\t}\n\n\tcode {\n\t\t/* stylelint-disable-next-line property-disallowed-list -- we do not have a monospace Source font */\n\t\tfont-family: monospace;\n\t\tfont-size: 1em;\n\t}\n`;\n\nconst blockedCommentStyles = css`\n\tcolor: ${schemedPalette('--discussion-subdued')};\n\t${textSans12}\n`;\n\n// to override a tag styles from dangerouslySetInnerHTML\nconst commentLinkStyling = css`\n\ta {\n\t\tcolor: ${schemedPalette('--discussion-link')};\n\t\ttext-decoration-color: ${schemedPalette(\n\t\t\t'--discussion-comment-underline',\n\t\t)};\n\t\t:hover {\n\t\t\ttext-decoration: underline;\n\t\t}\n\t}\n`;\n\nconst commentWrapper = css`\n\tborder-top: 1px solid ${schemedPalette('--discussion-border')};\n\tdisplay: flex;\n\tpadding: ${space[2]}px 0;\n`;\n\nconst selectedStyles = css`\n\tbackground-color: ${schemedPalette('--discussion-selected-background')};\n\tmargin-left: -${space[2]}px;\n\tpadding-left: ${space[2]}px;\n\tmargin-right: -${space[2]}px;\n\tpadding-right: ${space[2]}px;\n`;\n\nconst avatarMargin = css`\n\tmargin-right: ${space[2]}px;\n\n\t${until.mobileLandscape} {\n\t\tdisplay: none;\n\t}\n`;\n\nconst colourStyles = css`\n\ta {\n\t\tcolor: ${schemedPalette('--discussion-accent-text')};\n\t\ttext-decoration-color: ${schemedPalette('--discussion-accent-text')};\n\t\t:hover {\n\t\t\tcolor: ${schemedPalette('--discussion-accent-text')};\n\t\t\ttext-decoration-color: ${schemedPalette(\n\t\t\t\t'--discussion-accent-text',\n\t\t\t)};\n\t\t}\n\t}\n`;\n\nconst boldFont = css`\n\ta {\n\t\t${textSansBold15}\n\t}\n`;\n\nconst regularFont = css`\n\ta {\n\t\t${textSans15}\n\t}\n`;\n\n// TODO: fix using !important\nconst svgReplyArrow = css`\n\tsvg {\n\t\t/* stylelint-disable-next-line declaration-no-important */\n\t\tfill: ${schemedPalette('--discussion-subdued')} !important;\n\t}\n`;\n\nconst commentDetails = css`\n\tflex-grow: 1;\n\twidth: 100%;\n`;\n\nconst headerStyles = css`\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: space-between;\n`;\n\nconst iconWrapper = css`\n\tpadding: 2px;\n\twhite-space: nowrap;\n`;\n\nconst timestampWrapperStyles = css`\n\tmargin-left: ${space[2]}px;\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: center;\n`;\n\nconst hideBelowMobileLandscape = css`\n\t${until.mobileLandscape} {\n\t\tdisplay: none;\n\t}\n`;\n\nconst hideAboveMobileLandscape = css`\n\t${from.mobileLandscape} {\n\t\tdisplay: none;\n\t}\n`;\n\nconst negativeMargin = css`\n\tmargin-top: 0px;\n\tmargin-bottom: -6px;\n`;\n\nconst cssTextOverflowElip = css`\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n`;\n\nconst cssReplyToWrapper = css`\n\t${until.mobileLandscape} {\n\t\tpadding-right: 10px;\n\t\twidth: calc(100% - 35px);\n\t\tbox-sizing: border-box;\n\t}\n`;\n\nconst buttonLinkPillarBaseStyles = css`\n\tbutton {\n\t\tcolor: ${schemedPalette('--discussion-accent-text')};\n\t\tbackground-color: transparent;\n\t\theight: 18px;\n\t\tmin-height: 18px;\n\t\t/* Radius 0 is used to style focus halo */\n\t\tborder-radius: 0;\n\n\t\t:hover {\n\t\t\ttext-decoration: underline;\n\t\t\ttext-decoration-color: ${schemedPalette(\n\t\t\t\t'--discussion-accent-text',\n\t\t\t)};\n\t\t}\n\t}\n`;\n\nconst buttonLinkBaseStyles = css`\n\tbutton {\n\t\tcolor: ${schemedPalette('--discussion-subdued')};\n\t\tbackground-color: transparent;\n\t\theight: 18px;\n\t\tmin-height: 18px;\n\t\t/* Radius 0 is used to style focus halo */\n\t\tborder-radius: 0;\n\n\t\t:hover {\n\t\t\ttext-decoration: underline;\n\t\t\ttext-decoration-color: ${schemedPalette('--discussion-subdued')};\n\t\t}\n\t}\n`;\n\nconst subdued = css`\n\ttext-decoration: none;\n`;\n\n// In order to show as much of the usernames as possible without fixed widths:\n// - First label should shrink to contents but be no bigger than 60%\n// - Second label should never force first label less than its contents if less than 60%\n// - Second label should fill remaining space after above\n// - Both labels should truncate with ellipsis if they fill their space\n// Test page: https://codepen.io/gtrufitt/pen/LYGKQyY\n\nconst cssReplyAlphaDisplayName = css`\n\t${until.mobileLandscape} {\n\t\t${cssTextOverflowElip}\n\t\twidth: 100%;\n\t\tmax-width: fit-content;\n\t}\n`;\n\nconst cssReplyBetaDisplayName = css`\n\tmargin-top: -2px;\n\t${until.mobileLandscape} {\n\t\t${cssTextOverflowElip}\n\t\tmin-width: 40%;\n\t\tflex-grow: 1;\n\t}\n`;\n\nconst spacedColumnStyles = css`\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: ${space[1]}px;\n`;\n\nconst Space = ({ amount }: { amount: 1 | 2 | 3 | 4 | 5 | 6 | 9 | 12 | 24 }) => (\n\t<div\n\t\tcss={css`\n\t\t\twidth: ${space[amount]}px;\n\t\t`}\n\t/>\n);\n\nexport const Comment = ({\n\tcomment,\n\tisClosedForComments,\n\tisClosedForRecommendations,\n\tsetCommentBeingRepliedTo,\n\tuser,\n\tisReply,\n\twasScrolledTo,\n\tisMuted,\n\ttoggleMuteStatus,\n\tonPermalinkClick,\n\treportAbuse,\n\tisExpanded,\n}: Props) => {\n\tconst [isHighlighted, setIsHighlighted] = useState<boolean>(\n\t\tcomment.isHighlighted,\n\t);\n\tconst [showAbuseReportForm, setAbuseReportForm] = useState(false);\n\tconst [pickError, setPickError] = useState('');\n\n\tconst toggleSetShowForm = () => {\n\t\tsetAbuseReportForm(!showAbuseReportForm);\n\t};\n\n\tconst pick = async (staffUser: Staff) => {\n\t\tsetPickError('');\n\t\tconst response = await staffUser.onPick(comment.id);\n\t\tif (response.kind === 'error') {\n\t\t\tsetPickError(response.error);\n\t\t} else {\n\t\t\tsetIsHighlighted(response.value);\n\t\t}\n\t};\n\n\tconst unPick = async (staffUser: Staff) => {\n\t\tsetPickError('');\n\t\tconst response = await staffUser.onUnpick(comment.id);\n\t\tif (response.kind === 'error') {\n\t\t\tsetPickError(response.error);\n\t\t} else {\n\t\t\tsetIsHighlighted(response.value);\n\t\t}\n\t};\n\n\tconst showStaffBadge = comment.userProfile.badge.some(\n\t\t(obj) => obj['name'] === 'Staff',\n\t);\n\n\tconst showPickBadge = comment.status !== 'blocked' && isHighlighted;\n\n\t// A contributor could be e.g. a freelancer that commonly comments on articles.\n\t// In frontend we check/display the Staff badge else we check/display the\n\t// Contributor - we shouldn't see both Staff & Contributor badges.\n\t// https://github.com/guardian/frontend/blob/main/discussion/app/views/fragments/commentBadges.scala.html#L8\n\tconst showContributorBadge = comment.userProfile.badge.some(\n\t\t(obj) => obj['name'] === 'Contributor',\n\t);\n\n\treturn (\n\t\t<>\n\t\t\t{!!pickError && (\n\t\t\t\t<span\n\t\t\t\t\tcss={css`\n\t\t\t\t\t\tcolor: red;\n\t\t\t\t\t`}\n\t\t\t\t>\n\t\t\t\t\t{pickError}\n\t\t\t\t</span>\n\t\t\t)}\n\t\t\t<div\n\t\t\t\tid={`comment-${comment.id}`}\n\t\t\t\tdata-testid={comment.id}\n\t\t\t\tcss={[commentWrapper, wasScrolledTo && selectedStyles]}\n\t\t\t>\n\t\t\t\t<div css={avatarMargin}>\n\t\t\t\t\t<Avatar\n\t\t\t\t\t\timageUrl={comment.userProfile.avatar}\n\t\t\t\t\t\tdisplayName={comment.userProfile.displayName}\n\t\t\t\t\t\tsize={isReply ? 'small' : 'medium'}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\n\t\t\t\t<div css={commentDetails}>\n\t\t\t\t\t<header css={headerStyles}>\n\t\t\t\t\t\t<div css={cssReplyToWrapper}>\n\t\t\t\t\t\t\t<Column>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tcss={[\n\t\t\t\t\t\t\t\t\t\tcomment.responseTo &&\n\t\t\t\t\t\t\t\t\t\t\thideBelowMobileLandscape,\n\t\t\t\t\t\t\t\t\t\thideAboveMobileLandscape,\n\t\t\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Row>\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tcss={css`\n\t\t\t\t\t\t\t\t\t\t\t\tmargin-right: ${space[2]}px;\n\t\t\t\t\t\t\t\t\t\t\t`}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Avatar\n\t\t\t\t\t\t\t\t\t\t\t\timageUrl={\n\t\t\t\t\t\t\t\t\t\t\t\t\tcomment.userProfile.avatar\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tdisplayName={''}\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div css={spacedColumnStyles}>\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tcss={[\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolourStyles,\n\t\t\t\t\t\t\t\t\t\t\t\t\tboldFont,\n\t\t\t\t\t\t\t\t\t\t\t\t\tnegativeMargin,\n\t\t\t\t\t\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\t\thref={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomment.userProfile\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.webUrl\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\tcssOverrides={subdued}\n\t\t\t\t\t\t\t\t\t\t\t\t\trel=\"nofollow\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomment.userProfile\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.displayName\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t<Timestamp\n\t\t\t\t\t\t\t\t\t\t\t\tisoDateTime={\n\t\t\t\t\t\t\t\t\t\t\t\t\tcomment.isoDateTime\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\twebUrl={comment.webUrl}\n\t\t\t\t\t\t\t\t\t\t\t\tcommentId={comment.id}\n\t\t\t\t\t\t\t\t\t\t\t\tonPermalinkClick={\n\t\t\t\t\t\t\t\t\t\t\t\t\tonPermalinkClick\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</Row>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tcss={[\n\t\t\t\t\t\t\t\t\t\t!comment.responseTo &&\n\t\t\t\t\t\t\t\t\t\t\thideBelowMobileLandscape,\n\t\t\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Row>\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tcss={[\n\t\t\t\t\t\t\t\t\t\t\t\tcolourStyles,\n\t\t\t\t\t\t\t\t\t\t\t\tboldFont,\n\t\t\t\t\t\t\t\t\t\t\t\tcssReplyAlphaDisplayName,\n\t\t\t\t\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\thref={\n\t\t\t\t\t\t\t\t\t\t\t\t\tcomment.userProfile.webUrl\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tcssOverrides={subdued}\n\t\t\t\t\t\t\t\t\t\t\t\trel=\"nofollow\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\tcomment.userProfile\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.displayName\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t{comment.responseTo ? (\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tcss={[\n\t\t\t\t\t\t\t\t\t\t\t\t\tcolourStyles,\n\t\t\t\t\t\t\t\t\t\t\t\t\tregularFont,\n\t\t\t\t\t\t\t\t\t\t\t\t\tsvgReplyArrow,\n\t\t\t\t\t\t\t\t\t\t\t\t\tcssReplyBetaDisplayName,\n\t\t\t\t\t\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\t\thref={`#comment-${comment.responseTo.commentId}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\tcssOverrides={subdued}\n\t\t\t\t\t\t\t\t\t\t\t\t\ticon={<SvgIndent />}\n\t\t\t\t\t\t\t\t\t\t\t\t\ticonSide=\"left\"\n\t\t\t\t\t\t\t\t\t\t\t\t\trel=\"nofollow\"\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomment.responseTo\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.displayName\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t<></>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tcss={[\n\t\t\t\t\t\t\t\t\t\t\t\ttimestampWrapperStyles,\n\t\t\t\t\t\t\t\t\t\t\t\tcomment.responseTo &&\n\t\t\t\t\t\t\t\t\t\t\t\t\thideBelowMobileLandscape,\n\t\t\t\t\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Timestamp\n\t\t\t\t\t\t\t\t\t\t\t\tisoDateTime={\n\t\t\t\t\t\t\t\t\t\t\t\t\tcomment.isoDateTime\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\twebUrl={comment.webUrl}\n\t\t\t\t\t\t\t\t\t\t\t\tcommentId={comment.id}\n\t\t\t\t\t\t\t\t\t\t\t\tonPermalinkClick={\n\t\t\t\t\t\t\t\t\t\t\t\t\tonPermalinkClick\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</Row>\n\t\t\t\t\t\t\t\t\t<Row>\n\t\t\t\t\t\t\t\t\t\t{showStaffBadge && (\n\t\t\t\t\t\t\t\t\t\t\t<div css={iconWrapper}>\n\t\t\t\t\t\t\t\t\t\t\t\t<GuardianStaff />\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t{showContributorBadge &&\n\t\t\t\t\t\t\t\t\t\t\t!showStaffBadge && (\n\t\t\t\t\t\t\t\t\t\t\t\t<div css={iconWrapper}>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<GuardianContributor />\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t{showPickBadge && (\n\t\t\t\t\t\t\t\t\t\t\t<div css={iconWrapper}>\n\t\t\t\t\t\t\t\t\t\t\t\t<GuardianPick />\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t</Row>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</Column>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{comment.status !== 'blocked' && (\n\t\t\t\t\t\t\t<RecommendationCount\n\t\t\t\t\t\t\t\tcommentId={comment.id}\n\t\t\t\t\t\t\t\tinitialCount={comment.numRecommends}\n\t\t\t\t\t\t\t\talreadyRecommended={false}\n\t\t\t\t\t\t\t\tuser={user}\n\t\t\t\t\t\t\t\tuserMadeComment={\n\t\t\t\t\t\t\t\t\tuser?.profile.userId ===\n\t\t\t\t\t\t\t\t\tcomment.userProfile.userId\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tisClosedForRecommendations={\n\t\t\t\t\t\t\t\t\tisClosedForRecommendations\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</header>\n\n\t\t\t\t\t<div\n\t\t\t\t\t\tcss={[\n\t\t\t\t\t\t\tcomment.responseTo && hideBelowMobileLandscape,\n\t\t\t\t\t\t\thideAboveMobileLandscape,\n\t\t\t\t\t\t]}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Row>\n\t\t\t\t\t\t\t{showStaffBadge && (\n\t\t\t\t\t\t\t\t<div css={iconWrapper}>\n\t\t\t\t\t\t\t\t\t<GuardianStaff />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{showContributorBadge && !showStaffBadge && (\n\t\t\t\t\t\t\t\t<div css={iconWrapper}>\n\t\t\t\t\t\t\t\t\t<GuardianContributor />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t{showPickBadge && (\n\t\t\t\t\t\t\t\t<div css={iconWrapper}>\n\t\t\t\t\t\t\t\t\t<GuardianPick />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</Row>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{/* MUTED */}\n\t\t\t\t\t{isMuted && (\n\t\t\t\t\t\t<p css={blockedCommentStyles}>\n\t\t\t\t\t\t\t<Row>\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\tAll posts from this user have been muted on\n\t\t\t\t\t\t\t\t\tthis device.\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t<Space amount={1} />\n\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\tcss={[\n\t\t\t\t\t\t\t\t\t\tbuttonLinkBaseStyles,\n\t\t\t\t\t\t\t\t\t\tcss`\n\t\t\t\t\t\t\t\t\t\t\tbutton {\n\t\t\t\t\t\t\t\t\t\t\t\t${textSansBold12}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t`,\n\t\t\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\tpriority=\"subdued\"\n\t\t\t\t\t\t\t\t\t\tsize=\"xsmall\"\n\t\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\t\ttoggleMuteStatus(\n\t\t\t\t\t\t\t\t\t\t\t\tcomment.userProfile.userId,\n\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tdata-link-name=\"unmute-user\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tUnmute?\n\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</Row>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* BLOCKED */}\n\t\t\t\t\t{!isMuted && comment.status === 'blocked' && (\n\t\t\t\t\t\t<p\n\t\t\t\t\t\t\tcss={[blockedCommentStyles, commentLinkStyling]}\n\t\t\t\t\t\t\tdangerouslySetInnerHTML={{ __html: comment.body }}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\n\t\t\t\t\t{/* NORMAL */}\n\t\t\t\t\t{!isMuted && comment.status !== 'blocked' && (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tcss={[commentCss, commentLinkStyling]}\n\t\t\t\t\t\t\t\tdangerouslySetInnerHTML={{\n\t\t\t\t\t\t\t\t\t__html: comment.body,\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<div css={spaceBetween}>\n\t\t\t\t\t\t\t\t<Row>\n\t\t\t\t\t\t\t\t\t{/* When commenting is closed, no reply link shows at all */}\n\t\t\t\t\t\t\t\t\t{!isClosedForComments && (\n\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t{/* If user is not logged in we link to the login page */}\n\t\t\t\t\t\t\t\t\t\t\t{user ? (\n\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\tcss={[\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsvgReplyArrow,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbuttonLinkPillarBaseStyles,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcss`\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbutton {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t${textSansBold15}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t`,\n\t\t\t\t\t\t\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tpriority=\"subdued\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetCommentBeingRepliedTo(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomment,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ticon={<SvgIndent />}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ticonSide=\"left\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata-link-name=\"reply to comment\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tReply\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\t\tcss={[\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsvgReplyArrow,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcommentControlsLink,\n\t\t\t\t\t\t\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thref={`https://profile.theguardian.com/signin?returnUrl=${\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomment.webUrl\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}&${createAuthenticationEventParams(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'signin_to_reply_comment',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}`}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcssOverrides={subdued}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ticon={<SvgIndent />}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ticonSide=\"left\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\trel=\"nofollow\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* We use this span to scope the styling */}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span data-link-name=\"reply to comment\">\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tReply\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t<Space amount={4} />\n\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t<Space amount={4} />\n\t\t\t\t\t\t\t\t\t{/* Only staff can pick, and they cannot pick their own comment */}\n\t\t\t\t\t\t\t\t\t{user?.kind === 'Staff' &&\n\t\t\t\t\t\t\t\t\t\tuser.profile.userId !==\n\t\t\t\t\t\t\t\t\t\t\tcomment.userProfile.userId && (\n\t\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\t\tcss={[\n\t\t\t\t\t\t\t\t\t\t\t\t\tbuttonLinkPillarBaseStyles,\n\t\t\t\t\t\t\t\t\t\t\t\t\tcss`\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tbutton {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t${textSansBold15}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t`,\n\t\t\t\t\t\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\t\tpriority=\"subdued\"\n\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tisHighlighted\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? () => unPick(user)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: () => pick(user)\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\tdata-link-name={\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tisHighlighted\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'unpick-comment'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'pick-comment'\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\t\t{isHighlighted\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t? 'Unpick'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t: 'Pick'}\n\t\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</Row>\n\t\t\t\t\t\t\t\t<Row>\n\t\t\t\t\t\t\t\t\t{/* You can't mute unless logged in and you can't mute yourself */}\n\t\t\t\t\t\t\t\t\t{user &&\n\t\t\t\t\t\t\t\t\tcomment.userProfile.userId !==\n\t\t\t\t\t\t\t\t\t\tuser.profile.userId ? (\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tcss={[\n\t\t\t\t\t\t\t\t\t\t\t\tbuttonLinkBaseStyles,\n\t\t\t\t\t\t\t\t\t\t\t\tcss`\n\t\t\t\t\t\t\t\t\t\t\t\t\tbutton {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t${textSans12}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t`,\n\t\t\t\t\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\tpriority=\"subdued\"\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\t\t\t\t\t\t\ttoggleMuteStatus(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomment.userProfile\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.userId,\n\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tdata-link-name=\"mute-user\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\tMute\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t<></>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t<Space amount={4} />\n\t\t\t\t\t\t\t\t\t{isExpanded && (\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tcss={[\n\t\t\t\t\t\t\t\t\t\t\t\tbuttonLinkBaseStyles,\n\t\t\t\t\t\t\t\t\t\t\t\tcss`\n\t\t\t\t\t\t\t\t\t\t\t\t\tbutton {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t${textSans12}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t`,\n\t\t\t\t\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\t\t\t\t\tpriority=\"subdued\"\n\t\t\t\t\t\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={toggleSetShowForm}\n\t\t\t\t\t\t\t\t\t\t\t\tdata-link-name=\"Open report abuse\"\n\t\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t\tReport\n\t\t\t\t\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t{showAbuseReportForm && (\n\t\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\t\tcss={css`\n\t\t\t\t\t\t\t\t\t\t\t\tposition: relative;\n\t\t\t\t\t\t\t\t\t\t\t`}\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t<AbuseReportForm\n\t\t\t\t\t\t\t\t\t\t\t\ttoggleSetShowForm={\n\t\t\t\t\t\t\t\t\t\t\t\t\ttoggleSetShowForm\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tcommentId={comment.id}\n\t\t\t\t\t\t\t\t\t\t\t\treportAbuse={reportAbuse}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t</Row>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</>\n\t);\n};\n","import { css } from '@emotion/react';\nimport { textSansBold15 } from '@guardian/source/foundations';\nimport { Button } from '@guardian/source/react-components';\nimport { palette as themePalette } from '../../palette';\n\ntype Props = {\n\tonClick?: () => void | Promise<void>;\n\tchildren: string;\n\ttype?: 'submit';\n\tpriority?: 'primary' | 'secondary' | 'subdued';\n\ticon?: JSX.Element;\n\ticonSide?: 'left' | 'right';\n\tlinkName: string;\n\tsize?: 'xsmall' | 'small' | 'default';\n};\n\nconst buttonOverrides = (priority: 'primary' | 'secondary' | 'subdued') => {\n\tswitch (priority) {\n\t\tcase 'primary':\n\t\t\treturn css`\n\t\t\t\tbutton {\n\t\t\t\t\t${textSansBold15}\n\t\t\t\t\tbackground-color: ${themePalette(\n\t\t\t\t\t\t'--discussion-primary-button-background',\n\t\t\t\t\t)};\n\t\t\t\t\tcolor: ${themePalette('--discussion-button-text')};\n\n\t\t\t\t\t:hover {\n\t\t\t\t\t\tbackground-color: ${themePalette(\n\t\t\t\t\t\t\t'--discussion-button-background-hover',\n\t\t\t\t\t\t)};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t`;\n\n\t\tcase 'secondary':\n\t\t\treturn css`\n\t\t\t\tbutton {\n\t\t\t\t\t${textSansBold15}\n\t\t\t\t\tbackground-color: transparent;\n\t\t\t\t\tborder: 1px solid\n\t\t\t\t\t\t${themePalette('--discussion-accent-text')};\n\t\t\t\t\tcolor: ${themePalette('--discussion-accent-text')};\n\n\t\t\t\t\t:hover {\n\t\t\t\t\t\tbackground-color: ${themePalette(\n\t\t\t\t\t\t\t'--discussion-button-background-hover',\n\t\t\t\t\t\t)};\n\t\t\t\t\t\tborder: 1px solid\n\t\t\t\t\t\t\t${themePalette(\n\t\t\t\t\t\t\t\t'--discussion-button-background-hover',\n\t\t\t\t\t\t\t)};\n\t\t\t\t\t\tcolor: ${themePalette('--discussion-button-text')};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t`;\n\t\tcase 'subdued':\n\t\t\treturn css`\n\t\t\t\tbutton {\n\t\t\t\t\t${textSansBold15}\n\t\t\t\t\tbackground-color: transparent;\n\t\t\t\t\tcolor: ${themePalette('--discussion-accent-text')};\n\t\t\t\t\tborder-radius: 0;\n\t\t\t\t}\n\t\t\t`;\n\t}\n};\n\nexport const PillarButton = ({\n\tonClick,\n\ttype,\n\tpriority = 'primary',\n\tchildren,\n\ticon,\n\ticonSide,\n\tlinkName,\n\tsize = 'default',\n}: Props) => (\n\t<div css={buttonOverrides(priority)}>\n\t\t<Button\n\t\t\tpriority={priority}\n\t\t\tsize={size}\n\t\t\tonClick={onClick}\n\t\t\ttype={type}\n\t\t\ticon={icon}\n\t\t\ticonSide={iconSide}\n\t\t\tdata-link-name={linkName}\n\t\t>\n\t\t\t{children}\n\t\t</Button>\n\t</div>\n);\n","import { css } from '@emotion/react';\nimport { space, textSans15 } from '@guardian/source/foundations';\nimport { palette as schemedPalette } from '../../palette';\n\ntype Props = {\n\tpreviewHtml: string;\n\tshowSpout: boolean;\n};\n\nconst previewStyle = css`\n\t${textSans15}\n\tpadding: ${space[2]}px ${space[4]}px;\n\tbackground-color: ${schemedPalette('--discussion-preview-background')};\n\tborder-radius: 5px;\n\tmargin-top: 0;\n\tmargin-bottom: ${20}px;\n\tword-break: break-word;\n\n\tblockquote {\n\t\tmargin-top: ${space[3]}px;\n\t\tmargin-bottom: ${space[3]}px;\n\t\tmargin-left: ${space[5]}px;\n\t\tmargin-right: ${space[5]}px;\n\t\tpadding-left: ${space[2]}px;\n\t\tcolor: ${schemedPalette('--discussion-subdued')};\n\t}\n\n\ti {\n\t\tfont-style: italic;\n\t}\n\n\tb {\n\t\tfont-weight: bold;\n\t}\n\n\tcode {\n\t\t/* stylelint-disable-next-line property-disallowed-list -- Source doesn't have a monospace font */\n\t\tfont-family: monospace;\n\t\tfont-size: 1em;\n\t}\n\n\t/*\n\t\ttodo: this spacing is currently repeated here, on regular comments, and\n\t\ton TopPick comments; can we factor out the common styling for these\n\t\tthree components?\n\t*/\n\tp {\n\t\tmargin-top: 0;\n\t\tmargin-bottom: ${space[3]}px;\n\t}\n`;\n\nconst spout = css`\n\tdisplay: block;\n\tleft: 0;\n\twidth: 0;\n\theight: 0;\n\tborder-right: 1rem solid transparent;\n\tborder-bottom: 1rem solid\n\t\t${schemedPalette('--discussion-preview-background')};\n\tmargin-left: 12.5rem;\n\tborder-right-style: inset;\n`;\n\nexport const Preview = ({ previewHtml, showSpout }: Props) => (\n\t<>\n\t\t{showSpout && <div css={spout} />}\n\t\t<div\n\t\t\tcss={previewStyle}\n\t\t\tdangerouslySetInnerHTML={{ __html: previewHtml || '' }}\n\t\t/>\n\t</>\n);\n","import { css } from '@emotion/react';\nimport {\n\theadlineBold20,\n\tspace,\n\ttextSans15,\n} from '@guardian/source/foundations';\nimport { Link, TextInput } from '@guardian/source/react-components';\nimport { useState } from 'react';\nimport { palette as schemedPalette } from '../../palette';\nimport { useConfig } from '../ConfigContext';\nimport { PillarButton } from './PillarButton';\nimport { Preview } from './Preview';\nimport { Row } from './Row';\n\nconst textStyling = css`\n\t${textSans15};\n`;\n\nconst linkStyles = css`\n\tcolor: ${schemedPalette('--discussion-link')};\n`;\n\nconst Text = ({ children }: { children: React.ReactNode }) => (\n\t<p css={textStyling}>{children}</p>\n);\n\nconst inputLabelStyles = css`\n\t> label {\n\t\t> * {\n\t\t\tcolor: inherit;\n\t\t}\n\t}\n`;\nconst textInputStyles = css`\n\tbackground-color: transparent;\n\tcolor: inherit;\n`;\n\nconst h3Style = css`\n\t${headlineBold20};\n`;\n\ntype Props = {\n\terror?: string;\n\tsubmitForm: (userName: string) => Promise<void>;\n\tcancelSubmit: () => void;\n\tpreviewBody: string;\n};\n\nexport const FirstCommentWelcome = ({\n\terror = '',\n\tsubmitForm,\n\tcancelSubmit,\n\tpreviewBody,\n}: Props) => {\n\tconst { renderingTarget } = useConfig();\n\tconst [userName, setUserName] = useState<string>('');\n\n\tif (renderingTarget === 'Apps') {\n\t\treturn (\n\t\t\t<div\n\t\t\t\tcss={css`\n\t\t\t\t\tpadding: ${space[2]}px;\n\t\t\t\t`}\n\t\t\t>\n\t\t\t\t<h3 css={h3Style}>\n\t\t\t\t\tWelcome, you’re about to make your first comment!\n\t\t\t\t</h3>\n\n\t\t\t\t<Text>\n\t\t\t\t\tBefore you can post, you need to choose a username. Please\n\t\t\t\t\tdo this in your profile settings.\n\t\t\t\t</Text>\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div\n\t\t\tcss={css`\n\t\t\t\tpadding: ${space[2]}px;\n\t\t\t`}\n\t\t>\n\t\t\t<form\n\t\t\t\tonSubmit={(e) => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tvoid submitForm(userName);\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<h3 css={h3Style}>\n\t\t\t\t\tWelcome, you’re about to make your first comment!\n\t\t\t\t</h3>\n\t\t\t\t<Text>\n\t\t\t\t\tBefore you post, we’d like to thank you for joining the\n\t\t\t\t\tdebate - we’re glad you’ve chosen to participate and we\n\t\t\t\t\tvalue your opinions and experiences.\n\t\t\t\t</Text>\n\t\t\t\t<Text>\n\t\t\t\t\tPlease choose your username under which you would like all\n\t\t\t\t\tyour comments to show up. You can only set your username\n\t\t\t\t\tonce.\n\t\t\t\t</Text>\n\t\t\t\t<div css={inputLabelStyles}>\n\t\t\t\t\t<TextInput\n\t\t\t\t\t\tlabel=\"Username:\"\n\t\t\t\t\t\tsupporting=\"Must be 6-20 characters, letters and/or numbers only, no spaces.\"\n\t\t\t\t\t\tvalue={userName}\n\t\t\t\t\t\tonChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n\t\t\t\t\t\t\tsetUserName(e.target.value)\n\t\t\t\t\t\t}\n\t\t\t\t\t\twidth={30}\n\t\t\t\t\t\terror={error}\n\t\t\t\t\t\tcssOverrides={textInputStyles}\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<Text>\n\t\t\t\t\t<>\n\t\t\t\t\t\tPlease keep your posts respectful and abide by the{' '}\n\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\thref=\"/community-standards\"\n\t\t\t\t\t\t\tpriority=\"primary\"\n\t\t\t\t\t\t\tsubdued={true}\n\t\t\t\t\t\t\trel=\"nofollow\"\n\t\t\t\t\t\t\tcssOverrides={linkStyles}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<span css={textStyling}>community guidelines</span>\n\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t{` -`} and if you spot a comment you think doesn’t\n\t\t\t\t\t\tadhere to the guidelines, please use the ‘Report’ link\n\t\t\t\t\t\tnext to it to let us know.\n\t\t\t\t\t</>\n\t\t\t\t</Text>\n\t\t\t\t<Text>\n\t\t\t\t\tPlease preview your comment below and click ‘post’ when\n\t\t\t\t\tyou’re happy with it.\n\t\t\t\t</Text>\n\t\t\t\t<Preview previewHtml={previewBody} showSpout={false} />\n\t\t\t\t<Row>\n\t\t\t\t\t<PillarButton\n\t\t\t\t\t\tonClick={() => void submitForm(userName)}\n\t\t\t\t\t\tlinkName=\"post comment\"\n\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t>\n\t\t\t\t\t\tPost your comment\n\t\t\t\t\t</PillarButton>\n\t\t\t\t\t<div\n\t\t\t\t\t\tcss={css`\n\t\t\t\t\t\t\twidth: ${space[3]}px;\n\t\t\t\t\t\t`}\n\t\t\t\t\t></div>\n\t\t\t\t\t<PillarButton\n\t\t\t\t\t\tpriority=\"subdued\"\n\t\t\t\t\t\tonClick={cancelSubmit}\n\t\t\t\t\t\tlinkName=\"cancel-post-comment\"\n\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t>\n\t\t\t\t\t\tCancel\n\t\t\t\t\t</PillarButton>\n\t\t\t\t</Row>\n\t\t\t</form>\n\t\t</div>\n\t);\n};\n","import { css } from '@emotion/react';\nimport {\n\tspace,\n\ttextSans12,\n\ttextSans15,\n\ttextSansBold12,\n\tuntil,\n} from '@guardian/source/foundations';\nimport { Link, TextArea } from '@guardian/source/react-components';\nimport { InfoSummary } from '@guardian/source-development-kitchen/react-components';\nimport { useEffect, useState } from 'react';\nimport type {\n\tCommentType,\n\tReplyType,\n\tSignedInUser,\n\tUserProfile,\n} from '../../lib/discussion';\nimport { preview as defaultPreview } from '../../lib/discussionApi';\nimport { palette as schemedPalette } from '../../palette';\nimport { FirstCommentWelcome } from './FirstCommentWelcome';\nimport { PillarButton } from './PillarButton';\nimport { Preview } from './Preview';\nimport { Row } from './Row';\n\ntype Props = {\n\tshortUrl: string;\n\tuser: SignedInUser;\n\tonAddComment: (response: CommentType | ReplyType) => void;\n\tsetCommentBeingRepliedTo?: () => void;\n\tcommentBeingRepliedTo?: CommentType | ReplyType;\n\tonPreview?: typeof defaultPreview;\n\terror: string;\n\tsetError: (error: string) => void;\n\tuserNameMissing: boolean;\n\tsetUserNameMissing: (isUserNameMissing: boolean) => void;\n\tpreviewBody: string;\n\tsetPreviewBody: (previewBody: string) => void;\n};\n\nconst boldString = (str: string) => `<b>${str}</b>`;\nconst italicsString = (str: string) => `<i>${str}</i>`;\nconst strikethroughString = (str: string) => `<del>${str}</del>`;\nconst codeString = (str: string) => `<code>${str}</code>`;\nconst quoteString = (str: string) => `<blockquote>${str}</blockquote>`;\nconst linkStringFunc = (url: string, highlightedText?: string) =>\n\t`<a href=\"${url}\" rel=\"nofollow\">${\n\t\thighlightedText ? highlightedText : url\n\t}</a>`;\n\nconst formWrapper = css`\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tmargin-bottom: ${space[5]}px;\n`;\n\nconst commentTextArea = css`\n\twidth: 100%;\n\tmargin-bottom: ${space[3]}px;\n\tpadding: 8px 10px 10px 8px;\n\t${textSans15};\n\tborder-color: ${schemedPalette('--discussion-border')};\n\t:focus {\n\t\tborder-color: ${schemedPalette('--discussion-subdued')};\n\t\toutline: none;\n\t}\n\tcolor: inherit;\n\tbackground-color: ${schemedPalette('--comment-form-input-background')};\n`;\n\nconst greyPlaceholder = css`\n\t::placeholder {\n\t\tcolor: ${schemedPalette('--discussion-subdued')};\n\t}\n`;\n\n// Opacity? See: https://stackoverflow.com/questions/19621306/css-placeholder-text-color-on-firefox\nconst blackPlaceholder = css`\n\t::placeholder {\n\t\tfont-weight: bold;\n\t\topacity: 1;\n\t\tcolor: inherit;\n\t}\n`;\n\nconst headerTextStyles = css`\n\tmargin: 0 0 10px 0;\n\t${textSans12};\n`;\n\nconst linkStyles = css`\n\ta {\n\t\tcolor: ${schemedPalette('--discussion-link')};\n\t\ttext-decoration: none;\n\t\t:hover,\n\t\t:focus {\n\t\t\ttext-decoration: underline;\n\t\t}\n\t}\n`;\n\nconst wrapperHeaderTextStyles = css`\n\tbackground-color: ${schemedPalette('--comment-form-header-background')};\n\tpadding: 8px 10px 10px 8px;\n\twidth: 100%;\n\tmargin-top: 8px;\n\tmargin-bottom: 2px;\n`;\n\nconst commentAddOns = css`\n\theight: 22px;\n\tfont-size: 13px;\n\tline-height: 17px;\n\tborder: 1px solid ${schemedPalette('--discussion-background')};\n\tbackground-color: ${schemedPalette('--discussion-background')};\n\tcolor: inherit;\n\ttext-align: center;\n\tcursor: pointer;\n\tmargin-left: 4px;\n\tpadding: 2px 5px 0px 5px;\n\tmin-width: 11px;\n\tlist-style-type: none;\n`;\n\nconst preModMessage = css`\n\t& div {\n\t\tcolor: inherit;\n\t\t${textSansBold12};\n\t\tsvg {\n\t\t\tfill: ${schemedPalette('--discussion-pre-mod')};\n\t\t}\n\t}\n`;\n\nconst preModLink = css`\n\tcolor: ${schemedPalette('--discussion-pre-mod')};\n\t${textSansBold12};\n`;\n\nconst bottomContainer = css`\n\twidth: 100%;\n\tdisplay: flex;\n\tflex-direction: row;\n\tflex-wrap: wrap;\n\tjustify-content: space-between;\n\talign-items: stretch;\n\talign-content: space-between;\n\tgap: ${space[3]}px;\n\t${until.wide} {\n\t\tflex-direction: column-reverse;\n\t}\n`;\n\nconst Space = ({ amount }: { amount: 1 | 2 | 3 | 4 | 5 | 6 | 9 | 12 | 24 }) => (\n\t<div\n\t\tcss={css`\n\t\t\twidth: ${space[amount]}px;\n\t\t`}\n\t/>\n);\n\n/**\n * The returned object below is a simulation of the comment that was created that\n * we add to our local state so that the reader has immediate feedback.\n * We do this because the API has a 1 minute cache expiry so simply refreshing\n * the main list of comments often will not return the comment just added.\n *\n * Edge case: If the user _does_ refresh then this local state will be overridden\n * by the new API response and - if the refresh was within 60 seconds - the\n * reader's comment will not be present. The same edge case exists in frontend.\n */\nconst simulateNewComment = (\n\tcommentId: string,\n\tbody: string,\n\tuserProfile: UserProfile,\n): CommentType => ({\n\tid: commentId,\n\tbody,\n\tdate: Date(),\n\tisoDateTime: new Date().toISOString(),\n\tstatus: 'visible',\n\twebUrl: `https://discussion.theguardian.com/comment-permalink/${commentId}`,\n\tapiUrl: `https://discussion.guardianapis.com/discussion-api/comment/${commentId}`,\n\tnumRecommends: 0,\n\tisHighlighted: false,\n\tuserProfile,\n\tresponses: [],\n});\n\nconst simulateNewReply = (\n\tcommentId: string,\n\tbody: string,\n\tuserProfile: UserProfile,\n\tcommentBeingRepliedTo: CommentType | ReplyType,\n): ReplyType => ({\n\tid: commentId,\n\tbody,\n\tdate: Date(),\n\tisoDateTime: new Date().toISOString(),\n\tstatus: 'visible',\n\twebUrl: `https://discussion.theguardian.com/comment-permalink/${commentId}`,\n\tapiUrl: `https://discussion.guardianapis.com/discussion-api/comment/${commentId}`,\n\tnumRecommends: 0,\n\tisHighlighted: false,\n\tuserProfile,\n\tresponseTo: {\n\t\tdisplayName: commentBeingRepliedTo.userProfile.displayName,\n\t\tcommentApiUrl: `https://discussion.guardianapis.com/discussion-api/comment/${commentBeingRepliedTo.id}`,\n\t\tisoDateTime: commentBeingRepliedTo.isoDateTime,\n\t\tdate: commentBeingRepliedTo.date,\n\t\tcommentId: String(commentBeingRepliedTo.id),\n\t\tcommentWebUrl: `https://discussion.theguardian.com/comment-permalink/${commentBeingRepliedTo.id}`,\n\t},\n});\n\nexport const CommentForm = ({\n\tshortUrl,\n\tonAddComment,\n\tuser,\n\tsetCommentBeingRepliedTo,\n\tcommentBeingRepliedTo,\n\tonPreview,\n\terror,\n\tsetError,\n\tuserNameMissing,\n\tsetUserNameMissing,\n\tpreviewBody,\n\tsetPreviewBody,\n}: Props) => {\n\tconst [isActive, setIsActive] = useState(false);\n\tconst [isDisabled, setIsDisabled] = useState(false);\n\tconst [selectionStart, setSelectionStart] = useState(0);\n\tconst [selectionEnd, setSelectionEnd] = useState(0);\n\tconst [textValue, setTextValue] = useState('');\n\n\tconst handleSelect = (event: React.ChangeEvent<HTMLTextAreaElement>) => {\n\t\tsetSelectionStart(event.target.selectionStart);\n\t\tsetSelectionEnd(event.target.selectionEnd);\n\t};\n\n\tconst handleTextChange = (\n\t\tevent: React.ChangeEvent<HTMLTextAreaElement>,\n\t) => {\n\t\tsetTextValue(event.target.value);\n\t};\n\n\tconst setBody = (body: string) => {\n\t\tsetTextValue(body);\n\t};\n\n\tuseEffect(() => {\n\t\tif (commentBeingRepliedTo) {\n\t\t\tdocument\n\t\t\t\t.getElementById(`comment-${commentBeingRepliedTo.id}`)\n\t\t\t\t?.scrollIntoView();\n\t\t\tdocument\n\t\t\t\t.querySelector<HTMLTextAreaElement>(\n\t\t\t\t\t`#comment-reply-form-${commentBeingRepliedTo.id} textarea`,\n\t\t\t\t)\n\t\t\t\t?.focus();\n\t\t}\n\t}, [commentBeingRepliedTo]);\n\n\tconst getHighlightedString = ():\n\t\t| {\n\t\t\t\thighlightedString: string;\n\t\t\t\tstartString: string;\n\t\t\t\tendString: string;\n\t\t  }\n\t\t| undefined => {\n\t\tconst value = textValue;\n\n\t\tconst startString = value.substring(0, selectionStart);\n\t\tconst highlightedString = value.substring(selectionStart, selectionEnd);\n\t\tconst endString = value.substring(selectionEnd, value.length);\n\t\treturn { startString, highlightedString, endString };\n\t};\n\n\tconst transformText = (\n\t\ttransfromFunc: (highlightedString: string) => string,\n\t) => {\n\t\tconst textAreaStrings = getHighlightedString();\n\t\tif (!textAreaStrings) return;\n\t\tconst { startString, highlightedString, endString } = textAreaStrings;\n\t\tsetBody(\n\t\t\tstartString.concat(transfromFunc(highlightedString), endString),\n\t\t);\n\t};\n\n\tconst transformLink = () => {\n\t\tconst url = prompt('Your URL:', 'http://www.');\n\t\tif (url === null) return;\n\t\tconst textAreaStrings = getHighlightedString();\n\t\tif (!textAreaStrings) return;\n\t\tconst { startString, highlightedString, endString } = textAreaStrings;\n\t\tsetBody(\n\t\t\tstartString.concat(\n\t\t\t\tlinkStringFunc(url, highlightedString),\n\t\t\t\tendString,\n\t\t\t),\n\t\t);\n\t};\n\n\tconst fetchShowPreview = async () => {\n\t\tconst body = textValue;\n\t\tif (!body) return;\n\n\t\tconst preview = onPreview ?? defaultPreview;\n\t\tconst response = await preview(body);\n\n\t\tif (response.kind === 'error') {\n\t\t\tsetError('Preview request failed, please try again');\n\t\t\tsetPreviewBody('');\n\t\t\treturn;\n\t\t}\n\n\t\tsetPreviewBody(response.value);\n\t};\n\n\tconst handleError = (commentError: string) => {\n\t\tswitch (commentError) {\n\t\t\t// Reader has never posted before and needs to choose a username\n\t\t\tcase 'USERNAME_MISSING':\n\t\t\t\treturn setUserNameMissing(true);\n\t\t\tcase 'EMPTY_COMMENT_BODY':\n\t\t\t\treturn setError('Please write a comment.');\n\t\t\tcase 'COMMENT_TOO_LONG':\n\t\t\t\treturn setError(\n\t\t\t\t\t'Your comment must be fewer than 5000 characters long.',\n\t\t\t\t);\n\t\t\tcase 'USER_BANNED':\n\t\t\t\treturn setError(\n\t\t\t\t\t'Commenting has been disabled for this account (<a href=\"/community-faqs#321a\">why?</a>).',\n\t\t\t\t);\n\t\t\tcase 'IP_THROTTLED':\n\t\t\t\treturn setError(\n\t\t\t\t\t'Commenting has been temporarily blocked for this IP address (<a href=\"/community-faqs\">why?</a>).',\n\t\t\t\t);\n\t\t\tcase 'DISCUSSION_CLOSED':\n\t\t\t\treturn setError(\n\t\t\t\t\t'Sorry your comment can not be published as the discussion is now closed for comments.',\n\t\t\t\t);\n\t\t\tcase 'PARENT_COMMENT_MODERATED':\n\t\t\t\treturn setError(\n\t\t\t\t\t'Sorry the comment can not be published as the comment you replied to has been moderated since.',\n\t\t\t\t);\n\t\t\tcase 'COMMENT_RATE_LIMIT_EXCEEDED':\n\t\t\t\treturn setError(\n\t\t\t\t\t'You can only post one comment every minute. Please try again in a moment.',\n\t\t\t\t);\n\t\t\tcase 'INVALID_PROTOCOL':\n\t\t\t\treturn setError(`Sorry your comment can not be published as it was not sent over\n\t\t\t\t\ta secure channel. Please report us this issue using the technical issue link\n\t\t\t\t\tin the page footer.`);\n\t\t\tcase 'AUTH_COOKIE_INVALID':\n\t\t\t\treturn setError(\n\t\t\t\t\t'Sorry, your comment was not published as you are no longer signed in. Please sign in and try again.',\n\t\t\t\t);\n\t\t\tcase 'READ-ONLY-MODE':\n\t\t\t\treturn setError(`Sorry your comment can not currently be published as\n\t\t\t\t\tcommenting is undergoing maintenance but will be back shortly. Please try\n\t\t\t\t\tagain in a moment.`);\n\t\t\tcase 'API_CORS_BLOCKED':\n\t\t\t\treturn setError(`Could not post due to your internet settings, which might be\n\t\t\t\t   controlled by your provider. Please contact your administrator\n\t\t\t\t   or disable any proxy servers or VPNs and try again.`);\n\t\t\tcase 'API_ERROR':\n\t\t\t\treturn setError(`Sorry, there was a problem posting your comment. Please try\n\t\t\t\t\tanother browser or network connection.  Reference code `);\n\t\t\tcase 'EMAIL_NOT_VALIDATED':\n\t\t\t\t// TODO: Support resending verification email\n\t\t\t\treturn setError(`Please confirm your email address to comment.<br />\n\t\t\t\t\tIf you can't find the email, we can\n\t\t\t\t\t<a href=\"#\">\n\t\t\t\t\t<strong>resend the verification email</strong></a> to your email\n\t\t\t\t\taddress.`);\n\t\t\tdefault:\n\t\t\t\treturn setError(\n\t\t\t\t\t'Sorry, there was a problem posting your comment.',\n\t\t\t\t);\n\t\t}\n\t};\n\n\tconst resetForm = () => {\n\t\tsetError('');\n\t\tsetBody('');\n\t\tsetPreviewBody('');\n\t\tsetIsActive(false);\n\t\tsetCommentBeingRepliedTo?.();\n\t};\n\n\tconst submitForm = async () => {\n\t\tif (isDisabled) return;\n\t\tsetIsDisabled(true);\n\t\tsetError('');\n\n\t\tconst body = textValue;\n\n\t\tif (body) {\n\t\t\tconst response = commentBeingRepliedTo\n\t\t\t\t? await user.onReply(shortUrl, body, commentBeingRepliedTo.id)\n\t\t\t\t: await user.onComment(shortUrl, body);\n\t\t\t// Check response message for error states\n\t\t\tif (response.kind === 'error') {\n\t\t\t\thandleError(response.error);\n\t\t\t} else {\n\t\t\t\tonAddComment(\n\t\t\t\t\tcommentBeingRepliedTo\n\t\t\t\t\t\t? simulateNewReply(\n\t\t\t\t\t\t\t\tresponse.value,\n\t\t\t\t\t\t\t\tbody,\n\t\t\t\t\t\t\t\tuser.profile,\n\t\t\t\t\t\t\t\tcommentBeingRepliedTo,\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: simulateNewComment(\n\t\t\t\t\t\t\t\tresponse.value,\n\t\t\t\t\t\t\t\tbody,\n\t\t\t\t\t\t\t\tuser.profile,\n\t\t\t\t\t\t  ),\n\t\t\t\t);\n\t\t\t\tresetForm();\n\t\t\t}\n\t\t}\n\t\tsetIsDisabled(false);\n\t};\n\n\tconst submitUserName = async (userName: string) => {\n\t\tsetError('');\n\t\tif (!userName) {\n\t\t\tsetError('Username field cannot be empty');\n\t\t\treturn;\n\t\t}\n\n\t\tconst response = await user.addUsername(userName);\n\t\tif (response.kind === 'ok') {\n\t\t\t// If we are able to submit userName we should continue with submitting comment\n\t\t\tvoid submitForm();\n\t\t\tsetUserNameMissing(false);\n\t\t} else {\n\t\t\tsetError(response.error);\n\t\t}\n\t};\n\n\tif (isActive && userNameMissing) {\n\t\treturn (\n\t\t\t<FirstCommentWelcome\n\t\t\t\terror={error}\n\t\t\t\tsubmitForm={submitUserName}\n\t\t\t\tcancelSubmit={() => setUserNameMissing(false)}\n\t\t\t\tpreviewBody={previewBody}\n\t\t\t/>\n\t\t);\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t<form\n\t\t\t\tcss={formWrapper}\n\t\t\t\tonSubmit={(e) => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tvoid submitForm();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t{isActive && (\n\t\t\t\t\t<div css={wrapperHeaderTextStyles}>\n\t\t\t\t\t\t<p css={[headerTextStyles, linkStyles]}>\n\t\t\t\t\t\t\tPlease keep comments respectful and abide by the{' '}\n\t\t\t\t\t\t\t<a href=\"/community-standards\">\n\t\t\t\t\t\t\t\tcommunity guidelines\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t{user.profile.privateFields?.isPremoderated && (\n\t\t\t\t\t\t\t<InfoSummary\n\t\t\t\t\t\t\t\tmessage={\n\t\t\t\t\t\t\t\t\t'Your comments are currently being pre-moderated'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcontext={\n\t\t\t\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\t\t\t\thref=\"/community-faqs#311\"\n\t\t\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\t\t\trel=\"nofollow\"\n\t\t\t\t\t\t\t\t\t\tcssOverrides={preModLink}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t(why?)\n\t\t\t\t\t\t\t\t\t</Link>\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcssOverrides={preModMessage}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t\t<TextArea\n\t\t\t\t\tdata-testid=\"comment-input\"\n\t\t\t\t\tplaceholder={\n\t\t\t\t\t\t!!commentBeingRepliedTo || !isActive\n\t\t\t\t\t\t\t? 'Join the discussion'\n\t\t\t\t\t\t\t: ''\n\t\t\t\t\t}\n\t\t\t\t\tcssOverrides={css([\n\t\t\t\t\t\tcommentTextArea,\n\t\t\t\t\t\tcommentBeingRepliedTo && isActive && greyPlaceholder,\n\t\t\t\t\t\t!commentBeingRepliedTo && !isActive && blackPlaceholder,\n\t\t\t\t\t])}\n\t\t\t\t\tstyle={{ height: isActive ? '132px' : '50px' }}\n\t\t\t\t\tonFocus={() => setIsActive(true)}\n\t\t\t\t\tvalue={textValue}\n\t\t\t\t\tonChange={handleTextChange}\n\t\t\t\t\tonSelect={handleSelect}\n\t\t\t\t\tlabel={''}\n\t\t\t\t\terror={error}\n\t\t\t\t/>\n\t\t\t\t<div css={bottomContainer}>\n\t\t\t\t\t<Row wrap={true}>\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<PillarButton\n\t\t\t\t\t\t\t\ttype=\"submit\"\n\t\t\t\t\t\t\t\tlinkName=\"post comment\"\n\t\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tPost your comment\n\t\t\t\t\t\t\t</PillarButton>\n\t\t\t\t\t\t\t{isActive && (\n\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t<Space amount={3} />\n\t\t\t\t\t\t\t\t\t<PillarButton\n\t\t\t\t\t\t\t\t\t\tonClick={fetchShowPreview}\n\t\t\t\t\t\t\t\t\t\tpriority=\"secondary\"\n\t\t\t\t\t\t\t\t\t\tlinkName=\"preview-comment\"\n\t\t\t\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tPreview\n\t\t\t\t\t\t\t\t\t</PillarButton>\n\t\t\t\t\t\t\t\t\t<Space amount={3} />\n\n\t\t\t\t\t\t\t\t\t<PillarButton\n\t\t\t\t\t\t\t\t\t\tonClick={resetForm}\n\t\t\t\t\t\t\t\t\t\tpriority=\"subdued\"\n\t\t\t\t\t\t\t\t\t\tlinkName=\"cancel-post-comment\"\n\t\t\t\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tCancel\n\t\t\t\t\t\t\t\t\t</PillarButton>\n\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</>\n\t\t\t\t\t</Row>\n\t\t\t\t\t{isActive && (\n\t\t\t\t\t\t<Row wrap={true}>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\ttransformText(boldString);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tcss={commentAddOns}\n\t\t\t\t\t\t\t\tstyle={{ fontWeight: 'bold' }}\n\t\t\t\t\t\t\t\tdata-link-name=\"formatting-controls-bold\"\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\ttitle=\"Bold\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tbold\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\ttransformText(italicsString);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tcss={commentAddOns}\n\t\t\t\t\t\t\t\tstyle={{ fontStyle: 'italic' }}\n\t\t\t\t\t\t\t\tdata-link-name=\"formatting-controls-italic\"\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\ttitle=\"Italic\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\titalic\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\ttransformText(strikethroughString);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tcss={commentAddOns}\n\t\t\t\t\t\t\t\tstyle={{ textDecoration: 'line-through' }}\n\t\t\t\t\t\t\t\tdata-link-name=\"formatting-controls-strikethrough\"\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\ttitle=\"Strikethrough\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tstrikethrough\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\ttransformText(codeString);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tcss={commentAddOns}\n\t\t\t\t\t\t\t\tstyle={{ fontFamily: 'monospace' }}\n\t\t\t\t\t\t\t\tdata-link-name=\"formatting-controls-code\"\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\ttitle=\"Code\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{`<code>`}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\ttransformText(quoteString);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tcss={commentAddOns}\n\t\t\t\t\t\t\t\tdata-link-name=\"formatting-controls-quote\"\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\ttitle=\"Quote\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\"quote\"\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\tonClick={(e) => {\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\ttransformLink();\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tcss={commentAddOns}\n\t\t\t\t\t\t\t\tstyle={{ textDecoration: 'underline' }}\n\t\t\t\t\t\t\t\tdata-link-name=\"formatting-controls-link\"\n\t\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t\t\ttitle=\"Link\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tLink\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</Row>\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t</form>\n\n\t\t\t{previewBody.trim() !== '' && (\n\t\t\t\t<Preview previewHtml={previewBody} showSpout={true} />\n\t\t\t)}\n\t\t</>\n\t);\n};\n","import { css } from '@emotion/react';\nimport {\n\tspace,\n\ttextSans15,\n\ttextSansBold15,\n} from '@guardian/source/foundations';\nimport { Button, SvgIndent } from '@guardian/source/react-components';\nimport { useState } from 'react';\nimport type { CommentType, ReplyType } from '../../lib/discussion';\nimport { palette as schemedPalette } from '../../palette';\nimport { Row } from './Row';\n\ntype Props = {\n\tcommentBeingRepliedTo: CommentType | ReplyType;\n};\n\nconst Space = ({ amount }: { amount: 1 | 2 | 3 | 4 | 5 | 6 | 9 | 12 | 24 }) => (\n\t<div\n\t\tcss={css`\n\t\t\twidth: ${space[amount]}px;\n\t\t`}\n\t/>\n);\n\nconst indentStyles = css`\n\twidth: 18px;\n\tsvg {\n\t\t/* stylelint-disable-next-line declaration-no-important */\n\t\tfill: ${schemedPalette('--discussion-subdued')} !important;\n\t}\n`;\n\nconst smallFontStyles = css`\n\t${textSans15};\n\tline-height: 19px;\n`;\n\nconst replyPreviewHeaderStyle = css`\n\t${textSansBold15};\n\tmargin-top: 0px;\n\tmargin-bottom: ${space[2]}px;\n`;\n\nconst arrowSize = 15;\n\nconst previewStyle = css`\n\tpadding-top: ${space[3]}px;\n\tpadding-bottom: ${space[3]}px;\n\tpadding-left: ${space[5]}px;\n\tpadding-right: ${space[5]}px;\n\tbackground-color: ${schemedPalette('--discussion-top-pick-background')};\n\tmargin-top: ${arrowSize}px;\n\tmargin-bottom: ${arrowSize + 5}px;\n\tposition: relative;\n\tdisplay: flex;\n\tflex-direction: column;\n\t:before {\n\t\tcontent: '';\n\t\tposition: absolute;\n\t\tborder-left: ${arrowSize}px solid\n\t\t\t${schemedPalette('--discussion-top-pick-background')};\n\t\tborder-top: ${arrowSize}px solid transparent;\n\t\ttop: -${arrowSize - 1}px;\n\t\tmargin-left: ${space[9]}px;\n\t}\n`;\n\nconst commentStyles = css`\n\tp {\n\t\t${textSans15};\n\t\tmargin-top: 0px;\n\t\tmargin-bottom: ${space[3]}px;\n\t}\n`;\n\nconst blueLink = css`\n\tcolor: ${schemedPalette('--discussion-link')};\n`;\n\nconst buttonLinkPillarBaseStyles = css`\n\tbutton {\n\t\tcolor: ${schemedPalette('--discussion-accent-text')};\n\t\tbackground-color: transparent;\n\t\theight: 18px;\n\t\tmin-height: 18px;\n\t\t/* Radius 0 is used to style focus halo */\n\t\tborder-radius: 0;\n\n\t\t:hover {\n\t\t\ttext-decoration: underline;\n\t\t\ttext-decoration-color: ${schemedPalette(\n\t\t\t\t'--discussion-accent-text',\n\t\t\t)};\n\t\t}\n\t}\n`;\n\nconst buttonLinkBaseStyles = css`\n\tbutton {\n\t\tcolor: ${schemedPalette('--discussion-subdued')};\n\t\tbackground-color: transparent;\n\t\theight: 18px;\n\t\tmin-height: 18px;\n\t\t/* Radius 0 is used to style focus halo */\n\t\tborder-radius: 0;\n\n\t\t:hover {\n\t\t\ttext-decoration: underline;\n\t\t\ttext-decoration-color: ${schemedPalette('--discussion-subdued')};\n\t\t}\n\t}\n`;\n\nexport const CommentReplyPreview = ({ commentBeingRepliedTo }: Props) => {\n\tconst [displayReplyComment, setDisplayReplyComment] =\n\t\tuseState<boolean>(false);\n\treturn (\n\t\t<>\n\t\t\t<Row>\n\t\t\t\t<div css={indentStyles}>\n\t\t\t\t\t<SvgIndent />\n\t\t\t\t</div>\n\t\t\t\t<Space amount={1} />\n\t\t\t\t<div css={smallFontStyles}>\n\t\t\t\t\t{commentBeingRepliedTo.userProfile.displayName}\n\t\t\t\t</div>\n\t\t\t\t<Space amount={3} />\n\t\t\t\t<div\n\t\t\t\t\tcss={[\n\t\t\t\t\t\tbuttonLinkPillarBaseStyles,\n\t\t\t\t\t\tcss`\n\t\t\t\t\t\t\tbutton {\n\t\t\t\t\t\t\t\t${textSansBold15}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t`,\n\t\t\t\t\t]}\n\t\t\t\t>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tpriority=\"subdued\"\n\t\t\t\t\t\tonClick={() =>\n\t\t\t\t\t\t\tsetDisplayReplyComment(!displayReplyComment)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdata-link-name={\n\t\t\t\t\t\t\tdisplayReplyComment\n\t\t\t\t\t\t\t\t? 'reply-comment-hide'\n\t\t\t\t\t\t\t\t: 'reply-comment-show'\n\t\t\t\t\t\t}\n\t\t\t\t\t>\n\t\t\t\t\t\t{displayReplyComment ? 'Hide Comment' : 'Show comment'}\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t</Row>\n\t\t\t{displayReplyComment && (\n\t\t\t\t<Preview\n\t\t\t\t\tcommentBeingRepliedTo={commentBeingRepliedTo}\n\t\t\t\t\tsetDisplayReplyComment={setDisplayReplyComment}\n\t\t\t\t\tdisplayReplyComment={displayReplyComment}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</>\n\t);\n};\n\nexport const Preview = ({\n\tcommentBeingRepliedTo,\n\tsetDisplayReplyComment,\n\tdisplayReplyComment,\n}: {\n\tcommentBeingRepliedTo: CommentType | ReplyType;\n\tsetDisplayReplyComment: (displayReplyComment: boolean) => void;\n\tdisplayReplyComment: boolean;\n}) => {\n\treturn (\n\t\t<div css={previewStyle}>\n\t\t\t<p css={replyPreviewHeaderStyle}>\n\t\t\t\t{commentBeingRepliedTo.userProfile.displayName} @{' '}\n\t\t\t\t{commentBeingRepliedTo.date} said:\n\t\t\t</p>\n\t\t\t<div\n\t\t\t\tcss={commentStyles}\n\t\t\t\tdangerouslySetInnerHTML={{\n\t\t\t\t\t__html: commentBeingRepliedTo.body || '',\n\t\t\t\t}}\n\t\t\t/>\n\t\t\t<div\n\t\t\t\tcss={[\n\t\t\t\t\tbuttonLinkBaseStyles,\n\t\t\t\t\tcss`\n\t\t\t\t\t\tbutton {\n\t\t\t\t\t\t\t${textSans15}\n\t\t\t\t\t\t}\n\t\t\t\t\t`,\n\t\t\t\t]}\n\t\t\t>\n\t\t\t\t<Button\n\t\t\t\t\tpriority=\"subdued\"\n\t\t\t\t\tonClick={() => setDisplayReplyComment(!displayReplyComment)}\n\t\t\t\t\tdata-link-name=\"hide-comment\"\n\t\t\t\t>\n\t\t\t\t\t<span css={blueLink}>Hide Comment</span>\n\t\t\t\t</Button>\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","import { css } from '@emotion/react';\nimport { space } from '@guardian/source/foundations';\nimport { SvgPlus } from '@guardian/source/react-components';\nimport { useState } from 'react';\nimport type {\n\tCommentType,\n\tReplyType,\n\tSignedInUser,\n\tThreadsType,\n} from '../../lib/discussion';\nimport type { preview, reportAbuse } from '../../lib/discussionApi';\nimport { getAllReplies } from '../../lib/discussionApi';\nimport { palette as schemedPalette } from '../../palette';\nimport { Comment } from './Comment';\nimport { CommentForm } from './CommentForm';\nimport { CommentReplyPreview } from './CommentReplyPreview';\nimport { PillarButton } from './PillarButton';\n\ntype Props = {\n\tcomment: CommentType | ReplyType;\n\tisClosedForComments: boolean;\n\tisClosedForRecommendations: boolean;\n\tshortUrl: string;\n\tuser?: SignedInUser;\n\tthreads: ThreadsType;\n\tcommentBeingRepliedTo?: CommentType | ReplyType;\n\tsetCommentBeingRepliedTo: (\n\t\tcommentBeingRepliedTo?: CommentType | ReplyType,\n\t) => void;\n\tcommentToScrollTo?: string;\n\tmutes: string[];\n\ttoggleMuteStatus: (userId: string) => void;\n\tonPermalinkClick: (commentId: string) => void;\n\tonPreview?: typeof preview;\n\terror: string;\n\tsetError: (error: string) => void;\n\tuserNameMissing: boolean;\n\tsetUserNameMissing: (isUserNameMissing: boolean) => void;\n\tpreviewBody: string;\n\tsetPreviewBody: (previewBody: string) => void;\n\treportAbuse: ReturnType<typeof reportAbuse>;\n\texpandCommentReplies: (commentId: string, responses: ReplyType[]) => void;\n\tisExpanded: boolean;\n};\n\nconst nestingStyles = css`\n\tlist-style-type: none;\n\tpadding-left: ${space[2]}px;\n\tmargin-left: ${space[12]}px;\n`;\n\nconst topBorder = css`\n\tborder-top: 1px solid ${schemedPalette('--discussion-border')};\n`;\n\nconst commentContainerStyles = css`\n\tlist-style-type: none;\n\tpadding-left: 0;\n`;\n\nconst selectedStyles = css`\n\tbackground-color: ${schemedPalette('--discussion-selected-background')};\n\tmargin-left: -${space[2]}px;\n\tpadding-left: ${space[2]}px;\n\tmargin-right: -${space[2]}px;\n\tpadding-right: ${space[2]}px;\n`;\n\nconst removeMargin = css`\n\tmargin: 0px;\n`;\n\nexport const avatar = (avatarSize: number) => css`\n\tborder-radius: ${avatarSize + 10}px;\n\twidth: ${avatarSize}px;\n\theight: ${avatarSize}px;\n`;\n\nexport const CommentContainer = ({\n\tcomment,\n\tisClosedForComments,\n\tisClosedForRecommendations,\n\tuser,\n\tshortUrl,\n\tthreads,\n\tcommentBeingRepliedTo,\n\tsetCommentBeingRepliedTo,\n\tcommentToScrollTo,\n\tmutes,\n\ttoggleMuteStatus,\n\tonPermalinkClick,\n\tonPreview,\n\terror,\n\tsetError,\n\tuserNameMissing,\n\tsetUserNameMissing,\n\tpreviewBody,\n\tsetPreviewBody,\n\treportAbuse,\n\texpandCommentReplies,\n\tisExpanded,\n}: Props) => {\n\tconst responses = comment.responses ? comment.responses : [];\n\tconst totalResponseCount = comment.metaData?.responseCount ?? 0;\n\n\t// Filter logic\n\tconst expanded = responses.length >= totalResponseCount;\n\tconst [loading, setLoading] = useState<boolean>(false);\n\n\tconst showResponses = threads !== 'unthreaded' && responses.length > 0;\n\n\tconst decideShowMoreText = () => {\n\t\tconst remainingResponses = totalResponseCount - responses.length;\n\t\treturn remainingResponses === 1\n\t\t\t? `Show 1 more reply`\n\t\t\t: `Show ${remainingResponses} more replies`;\n\t};\n\n\tconst expand = (commentId: string) => {\n\t\tsetLoading(true);\n\t\tgetAllReplies(commentId)\n\t\t\t.then((result) => {\n\t\t\t\tif (result.kind === 'error') {\n\t\t\t\t\tconsole.error(result.error);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\texpandCommentReplies(commentId, result.value);\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\t// do nothing\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tsetLoading(false);\n\t\t\t});\n\t};\n\n\tconst onAddReply = (commentId: string, response: ReplyType) =>\n\t\texpandCommentReplies(commentId, [...responses, response]);\n\n\treturn (\n\t\t<div css={[commentToScrollTo === comment.id && selectedStyles]}>\n\t\t\t<Comment\n\t\t\t\tcomment={comment}\n\t\t\t\tisClosedForComments={isClosedForComments}\n\t\t\t\tisClosedForRecommendations={isClosedForRecommendations}\n\t\t\t\tsetCommentBeingRepliedTo={setCommentBeingRepliedTo}\n\t\t\t\tuser={user}\n\t\t\t\tisReply={false}\n\t\t\t\tisMuted={mutes.includes(comment.userProfile.userId)}\n\t\t\t\ttoggleMuteStatus={toggleMuteStatus}\n\t\t\t\tonPermalinkClick={onPermalinkClick}\n\t\t\t\treportAbuse={reportAbuse}\n\t\t\t\tisExpanded={isExpanded}\n\t\t\t/>\n\n\t\t\t<>\n\t\t\t\t{showResponses && responses.length > 0 && (\n\t\t\t\t\t<div css={nestingStyles}>\n\t\t\t\t\t\t<ul css={[commentContainerStyles, removeMargin]}>\n\t\t\t\t\t\t\t{responses.map((responseComment) => (\n\t\t\t\t\t\t\t\t<li key={responseComment.id}>\n\t\t\t\t\t\t\t\t\t<Comment\n\t\t\t\t\t\t\t\t\t\tcomment={responseComment}\n\t\t\t\t\t\t\t\t\t\tisClosedForComments={\n\t\t\t\t\t\t\t\t\t\t\tisClosedForComments\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tisClosedForRecommendations={\n\t\t\t\t\t\t\t\t\t\t\tisClosedForRecommendations\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tsetCommentBeingRepliedTo={\n\t\t\t\t\t\t\t\t\t\t\tsetCommentBeingRepliedTo\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tuser={user}\n\t\t\t\t\t\t\t\t\t\tisReply={true}\n\t\t\t\t\t\t\t\t\t\twasScrolledTo={\n\t\t\t\t\t\t\t\t\t\t\tcommentToScrollTo ===\n\t\t\t\t\t\t\t\t\t\t\tresponseComment.id\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tisMuted={mutes.includes(\n\t\t\t\t\t\t\t\t\t\t\tresponseComment.userProfile.userId,\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\ttoggleMuteStatus={toggleMuteStatus}\n\t\t\t\t\t\t\t\t\t\tonPermalinkClick={onPermalinkClick}\n\t\t\t\t\t\t\t\t\t\treportAbuse={reportAbuse}\n\t\t\t\t\t\t\t\t\t\tisExpanded={isExpanded}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t{!expanded && (\n\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\tcss={[\n\t\t\t\t\t\t\t\t\ttopBorder,\n\t\t\t\t\t\t\t\t\tcss`\n\t\t\t\t\t\t\t\t\t\tpadding-top: ${space[3]}px;\n\t\t\t\t\t\t\t\t\t\tpadding-bottom: ${space[3]}px;\n\t\t\t\t\t\t\t\t\t`,\n\t\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<PillarButton\n\t\t\t\t\t\t\t\t\tpriority=\"secondary\"\n\t\t\t\t\t\t\t\t\ticon={<SvgPlus />}\n\t\t\t\t\t\t\t\t\ticonSide=\"left\"\n\t\t\t\t\t\t\t\t\tlinkName=\"Show more replies\"\n\t\t\t\t\t\t\t\t\tonClick={() => expand(comment.id)}\n\t\t\t\t\t\t\t\t\tsize=\"xsmall\"\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t{loading\n\t\t\t\t\t\t\t\t\t\t? 'loading...'\n\t\t\t\t\t\t\t\t\t\t: decideShowMoreText()}\n\t\t\t\t\t\t\t\t</PillarButton>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t)}\n\t\t\t\t{commentBeingRepliedTo &&\n\t\t\t\t\t(commentBeingRepliedTo.id === comment.id ||\n\t\t\t\t\t\tresponses.find(\n\t\t\t\t\t\t\t(response: ReplyType) =>\n\t\t\t\t\t\t\t\tresponse.id === commentBeingRepliedTo.id,\n\t\t\t\t\t\t)) &&\n\t\t\t\t\tuser && (\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tid={`comment-reply-form-${commentBeingRepliedTo.id}`}\n\t\t\t\t\t\t\tcss={nestingStyles}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<CommentReplyPreview\n\t\t\t\t\t\t\t\tcommentBeingRepliedTo={commentBeingRepliedTo}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t<CommentForm\n\t\t\t\t\t\t\t\tshortUrl={shortUrl}\n\t\t\t\t\t\t\t\tonAddComment={(response) => {\n\t\t\t\t\t\t\t\t\tif ('responses' in response) return;\n\t\t\t\t\t\t\t\t\tonAddReply(comment.id, response);\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\tuser={user}\n\t\t\t\t\t\t\t\tsetCommentBeingRepliedTo={\n\t\t\t\t\t\t\t\t\tsetCommentBeingRepliedTo\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcommentBeingRepliedTo={commentBeingRepliedTo}\n\t\t\t\t\t\t\t\tonPreview={onPreview}\n\t\t\t\t\t\t\t\terror={error}\n\t\t\t\t\t\t\t\tsetError={setError}\n\t\t\t\t\t\t\t\tuserNameMissing={userNameMissing}\n\t\t\t\t\t\t\t\tsetUserNameMissing={setUserNameMissing}\n\t\t\t\t\t\t\t\tpreviewBody={previewBody}\n\t\t\t\t\t\t\t\tsetPreviewBody={setPreviewBody}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t</>\n\t\t</div>\n\t);\n};\n","import { css } from '@emotion/react';\nimport {\n\tfrom,\n\ttextSans15,\n\ttextSansBold15,\n\tuntil,\n} from '@guardian/source/foundations';\nimport { useEffect, useState } from 'react';\nimport type { DropdownOptionType } from '../../lib/discussion';\nimport { palette as schemedPalette } from '../../palette';\n\ntype Props = {\n\tid: string;\n\tlabel: string;\n\toptions: DropdownOptionType[];\n\tonSelect: (value: string) => void;\n};\n\nconst containerStyles = css`\n\tposition: relative;\n`;\n\nconst ulStyles = css`\n\tz-index: 2;\n\tlist-style: none;\n\tborder: 1px solid ${schemedPalette('--discussion-border')};\n\tmargin-left: -8px;\n\tpadding: 0px;\n\tdisplay: none;\n\tbackground-color: ${schemedPalette('--discussion-background')};\n\n\tposition: absolute;\n\n\t${until.tablet} {\n\t\tmargin-top: 4px;\n\t\tborder-radius: 0;\n\t\toverflow: auto;\n\t}\n\n\t${from.tablet} {\n\t\tmargin-top: 12px;\n\t\tborder-radius: 3px;\n\t}\n`;\n\nconst ulExpanded = css`\n\tdisplay: block;\n`;\n\nconst linkStyles = (disabled: boolean) => css`\n\t${textSans15};\n\ttext-align: left;\n\tcolor: ${disabled\n\t\t? schemedPalette('--discussion-text')\n\t\t: schemedPalette('--discussion-subdued')};\n\tposition: relative;\n\ttext-decoration: none;\n\tmargin-top: 1px;\n\tpadding-top: 8px;\n\tpadding-right: 30px;\n\tpadding-bottom: 8px;\n\tpadding-left: 8px;\n\twidth: 100%;\n\tcursor: ${disabled ? 'default' : 'pointer'};\n\tbackground-color: white;\n\tborder: none;\n\n\t${!disabled &&\n\t`\n    :hover {\n      background-color: ${schemedPalette('--discussion-background')};\n      text-decoration: underline;\n    }\n\n    :focus {\n      text-decoration: underline;\n    }\n  `}\n`;\n\nconst firstStyles = css`\n\tmargin-top: 0;\n`;\n\nconst activeStyles = css`\n\tfont-weight: bold;\n\n\t:after {\n\t\tcontent: '';\n\t\tborder: 2px solid ${schemedPalette('--discussion-accent-text')};\n\t\tborder-top: 0px;\n\t\tborder-right: 0px;\n\t\tposition: absolute;\n\t\ttop: 12px;\n\t\tright: 12px;\n\t\twidth: 8px;\n\t\theight: 4px;\n\t\ttransform: rotate(-45deg);\n\t}\n`;\n\nconst buttonStyles = css`\n\t${textSans15};\n\t/**\n\t * Typography preset styles should not be overridden.\n\t * This has been done because the styles do not directly map to the new presets.\n\t * Please speak to your team's designer and update this to use a more appropriate preset.\n\t */\n\tfont-weight: 500;\n\tdisplay: block;\n\tcursor: pointer;\n\tbackground: none;\n\tborder: none;\n\t/* Design System: The buttons should be components that handle their own layout using primitives  */\n\tline-height: 1.2;\n\tcolor: ${schemedPalette('--discussion-subdued')};\n\ttransition: color 80ms ease-out;\n\tpadding: 0px 10px 6px 0px;\n\tmargin: 1px 0 0;\n\ttext-decoration: none;\n\n\t:hover {\n\t\t:after {\n\t\t\ttransform: translateY(0) rotate(45deg);\n\t\t}\n\t}\n\n\t:after {\n\t\tcontent: '';\n\t\tdisplay: inline-block;\n\t\twidth: 5px;\n\t\theight: 5px;\n\t\ttransform: translateY(-2px) rotate(45deg);\n\t\tborder: 1px solid currentColor;\n\t\tborder-left: transparent;\n\t\tborder-top: transparent;\n\t\tmargin-left: 5px;\n\t\tvertical-align: middle;\n\t\ttransition: transform 250ms ease-out;\n\t}\n`;\n\nconst expandedStyles = css`\n\t:hover:after {\n\t\ttransform: translateY(-1px) rotate(-135deg);\n\t}\n\t:after {\n\t\ttransform: translateY(1px) rotate(-135deg);\n\t}\n`;\n\nconst labelStyles = css`\n\t${textSansBold15};\n\tcolor: ${schemedPalette('--discussion-subdued')};\n`;\n\nexport const Dropdown = ({ id, label, options, onSelect }: Props) => {\n\tconst [isExpanded, setIsExpanded] = useState(false);\n\n\tuseEffect(() => {\n\t\tconst dismissOnEsc = (event: KeyboardEvent) => {\n\t\t\tif (isExpanded && event.code === 'Escape') {\n\t\t\t\tsetIsExpanded(false);\n\t\t\t}\n\t\t};\n\n\t\tdocument.addEventListener('keydown', dismissOnEsc, false);\n\n\t\t// Remove listener on unmount\n\t\treturn () => document.removeEventListener('keydown', dismissOnEsc);\n\t}, [isExpanded]);\n\n\tuseEffect(() => {\n\t\tconst dismissOnClick = (event: MouseEvent) => {\n\t\t\tif (isExpanded) {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tsetIsExpanded(false);\n\t\t\t}\n\t\t};\n\n\t\tdocument.addEventListener('click', dismissOnClick, false);\n\n\t\t// Remove listener on unmount\n\t\treturn () => document.removeEventListener('click', dismissOnClick);\n\t}, [isExpanded]);\n\n\t// needs to be unique to allow multiple dropdowns on same page\n\t// this should be unique because JS is single-threaded\n\tconst dropdownID = `dropbox-id-${id}`;\n\n\tconst activeLink = options.find((option) => option.isActive);\n\n\treturn (\n\t\t<div css={containerStyles}>\n\t\t\t<div css={labelStyles}>\n\t\t\t\t{label}\n\t\t\t\t<button\n\t\t\t\t\tonClick={() => setIsExpanded(!isExpanded)}\n\t\t\t\t\tcss={[buttonStyles, isExpanded && expandedStyles]}\n\t\t\t\t\taria-controls={dropdownID}\n\t\t\t\t\taria-expanded={isExpanded ? 'true' : 'false'}\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t>\n\t\t\t\t\t{activeLink ? activeLink.title : 'Please select'}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<ul id={dropdownID} css={[ulStyles, isExpanded && ulExpanded]}>\n\t\t\t\t{options.map((option, index) => (\n\t\t\t\t\t<li key={option.title}>\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tonClick={() => onSelect(option.value)}\n\t\t\t\t\t\t\tcss={[\n\t\t\t\t\t\t\t\tlinkStyles(!!option.disabled),\n\t\t\t\t\t\t\t\toption.isActive && activeStyles,\n\t\t\t\t\t\t\t\tindex === 0 && firstStyles,\n\t\t\t\t\t\t\t]}\n\t\t\t\t\t\t\tdisabled={!!option.isActive || !!option.disabled}\n\t\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{option.title}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</li>\n\t\t\t\t))}\n\t\t\t</ul>\n\t\t</div>\n\t);\n};\n","import { css } from '@emotion/react';\nimport { space } from '@guardian/source/foundations';\nimport type {\n\tFilterOptions,\n\tOrderByType,\n\tPageSizeType,\n\tThreadsType,\n} from '../../lib/discussion';\nimport { palette as schemedPalette } from '../../palette';\nimport { Dropdown } from './Dropdown';\n\ntype Props = {\n\tfilters: FilterOptions;\n\tonFilterChange: (newFilterObject: FilterOptions) => void;\n\ttopLevelCommentCount: number;\n};\n\nconst filterBar = css`\n\tpadding-top: ${space[1]}px;\n\tpadding-bottom: ${space[2]}px;\n\n\tborder-top: 1px solid ${schemedPalette('--discussion-border')};\n\n\tdisplay: flex;\n\tflex-direction: row;\n`;\n\nconst dividerStyles = css`\n\tposition: relative;\n\tmargin-left: ${space[2]}px;\n\t:after {\n\t\tcontent: '';\n\t\tdisplay: block;\n\t\twidth: 1px;\n\t\tbackground-color: ${schemedPalette('--discussion-border')};\n\t\tposition: absolute;\n\t\ttop: -${space[1]}px;\n\t\tbottom: ${space[1]}px;\n\t\tleft: -${space[2]}px;\n\t}\n`;\n\nconst filterPadding = css`\n\tpadding-right: ${space[3]}px;\n`;\n\nexport const Filters = ({\n\tfilters,\n\tonFilterChange,\n\ttopLevelCommentCount,\n}: Props) => (\n\t<div id=\"comment-filters\" css={filterBar}>\n\t\t<div css={filterPadding}>\n\t\t\t<Dropdown\n\t\t\t\tid=\"order-by-dropdown\"\n\t\t\t\tlabel=\"Sort by\"\n\t\t\t\toptions={[\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: 'Newest',\n\t\t\t\t\t\tvalue: 'newest',\n\t\t\t\t\t\tisActive: filters.orderBy === 'newest',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: 'Oldest',\n\t\t\t\t\t\tvalue: 'oldest',\n\t\t\t\t\t\tisActive: filters.orderBy === 'oldest',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: 'Recommendations',\n\t\t\t\t\t\tvalue: 'recommendations',\n\t\t\t\t\t\tisActive: filters.orderBy === 'recommendations',\n\t\t\t\t\t},\n\t\t\t\t]}\n\t\t\t\tonSelect={(value) =>\n\t\t\t\t\tonFilterChange({\n\t\t\t\t\t\t...filters,\n\t\t\t\t\t\torderBy: value as OrderByType,\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t/>\n\t\t</div>\n\t\t<div css={dividerStyles} />\n\t\t<div css={filterPadding}>\n\t\t\t<Dropdown\n\t\t\t\tid=\"page-size-dropdown\"\n\t\t\t\tlabel=\"Per page\"\n\t\t\t\toptions={[\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: '25',\n\t\t\t\t\t\tvalue: '25',\n\t\t\t\t\t\tdisabled: topLevelCommentCount <= 25,\n\t\t\t\t\t\tisActive: filters.pageSize === 25,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: '50',\n\t\t\t\t\t\tvalue: '50',\n\t\t\t\t\t\tdisabled: topLevelCommentCount <= 50,\n\t\t\t\t\t\tisActive: filters.pageSize === 50,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: '100',\n\t\t\t\t\t\tvalue: '100',\n\t\t\t\t\t\tdisabled: topLevelCommentCount <= 100,\n\t\t\t\t\t\tisActive: filters.pageSize === 100,\n\t\t\t\t\t},\n\t\t\t\t]}\n\t\t\t\tonSelect={(value) =>\n\t\t\t\t\tonFilterChange({\n\t\t\t\t\t\t...filters,\n\t\t\t\t\t\tpageSize: parseInt(value) as PageSizeType,\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t/>\n\t\t</div>\n\t\t<div css={dividerStyles} />\n\t\t<div css={filterPadding}>\n\t\t\t<Dropdown\n\t\t\t\tid=\"threads-dropdown\"\n\t\t\t\tlabel=\"Display threads\"\n\t\t\t\toptions={[\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: 'Collapsed',\n\t\t\t\t\t\tvalue: 'collapsed',\n\t\t\t\t\t\tisActive: filters.threads === 'collapsed',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: 'Expanded',\n\t\t\t\t\t\tvalue: 'expanded',\n\t\t\t\t\t\tisActive: filters.threads === 'expanded',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttitle: 'Unthreaded',\n\t\t\t\t\t\tvalue: 'unthreaded',\n\t\t\t\t\t\tisActive: filters.threads === 'unthreaded',\n\t\t\t\t\t},\n\t\t\t\t]}\n\t\t\t\tonSelect={(value) =>\n\t\t\t\t\tonFilterChange({\n\t\t\t\t\t\t...filters,\n\t\t\t\t\t\tthreads: value as ThreadsType,\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t/>\n\t\t</div>\n\t</div>\n);\n","import { css, keyframes } from '@emotion/react';\nimport { isUndefined } from '@guardian/libs';\nimport { space } from '@guardian/source/foundations';\nimport { palette as schemedPalette } from '../../palette';\nimport { Column } from './Column';\nimport { Row } from './Row';\n\nconst BACKGROUND_COLOUR = schemedPalette('--discussion-loading-background');\n\nconst shimmer = keyframes`\n  0% {\n    background-position: -1500px 0;\n  }\n  100% {\n    background-position: 1500px 0;\n  }\n`;\n\nconst shimmerStyles = css`\n\tanimation: ${shimmer} 2s infinite linear;\n\tbackground: linear-gradient(\n\t\tto right,\n\t\t${BACKGROUND_COLOUR} 4%,\n\t\t${schemedPalette('--discussion-loading-shimmer')} 25%,\n\t\t${BACKGROUND_COLOUR} 36%\n\t);\n\tbackground-size: 1500px 100%;\n`;\n\nconst containerStyles = css`\n\tborder-bottom: 1px solid ${schemedPalette('--discussion-border')};\n\twidth: 620px;\n\tdisplay: flex;\n\tpadding: ${space[2]}px 0;\n`;\n\nconst avatarStyles = (size: number) => css`\n\tborder-radius: ${size + 10}px;\n\twidth: ${size}px;\n\theight: ${size}px;\n\tbackground-color: ${BACKGROUND_COLOUR};\n\tmargin-right: ${space[2]}px;\n\n\t${shimmerStyles}\n`;\n\nconst Grey = ({\n\theight,\n\twidth,\n\tspaceBelow,\n\tspaceLeft,\n}: {\n\theight: number;\n\twidth?: number;\n\tspaceBelow?: 1 | 2 | 3 | 4 | 5 | 6 | 9;\n\tspaceLeft?: 1 | 2 | 3 | 4 | 5 | 6 | 9;\n}) => (\n\t<div\n\t\tcss={css`\n\t\t\theight: ${height}px;\n\t\t\twidth: ${!isUndefined(width) && width !== 0 && !isNaN(width)\n\t\t\t\t? `${width}px`\n\t\t\t\t: '100%'};\n\t\t\tmargin-bottom: ${spaceBelow && space[spaceBelow]}px;\n\t\t\tmargin-left: ${spaceLeft && space[spaceLeft]}px;\n\t\t\tbackground-color: ${BACKGROUND_COLOUR};\n\n\t\t\t${shimmerStyles}\n\t\t`}\n\t/>\n);\n\nexport const LoadingComments = () => (\n\t<div css={containerStyles} data-testid=\"loading-comments\">\n\t\t<div css={avatarStyles(48)} />\n\t\t<Column>\n\t\t\t<Row>\n\t\t\t\t<Grey height={20} width={140} spaceBelow={9} />\n\t\t\t\t<Grey height={15} width={100} spaceBelow={9} spaceLeft={2} />\n\t\t\t</Row>\n\t\t\t<Grey height={20} spaceBelow={1} />\n\t\t\t<Grey height={20} spaceBelow={1} />\n\t\t\t<Grey height={20} width={200} spaceBelow={5} />\n\n\t\t\t<Row>\n\t\t\t\t<Grey height={15} width={40} />\n\t\t\t\t<Grey height={15} width={40} spaceLeft={6} />\n\t\t\t</Row>\n\t\t</Column>\n\t</div>\n);\n","import { css } from '@emotion/react';\nimport {\n\tspace,\n\ttextSans15,\n\ttextSansBold15,\n\tuntil,\n} from '@guardian/source/foundations';\nimport type { ThemeButton } from '@guardian/source/react-components';\nimport {\n\tButton,\n\tSvgChevronLeftSingle,\n\tSvgChevronRightSingle,\n} from '@guardian/source/react-components';\nimport type { FilterOptions } from '../../lib/discussion';\nimport { palette as schemedPalette } from '../../palette';\n\ntype Props = {\n\tcurrentPage: number;\n\tsetCurrentPage: (currentPage: number) => void;\n\ttopLevelCommentCount: number;\n\tfilters: FilterOptions;\n};\n\nconst pageButtonStyles = (isSelected: boolean) => css`\n\tcursor: pointer;\n\t${textSansBold15}\n\n\ttext-decoration: none;\n\tborder-radius: 62.5rem;\n\tbox-sizing: border-box;\n\n\tcolor: ${isSelected\n\t\t? schemedPalette('--discussion-pagination-background')\n\t\t: schemedPalette('--discussion-pagination-text')};\n\tbackground-color: ${isSelected\n\t\t? schemedPalette('--discussion-pagination-text')\n\t\t: 'transparent'};\n\tborder: none;\n\t:hover {\n\t\tborder-width: 0.0625rem;\n\t\tborder-style: solid;\n\t\tborder-color: ${schemedPalette('--discussion-pagination-text')};\n\t}\n\n\tmargin-right: 2px;\n\tpadding: 0 0.125rem;\n\tmin-width: 1.5rem;\n\ttext-align: center;\n\n\theight: 1.5rem;\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n`;\n\nconst theme = {\n\tborderTertiary: schemedPalette('--discussion-pagination-border'),\n\tbackgroundTertiaryHover: schemedPalette(\n\t\t'--discussion-pagination-background',\n\t),\n\ttextTertiary: schemedPalette('--discussion-pagination-text'),\n} satisfies Partial<ThemeButton>;\n\nconst ellipsisStyles = css`\n\tline-height: 26px;\n\tmargin-right: 2px;\n`;\n\nconst wrapperStyles = css`\n\t${textSans15};\n\tcolor: ${schemedPalette('--discussion-pagination-text')};\n\n\tdisplay: flex;\n\tflex-direction: row;\n\tjustify-content: space-between;\n\tpadding: ${space[2]}px 0;\n\tborder-top: 1px solid ${schemedPalette('--discussion-pagination-border')};\n\t${until.mobileLandscape} {\n\t\tflex-direction: column;\n\t}\n`;\n\nconst paginationButtons = css`\n\tdisplay: flex;\n\tflex-direction: row;\n\theight: 25px;\n\n\tbutton:hover {\n\t\tborder-color: ${schemedPalette('--discussion-pagination-border-hover')};\n\t}\n`;\n\nconst paginationText = css`\n\t${textSans15};\n\tmargin-left: 5px;\n\t${until.mobileLandscape} {\n\t\tpadding-top: 10px;\n\t}\n`;\n\nconst Forward = ({\n\tcurrentPage,\n\tsetCurrentPage,\n}: {\n\tcurrentPage: number;\n\tsetCurrentPage: Props['setCurrentPage'];\n}) => (\n\t<Button\n\t\tonClick={() => setCurrentPage(currentPage + 1)}\n\t\tdata-link-name={`Pagination view page ${currentPage + 1}`}\n\t\tsize=\"xsmall\"\n\t\tpriority=\"tertiary\"\n\t\ttheme={theme}\n\t\t// @TODO: These overrides should be removed once fixed upstream\n\t\tcssOverrides={css`\n\t\t\t/* theme does not support Tertiary background */\n\t\t\tbackground-color: ${schemedPalette(\n\t\t\t\t'--discussion-pagination-background',\n\t\t\t)};\n\t\t\t/* the icon is not perfectly centred */\n\t\t\tsvg {\n\t\t\t\ttransform: translateX(1px);\n\t\t\t}\n\t\t`}\n\t\ticon={\n\t\t\t<SvgChevronRightSingle\n\t\t\t\ttheme={{ fill: schemedPalette('--discussion-pagination-text') }}\n\t\t\t/>\n\t\t}\n\t\thideLabel={true}\n\t>\n\t\tPrevious discussion page\n\t</Button>\n);\n\nconst Back = ({\n\tcurrentPage,\n\tsetCurrentPage,\n}: {\n\tcurrentPage: number;\n\tsetCurrentPage: Props['setCurrentPage'];\n}) => (\n\t<Button\n\t\tonClick={() => setCurrentPage(currentPage - 1)}\n\t\tdata-link-name={`Pagination view page ${currentPage - 1}`}\n\t\tsize=\"xsmall\"\n\t\tpriority=\"tertiary\"\n\t\ttheme={theme}\n\t\t// @TODO: These overrides should be removed once fixed upstream\n\t\tcssOverrides={css`\n\t\t\t/* theme does not support Tertiary background */\n\t\t\tbackground-color: ${schemedPalette(\n\t\t\t\t'--discussion-pagination-background',\n\t\t\t)};\n\t\t\t/* the icon is not perfectly centred */\n\t\t\tsvg {\n\t\t\t\ttransform: translateX(-1px);\n\t\t\t}\n\t\t`}\n\t\ticon={\n\t\t\t<SvgChevronLeftSingle\n\t\t\t\ttheme={{ fill: schemedPalette('--discussion-pagination-text') }}\n\t\t\t/>\n\t\t}\n\t\thideLabel={true}\n\t>\n\t\tPrevious discussion page\n\t</Button>\n);\n\nconst PageButton = ({\n\tcurrentPage,\n\tsetCurrentPage,\n\tisSelected,\n}: {\n\tcurrentPage: number;\n\tsetCurrentPage: Props['setCurrentPage'];\n\tisSelected: boolean;\n}) => (\n\t<button\n\t\tkey={currentPage}\n\t\tcss={pageButtonStyles(isSelected)}\n\t\tonClick={() => setCurrentPage(currentPage)}\n\t\tdata-link-name={`Pagination view page ${currentPage}`}\n\t\ttype=\"button\"\n\t>\n\t\t{currentPage}\n\t</button>\n);\n\nexport const getPages = (\n\tcurrentPage: number,\n\ttotalPages: number,\n): (number | '…')[] => {\n\tif (totalPages <= 6) {\n\t\treturn [1, 2, 3, 4, 5, 6].filter((page) => page <= totalPages);\n\t} else if (currentPage <= 3) {\n\t\treturn [1, 2, 3, 4, '…', totalPages];\n\t} else if (currentPage <= totalPages - 3) {\n\t\treturn [\n\t\t\t1,\n\t\t\t'…',\n\t\t\tcurrentPage - 1,\n\t\t\tcurrentPage,\n\t\t\tcurrentPage + 1,\n\t\t\t'…',\n\t\t\ttotalPages,\n\t\t];\n\t} else {\n\t\treturn [\n\t\t\t1,\n\t\t\t'…',\n\t\t\ttotalPages - 3,\n\t\t\ttotalPages - 2,\n\t\t\ttotalPages - 1,\n\t\t\ttotalPages,\n\t\t];\n\t}\n};\n\nexport const Pagination = ({\n\tcurrentPage,\n\tsetCurrentPage,\n\ttopLevelCommentCount,\n\tfilters,\n}: Props) => {\n\tconst totalPages = Math.ceil(topLevelCommentCount / filters.pageSize);\n\t// Make decisions about which pagination elements to show\n\tconst showBackButton = totalPages > 4 && currentPage > 1;\n\tconst showForwardButton = totalPages > 4 && currentPage !== totalPages;\n\n\t// Pagination Text\n\tconst { pageSize } = filters;\n\t/**\n\t * Starting index of **1**\n\t *\n\t * For example, with a page size of 25, and 63 comments total:\n\t * 1. from 1\n\t * 2. from 26\n\t * 3. from 51\n\t */\n\tconst startIndex = 1 + pageSize * (currentPage - 1);\n\t/**\n\t * Starting index of **1**\n\t *\n\t * For example, with a page size of 25, and 63 comments total:\n\t * 1. until 25\n\t * 2. until 50\n\t * 3. until 63\n\t */\n\tconst endIndex = Math.min(pageSize * currentPage, topLevelCommentCount);\n\n\treturn (\n\t\t<div css={wrapperStyles}>\n\t\t\t<div css={paginationButtons}>\n\t\t\t\t{showBackButton && (\n\t\t\t\t\t<Back\n\t\t\t\t\t\tcurrentPage={currentPage}\n\t\t\t\t\t\tsetCurrentPage={setCurrentPage}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t\t{getPages(currentPage, totalPages).map((page, index) =>\n\t\t\t\t\tpage === '…' ? (\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tkey={\n\t\t\t\t\t\t\t\tindex === 1 ? 'first-ellipsis' : 'last-ellipsis'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcss={ellipsisStyles}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t&hellip;\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<PageButton\n\t\t\t\t\t\t\tkey={`page-${page}`}\n\t\t\t\t\t\t\tcurrentPage={page}\n\t\t\t\t\t\t\tsetCurrentPage={setCurrentPage}\n\t\t\t\t\t\t\tisSelected={page === currentPage}\n\t\t\t\t\t\t/>\n\t\t\t\t\t),\n\t\t\t\t)}\n\t\t\t\t{showForwardButton && (\n\t\t\t\t\t<Forward\n\t\t\t\t\t\tcurrentPage={currentPage}\n\t\t\t\t\t\tsetCurrentPage={setCurrentPage}\n\t\t\t\t\t/>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t\t<div css={paginationText}>\n\t\t\t\t{`Displaying ${\n\t\t\t\t\tfilters.threads === 'unthreaded' ? 'comments' : 'threads'\n\t\t\t\t} ${startIndex} to ${endIndex} of ${topLevelCommentCount}`}\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","import { css } from '@emotion/react';\nimport { from, space, textSans15 } from '@guardian/source/foundations';\nimport { Link } from '@guardian/source/react-components';\nimport type {\n\tCommentType,\n\tReplyType,\n\tSignedInUser,\n} from '../../lib/discussion';\nimport { palette as schemedPalette } from '../../palette';\nimport { Avatar } from './Avatar';\nimport { GuardianContributor, GuardianStaff } from './Badges';\nimport { Column } from './Column';\nimport { RecommendationCount } from './RecommendationCount';\nimport { Row } from './Row';\nimport { Timestamp } from './Timestamp';\n\ntype Props = {\n\tcomment: CommentType | ReplyType;\n\tuserMadeComment: boolean;\n\tonPermalinkClick: (commentId: string) => void;\n\tuser?: SignedInUser;\n\tisClosedForRecommendations: boolean;\n};\n\nconst pickStyles = css`\n\tdisplay: flex;\n\tflex-direction: column;\n\twidth: 100%;\n\tmin-width: 250px;\n\tmargin-bottom: ${space[5]}px;\n\t${textSans15};\n\n\tblockquote {\n\t\tmargin-top: ${space[3]}px;\n\t\tmargin-bottom: ${space[3]}px;\n\t\tmargin-left: ${space[5]}px;\n\t\tmargin-right: ${space[5]}px;\n\t\tpadding-left: ${space[2]}px;\n\t\tcolor: ${schemedPalette('--discussion-subdued')};\n\t}\n`;\n\nconst arrowSize = 25;\n\nconst userNameStyles = css`\n\tmargin-top: 3px;\n\tmargin-bottom: -6px;\n\tfont-weight: bold;\n\tcolor: ${schemedPalette('--discussion-accent-text')};\n`;\n\nconst avatarMargin = css`\n\tmargin-right: ${space[2]}px;\n`;\n\nconst smallFontSize = css`\n\ta {\n\t\t${textSans15}\n\t}\n`;\n\nconst linkStyles = css`\n\tcolor: ${schemedPalette('--discussion-top-pick-link')};\n\ttext-decoration: none;\n\t:hover {\n\t\ttext-decoration: underline;\n\t\tcolor: ${schemedPalette('--discussion-top-pick-link')};\n\t}\n`;\n\nconst jumpToLinkStyles = css`\n\tcolor: ${schemedPalette('--discussion-top-pick-link')};\n\t:hover {\n\t\tcolor: ${schemedPalette('--discussion-top-pick-link')};\n\t}\n`;\n\n// to override a tag styles from dangerouslySetInnerHTML\nconst inCommentLinkStyling = css`\n\ta {\n\t\tcolor: ${schemedPalette('--discussion-top-pick-link')};\n\t\ttext-decoration: none;\n\t\t:hover {\n\t\t\ttext-decoration: underline;\n\t\t}\n\t}\n`;\n\nconst titleStyles = css`\n\t${textSans15};\n\tfont-weight: bold;\n\tmargin: 0px;\n\tmargin-bottom: ${space[1]}px;\n`;\n\nconst inheritColour = css`\n\tcolor: inherit;\n`;\n\nconst wrapStyles = css`\n\tword-break: break-word;\n`;\n\nconst PickBubble = ({ children }: { children: React.ReactNode }) => (\n\t<div\n\t\tcss={css`\n\t\t\tdisplay: flex;\n\t\t\tflex-direction: column;\n\t\t\tjustify-content: space-between;\n\n\t\t\tpadding: ${space[3]}px;\n\t\t\tbackground-color: ${schemedPalette(\n\t\t\t\t'--discussion-top-pick-background',\n\t\t\t)};\n\t\t\tborder-radius: 15px;\n\t\t\tmargin-bottom: ${arrowSize + 5}px;\n\t\t\tposition: relative;\n\n\t\t\t${from.tablet} {\n\t\t\t\tmin-height: 150px;\n\t\t\t}\n\n\t\t\t:before {\n\t\t\t\tcontent: '';\n\t\t\t\tmargin-left: ${space[6]}px;\n\t\t\t\tposition: absolute;\n\t\t\t\tborder-right: ${arrowSize}px solid transparent;\n\t\t\t\tborder-top: ${arrowSize}px solid\n\t\t\t\t\t${schemedPalette('--discussion-top-pick-background')};\n\t\t\t\tbottom: -${arrowSize - 1}px;\n\t\t\t}\n\n\t\t\tp {\n\t\t\t\tmargin-top: 0;\n\t\t\t\tmargin-bottom: ${space[3]}px;\n\t\t\t}\n\t\t`}\n\t>\n\t\t{children}\n\t</div>\n);\n\nconst Top = ({ children }: { children: React.ReactNode }) => (\n\t<div>{children}</div>\n);\n\nconst Bottom = ({ children }: { children: React.ReactNode }) => (\n\t<div>{children}</div>\n);\n\nconst PickMeta = ({ children }: { children: React.ReactNode }) => (\n\t<div\n\t\tcss={css`\n\t\t\tdisplay: flex;\n\t\t\tjustify-content: space-between;\n\t\t\tpadding-top: ${space[1]}px;\n\t\t`}\n\t>\n\t\t{children}\n\t</div>\n);\n\nconst truncateText = (input: string, limit: number) => {\n\t// If input greater than limit trucate by limit and append an ellipsis\n\tif (input.length > limit) return input.substr(0, limit) + '&#8230;';\n\treturn input;\n};\n\nexport const TopPick = ({\n\tcomment,\n\tuser,\n\tuserMadeComment,\n\tonPermalinkClick,\n\tisClosedForRecommendations,\n}: Props) => {\n\tconst showStaffBadge = comment.userProfile.badge.some(\n\t\t(obj) => obj['name'] === 'Staff',\n\t);\n\n\tconst showContributorBadge = comment.userProfile.badge.some(\n\t\t(obj) => obj['name'] === 'Contributor',\n\t);\n\n\treturn (\n\t\t<div css={pickStyles}>\n\t\t\t<PickBubble>\n\t\t\t\t<Top>\n\t\t\t\t\t<h3 css={titleStyles}>Guardian Pick</h3>\n\t\t\t\t\t<p\n\t\t\t\t\t\tcss={[wrapStyles, inCommentLinkStyling]}\n\t\t\t\t\t\tdangerouslySetInnerHTML={{\n\t\t\t\t\t\t\t__html: truncateText(comment.body, 450),\n\t\t\t\t\t\t}}\n\t\t\t\t\t></p>\n\t\t\t\t</Top>\n\t\t\t\t<Bottom>\n\t\t\t\t\t<div css={smallFontSize}>\n\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\tpriority=\"primary\"\n\t\t\t\t\t\t\thref={comment.webUrl}\n\t\t\t\t\t\t\tcssOverrides={jumpToLinkStyles}\n\t\t\t\t\t\t\tonClick={(\n\t\t\t\t\t\t\t\te: React.MouseEvent<HTMLAnchorElement>,\n\t\t\t\t\t\t\t) => {\n\t\t\t\t\t\t\t\tonPermalinkClick(comment.id);\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\trel=\"nofollow\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\tJump to comment\n\t\t\t\t\t\t</Link>\n\t\t\t\t\t</div>\n\t\t\t\t</Bottom>\n\t\t\t</PickBubble>\n\t\t\t<PickMeta>\n\t\t\t\t<Row>\n\t\t\t\t\t<div css={avatarMargin}>\n\t\t\t\t\t\t<Avatar\n\t\t\t\t\t\t\timageUrl={comment.userProfile.avatar}\n\t\t\t\t\t\t\tdisplayName={''}\n\t\t\t\t\t\t\tsize=\"medium\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t\t<Column>\n\t\t\t\t\t\t<span css={userNameStyles}>\n\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\thref={comment.userProfile.webUrl}\n\t\t\t\t\t\t\t\tcss={[linkStyles, inheritColour]}\n\t\t\t\t\t\t\t\trel=\"nofollow\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{comment.userProfile.displayName}\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<Timestamp\n\t\t\t\t\t\t\tisoDateTime={comment.isoDateTime}\n\t\t\t\t\t\t\twebUrl={comment.webUrl}\n\t\t\t\t\t\t\tcommentId={comment.id}\n\t\t\t\t\t\t\tonPermalinkClick={onPermalinkClick}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{showStaffBadge && <GuardianStaff />}\n\t\t\t\t\t\t{showContributorBadge && !showStaffBadge && (\n\t\t\t\t\t\t\t<GuardianContributor />\n\t\t\t\t\t\t)}\n\t\t\t\t\t</Column>\n\t\t\t\t</Row>\n\t\t\t\t<RecommendationCount\n\t\t\t\t\tcommentId={comment.id}\n\t\t\t\t\tinitialCount={comment.numRecommends}\n\t\t\t\t\talreadyRecommended={false}\n\t\t\t\t\tuser={user}\n\t\t\t\t\tuserMadeComment={userMadeComment}\n\t\t\t\t\tisClosedForRecommendations={isClosedForRecommendations}\n\t\t\t\t/>\n\t\t\t</PickMeta>\n\t\t</div>\n\t);\n};\n","import { css } from '@emotion/react';\nimport { from, until } from '@guardian/source/foundations';\nimport type {\n\tCommentType,\n\tReplyType,\n\tSignedInUser,\n} from '../../lib/discussion';\nimport { TopPick } from './TopPick';\n\ntype Props = {\n\tuser?: SignedInUser;\n\tcomments: Array<CommentType | ReplyType>;\n\tonPermalinkClick: (commentId: string) => void;\n\tisClosedForRecommendations: boolean;\n};\n\nconst columWrapperStyles = css`\n\twidth: 50%;\n\tdisplay: flex;\n\tflex-direction: column;\n`;\nconst paddingRight = css`\n\tpadding-right: 10px;\n`;\nconst paddingLeft = css`\n\tpadding-left: 10px;\n`;\n\nconst picksWrapper = css`\n\twidth: 100%;\n\tdisplay: flex;\n\tflex-wrap: wrap;\n`;\n\nconst twoColCommentsStyles = css`\n\twidth: 100%;\n\tdisplay: flex;\n\tflex-direction: row;\n\t${until.tablet} {\n\t\tdisplay: none;\n\t}\n`;\nconst oneColCommentsStyles = css`\n\twidth: 100%;\n\t${from.tablet} {\n\t\tdisplay: none;\n\t}\n`;\n\nexport const TopPicks = ({\n\tuser,\n\tcomments,\n\tonPermalinkClick,\n\tisClosedForRecommendations,\n}: Props) => {\n\tconst leftColComments: Array<CommentType | ReplyType> = [];\n\tconst rightColComments: Array<CommentType | ReplyType> = [];\n\tfor (const [index, comment] of comments.entries()) {\n\t\tindex % 2 === 0\n\t\t\t? leftColComments.push(comment)\n\t\t\t: rightColComments.push(comment);\n\t}\n\treturn (\n\t\t<div css={picksWrapper}>\n\t\t\t<div css={twoColCommentsStyles}>\n\t\t\t\t<div css={[columWrapperStyles, paddingRight]}>\n\t\t\t\t\t{leftColComments.map((comment) => (\n\t\t\t\t\t\t<TopPick\n\t\t\t\t\t\t\tkey={comment.id}\n\t\t\t\t\t\t\tcomment={comment}\n\t\t\t\t\t\t\tuser={user}\n\t\t\t\t\t\t\tuserMadeComment={\n\t\t\t\t\t\t\t\tuser?.profile.userId ===\n\t\t\t\t\t\t\t\tcomment.userProfile.userId\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonPermalinkClick={onPermalinkClick}\n\t\t\t\t\t\t\tisClosedForRecommendations={\n\t\t\t\t\t\t\t\tisClosedForRecommendations\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t))}\n\t\t\t\t</div>\n\t\t\t\t<div css={[columWrapperStyles, paddingLeft]}>\n\t\t\t\t\t{rightColComments.map((comment) => (\n\t\t\t\t\t\t<TopPick\n\t\t\t\t\t\t\tkey={comment.id}\n\t\t\t\t\t\t\tcomment={comment}\n\t\t\t\t\t\t\tuser={user}\n\t\t\t\t\t\t\tuserMadeComment={\n\t\t\t\t\t\t\t\tuser?.profile.userId ===\n\t\t\t\t\t\t\t\tcomment.userProfile.userId\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tonPermalinkClick={onPermalinkClick}\n\t\t\t\t\t\t\tisClosedForRecommendations={\n\t\t\t\t\t\t\t\tisClosedForRecommendations\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t))}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div css={oneColCommentsStyles}>\n\t\t\t\t{comments.map((comment) => (\n\t\t\t\t\t<TopPick\n\t\t\t\t\t\tkey={comment.id}\n\t\t\t\t\t\tcomment={comment}\n\t\t\t\t\t\tuserMadeComment={\n\t\t\t\t\t\t\tuser?.profile.userId === comment.userProfile.userId\n\t\t\t\t\t\t}\n\t\t\t\t\t\tonPermalinkClick={onPermalinkClick}\n\t\t\t\t\t\tisClosedForRecommendations={isClosedForRecommendations}\n\t\t\t\t\t/>\n\t\t\t\t))}\n\t\t\t</div>\n\t\t</div>\n\t);\n};\n","import { css } from '@emotion/react';\nimport { isString, isUndefined, storage } from '@guardian/libs';\nimport { space, textSans15 } from '@guardian/source/foundations';\nimport { useEffect, useState } from 'react';\nimport type {\n\tAdditionalHeadersType,\n\tCommentFormProps,\n\tCommentType,\n\tFilterOptions,\n\tReplyType,\n\tSignedInUser,\n} from '../../lib/discussion';\nimport type { preview, reportAbuse } from '../../lib/discussionApi';\nimport { getPicks, initialiseApi } from '../../lib/discussionApi';\nimport { palette as schemedPalette } from '../../palette';\nimport { useConfig } from '../ConfigContext';\nimport { useDispatch } from '../DispatchContext';\nimport { CommentContainer } from './CommentContainer';\nimport { CommentForm } from './CommentForm';\nimport { Filters } from './Filters';\nimport { LoadingComments } from './LoadingComments';\nimport { Pagination } from './Pagination';\nimport { TopPicks } from './TopPicks';\n\ntype Props = {\n\tshortUrl: string;\n\tbaseUrl: string;\n\tisClosedForComments: boolean;\n\tisClosedForRecommendations: boolean;\n\tcommentToScrollTo?: string;\n\tuser?: SignedInUser;\n\tadditionalHeaders: AdditionalHeadersType;\n\texpanded: boolean;\n\tonPermalinkClick: (commentId: string) => void;\n\tapiKey: string;\n\tonPreview?: typeof preview;\n\tidApiUrl: string;\n\tpage: number;\n\tfilters: FilterOptions;\n\ttopLevelCommentCount: number;\n\tloading: boolean;\n\tcomments: Array<CommentType | ReplyType>;\n\ttopForm: CommentFormProps;\n\treplyForm: CommentFormProps;\n\tbottomForm: CommentFormProps;\n\treportAbuse: ReturnType<typeof reportAbuse>;\n};\n\nconst footerStyles = css`\n\tdisplay: flex;\n\tjustify-content: flex-end;\n`;\n\nconst commentColumnWrapperStyles = css`\n\tdisplay: flex;\n\tflex-direction: column;\n\tmax-width: 100%;\n`;\n\nconst commentContainerStyles = css`\n\tdisplay: flex;\n\tflex-direction: column;\n\tlist-style-type: none;\n\tpadding-left: 0;\n\tmargin: 0;\n`;\n\nconst picksWrapper = css`\n\tdisplay: flex;\n\tflex-wrap: wrap;\n\tjustify-content: space-between;\n`;\n\nconst NoComments = () => (\n\t<div\n\t\tcss={css`\n\t\t\tcolor: ${schemedPalette('--discussion-subdued')};\n\t\t\t${textSans15}\n\t\t\tpadding-top: ${space[5]}px;\n\t\t\tpadding-left: ${space[1]}px;\n\t\t\tpadding-bottom: ${space[9]}px;\n\t\t`}\n\t>\n\t\tNo comments found\n\t</div>\n);\n\n/** Reads mutes from local storage, if available. */\nconst readMutes = (): string[] => {\n\tconst mutes = storage.local.get('gu.prefs.discussion.mutes') ?? [];\n\treturn Array.isArray(mutes) && mutes.every(isString) ? mutes : [];\n};\n\n/** Writes mutes to local storage. */\nconst writeMutes = (mutes: string[]) => {\n\tstorage.local.set('gu.prefs.discussion.mutes', mutes);\n};\n\n/** Dispatches a custom event which is handled by @guardian/commercial */\nconst dispatchCommentsStateChange = () =>\n\tdocument.dispatchEvent(new CustomEvent('comments-state-change'));\n\nexport const Comments = ({\n\tbaseUrl,\n\tshortUrl,\n\tisClosedForComments,\n\tisClosedForRecommendations,\n\tcommentToScrollTo,\n\tuser,\n\tadditionalHeaders,\n\texpanded,\n\tonPermalinkClick,\n\tapiKey,\n\tonPreview,\n\tidApiUrl,\n\tpage,\n\tfilters,\n\ttopLevelCommentCount,\n\tloading,\n\tcomments,\n\ttopForm,\n\treplyForm,\n\tbottomForm,\n\treportAbuse,\n}: Props) => {\n\tconst [picks, setPicks] = useState<Array<CommentType | ReplyType>>([]);\n\tconst [commentBeingRepliedTo, setCommentBeingRepliedTo] = useState<\n\t\tCommentType | ReplyType\n\t>();\n\tconst [mutes, setMutes] = useState<string[]>(readMutes());\n\tconst { renderingTarget } = useConfig();\n\tconst isWeb = renderingTarget === 'Web';\n\n\tconst dispatch = useDispatch();\n\n\tconst addComment = (comment: CommentType) => {\n\t\tdispatch({ type: 'addComment', comment });\n\t};\n\n\tconst setPage = (newPage: number) => {\n\t\tdispatch({\n\t\t\ttype: 'updateCommentPage',\n\t\t\tcommentPage: newPage,\n\t\t});\n\t};\n\n\tconst handleFilterChange = (\n\t\tnewFilters: FilterOptions,\n\t\tnewPage?: number,\n\t) => {\n\t\tdispatch({\n\t\t\ttype: 'filterChange',\n\t\t\tfilters: newFilters,\n\t\t\tcommentPage: newPage,\n\t\t});\n\t};\n\n\tconst setTopFormUserMissing = (userNameMissing: boolean) =>\n\t\tdispatch({\n\t\t\ttype: 'setTopFormUserMissing',\n\t\t\tuserNameMissing,\n\t\t});\n\n\tconst setReplyFormUserMissing = (userNameMissing: boolean) =>\n\t\tdispatch({\n\t\t\ttype: 'setReplyFormUserMissing',\n\t\t\tuserNameMissing,\n\t\t});\n\n\tconst setBottomFormUserMissing = (userNameMissing: boolean) =>\n\t\tdispatch({\n\t\t\ttype: 'setBottomFormUserMissing',\n\t\t\tuserNameMissing,\n\t\t});\n\n\tconst setTopFormError = (error: string) =>\n\t\tdispatch({\n\t\t\ttype: 'setTopFormError',\n\t\t\terror,\n\t\t});\n\n\tconst setReplyFormError = (error: string) =>\n\t\tdispatch({\n\t\t\ttype: 'setReplyFormError',\n\t\t\terror,\n\t\t});\n\n\tconst setBottomFormError = (error: string) =>\n\t\tdispatch({\n\t\t\ttype: 'setBottomFormError',\n\t\t\terror,\n\t\t});\n\n\tconst setTopFormPreviewBody = (previewBody: string) =>\n\t\tdispatch({\n\t\t\ttype: 'setTopFormPreviewBody',\n\t\t\tpreviewBody,\n\t\t});\n\n\tconst setReplyFormPreviewBody = (previewBody: string) =>\n\t\tdispatch({\n\t\t\ttype: 'setReplyFormPreviewBody',\n\t\t\tpreviewBody,\n\t\t});\n\n\tconst setBottomFormPreviewBody = (previewBody: string) =>\n\t\tdispatch({\n\t\t\ttype: 'setBottomFormPreviewBody',\n\t\t\tpreviewBody,\n\t\t});\n\tconst expandCommentReplies = (commentId: string, responses: ReplyType[]) =>\n\t\tdispatch({\n\t\t\ttype: 'expandCommentReplies',\n\t\t\tcommentId,\n\t\t\tresponses,\n\t\t});\n\n\tconst addReply = (comment: ReplyType) => {\n\t\tdispatch({ type: 'addReply', comment });\n\t};\n\n\tuseEffect(() => {\n\t\tif (isWeb && expanded && !loading) {\n\t\t\tconst event = new CustomEvent('comments-loaded');\n\t\t\tdocument.dispatchEvent(event);\n\t\t}\n\t}, [isWeb, expanded, loading]);\n\n\tuseEffect(() => {\n\t\tvoid getPicks(shortUrl).then((result) => {\n\t\t\tif (result.kind === 'error') {\n\t\t\t\tconsole.error(result.error);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsetPicks(result.value);\n\t\t});\n\t}, [shortUrl]);\n\n\t/**\n\t * Verify if there is a comment to scroll to; if found, scroll to the corresponding div.\n\t * This JavaScript is necessary because the comments list isn't initially loaded with the\n\t * page and is added to the DOM later, following an API call.\n\t * */\n\tuseEffect(() => {\n\t\tif (isUndefined(commentToScrollTo)) return;\n\t\tif (loading) return;\n\n\t\tdocument\n\t\t\t.getElementById(`comment-${commentToScrollTo}`)\n\t\t\t?.scrollIntoView();\n\t}, [commentToScrollTo, loading]);\n\n\tconst onFilterChange = (newFilterObject: FilterOptions) => {\n\t\t/**\n\t\t * When decreasing the page size, we adjust the current page\n\t\t * to avoid requesting non-existent pages. For example,\n\t\t * if we had 102 comments with a page size of 25, and the current\n\t\t * page was 5 (showing 2 comments), reducing the page size to 50 eliminates page 5.\n\t\t * To respect the reader's preference to stay on the last page,\n\t\t * we calculate and use the maximum possible page instead.\n\t\t */\n\n\t\tconst maxPagePossible = Math.ceil(\n\t\t\ttopLevelCommentCount / newFilterObject.pageSize,\n\t\t);\n\n\t\tif (page > maxPagePossible) {\n\t\t\thandleFilterChange(newFilterObject, maxPagePossible);\n\t\t} else {\n\t\t\thandleFilterChange(newFilterObject);\n\t\t}\n\n\t\tisWeb && dispatchCommentsStateChange();\n\t};\n\n\tuseEffect(() => {\n\t\tconst element = document.getElementById('comment-filters');\n\t\telement?.scrollIntoView();\n\t}, [page]);\n\n\t/** Remember updated mutes locally */\n\tuseEffect(() => {\n\t\twriteMutes(mutes);\n\t}, [mutes]);\n\n\tconst toggleMuteStatus = (userId: string) => {\n\t\tconst updatedMutes = mutes.includes(userId)\n\t\t\t? mutes.filter((id) => id !== userId) // Already muted, unmute them\n\t\t\t: [...mutes, userId]; // Add this user to our list of mutes\n\n\t\tsetMutes(updatedMutes); // Update local state\n\t};\n\tconst onAddComment = (comment: CommentType | ReplyType) => {\n\t\tif (comment.responses) {\n\t\t\taddComment(comment);\n\t\t} else {\n\t\t\taddReply(comment);\n\t\t}\n\t\tconst commentElement = document.getElementById(`comment-${comment.id}`);\n\t\tcommentElement?.scrollIntoView();\n\t};\n\n\tconst onPageChange = (pageNumber: number) => {\n\t\tsetPage(pageNumber);\n\t\tisWeb && dispatchCommentsStateChange();\n\t};\n\n\tinitialiseApi({ additionalHeaders, baseUrl, apiKey, idApiUrl });\n\n\tconst showPagination = topLevelCommentCount > filters.pageSize;\n\n\tif (!expanded && loading) {\n\t\treturn <span data-testid=\"loading-comments\"></span>;\n\t}\n\n\tif (!expanded) {\n\t\treturn (\n\t\t\t<div data-component=\"discussion\" css={commentContainerStyles}>\n\t\t\t\t{picks.length !== 0 ? (\n\t\t\t\t\t<div css={picksWrapper}>\n\t\t\t\t\t\t<TopPicks\n\t\t\t\t\t\t\tcomments={picks.slice(0, 2)}\n\t\t\t\t\t\t\tuser={user}\n\t\t\t\t\t\t\tonPermalinkClick={onPermalinkClick}\n\t\t\t\t\t\t\tisClosedForRecommendations={\n\t\t\t\t\t\t\t\tisClosedForRecommendations\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t) : (\n\t\t\t\t\t<>\n\t\t\t\t\t\t<Filters\n\t\t\t\t\t\t\tfilters={filters}\n\t\t\t\t\t\t\tonFilterChange={onFilterChange}\n\t\t\t\t\t\t\ttopLevelCommentCount={topLevelCommentCount}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t{showPagination && (\n\t\t\t\t\t\t\t<Pagination\n\t\t\t\t\t\t\t\tcurrentPage={page}\n\t\t\t\t\t\t\t\tsetCurrentPage={onPageChange}\n\t\t\t\t\t\t\t\ttopLevelCommentCount={topLevelCommentCount}\n\t\t\t\t\t\t\t\tfilters={filters}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{!comments.length ? (\n\t\t\t\t\t\t\t<NoComments />\n\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t<ul css={commentContainerStyles}>\n\t\t\t\t\t\t\t\t{comments.slice(0, 2).map((comment) => (\n\t\t\t\t\t\t\t\t\t<li key={comment.id}>\n\t\t\t\t\t\t\t\t\t\t<CommentContainer\n\t\t\t\t\t\t\t\t\t\t\tcomment={comment}\n\t\t\t\t\t\t\t\t\t\t\tisClosedForComments={\n\t\t\t\t\t\t\t\t\t\t\t\tisClosedForComments\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tisClosedForRecommendations={\n\t\t\t\t\t\t\t\t\t\t\t\tisClosedForRecommendations\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tshortUrl={shortUrl}\n\t\t\t\t\t\t\t\t\t\t\tuser={user}\n\t\t\t\t\t\t\t\t\t\t\tthreads={filters.threads}\n\t\t\t\t\t\t\t\t\t\t\tcommentBeingRepliedTo={\n\t\t\t\t\t\t\t\t\t\t\t\tcommentBeingRepliedTo\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tsetCommentBeingRepliedTo={\n\t\t\t\t\t\t\t\t\t\t\t\tsetCommentBeingRepliedTo\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tmutes={mutes}\n\t\t\t\t\t\t\t\t\t\t\ttoggleMuteStatus={toggleMuteStatus}\n\t\t\t\t\t\t\t\t\t\t\tonPermalinkClick={onPermalinkClick}\n\t\t\t\t\t\t\t\t\t\t\terror={replyForm.error}\n\t\t\t\t\t\t\t\t\t\t\tsetError={setReplyFormError}\n\t\t\t\t\t\t\t\t\t\t\tuserNameMissing={\n\t\t\t\t\t\t\t\t\t\t\t\treplyForm.userNameMissing\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tsetUserNameMissing={\n\t\t\t\t\t\t\t\t\t\t\t\tsetReplyFormUserMissing\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tpreviewBody={replyForm.previewBody}\n\t\t\t\t\t\t\t\t\t\t\tsetPreviewBody={\n\t\t\t\t\t\t\t\t\t\t\t\tsetReplyFormPreviewBody\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\treportAbuse={reportAbuse}\n\t\t\t\t\t\t\t\t\t\t\texpandCommentReplies={\n\t\t\t\t\t\t\t\t\t\t\t\texpandCommentReplies\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\tisExpanded={expanded}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</>\n\t\t\t\t)}\n\t\t\t</div>\n\t\t);\n\t}\n\n\treturn (\n\t\t<div data-component=\"discussion\" css={commentColumnWrapperStyles}>\n\t\t\t{user && !isClosedForComments && (\n\t\t\t\t<CommentForm\n\t\t\t\t\tshortUrl={shortUrl}\n\t\t\t\t\tonAddComment={onAddComment}\n\t\t\t\t\tuser={user}\n\t\t\t\t\tonPreview={onPreview}\n\t\t\t\t\terror={topForm.error}\n\t\t\t\t\tsetError={setTopFormError}\n\t\t\t\t\tuserNameMissing={topForm.userNameMissing}\n\t\t\t\t\tsetUserNameMissing={setTopFormUserMissing}\n\t\t\t\t\tpreviewBody={topForm.previewBody}\n\t\t\t\t\tsetPreviewBody={setTopFormPreviewBody}\n\t\t\t\t/>\n\t\t\t)}\n\t\t\t{!!picks.length && (\n\t\t\t\t<TopPicks\n\t\t\t\t\tcomments={picks}\n\t\t\t\t\tuser={user}\n\t\t\t\t\tonPermalinkClick={onPermalinkClick}\n\t\t\t\t\tisClosedForRecommendations={isClosedForRecommendations}\n\t\t\t\t/>\n\t\t\t)}\n\t\t\t<Filters\n\t\t\t\tfilters={filters}\n\t\t\t\tonFilterChange={onFilterChange}\n\t\t\t\ttopLevelCommentCount={topLevelCommentCount}\n\t\t\t/>\n\t\t\t{showPagination && (\n\t\t\t\t<Pagination\n\t\t\t\t\tcurrentPage={page}\n\t\t\t\t\tsetCurrentPage={onPageChange}\n\t\t\t\t\ttopLevelCommentCount={topLevelCommentCount}\n\t\t\t\t\tfilters={filters}\n\t\t\t\t/>\n\t\t\t)}\n\t\t\t{loading ? (\n\t\t\t\t<LoadingComments />\n\t\t\t) : !comments.length ? (\n\t\t\t\t<NoComments />\n\t\t\t) : (\n\t\t\t\t<ul\n\t\t\t\t\tcss={[commentContainerStyles]}\n\t\t\t\t\tdata-commercial-id=\"comments-column\"\n\t\t\t\t>\n\t\t\t\t\t{comments.map((comment) => (\n\t\t\t\t\t\t<li key={comment.id}>\n\t\t\t\t\t\t\t<CommentContainer\n\t\t\t\t\t\t\t\tcomment={comment}\n\t\t\t\t\t\t\t\tisClosedForComments={isClosedForComments}\n\t\t\t\t\t\t\t\tisClosedForRecommendations={\n\t\t\t\t\t\t\t\t\tisClosedForRecommendations\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tshortUrl={shortUrl}\n\t\t\t\t\t\t\t\tuser={user}\n\t\t\t\t\t\t\t\tthreads={filters.threads}\n\t\t\t\t\t\t\t\tcommentBeingRepliedTo={commentBeingRepliedTo}\n\t\t\t\t\t\t\t\tsetCommentBeingRepliedTo={\n\t\t\t\t\t\t\t\t\tsetCommentBeingRepliedTo\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcommentToScrollTo={commentToScrollTo}\n\t\t\t\t\t\t\t\tmutes={mutes}\n\t\t\t\t\t\t\t\ttoggleMuteStatus={toggleMuteStatus}\n\t\t\t\t\t\t\t\tonPermalinkClick={onPermalinkClick}\n\t\t\t\t\t\t\t\terror={replyForm.error}\n\t\t\t\t\t\t\t\tsetError={setReplyFormError}\n\t\t\t\t\t\t\t\tuserNameMissing={replyForm.userNameMissing}\n\t\t\t\t\t\t\t\tsetUserNameMissing={setReplyFormUserMissing}\n\t\t\t\t\t\t\t\tpreviewBody={replyForm.previewBody}\n\t\t\t\t\t\t\t\tsetPreviewBody={setReplyFormPreviewBody}\n\t\t\t\t\t\t\t\treportAbuse={reportAbuse}\n\t\t\t\t\t\t\t\texpandCommentReplies={expandCommentReplies}\n\t\t\t\t\t\t\t\tisExpanded={expanded}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t))}\n\t\t\t\t</ul>\n\t\t\t)}\n\t\t\t{showPagination && (\n\t\t\t\t<footer css={footerStyles}>\n\t\t\t\t\t<Pagination\n\t\t\t\t\t\tcurrentPage={page}\n\t\t\t\t\t\tsetCurrentPage={onPageChange}\n\t\t\t\t\t\ttopLevelCommentCount={topLevelCommentCount}\n\t\t\t\t\t\tfilters={filters}\n\t\t\t\t\t/>\n\t\t\t\t</footer>\n\t\t\t)}\n\t\t\t{user && !isClosedForComments && comments.length > 10 && (\n\t\t\t\t<CommentForm\n\t\t\t\t\tshortUrl={shortUrl}\n\t\t\t\t\tonAddComment={onAddComment}\n\t\t\t\t\tuser={user}\n\t\t\t\t\tonPreview={onPreview}\n\t\t\t\t\terror={bottomForm.error}\n\t\t\t\t\tsetError={setBottomFormError}\n\t\t\t\t\tuserNameMissing={bottomForm.userNameMissing}\n\t\t\t\t\tsetUserNameMissing={setBottomFormUserMissing}\n\t\t\t\t\tpreviewBody={bottomForm.previewBody}\n\t\t\t\t\tsetPreviewBody={setBottomFormPreviewBody}\n\t\t\t\t/>\n\t\t\t)}\n\t\t</div>\n\t);\n};\n","import { css } from '@emotion/react';\nimport { isUndefined, storage } from '@guardian/libs';\nimport { space } from '@guardian/source/foundations';\nimport { SvgPlus } from '@guardian/source/react-components';\nimport { useEffect, useReducer } from 'react';\nimport { assertUnreachable } from '../lib/assert-unreachable';\nimport type {\n\tCommentFormProps,\n\tCommentType,\n\tFilterOptions,\n\tReplyType,\n\tSignedInUser,\n} from '../lib/discussion';\nimport {\n\tgetCommentContext,\n\tgetDiscussion,\n\ttype reportAbuse,\n} from '../lib/discussionApi';\nimport { initFiltersFromLocalStorage } from '../lib/discussionFilters';\nimport { palette as themePalette } from '../palette';\nimport { Comments } from './Discussion/Comments';\nimport { PillarButton } from './Discussion/PillarButton';\nimport type { Action } from './DispatchContext';\nimport { DispatchProvider } from './DispatchContext';\nimport { Hide } from './Hide';\nimport { SignedInAs } from './SignedInAs';\n\nexport type Props = {\n\tdiscussionApiUrl: string;\n\tshortUrlId: string;\n\tdiscussionD2Uid: string;\n\tdiscussionApiClientHeader: string;\n\tenableDiscussionSwitch: boolean;\n\tuser?: SignedInUser;\n\tidApiUrl: string;\n\treportAbuseUnauthenticated: ReturnType<typeof reportAbuse>;\n};\n\nconst overlayStyles = css`\n\tbackground-image: linear-gradient(\n\t\t0deg,\n\t\t${themePalette('--discussion-section-background')},\n\t\t${themePalette('--discussion-section-background')} 40%,\n\t\ttransparent\n\t);\n\theight: 80px;\n\tposition: absolute;\n\tbottom: 0;\n\tright: 0;\n\twidth: 100%;\n\tdisplay: block;\n`;\n\nconst fixHeight = css`\n\tmax-height: 280px;\n\tmin-height: 280px;\n\toverflow: hidden;\n`;\n\nconst positionRelative = css`\n\tposition: relative;\n`;\n\nconst rememberFilters = ({ threads, pageSize, orderBy }: FilterOptions) => {\n\tstorage.local.set('gu.prefs.discussion.threading', threads);\n\tstorage.local.set('gu.prefs.discussion.pagesize', pageSize);\n\tstorage.local.set('gu.prefs.discussion.order', orderBy);\n};\n\nconst commentIdFromUrl = () => {\n\tconst { hash } = window.location;\n\tif (!hash.includes('comment')) return;\n\n\tconst [, commentId] = hash.split('-');\n\tif (!commentId) return;\n\n\treturn commentId;\n};\n\n/**\n * If a permalink is used and the threading is set to collapsed, this function remaps the threading filter to expanded.\n * We do this to ensure that threads are expanded in the UI while respecting the user's local preference.\n */\nconst remapToValidFilters = (\n\tfilters: FilterOptions,\n\thashCommentId: string | undefined,\n) => {\n\tconst permalinkBeingUsed = !!hashCommentId;\n\n\tif (!permalinkBeingUsed) return filters;\n\tif (filters.threads !== 'collapsed') return filters;\n\treturn {\n\t\t...filters,\n\t\tthreads: 'expanded',\n\t} satisfies FilterOptions;\n};\n\n/**\n * Finds the matching comment for which to expand the replies,\n * and replaces its responses with a new list.\n\n * @example\n * ```txt\n * Comment ID: 1234\n *\n * Before\n * ━━ 1233\n * ━┳ 1234\n *  ┣━ 0001\n *  ┣━ 0002\n *  ┡━ 0003\n *  ┆  (show 4 more replies)\n * ━━ 1235\n *\n * After\n * ━━ 1233\n * ━┳ 1234\n *  ┣━ 0001\n *  ┣━ 0002\n *  ┣━ 0003\n *  ┣━ 0004\n *  ┣━ 0005\n *  ┣━ 0006\n *  ┗━ 0007\n * ━━ 1235\n * ```\n */\nexport const replaceMatchingCommentResponses =\n\t(action: Action & { type: 'expandCommentReplies' }) =>\n\t<T extends CommentType | ReplyType>(comment: T): T =>\n\t\tcomment.id === action.commentId\n\t\t\t? { ...comment, responses: action.responses }\n\t\t\t: comment;\n\ntype State = {\n\tcomments: Array<CommentType | ReplyType>;\n\tisClosedForComments: boolean;\n\tisClosedForRecommendation: boolean;\n\tisExpanded: boolean;\n\tcommentPage: number;\n\tcommentCount: number | undefined;\n\ttopLevelCommentCount: number;\n\tfilters: FilterOptions;\n\thashCommentId: string | undefined;\n\tloading: boolean;\n\ttopForm: CommentFormProps;\n\treplyForm: CommentFormProps;\n\tbottomForm: CommentFormProps;\n};\n\nconst initialCommentFormState = {\n\tisActive: false,\n\tuserNameMissing: false,\n\terror: '',\n\tshowPreview: false,\n\tpreviewBody: '',\n\tbody: '',\n};\n\nconst initialState: State = {\n\tcomments: [],\n\tisClosedForComments: false,\n\tisClosedForRecommendation: false,\n\tisExpanded: false,\n\tcommentPage: 1,\n\tcommentCount: undefined,\n\ttopLevelCommentCount: 0,\n\tfilters: initFiltersFromLocalStorage(),\n\thashCommentId: undefined,\n\tloading: true,\n\ttopForm: initialCommentFormState,\n\treplyForm: initialCommentFormState,\n\tbottomForm: initialCommentFormState,\n};\n\nconst reducer = (state: State, action: Action): State => {\n\tswitch (action.type) {\n\t\tcase 'commentsLoaded':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcomments: action.comments,\n\t\t\t\tisClosedForComments: action.isClosedForComments,\n\t\t\t\tisClosedForRecommendation: action.isClosedForRecommendation,\n\t\t\t\tcommentCount: action.commentCount,\n\t\t\t\ttopLevelCommentCount: action.topLevelCommentCount,\n\t\t\t\tloading: false,\n\t\t\t};\n\t\tcase 'addComment':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcomments: [action.comment, ...state.comments],\n\t\t\t\tisExpanded: true,\n\t\t\t};\n\t\tcase 'addReply':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcomments: state.comments.map((comment) =>\n\t\t\t\t\tcomment.responses &&\n\t\t\t\t\tcomment.id === action.comment.responseTo.commentId\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t...comment,\n\t\t\t\t\t\t\t\tresponses: [\n\t\t\t\t\t\t\t\t\t...comment.responses,\n\t\t\t\t\t\t\t\t\taction.comment,\n\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t  }\n\t\t\t\t\t\t: comment,\n\t\t\t\t),\n\t\t\t\tisExpanded: true,\n\t\t\t};\n\t\tcase 'expandComments':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisExpanded: true,\n\t\t\t};\n\t\tcase 'updateCommentPage':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tcommentPage: action.commentPage,\n\t\t\t\tisExpanded: true,\n\t\t\t};\n\t\tcase 'filterChange':\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tfilters: action.filters,\n\t\t\t\thashCommentId: undefined,\n\t\t\t\tisExpanded: true,\n\t\t\t\tcommentPage: action.commentPage ?? state.commentPage,\n\t\t\t};\n\t\tcase 'setLoading': {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tloading: action.loading,\n\t\t\t};\n\t\t}\n\t\tcase 'updateHashCommentId': {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\thashCommentId: action.hashCommentId,\n\t\t\t\tisExpanded: true,\n\t\t\t};\n\t\t}\n\t\tcase 'setTopFormUserMissing': {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\ttopForm: {\n\t\t\t\t\t...state.topForm,\n\t\t\t\t\tuserNameMissing: action.userNameMissing,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t\tcase 'setReplyFormUserMissing': {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\treplyForm: {\n\t\t\t\t\t...state.replyForm,\n\t\t\t\t\tuserNameMissing: action.userNameMissing,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t\tcase 'setBottomFormUserMissing': {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tbottomForm: {\n\t\t\t\t\t...state.bottomForm,\n\t\t\t\t\tuserNameMissing: action.userNameMissing,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t\tcase 'setTopFormPreviewBody': {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\ttopForm: {\n\t\t\t\t\t...state.topForm,\n\t\t\t\t\tpreviewBody: action.previewBody,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t\tcase 'setReplyFormPreviewBody': {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\treplyForm: {\n\t\t\t\t\t...state.replyForm,\n\t\t\t\t\tpreviewBody: action.previewBody,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t\tcase 'setBottomFormPreviewBody': {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tbottomForm: {\n\t\t\t\t\t...state.bottomForm,\n\t\t\t\t\tpreviewBody: action.previewBody,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t\tcase 'setTopFormError': {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\ttopForm: {\n\t\t\t\t\t...state.topForm,\n\t\t\t\t\terror: action.error,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t\tcase 'setReplyFormError': {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\treplyForm: {\n\t\t\t\t\t...state.replyForm,\n\t\t\t\t\terror: action.error,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t\tcase 'setBottomFormError': {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tbottomForm: {\n\t\t\t\t\t...state.bottomForm,\n\t\t\t\t\terror: action.error,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t\tcase 'expandCommentReplies': {\n\t\t\treturn {\n\t\t\t\t...state,\n\t\t\t\tisExpanded: true,\n\t\t\t\tcomments: state.comments.map(\n\t\t\t\t\treplaceMatchingCommentResponses(action),\n\t\t\t\t),\n\t\t\t};\n\t\t}\n\n\t\tdefault:\n\t\t\tassertUnreachable(action);\n\t\t\treturn state;\n\t}\n};\n\nexport const Discussion = ({\n\tdiscussionApiUrl,\n\tshortUrlId,\n\tdiscussionD2Uid,\n\tdiscussionApiClientHeader,\n\tenableDiscussionSwitch,\n\tuser,\n\tidApiUrl,\n\treportAbuseUnauthenticated,\n}: Props) => {\n\tconst [\n\t\t{\n\t\t\tcomments,\n\t\t\tisClosedForComments,\n\t\t\tisClosedForRecommendation,\n\t\t\tisExpanded,\n\t\t\tcommentPage,\n\t\t\tfilters,\n\t\t\thashCommentId,\n\t\t\tloading,\n\t\t\ttopForm,\n\t\t\treplyForm,\n\t\t\tbottomForm,\n\t\t\ttopLevelCommentCount,\n\t\t\tcommentCount,\n\t\t},\n\t\tdispatch,\n\t] = useReducer(reducer, initialState);\n\n\tuseEffect(() => {\n\t\tconst newHashCommentId = commentIdFromUrl();\n\t\tif (!isUndefined(newHashCommentId)) {\n\t\t\tdispatch({\n\t\t\t\ttype: 'updateHashCommentId',\n\t\t\t\thashCommentId: newHashCommentId,\n\t\t\t});\n\t\t}\n\t}, []);\n\n\tuseEffect(() => {\n\t\tdispatch({ type: 'setLoading', loading: true });\n\n\t\tconst controller = new AbortController();\n\n\t\tvoid getDiscussion({\n\t\t\tshortUrl: shortUrlId,\n\t\t\tpage: commentPage,\n\t\t\tfilters: remapToValidFilters(filters, hashCommentId),\n\t\t\tsignal: controller.signal,\n\t\t})\n\t\t\t.then((result) => {\n\t\t\t\tif (result.kind === 'error') {\n\t\t\t\t\tif (result.error !== 'AbortedSignal') {\n\t\t\t\t\t\tconsole.error(`getDiscussion - error: ${result.error}`);\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst { discussion } = result.value;\n\n\t\t\t\tdispatch({\n\t\t\t\t\ttype: 'commentsLoaded',\n\t\t\t\t\tcomments: discussion.comments,\n\t\t\t\t\tisClosedForComments: discussion.isClosedForComments,\n\t\t\t\t\tisClosedForRecommendation:\n\t\t\t\t\t\tdiscussion.isClosedForRecommendation,\n\t\t\t\t\ttopLevelCommentCount: discussion.topLevelCommentCount,\n\t\t\t\t\tcommentCount: discussion.commentCount,\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\t// do nothing\n\t\t\t});\n\n\t\treturn () => controller.abort();\n\t}, [commentPage, filters, hashCommentId, shortUrlId]);\n\n\tconst validFilters = remapToValidFilters(filters, hashCommentId);\n\n\tuseEffect(() => {\n\t\trememberFilters(filters);\n\t}, [filters]);\n\n\tconst handlePermalink = (commentId: string) => {\n\t\twindow.location.hash = `#comment-${commentId}`;\n\t\t// Put this comment id into the hashCommentId state which will\n\t\t// trigger an api call to get the comment context and then expand\n\t\t// and reload the discussion based on the resuts\n\t\tdispatch({ type: 'updateHashCommentId', hashCommentId: commentId });\n\t\treturn false;\n\t};\n\n\t// Check the url to see if there is a comment hash, e.g. ...crisis#comment-139113120\n\t// If so, make a call to get the context of this comment so we know what page it is\n\t// on.\n\tuseEffect(() => {\n\t\tif (!isUndefined(hashCommentId)) {\n\t\t\tgetCommentContext(\n\t\t\t\tdiscussionApiUrl,\n\t\t\t\thashCommentId,\n\t\t\t\tremapToValidFilters(filters, hashCommentId),\n\t\t\t)\n\t\t\t\t.then((context) => {\n\t\t\t\t\tif (context.kind === 'ok') {\n\t\t\t\t\t\tdispatch({\n\t\t\t\t\t\t\ttype: 'updateCommentPage',\n\t\t\t\t\t\t\tcommentPage: context.value.page,\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t\t`getCommentContext - error: ${context.error}`,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\t.catch((e) =>\n\t\t\t\t\tconsole.error(`getCommentContext - error: ${String(e)}`),\n\t\t\t\t);\n\t\t}\n\t}, [filters, discussionApiUrl, hashCommentId]);\n\n\tuseEffect(() => {\n\t\tif (window.location.hash === '#comments') {\n\t\t\tdispatch({ type: 'expandComments' });\n\t\t}\n\t}, []);\n\n\tuseEffect(() => {\n\t\t// There's no point showing the view more button if there isn't much more to view\n\t\tif (commentCount === 0 || commentCount === 1 || commentCount === 2) {\n\t\t\tdispatch({ type: 'expandComments' });\n\t\t}\n\t}, [commentCount]);\n\n\treturn (\n\t\t<DispatchProvider value={dispatch}>\n\t\t\t<div css={[positionRelative, !isExpanded && fixHeight]}>\n\t\t\t\t<Hide when=\"above\" breakpoint=\"leftCol\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tdata-testid=\"discussion\"\n\t\t\t\t\t\tcss={css`\n\t\t\t\t\t\t\tpadding-bottom: ${space[2]}px;\n\t\t\t\t\t\t`}\n\t\t\t\t\t>\n\t\t\t\t\t\t<SignedInAs\n\t\t\t\t\t\t\tenableDiscussionSwitch={enableDiscussionSwitch}\n\t\t\t\t\t\t\tuser={user?.profile}\n\t\t\t\t\t\t\tcommentCount={commentCount}\n\t\t\t\t\t\t\tisClosedForComments={isClosedForComments}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</Hide>\n\t\t\t\t<Comments\n\t\t\t\t\tuser={user}\n\t\t\t\t\tbaseUrl={discussionApiUrl}\n\t\t\t\t\tisClosedForComments={\n\t\t\t\t\t\t!!isClosedForComments || !enableDiscussionSwitch\n\t\t\t\t\t}\n\t\t\t\t\tisClosedForRecommendations={!!isClosedForRecommendation}\n\t\t\t\t\tshortUrl={shortUrlId}\n\t\t\t\t\tadditionalHeaders={{\n\t\t\t\t\t\t'D2-X-UID': discussionD2Uid,\n\t\t\t\t\t\t'GU-Client': discussionApiClientHeader,\n\t\t\t\t\t}}\n\t\t\t\t\texpanded={isExpanded}\n\t\t\t\t\tcommentToScrollTo={hashCommentId}\n\t\t\t\t\tonPermalinkClick={handlePermalink}\n\t\t\t\t\tapiKey=\"dotcom-rendering\"\n\t\t\t\t\tidApiUrl={idApiUrl}\n\t\t\t\t\tpage={commentPage}\n\t\t\t\t\tfilters={validFilters}\n\t\t\t\t\ttopLevelCommentCount={topLevelCommentCount}\n\t\t\t\t\tloading={loading}\n\t\t\t\t\tcomments={comments}\n\t\t\t\t\ttopForm={topForm}\n\t\t\t\t\treplyForm={replyForm}\n\t\t\t\t\tbottomForm={bottomForm}\n\t\t\t\t\treportAbuse={\n\t\t\t\t\t\t!isUndefined(user)\n\t\t\t\t\t\t\t? user.reportAbuse\n\t\t\t\t\t\t\t: reportAbuseUnauthenticated\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t\t{!isExpanded && (\n\t\t\t\t\t<div id=\"discussion-overlay\" css={overlayStyles} />\n\t\t\t\t)}\n\t\t\t</div>\n\t\t\t{!isExpanded && (\n\t\t\t\t<PillarButton\n\t\t\t\t\tonClick={() => {\n\t\t\t\t\t\tdispatch({ type: 'expandComments' });\n\t\t\t\t\t}}\n\t\t\t\t\ticon={<SvgPlus />}\n\t\t\t\t\tlinkName=\"view-more-comments\"\n\t\t\t\t>\n\t\t\t\t\tView more comments\n\t\t\t\t</PillarButton>\n\t\t\t)}\n\t\t</DispatchProvider>\n\t);\n};\n","import { css } from '@emotion/react';\nimport type { Breakpoint } from '@guardian/source/foundations';\nimport { from, until } from '@guardian/source/foundations';\n\ninterface Props {\n\tchildren: React.ReactNode;\n\twhen: 'above' | 'below';\n\tbreakpoint: Breakpoint;\n}\n\ninterface PropsSpan extends Props {\n\tel?: 'span';\n}\ninterface PropsLi extends Props {\n\tel: 'li';\n}\n\nexport const Hide = ({\n\tchildren,\n\twhen,\n\tbreakpoint,\n\tel,\n}: PropsSpan | PropsLi) => {\n\tlet whenToHide;\n\tif (when === 'below') {\n\t\twhenToHide = css`\n\t\t\t${until[breakpoint]} {\n\t\t\t\tdisplay: none;\n\t\t\t}\n\t\t`;\n\t} else {\n\t\twhenToHide = css`\n\t\t\t${from[breakpoint]} {\n\t\t\t\tdisplay: none;\n\t\t\t}\n\t\t`;\n\t}\n\treturn el === 'li' ? (\n\t\t<li css={whenToHide}>{children}</li>\n\t) : (\n\t\t<span css={whenToHide}>{children}</span>\n\t);\n};\n","/**\n * A function that asserts it should never be called\n *\n * Useful for checking exhaustiveness of switch cases\n *\n * @see https://tinytip.co/tips/ts-switch-assert-unreachable/\n *\n */\n// eslint-disable-next-line @typescript-eslint/no-unused-vars -- We don't actually use the value\nexport const assertUnreachable = (value: never): never => {\n\tthrow new Error('This should be unreachable');\n};\n","import { isOneOf } from '@guardian/libs';\nimport type { BaseSchema, Input, Output } from 'valibot';\nimport {\n\tarray,\n\tboolean,\n\tliteral,\n\tmerge,\n\tminLength,\n\tnumber,\n\tobject,\n\toptional,\n\tpicklist,\n\tsafeParse,\n\tstring,\n\ttransform,\n\tundefined_,\n\tunion,\n\tvariant,\n} from 'valibot';\nimport type {\n\taddUserName,\n\tcomment as onComment,\n\trecommend as onRecommend,\n\treply as onReply,\n\tpickComment,\n\treportAbuse,\n\tunPickComment,\n} from './discussionApi';\nimport { error, ok, type Result } from './result';\n\nexport type CAPIPillar =\n\t| 'news'\n\t| 'sport'\n\t| 'culture'\n\t| 'opinion'\n\t| 'lifestyle'\n\t| 'labs';\n\nconst userProfile: BaseSchema<UserProfile> = object({\n\tuserId: string(),\n\tdisplayName: string(),\n\twebUrl: string(),\n\tapiUrl: string(),\n\tavatar: string(),\n\tsecureAvatarUrl: string(),\n\tbadge: array(object({ name: string() })),\n\n\t// only included from /profile/me endpoint\n\tprivateFields: optional(\n\t\tobject({\n\t\t\tcanPostComment: boolean(),\n\t\t\tisPremoderated: boolean(),\n\t\t\thasCommented: boolean(),\n\t\t}),\n\t),\n});\n\nexport interface UserProfile {\n\tuserId: string;\n\tdisplayName: string;\n\twebUrl: string;\n\tapiUrl: string;\n\tavatar: string;\n\tsecureAvatarUrl: string;\n\tbadge: { name: string }[];\n\n\t// only included from /profile/me endpoint\n\tprivateFields?: {\n\t\tcanPostComment: boolean;\n\t\tisPremoderated: boolean;\n\t\thasCommented: boolean;\n\t};\n}\n\nexport const parseUserProfile = (\n\tdata: unknown,\n): Result<'ParsingError', UserProfile> => {\n\tconst result = safeParse(\n\t\tobject({ status: literal('ok'), userProfile }),\n\t\tdata,\n\t);\n\tif (!result.success) {\n\t\treturn error('ParsingError');\n\t}\n\treturn ok(result.output.userProfile);\n};\n\nconst baseCommentSchema = object({\n\tid: transform(union([number(), string()]), (id) => id.toString()),\n\tbody: string(),\n\tdate: string(),\n\tisoDateTime: string(),\n\tstatus: string(),\n\twebUrl: string(),\n\tapiUrl: string(),\n\tnumResponses: optional(number()),\n\tnumRecommends: number(),\n\tisHighlighted: boolean(),\n\tuserProfile,\n\tdiscussion: optional(\n\t\tobject({\n\t\t\tkey: string(),\n\t\t\twebUrl: string(),\n\t\t\tapiUrl: string(),\n\t\t\ttitle: string(),\n\t\t\tisClosedForComments: boolean(),\n\t\t\tisClosedForRecommendation: boolean(),\n\t\t}),\n\t),\n\tmetaData: optional(\n\t\tobject({\n\t\t\tcommentCount: number(),\n\t\t\tstaffCommenterCount: number(),\n\t\t\teditorsPickCount: number(),\n\t\t\tblockedCount: number(),\n\t\t\tresponseCount: number(),\n\t\t}),\n\t),\n});\n\nexport type ReplyType = Output<typeof replySchema>;\n\nconst replySchema = merge([\n\tbaseCommentSchema,\n\tobject({\n\t\tresponses: optional(undefined_(), undefined),\n\t\tresponseTo: object({\n\t\t\tdisplayName: string(),\n\t\t\tcommentApiUrl: string(),\n\t\t\tisoDateTime: string(),\n\t\t\tdate: string(),\n\t\t\tcommentId: string(),\n\t\t\tcommentWebUrl: string(),\n\t\t}),\n\t}),\n]);\n\nexport type CommentType = Output<typeof commentSchema>;\n\nconst commentSchema = merge([\n\tbaseCommentSchema,\n\tobject({\n\t\tresponses: optional(array(replySchema), []),\n\t\tresponseTo: optional(undefined_(), undefined),\n\t}),\n]);\n\nconst commentRepliesResponseSchema = variant('status', [\n\tobject({\n\t\tstatus: literal('error'),\n\t}),\n\tobject({\n\t\tstatus: literal('ok'),\n\t\tcomment: commentSchema,\n\t}),\n]);\n\nexport const parseRepliesResponse = (\n\tdata: unknown,\n): Result<'ParsingError' | 'ApiError', ReplyType[]> => {\n\tconst result = safeParse(commentRepliesResponseSchema, data);\n\tif (!result.success) {\n\t\treturn error('ParsingError');\n\t}\n\tif (result.output.status === 'error') {\n\t\treturn error('ApiError');\n\t}\n\treturn ok(result.output.comment.responses);\n};\n\nexport type CommentResponseErrorCodes = (typeof errorCodes)[number];\nconst errorCodes = [\n\t'USERNAME_MISSING',\n\t'EMPTY_COMMENT_BODY',\n\t'COMMENT_TOO_LONG',\n\t'USER_BANNED',\n\t'IP_THROTTLED',\n\t'DISCUSSION_CLOSED',\n\t'PARENT_COMMENT_MODERATED',\n\t'COMMENT_RATE_LIMIT_EXCEEDED',\n\t'INVALID_PROTOCOL',\n\t'AUTH_COOKIE_INVALID',\n\t'READ-ONLY-MODE',\n\t'API_CORS_BLOCKED',\n\t'API_ERROR',\n\t'EMAIL_NOT_VALIDATED',\n] as const;\n\nconst commentResponseSchema = variant('status', [\n\tobject({\n\t\tstatus: literal('error'),\n\t\terrorCode: picklist(errorCodes),\n\t}),\n\tobject({\n\t\tstatus: literal('ok'),\n\t\t// response.message is the id of the comment that was created on the server\n\t\tmessage: string(),\n\t}),\n]);\n\nexport const parseCommentResponse = (\n\tdata: unknown,\n): Result<'ParsingError' | CommentResponseErrorCodes, string> => {\n\tconst { success, output } = safeParse(commentResponseSchema, data);\n\tif (!success) {\n\t\treturn error('ParsingError');\n\t}\n\n\tif (output.status === 'error') {\n\t\treturn error(output.errorCode);\n\t}\n\n\treturn ok(output.message);\n};\n\nconst abuseResponseSchema = variant('status', [\n\tobject({\n\t\tstatus: literal('error'),\n\t\tmessage: string(),\n\t}),\n\tobject({\n\t\tstatus: literal('ok'),\n\t}),\n]);\n\nexport const parseAbuseResponse = (data: unknown): Result<string, true> => {\n\tconst { success, output } = safeParse(abuseResponseSchema, data);\n\tif (!success) {\n\t\treturn error('An unknown error occured');\n\t}\n\treturn output.status === 'ok' ? ok(true) : error(output.message);\n};\n\nexport const postUsernameResponseSchema = variant('status', [\n\tobject({\n\t\tstatus: literal('error'),\n\t\terrors: array(\n\t\t\tobject({\n\t\t\t\tmessage: string(),\n\t\t\t}),\n\t\t\t[minLength(1)],\n\t\t),\n\t}),\n\tobject({\n\t\tstatus: literal('ok'),\n\t}),\n]);\n\nconst orderBy = ['newest', 'oldest', 'recommendations'] as const;\nexport const isOrderBy = isOneOf(orderBy);\nexport type OrderByType = (typeof orderBy)[number];\n\nconst threads = ['collapsed', 'expanded', 'unthreaded'] as const;\nexport const isThreads = isOneOf(threads);\nexport type ThreadsType = (typeof threads)[number];\n\nconst pageSize = [25, 50, 100] as const;\nexport const isPageSize = isOneOf(pageSize);\nexport type PageSizeType = (typeof pageSize)[number];\nexport interface FilterOptions {\n\torderBy: OrderByType;\n\tpageSize: PageSizeType;\n\tthreads: ThreadsType;\n}\n\ntype UserFields = {\n\tprofile: UserProfile;\n\tonComment: ReturnType<typeof onComment>;\n\tonReply: ReturnType<typeof onReply>;\n\tonRecommend: ReturnType<typeof onRecommend>;\n\taddUsername: ReturnType<typeof addUserName>;\n\treportAbuse: ReturnType<typeof reportAbuse>;\n};\n\nexport type Reader = UserFields & {\n\tkind: 'Reader';\n};\n\nexport type Staff = UserFields & {\n\tkind: 'Staff';\n\tonPick: ReturnType<typeof pickComment>;\n\tonUnpick: ReturnType<typeof unPickComment>;\n};\n\nexport type SignedInUser = Reader | Staff;\n\nconst discussionApiErrorSchema = object({\n\tstatus: literal('error'),\n\tstatusCode: number(),\n\tmessage: string(),\n\terrorCode: optional(string()),\n});\n\nexport type GetDiscussionSuccess = Output<typeof discussionApiSuccessSchema>;\n\nconst discussionApiSuccessSchema = object({\n\tstatus: literal('ok'),\n\tcurrentPage: number(),\n\tpages: number(),\n\tpageSize: number(),\n\torderBy: string(),\n\tdiscussion: object({\n\t\tkey: string(),\n\t\twebUrl: string(),\n\t\tapiUrl: string(),\n\t\tcommentCount: number(),\n\t\ttopLevelCommentCount: optional(number(), 0),\n\t\tisClosedForComments: boolean(),\n\t\tisClosedForRecommendation: boolean(),\n\t\tisThreaded: boolean(),\n\t\ttitle: string(),\n\t\tcomments: array(union([replySchema, commentSchema])),\n\t}),\n});\n\nexport const discussionApiResponseSchema = variant('status', [\n\tdiscussionApiErrorSchema,\n\tdiscussionApiSuccessSchema,\n]);\n\nexport type GetDiscussionResponse = Input<typeof discussionApiResponseSchema>;\n\nexport interface DiscussionOptions {\n\torderBy: string;\n\tpageSize: number;\n\tdisplayThreaded: boolean;\n\tmaxResponses: number;\n\tpage: number;\n\t'api-key': string;\n}\n\nexport type AdditionalHeadersType = { [key: string]: string };\n\nexport type DropdownOptionType = {\n\tvalue: string;\n\ttitle: string;\n\tdisabled?: boolean;\n\tisActive?: boolean;\n};\n\nexport const pickResponseSchema = object({\n\tstatus: literal('ok'),\n\tstatusCode: literal(200),\n\tmessage: string(),\n});\n\nconst recommendResponseSchema = object({\n\tstatus: literal('ok'),\n\tstatusCode: literal(200),\n});\n\nexport const parseRecommendResponse = (\n\tdata: unknown,\n): Result<'ParsingError', true> => {\n\tconst { success } = safeParse(recommendResponseSchema, data);\n\treturn success ? ok(true) : error('ParsingError');\n};\n\nexport type CommentFormProps = {\n\tuserNameMissing: boolean;\n\terror: string;\n\tpreviewBody: string;\n};\n\nexport const getCommentContextResponseSchema = object({\n\tstatus: literal('ok'),\n\tcommentId: number(),\n\tcommentAncestorId: number(),\n\tdiscussionKey: string(),\n\tdiscussionWebUrl: string(),\n\tdiscussionApiUrl: string(),\n\torderBy: picklist(orderBy),\n\tpageSize: picklist(pageSize),\n\tpage: number(),\n});\n\n/** for development purposes only! */\nexport const stubUser = {\n\tkind: 'Reader',\n\taddUsername: () => Promise.resolve(error('This is a stub user')),\n\tonComment: () =>\n\t\tPromise.resolve(\n\t\t\tok(\n\t\t\t\tString(\n\t\t\t\t\tNumber.MAX_SAFE_INTEGER - Math.ceil(Math.random() * 12_000),\n\t\t\t\t),\n\t\t\t),\n\t\t),\n\tonRecommend: () => Promise.resolve(true),\n\tonReply: () => Promise.resolve(error('API_ERROR')),\n\treportAbuse: () => Promise.resolve(error('Invalid')),\n\tprofile: {\n\t\tuserId: 'stub-user-000',\n\t\tdisplayName: 'Stub User',\n\t\twebUrl: '',\n\t\tapiUrl: '',\n\t\tavatar: '',\n\t\tsecureAvatarUrl: '',\n\t\tbadge: [],\n\t\tprivateFields: {\n\t\t\tcanPostComment: true,\n\t\t\tisPremoderated: false,\n\t\t\thasCommented: true,\n\t\t},\n\t},\n} satisfies Reader;\n","import { error, ok, type Result } from './result';\n\n/**\n * Safely fetch JSON from a URL.\n *\n * If successful, the value is typed as `unknown`.\n */\nexport const fetchJSON = async (\n\t...args: Parameters<typeof fetch>\n): Promise<Result<'ApiError' | 'NetworkError', unknown>> => {\n\ttry {\n\t\tconst response = await fetch(...args);\n\t\treturn ok(await response.json());\n\t} catch (err) {\n\t\tif (err instanceof SyntaxError) {\n\t\t\treturn error('ApiError');\n\t\t}\n\n\t\treturn error('NetworkError');\n\t}\n};\n","import { isObject, isString, joinUrl } from '@guardian/libs';\nimport { safeParse } from 'valibot';\nimport type {\n\tAdditionalHeadersType,\n\tCommentType,\n\tDiscussionOptions,\n\tFilterOptions,\n\tGetDiscussionSuccess,\n\tReplyType,\n} from './discussion';\nimport {\n\tdiscussionApiResponseSchema,\n\tgetCommentContextResponseSchema,\n\tparseAbuseResponse,\n\tparseCommentResponse,\n\tparseRecommendResponse,\n\tparseRepliesResponse,\n\tpickResponseSchema,\n\tpostUsernameResponseSchema,\n} from './discussion';\nimport type { CommentContextType } from './discussionFilters';\nimport type { SignedInWithCookies, SignedInWithOkta } from './identity';\nimport { getOptionsHeadersWithOkta } from './identity';\nimport { fetchJSON } from './json';\nimport { error, ok, type Result } from './result';\n\nconst options = {\n\t// Defaults\n\tbaseUrl: 'https://discussion.theguardian.com/discussion-api',\n\tapiKey: 'discussion-rendering',\n\theaders: {},\n\tidApiUrl: 'https://idapi.theguardian.com',\n};\n\nconst defaultParams = {\n\t'api-key': options.apiKey,\n};\n\nexport const initialiseApi = ({\n\tbaseUrl,\n\tadditionalHeaders,\n\tapiKey,\n\tidApiUrl,\n}: {\n\tbaseUrl: string;\n\tadditionalHeaders: AdditionalHeadersType;\n\tapiKey: string;\n\tidApiUrl: string;\n}) => {\n\toptions.baseUrl = baseUrl || options.baseUrl;\n\toptions.headers = additionalHeaders;\n\toptions.apiKey = apiKey || options.apiKey;\n\toptions.idApiUrl = idApiUrl || options.idApiUrl;\n\n\tdefaultParams['api-key'] = options.apiKey;\n};\n\nconst objAsParams = (obj: any): string => {\n\tconst params = Object.keys(obj)\n\t\t.map((key) => {\n\t\t\t// TODO: Refactor this for better typesafety. See https://github.com/guardian/dotcom-rendering/pull/8057/commits/da4667399d4a7726589f1944ac60380f1f3f36e1\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/restrict-template-expressions -- type issues here cannot be avoided with this implementation\n\t\t\treturn `${key}=${obj[key]}`;\n\t\t})\n\t\t.join('&');\n\n\treturn '?' + params;\n};\n\ntype GetDiscussionError =\n\t| 'ParsingError'\n\t| 'ApiError'\n\t| 'NetworkError'\n\t| 'AbortedSignal';\n\n//todo: figure out the different return types and consider error handling\nexport const getDiscussion = async ({\n\tshortUrl,\n\tpage,\n\tfilters,\n\tsignal,\n}: {\n\tshortUrl: string;\n\tpage: number;\n\tfilters: FilterOptions;\n\tsignal: AbortSignal;\n}): Promise<Result<GetDiscussionError, GetDiscussionSuccess>> => {\n\tconst apiOpts: DiscussionOptions = {\n\t\t...defaultParams,\n\t\t...{\n\t\t\t// Frontend uses the 'recommendations' key to store this options but the api expects\n\t\t\t// 'mostRecommended' so we have to map here to support both\n\t\t\torderBy:\n\t\t\t\tfilters.orderBy === 'recommendations'\n\t\t\t\t\t? 'mostRecommended'\n\t\t\t\t\t: filters.orderBy,\n\t\t\tpageSize: filters.pageSize,\n\t\t\tdisplayThreaded: filters.threads !== 'unthreaded',\n\t\t\tmaxResponses: filters.threads === 'collapsed' ? 3 : 100,\n\t\t\tpage,\n\t\t},\n\t};\n\tconst params = objAsParams(apiOpts);\n\n\tconst url = joinUrl(options.baseUrl, 'discussion', shortUrl) + params;\n\n\tconst jsonResult = await fetchJSON(url, {\n\t\theaders: options.headers,\n\t\tsignal,\n\t});\n\n\tif (jsonResult.kind === 'error') {\n\t\treturn signal.aborted ? error('AbortedSignal') : jsonResult;\n\t}\n\n\tconst result = safeParse(discussionApiResponseSchema, jsonResult.value);\n\tif (!result.success) {\n\t\treturn error('ParsingError');\n\t}\n\tif (\n\t\tresult.output.status === 'error' &&\n\t\t// We need force a refetch with unthreaded set, as we don't know\n\t\t// that this discussion is only available in linear format until\n\t\t// we get the response to tell us\n\t\tresult.output.errorCode === 'DISCUSSION_ONLY_AVAILABLE_IN_LINEAR_FORMAT'\n\t) {\n\t\treturn getDiscussion({\n\t\t\tshortUrl,\n\t\t\tpage,\n\t\t\tfilters: {\n\t\t\t\t...filters,\n\t\t\t\tthreads: 'unthreaded',\n\t\t\t},\n\t\t\tsignal,\n\t\t});\n\t}\n\tif (result.output.status === 'error') {\n\t\treturn error('ApiError');\n\t}\n\n\treturn ok(result.output);\n};\n\nexport const preview = async (\n\tbody: string,\n): Promise<Result<GetDiscussionError, string>> => {\n\tconst url =\n\t\tjoinUrl(options.baseUrl, 'comment/preview') +\n\t\tobjAsParams(defaultParams);\n\tconst data = new URLSearchParams();\n\tdata.append('body', body);\n\n\tconst jsonResult = await fetchJSON(url, {\n\t\tmethod: 'POST',\n\t\tbody: data.toString(),\n\t\theaders: {\n\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t...options.headers,\n\t\t},\n\t});\n\n\tif (jsonResult.kind === 'error') return jsonResult;\n\n\treturn isObject(jsonResult.value) && isString(jsonResult.value.commentBody)\n\t\t? ok(jsonResult.value.commentBody)\n\t\t: error('ParsingError');\n};\n\nexport type CommentResponse = Result<\n\t| 'NetworkError'\n\t| 'ApiError'\n\t| (ReturnType<typeof parseCommentResponse> & { kind: 'error' })['error'],\n\tstring\n>;\n\nexport const comment =\n\t(authStatus: SignedInWithCookies | SignedInWithOkta) =>\n\tasync (shortUrl: string, body: string): Promise<CommentResponse> => {\n\t\tconst url =\n\t\t\tjoinUrl(options.baseUrl, 'discussion', shortUrl, 'comment') +\n\t\t\tobjAsParams(defaultParams);\n\t\tconst data = new URLSearchParams();\n\t\tdata.append('body', body);\n\n\t\tconst authOptions = getOptionsHeadersWithOkta(authStatus);\n\n\t\tconst jsonResult = await fetchJSON(url, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: data.toString(),\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t\t...options.headers,\n\t\t\t\t...authOptions.headers,\n\t\t\t},\n\t\t\tcredentials: authOptions.credentials,\n\t\t});\n\n\t\tif (jsonResult.kind === 'error') return jsonResult;\n\n\t\treturn parseCommentResponse(jsonResult.value);\n\t};\n\nexport const reply =\n\t(authStatus: SignedInWithCookies | SignedInWithOkta) =>\n\tasync (\n\t\tshortUrl: string,\n\t\tbody: string,\n\t\tparentCommentId: string,\n\t): Promise<CommentResponse> => {\n\t\tconst url =\n\t\t\tjoinUrl(\n\t\t\t\toptions.baseUrl,\n\t\t\t\t'discussion',\n\t\t\t\tshortUrl,\n\t\t\t\t'comment',\n\t\t\t\tparentCommentId,\n\t\t\t\t'reply',\n\t\t\t) + objAsParams(defaultParams);\n\t\tconst data = new URLSearchParams();\n\t\tdata.append('body', body);\n\t\tconst authOptions = getOptionsHeadersWithOkta(authStatus);\n\n\t\tconst jsonResult = await fetchJSON(url, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: data.toString(),\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t\t...options.headers,\n\t\t\t\t...authOptions.headers,\n\t\t\t},\n\t\t\tcredentials: authOptions.credentials,\n\t\t});\n\n\t\tif (jsonResult.kind === 'error') return jsonResult;\n\n\t\treturn parseCommentResponse(jsonResult.value);\n\t};\n\nexport const getPicks = async (\n\tshortUrl: string,\n): Promise<Result<GetDiscussionError, Array<CommentType | ReplyType>>> => {\n\tconst url =\n\t\tjoinUrl(options.baseUrl, 'discussion', shortUrl, 'topcomments') +\n\t\tobjAsParams(defaultParams);\n\n\tconst jsonResult = await fetchJSON(url, {\n\t\theaders: {\n\t\t\t...options.headers,\n\t\t},\n\t});\n\n\tif (jsonResult.kind === 'error') return jsonResult;\n\n\tconst result = safeParse(discussionApiResponseSchema, jsonResult.value);\n\n\tif (!result.success) {\n\t\treturn error('ParsingError');\n\t}\n\tif (result.output.status === 'error') {\n\t\treturn error('ApiError');\n\t}\n\n\treturn ok(result.output.discussion.comments);\n};\n\nexport const reportAbuse =\n\t(authStatus?: SignedInWithCookies | SignedInWithOkta) =>\n\tasync ({\n\t\tcommentId,\n\t\tcategoryId,\n\t\temail,\n\t\treason,\n\t}: {\n\t\tcommentId: string;\n\t\tcategoryId: number;\n\t\treason?: string;\n\t\temail?: string;\n\t}): Promise<Result<string, true>> => {\n\t\tconst url =\n\t\t\tjoinUrl(options.baseUrl, 'comment', commentId, 'reportAbuse') +\n\t\t\tobjAsParams(defaultParams);\n\n\t\tconst data = new URLSearchParams();\n\t\tdata.append('categoryId', categoryId.toString());\n\t\temail && data.append('email', email.toString());\n\t\treason && data.append('reason', reason);\n\n\t\tconst authOptions = authStatus\n\t\t\t? getOptionsHeadersWithOkta(authStatus)\n\t\t\t: undefined;\n\n\t\tconst jsonResult = await fetchJSON(url, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: data.toString(),\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t\t...options.headers,\n\t\t\t\t...authOptions?.headers,\n\t\t\t},\n\t\t\tcredentials: authOptions?.credentials,\n\t\t});\n\n\t\tif (jsonResult.kind === 'error') {\n\t\t\treturn error('An unknown error occured');\n\t\t}\n\n\t\treturn parseAbuseResponse(jsonResult.value);\n\t};\n\nexport const recommend =\n\t(authStatus: SignedInWithCookies | SignedInWithOkta) =>\n\tasync (commentId: string): Promise<boolean> => {\n\t\tconst url =\n\t\t\tjoinUrl(options.baseUrl, 'comment', commentId, 'recommend') +\n\t\t\tobjAsParams(defaultParams);\n\n\t\tconst authOptions = getOptionsHeadersWithOkta(authStatus);\n\n\t\tconst jsonResult = await fetchJSON(url, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t...options.headers,\n\t\t\t\t...(authOptions.headers ?? {}),\n\t\t\t},\n\t\t\tcredentials: authOptions.credentials,\n\t\t});\n\n\t\tif (jsonResult.kind === 'error') return false;\n\t\treturn parseRecommendResponse(jsonResult.value).kind === 'ok';\n\t};\n\nexport const addUserName =\n\t(authStatus: SignedInWithCookies | SignedInWithOkta) =>\n\tasync (userName: string): Promise<Result<string, true>> => {\n\t\tconst url = options.idApiUrl + `/user/me/username`;\n\t\tconst authOptions = getOptionsHeadersWithOkta(authStatus);\n\n\t\tconst jsonResult = await fetchJSON(url, {\n\t\t\tmethod: 'POST',\n\t\t\tbody: JSON.stringify({\n\t\t\t\tpublicFields: {\n\t\t\t\t\tusername: userName,\n\t\t\t\t\tdisplayName: userName,\n\t\t\t\t},\n\t\t\t}),\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/json',\n\t\t\t\t...authOptions.headers,\n\t\t\t},\n\t\t\tcredentials: authOptions.credentials,\n\t\t});\n\n\t\tif (jsonResult.kind === 'error') {\n\t\t\treturn jsonResult;\n\t\t}\n\n\t\tconst result = safeParse(postUsernameResponseSchema, jsonResult.value);\n\n\t\tif (!result.success) {\n\t\t\treturn error('An unknown error occured');\n\t\t}\n\t\tif (result.output.status === 'error') {\n\t\t\treturn error(\n\t\t\t\tresult.output.errors.map(({ message }) => message).join('\\n'),\n\t\t\t);\n\t\t}\n\n\t\treturn ok(true);\n\t};\n\nexport const pickComment =\n\t(authStatus: SignedInWithCookies | SignedInWithOkta) =>\n\tasync (commentId: string): Promise<Result<GetDiscussionError, true>> => {\n\t\tconst url =\n\t\t\tjoinUrl(options.baseUrl, 'comment', commentId, 'highlight') +\n\t\t\tobjAsParams(defaultParams);\n\n\t\tconst authOptions = getOptionsHeadersWithOkta(authStatus);\n\t\tconst jsonResult = await fetchJSON(url, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t\t...options.headers,\n\t\t\t\t...authOptions.headers,\n\t\t\t},\n\t\t\tcredentials: authOptions.credentials,\n\t\t});\n\n\t\tif (jsonResult.kind === 'error') return jsonResult;\n\n\t\tconst result = safeParse(pickResponseSchema, jsonResult.value);\n\n\t\tif (!result.success) return error('ParsingError');\n\n\t\treturn ok(true);\n\t};\n\nexport const unPickComment =\n\t(authStatus: SignedInWithCookies | SignedInWithOkta) =>\n\tasync (commentId: string): Promise<Result<GetDiscussionError, false>> => {\n\t\tconst url =\n\t\t\tjoinUrl(options.baseUrl, 'comment', commentId, 'unhighlight') +\n\t\t\tobjAsParams(defaultParams);\n\n\t\tconst authOptions = getOptionsHeadersWithOkta(authStatus);\n\t\tconst jsonResult = await fetchJSON(url, {\n\t\t\tmethod: 'POST',\n\t\t\theaders: {\n\t\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t\t\t...options.headers,\n\t\t\t\t...authOptions.headers,\n\t\t\t},\n\t\t\tcredentials: authOptions.credentials,\n\t\t});\n\n\t\tif (jsonResult.kind === 'error') return jsonResult;\n\n\t\tconst result = safeParse(pickResponseSchema, jsonResult.value);\n\n\t\tif (!result.success) return error('ParsingError');\n\n\t\treturn ok(false);\n\t};\n\nexport const getAllReplies = async (\n\tcommentId: string,\n): Promise<Result<GetDiscussionError, ReplyType[]>> => {\n\tconst url =\n\t\tjoinUrl(options.baseUrl, 'comment', commentId) +\n\t\tobjAsParams({\n\t\t\t...defaultParams,\n\t\t\t...{\n\t\t\t\tdisplayThreaded: true,\n\t\t\t\tdisplayResponses: true,\n\t\t\t},\n\t\t});\n\n\tconst jsonResult = await fetchJSON(url, {\n\t\theaders: {\n\t\t\t...options.headers,\n\t\t},\n\t});\n\n\tif (jsonResult.kind === 'error') return jsonResult;\n\n\treturn parseRepliesResponse(jsonResult.value);\n};\n\nconst buildParams = (filters: FilterOptions): URLSearchParams => {\n\treturn new URLSearchParams({\n\t\t// Frontend uses the 'recommendations' key to store this options but the api expects\n\t\t// 'mostRecommended' so we have to map here to support both\n\t\torderBy:\n\t\t\tfilters.orderBy === 'recommendations'\n\t\t\t\t? 'mostRecommended'\n\t\t\t\t: filters.orderBy,\n\t\tpageSize: String(filters.pageSize),\n\t\tdisplayThreaded: String(\n\t\t\tfilters.threads === 'collapsed' || filters.threads === 'expanded',\n\t\t),\n\t});\n};\n\nexport const getCommentContext = async (\n\tajaxUrl: string,\n\tcommentId: string,\n\tfilters: FilterOptions,\n): Promise<Result<GetDiscussionError, CommentContextType>> => {\n\tconst url = joinUrl(ajaxUrl, 'comment', commentId, 'context');\n\tconst params = buildParams(filters);\n\n\tconst jsonResult = await fetchJSON(url + '?' + params.toString());\n\n\tif (jsonResult.kind === 'error') return jsonResult;\n\n\tconst result = safeParse(getCommentContextResponseSchema, jsonResult.value);\n\n\tif (!result.success) {\n\t\treturn error('ParsingError');\n\t}\n\n\treturn ok(result.output);\n};\n","type Result<Err, Value> =\n\t| {\n\t\t\tkind: 'ok';\n\t\t\tvalue: Value;\n\t  }\n\t| {\n\t\t\tkind: 'error';\n\t\t\terror: Err;\n\t  };\n\nconst ok = <Err, Value>(value: Value): Result<Err, Value> => ({\n\tkind: 'ok',\n\tvalue,\n});\n\nconst error = <Err, Value>(err: Err): Result<Err, Value> => ({\n\tkind: 'error',\n\terror: err,\n});\n\nexport type { Result };\n\nexport { ok, error };\n"],"names":["orderByTypes","threadTypes","pageSizeTypes","DispatchContext","createContext","debug","DispatchProvider","value","children","Provider","formWrapper","css","schemedPalette","space","textSans12","labelColour","errorColour","buttonStyles","errorBorderColour","borderColour","inputWrapper","svgStyles","errorSvgStyles","AbuseReportForm","commentId","toggleSetShowForm","reportAbuse","modalRef","useRef","firstElement","lastElement","useEffect","current","querySelector","focus","document","addEventListener","e","contains","target","keyListener","code","shiftKey","activeElement","preventDefault","removeEventListener","formVariables","setFormVariables","useState","categoryId","reason","email","defaultErrorTexts","response","errors","setErrors","successMessage","setSuccessMessage","isReasonRequired","div","aria-modal","ref","form","onSubmit","event","then","kind","error","catch","log","Select","label","onChange","Number","theme","textLabel","textOptional","textError","borderError","undefined","Option","TextArea","id","size","optional","required","TextInput","type","Button","data-link-name","cssOverrides","InlineError","InlineSuccess","custom-guardian","iconSide","icon","SvgCross","onClick","hideLabel","imageStyles","Avatar","imageUrl","displayName","img","src","alt","staffBadge","iconStyles","labelText","textSansBold12","staffLabel","themePalette","guardianPickLabel","GuardianStaff","svg","width","height","viewBox","fill","path","d","p","GuardianContributor","GuardianPick","Column","rowStyles","Row","wrap","style","flexWrap","countStyles","recommended","isSignedIn","arrowStyles","RecommendationCount","initialCount","alreadyRecommended","user","userMadeComment","isClosedForRecommendations","count","setCount","setRecommended","button","newCount","onRecommend","accepted","disabled","aria-label","SvgArrowUpStraight","dateFormatter","dateString","date","Date","timeStampYesterday","Math","round","getTime","isLast24Hrs","timeAgo","verbose","daysUntilAbsolute","getMonthString","getDate","month","getMonth","getFullYear","String","getHours","getMinutes","padStart","linkStyles","timeStyles","Timestamp","isoDateTime","webUrl","onPermalinkClick","setTimeAgo","callback","delay","savedCallback","setInterval","currentCallback","clearInterval","useInterval","a","href","rel","time","dateTime","toString","commentControlsLink","textSansBold15","spaceBetween","commentCss","textSans15","remSpace","blockedCommentStyles","commentLinkStyling","commentWrapper","selectedStyles","avatarMargin","until","mobileLandscape","colourStyles","boldFont","regularFont","svgReplyArrow","commentDetails","headerStyles","iconWrapper","timestampWrapperStyles","hideBelowMobileLandscape","hideAboveMobileLandscape","from","negativeMargin","cssTextOverflowElip","cssReplyToWrapper","buttonLinkPillarBaseStyles","buttonLinkBaseStyles","subdued","cssReplyAlphaDisplayName","cssReplyBetaDisplayName","spacedColumnStyles","Space","amount","Comment","comment","isClosedForComments","setCommentBeingRepliedTo","isReply","wasScrolledTo","isMuted","toggleMuteStatus","isExpanded","isHighlighted","setIsHighlighted","showAbuseReportForm","setAbuseReportForm","pickError","setPickError","showStaffBadge","userProfile","badge","some","obj","showPickBadge","status","showContributorBadge","span","data-testid","avatar","header","responseTo","Link","SvgIndent","numRecommends","profile","userId","priority","dangerouslySetInnerHTML","__html","body","createAuthenticationEventParams","async","staffUser","onUnpick","unPick","onPick","pick","buttonOverrides","PillarButton","linkName","previewStyle","spout","Preview","previewHtml","showSpout","textStyling","Text","inputLabelStyles","textInputStyles","h3Style","headlineBold20","FirstCommentWelcome","submitForm","cancelSubmit","previewBody","renderingTarget","useConfig","userName","setUserName","h3","supporting","boldString","str","italicsString","strikethroughString","codeString","quoteString","commentTextArea","greyPlaceholder","blackPlaceholder","headerTextStyles","wrapperHeaderTextStyles","commentAddOns","preModMessage","preModLink","bottomContainer","wide","CommentForm","shortUrl","onAddComment","commentBeingRepliedTo","onPreview","setError","userNameMissing","setUserNameMissing","setPreviewBody","isActive","setIsActive","isDisabled","setIsDisabled","selectionStart","setSelectionStart","selectionEnd","setSelectionEnd","textValue","setTextValue","setBody","getElementById","scrollIntoView","getHighlightedString","startString","substring","highlightedString","endString","length","transformText","transfromFunc","textAreaStrings","concat","resetForm","onReply","onComment","commentError","handleError","toISOString","apiUrl","commentApiUrl","commentWebUrl","simulateNewReply","responses","simulateNewComment","addUsername","privateFields","isPremoderated","InfoSummary","message","context","placeholder","onFocus","onSelect","preview","defaultPreview","fontWeight","title","fontStyle","textDecoration","fontFamily","url","prompt","highlightedText","linkStringFunc","transformLink","trim","indentStyles","smallFontStyles","replyPreviewHeaderStyle","arrowSize","commentStyles","blueLink","CommentReplyPreview","displayReplyComment","setDisplayReplyComment","nestingStyles","topBorder","commentContainerStyles","removeMargin","CommentContainer","threads","commentToScrollTo","mutes","expandCommentReplies","totalResponseCount","metaData","responseCount","expanded","loading","setLoading","showResponses","includes","ul","map","responseComment","li","SvgPlus","expand","getAllReplies","result","console","finally","remainingResponses","decideShowMoreText","find","onAddReply","containerStyles","ulStyles","tablet","ulExpanded","firstStyles","activeStyles","expandedStyles","labelStyles","Dropdown","options","setIsExpanded","dismissOnEsc","dismissOnClick","stopPropagation","dropdownID","activeLink","option","aria-controls","aria-expanded","index","filterBar","dividerStyles","filterPadding","Filters","filters","onFilterChange","topLevelCommentCount","orderBy","pageSize","parseInt","BACKGROUND_COLOUR","shimmer","keyframes","shimmerStyles","Grey","spaceBelow","spaceLeft","isUndefined","isNaN","LoadingComments","pageButtonStyles","isSelected","borderTertiary","backgroundTertiaryHover","textTertiary","ellipsisStyles","wrapperStyles","paginationButtons","paginationText","Forward","currentPage","setCurrentPage","SvgChevronRightSingle","Back","SvgChevronLeftSingle","PageButton","getPages","totalPages","filter","page","Pagination","ceil","showBackButton","showForwardButton","startIndex","endIndex","min","pickStyles","userNameStyles","smallFontSize","jumpToLinkStyles","inCommentLinkStyling","titleStyles","inheritColour","wrapStyles","PickBubble","Top","Bottom","PickMeta","TopPick","input","substr","columWrapperStyles","paddingRight","paddingLeft","picksWrapper","twoColCommentsStyles","oneColCommentsStyles","TopPicks","comments","leftColComments","rightColComments","entries","push","footerStyles","commentColumnWrapperStyles","NoComments","dispatchCommentsStateChange","dispatchEvent","CustomEvent","Comments","baseUrl","additionalHeaders","apiKey","idApiUrl","topForm","replyForm","bottomForm","picks","setPicks","setMutes","storage","local","get","Array","isArray","every","isString","readMutes","isWeb","dispatch","useContext","handleFilterChange","newFilters","newPage","commentPage","setReplyFormUserMissing","setReplyFormError","setReplyFormPreviewBody","getPicks","newFilterObject","maxPagePossible","element","set","writeMutes","updatedMutes","addComment","addReply","commentElement","onPageChange","pageNumber","initialiseApi","showPagination","data-component","data-commercial-id","footer","slice","overlayStyles","fixHeight","positionRelative","remapToValidFilters","hashCommentId","replaceMatchingCommentResponses","action","initialCommentFormState","showPreview","initialState","isClosedForRecommendation","commentCount","isOneOf","getThreadType","getPageSizeType","initFiltersFromLocalStorage","reducer","state","assertUnreachable","Discussion","discussionApiUrl","shortUrlId","discussionD2Uid","discussionApiClientHeader","enableDiscussionSwitch","reportAbuseUnauthenticated","useReducer","newHashCommentId","hash","window","location","split","commentIdFromUrl","controller","AbortController","getDiscussion","signal","discussion","abort","validFilters","rememberFilters","getCommentContext","Hide","when","breakpoint","SignedInAs","whenToHide","el","Error","object","string","secureAvatarUrl","array","name","canPostComment","boolean","hasCommented","parseUserProfile","data","safeParse","literal","success","ok","output","baseCommentSchema","transform","union","number","numResponses","key","staffCommenterCount","editorsPickCount","blockedCount","replySchema","merge","undefined_","commentSchema","commentRepliesResponseSchema","variant","parseRepliesResponse","commentResponseSchema","errorCode","picklist","parseCommentResponse","abuseResponseSchema","parseAbuseResponse","postUsernameResponseSchema","minLength","discussionApiErrorSchema","statusCode","discussionApiSuccessSchema","pages","isThreaded","discussionApiResponseSchema","pickResponseSchema","recommendResponseSchema","parseRecommendResponse","getCommentContextResponseSchema","commentAncestorId","discussionKey","discussionWebUrl","fetchJSON","args","fetch","json","err","SyntaxError","headers","defaultParams","objAsParams","Object","keys","join","apiOpts","displayThreaded","maxResponses","params","joinUrl","jsonResult","aborted","URLSearchParams","append","method","isObject","commentBody","authStatus","authOptions","getOptionsHeadersWithOkta","credentials","reply","parentCommentId","recommend","addUserName","JSON","stringify","publicFields","username","pickComment","unPickComment","displayResponses","ajaxUrl","buildParams"],"sourceRoot":""}